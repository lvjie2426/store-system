<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <title>销售开单-主页</title>
    <!-- bootstrap样式开始 -->
    <link href="../resource/css/bootstrap.min.css" rel="stylesheet">
    <link href="../resource/js/plugins/bootstarp-table/css/bootstrap-table.min.css" rel="stylesheet">
    <link href="../resource/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
    <!-- bootstrap样式结束 -->
    <!--时间插件引用的css-->
    <link href="../resource/css/yanjing/mobiscroll.2.13.2.css" rel="stylesheet">
    <link href="../resource/css/yanjing/myDate.css" rel="stylesheet">
    <!--时间插件引用的css结束-->
    <!-- layui样式 -->
    <link rel="stylesheet" href="../resource/layui/css/layui.css">
    <!-- 字体图标 -->
    <link rel="stylesheet" href="../resource/fonts/iconfont.css">
    <!-- 清除默认样式 -->
    <link rel="stylesheet" href="../resource/css/style.css">
    <link rel="stylesheet" href="../resource/css/reset.css">
    <!-- 公共样式 -->
    <link href="../resource/css/common.css" rel="stylesheet">
    <!-- 当前页面样式 -->
    <link rel="stylesheet" href="../resource/css/yanjing/salesOrder.css">
    <style>
        .dwhl:nth-child(2) {
            display: none;
        }

        .show {
            display: block !important;
        }

        .dw-bubble-bottom,
        .dw-bubble-top {
            border-right: 1px solid #e2e2e2;
            margin-left: -45px;
            box-shadow: 1px 3px 10px #e2e2e2;
        }

        .dw-bubble-top {
            margin-top: 255px !important;
        }

        .dwbw.dwb-n {
            display: none;
        }
        .orderProvisional .select-box-header span {
            max-width: 94%;
        }
    </style>
</head>

<body>
    <!-- 当前页面头部 -->
    <div class="headerBox clearfix">
        <i class="ruku" style="background: url(../resource/img/ruku.jpg)no-repeat;background-size: 100% 100%;"></i>
        <h3>销售开单</h3>
        <span class="text">*为选填信息</span>
        <div class="rightBox">
            <div class="orderProvisional">
                <div class="selectBox" id="selectBox">
                    <div class="select-box-header">
                        <span class="text">临时订单</span> <i class="iconfont icon-ico_arrow_down" id="jt"></i>
                    </div>
                    <div class="optionBox">
                        <ul class="optionUL" id="proOrderList">
                        </ul>
                    </div>
                </div>

            </div>
            <button class="btn intention" onclick="intentionCustomers()">意向顾客</button>
        </div>
    </div>
    <!-- 页面内容外层盒子 -->
    <div class="main">
        <!-- 顾客信息 -->
        <div class="mainCustomerInfo" id="mainCustomerInfo">
            <div class="titleBox clearfix">
                <h4>顾客信息</h4>
                <div class="telephoneNumBox">
                    <div class="searchTypeBox">
                        <div class="selectBox" id="searchTypeBox">
                            <div class="select-box-header">
                                <span class="text">手机号</span> <i class="iconfont icon-ico_arrow_down"></i>
                            </div>
                            <div class="optionBox">
                                <ul class="optionUL" id="shopPhoneList">
                                    <li value="1">手机号</li>
                                    <li value="2">会员卡号</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <input id="searchPhoneUser" type="text" placeholder="搜索手机号">
                    <div class="btn btn-info" style="margin-left: 10px;" onclick="searchCus()">搜索</div>
                </div>
            </div>
            <div class="contentBox">
                <h4>基本信息</h4>
                <div class="fromInfo">
                    <form class="layui-form" action="">
                        <div class="layui-form-item nameInput">
                            <div class="layui-input-block">
                                <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="姓名" id="cusInfoName"
                                    class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item phoneNum">
                            <div class="layui-input-block">
                                <input type="number" name="title" lay-verify="title" autocomplete="off" placeholder="手机号码" id="cusInfoPhone"
                                    class="layui-input">
                            </div>
                        </div>

                        <div class="benderBox" id="cusInfoSex">
                            <span class="active" data-value="1">男</span>
                            <span data-value="2">女</span>
                        </div>
                        <div class="dateBox" style="position: relative;height: 50px;">
                            <div class="setting" style="display:none;">
                                <select name="demo" id="demo">
                                    <option value="date">日期</option>
                                </select>
                            </div>
                            <input name="test" id="tests"
                                class="demo-test-date demo-test-datetime demo-test-time demo-test-credit"
                                placeholder="出生日期" data-type="day" />

                        </div>
                        <div class="layui-form-item ageNum">
                            <div class="layui-input-block">
                                <input id="autoAge" type="text" name="title" lay-verify="title" autocomplete="off"
                                    placeholder="年龄（自动）" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item phoneNum">
                            <div class="layui-input-block">
                                <input id="cusJob" type="text" name="title" lay-verify="title" autocomplete="off" placeholder="职业" class="layui-input">
                            </div>
                        </div>
<!--
                        <div class="occupationTypeBox">
                            <div class="selectBox" id="occupationTypeBox">
                                <div class="select-box-header">
                                    <span class="text">职业</span> <i class="iconfont icon-ico_arrow_down" id="jt"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL" id="shopOccupationList">
                                    </ul>
                                </div>
                            </div>
                        </div>
-->
                        <div class="recommenderBox" id="cusInfoReferrer">
                            <span class="tuiJianRen">推荐人</span>
                            <div class="selectBox" id="recommenderBox">
                                <div class="select-box-header">
                                    <span class="text">推荐人</span> <i class="iconfont icon-ico_arrow_down" id="jt"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL" id="referer">
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="footerBox registerNo">
                <div class="memberInfo  noRegister" style="display: block;">
                    <h4>会员信息</h4>
                    <button class="btn btn-order registerMember noRegisterZC" onclick="regMember()">注册成为会员</button>
                    <div style="color: #828297;margin-top: 16px;">暂无</div>
                </div>
                <div class="memberInfo  noRegisterWx" style="display: none">

                    <span class="weiyanzheng">
                        <h4>会员信息</h4>
                        <button class="btn btn-order registerMember" onclick="openVerify()">点击验证</button>
                        <span class="wxNoBind">未绑定微信</span>
                    </span>
                    <span class="yiyanzheng">
                        <h4>会员信息</h4>
                        <span class="registerMember active">已验证</span>
                        <button class="btn btn-order registerMember">储值卡充值</button>
                        <span class="wxNoBind active">已绑定微信</span>
                    </span>

                    <div class="textInfoBox">
                        <div class="textInfo">
                            <span class="mem-tag">卡号</span>
                            <em class="member-text" id="memcard-num"></em>
                        </div>
                        <div class="textInfo">
                            <span class="mem-tag">等级</span>
                            <em class="member-text" id="mem-grade"></em>
                        </div>
                        <div class="textInfo">
                            <span class="mem-tag">储值金额</span>
                            <em class="member-text" id="mem-money"></em>
                        </div>
                        <div class="textInfo">
                            <span class="mem-tag">积分</span>
                            <em class="member-text" id="mem-integral"></em>
                        </div>
                        <div class="textInfo">
                            <span class="mem-tag">上次消费</span>
                            <em class="member-text" id="last-contime">2018.06.17</em>
                        </div>
                        <div class="textInfo">
                            <span class="mem-tag">消费次数</span>
                            <em class="member-text" id="con-num"></em>
                        </div>
                        <div class="textInfo">
                            <span class="mem-tag">推荐人</span>
                            <em class="mem-text" id="tname"></em> · <b id="tphone"></b>
                        </div>
                    </div>
                </div>
                <div class="memberInfo  yesRegister" style="display: none">
                    <h4>会员信息</h4>
                    <div class="textInfoBox">
                        <div class="textInfo">
                            <span>卡号</span>
                            2938467713
                        </div>
                        <div class="textInfo">
                            <span>等级</span>
                            黄金会员
                        </div>
                        <div class="textInfo">
                            <span>储值金额</span>
                            1998元
                        </div>
                        <div class="textInfo">
                            <span>积分</span>
                            299分
                        </div>
                        <div class="textInfo">
                            <span>上次消费</span>
                            2018.06.17
                        </div>
                        <div class="textInfo">
                            <span>消费次数</span>
                            1次
                        </div>
                        <div class="textInfo">
                            <span>推荐人</span>
                            邓泽宇 · <b>18850918273</b>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <!-- 验光信息 -->
        <div class="optometryInfo">
            <div class="titleBox clearfix">
                <h4>验光信息</h4>
                <div class="selectBox" id="optometrySelect">
                    <div class="select-box-header">
                        <span class="text">更多信息</span> <i class="iconfont icon-ico_arrow_down" id="jt"></i>
                    </div>
                    <div class="optionBox">
                        <ul class="optionUL" id="moreYgList">
                        </ul>
                    </div>
                </div>
                <div class="tagDateBox">
                    <ul class="tab-ul" id="tagDataBox">
                        <li class="active">本次</li>
                    </ul>
                </div>
            </div>
            <div class="contentBox clearfix">
                <div class="leftBox">
                    <h4>验光师</h4>
                    <div class="dateNameInfo">
                        <div class="selectBox" id="optometristName">
                            <div class="select-box-header">
                                <span class="text"></span> <i class="iconfont icon-ico_arrow_down" id="jt"></i>
                            </div>
                            <div class="optionBox">
                                <ul class="optionUL" id="optometristList">
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="dateBox">
                        <div class="settings2" style="display:none;">
                            <select name="demo" id="demo2">
                                <option value="date">日期</option>
                            </select>
                        </div>
                        <input name="test" id="tests2"
                            class="demo-test-date demo-test-datetime demo-test-time demo-test-credit" placeholder="验光时间"
                            data-type='time' />
                    </div>
                    <h4 class="mt15">验光备注</h4>
                    <textarea name="备注" id="optometryRemarks" cols="30" rows="10"
                        style="resize:none"></textarea>
                </div>
                <div class="rightBox">
                    <div class="tagBox">
                        <ul class="tab-ul" id="ygType">
                            <li class="active">远用</li>
                            <li>隐形</li>
                            <li>近用</li>
                            <li>渐进多焦点</li>
                        </ul>
                        <div class="btnBox">
                            <button class="btnEmpty" type="button" onclick="clearYgInfo()">清空</button>
                            <button class="btnPreservation" type="button" onclick="saveYgInfo()">保存</button>
                        </div>
                    </div>
                    <div class="visionForm">
                        <div class="formLeftBorder"></div>
                        <div class="tableContent" id="tableContent">

                        </div>
                        <div class="formRightBorder"></div>
                    </div>

                    <div class="rightFooterBox clearfix">
                        <div class="degreesBox">
                            <div class="companyBox">
                                <input type="number" class="text" placeholder="远用瞳距">
                                <span class="Company">mm</span>
                            </div>
                            <div class="selectBox" id="eye">
                                <div class="select-box-header">
                                    <span class="text">右眼</span> <i class="iconfont icon-ico_arrow_down" id="jt"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL" style="overflow: hidden;">
                                        <li value="01">左眼</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="selectBox" id="glasses">
                                <div class="select-box-header">
                                    <span class="text">近视眼镜</span> <i class="iconfont icon-ico_arrow_down" id="jt"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL" style="overflow: hidden;">
                                        <li value="1">近视眼镜</li>
                                        <li value="2">远视眼镜</li>
                                        <li value="3">隐形眼镜</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="resultInfoBox">
                            <div class="selectBox" id="proposal">
                                <div class="select-box-header">
                                    <span class="text"></span> <i class="iconfont icon-ico_arrow_down" id="jt"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL" id="proposalList" style="overflow: hidden;">
                                    </ul>
                                </div>
                            </div>
                            <div class="selectBox" id="result">
                                <div class="select-box-header">
                                    <span class="text"></span> <i class="iconfont icon-ico_arrow_down" id="jt"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL" style="overflow: hidden;" id="resultList">

                                    </ul>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!-- 订单信息 -->
        <div class="orderInfo">
            <div class="titleBox clearfix">
                <h4>订单信息</h4>
                <div class="btnBox">
                    <button class="btn addRoutineCommodity" onclick="addPro(0)">添加常规商品</button>
                    <button class="btn addIntegralCommodity" onclick="addPro(1)">添加积分商品</button>
                    <!--<button class="btn seeHistoryOrder" onclick="hisOrder()">历史订单记录</button>-->
                </div>
            </div>
            <div class="contentBox clearfix">
                <div class="leftBox">
                    <div class="saleMachiningPeople">
                        <div class="saleBox">
                            <h4>销售员</h4>
                            <div class="selectBox" id="salePeople">
                                <div class="select-box-header">
                                    <span class="text"></span> <i class="iconfont icon-ico_arrow_down" id="jt"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL" id="saleUl" style="overflow: hidden;">
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="machiningBox">
                            <h4>加工师</h4>
                            <div class="selectBox" id="machiningPeople">
                                <div class="select-box-header">
                                    <span class="text"></span> <i class="iconfont icon-ico_arrow_down" id="jt"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL" style="overflow: hidden;" id="processUl">
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="costAdditional mt15">
                        <div class="costAdditionalSelect">
                            <h4>附加费用</h4>
                            <div class="selectBox" id="costAdditional">
                                <div class="select-box-header">
                                    <span class="text">加工费</span> <i class="iconfont icon-ico_arrow_down" id="jt"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL" style="overflow: hidden;" id="listExtraCharge">
                                        <li value="1">加工费</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <input type="number" class="moneyNum" id="extraCharges" placeholder="金额">
                        <button class="addOrder" style="padding: 7px 10px;" onclick="extraCharges()">添加</button>
                    </div>
                    <div class="promotionBox mt15">
                        <h4>促销方式</h4>
                        <div class="selectBox" id="promotion">
                            <div class="select-box-header">
                                <span class="text">促销方式</span> <i class="iconfont icon-ico_arrow_down"></i>
                            </div>
                            <div class="optionBox">
                                <ul class="optionUL" style="overflow: hidden;" id="ListPromotions">
                                </ul>
                            </div>
                        </div>
                    </div>
                    <h4 class="mt15">订单备注</h4>
                    <textarea name="备注" id="optometryRemarks2" cols="30" rows="10" style="resize:none">神秘顾客</textarea>
                </div>
                <div class="rightBox" id="orderForm">
                </div>
            </div>
        </div>
    </div>
    <!-- 固定底部 -->
    <div class="winFooterBox">
        <button class="btnSubmission" onclick="saveOrder(true)">提交订单</button>
        <button class="btnPreservation" onclick="saveOrder()">保存订单</button>
    </div>


    <!-- 弹窗结构 -->
    <div id="salesOrder">
        <!-- 注册成为会员弹窗 -->
        <div class="register-member">
            <div class="content">
                <ul class="input-list">
                    <li class="input-item">
                        <input type="number" class="member-input" placeholder="手机号" id="reg-phoneNum">
                    </li>
                    <li class="input-item two">
                        <input type="number" class="member-input" placeholder="输入验证码" id="reg-code">
                        <span class="send-code" id="sendSmsText" onclick="getSms()">发送短信验证码</span>
                    </li>
                    <!--<li class="input-item">
                        <input type="text" class="member-input" placeholder="搜索推荐人">
                    </li>-->
                </ul>
            </div>
        </div>
        <!-- 验证会员弹窗 -->
        <div class="verify">
            <div class="content">
                <ul class="input-list">
                    <li class="input-item">
                        <input type="number" class="member-input" placeholder="18728389182">
                    </li>
                    <li class="input-item two">
                        <input type="number" class="member-input" placeholder="输入验证码">
                        <span class="send-code">发送验证码</span>
                    </li>
                    <li class="input-item or-item">
                        <i></i>
                        <span>或者</span>
                        <i></i>
                    </li>
                    <li class="input-item">
                        <input type="text" placeholder="扫描微信ID二维码" class="member-input">
                    </li>
                </ul>
            </div>
        </div>
        <!-- 存储卡充值弹窗 -->
        <div class="card-pay">
            <div class="content">
                <ul class="input-list">
                    <li class="input-item">
                        <input type="number" class="member-input" placeholder="充值金额">
                    </li>
                    <li class="input-item">
                        <form class="layui-form cckXK">
                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <input type="checkbox" value="本次活动期间，充3送1" name="like1[write]" lay-skin="primary"
                                        lay-filter="shop" title="本次活动期间，充3送1">
                                    <div class="layui-unselect layui-form-checkbox" lay-skin="primary">
                                        <span>本次活动期间，充3送1</span><i class="layui-icon layui-icon-ok"></i></div>
                                </div>
                            </div>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
        <!-- 定制商品弹窗 -->
        <div class="popupCustomized">
            <div class="tagBox">
                <ul class="tab-ul">
                    <li class="active">镜片</li>
                    <li>镜架</li>
                    <li>隐形眼镜</li>
                    <li>太阳镜</li>
                </ul>
            </div>
            <div class="popMainContent">
                <div class="content boxLens">
                    <div class="mb10 brandSeries clearfix">
                        <div class="brand">
                            <h4>品牌</h4>
                            <div class="selectBox brandSelect">
                                <div class="select-box-header">
                                    <span class="text">品牌</span>
                                    <i class="iconfont icon-ico_arrow_down"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL">
                                        <li value="01">1</li>
                                        <li value="02">2</li>
                                        <li value="03">3</li>
                                        <li value="04">4</li>
                                        <li value="05">5</li>
                                    </ul>
                                    <div class="zi_dingyi">
                                        <span class="zdy_pingpai">自定义品牌</span>
                                        <div class="zi_dingyi_input_Box">
                                            <input type="text" placeholder="品牌" class="zi_dingyi_input">
                                            <div class="btn_conten">确定</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="series">
                            <h4>系列</h4>
                            <div class="selectBox seriesSelect">
                                <div class="select-box-header">
                                    <span class="text">品牌</span> <i class="iconfont icon-ico_arrow_down"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL">
                                        <li value="01">1</li>
                                        <li value="02">2</li>
                                        <li value="03">3</li>
                                        <li value="04">4</li>
                                        <li value="05">5</li>
                                    </ul>
                                    <div class="zi_dingyi">
                                        <span class="zdy_pingpai">自定义品牌</span>
                                        <div class="zi_dingyi_input_Box">
                                            <input type="text" placeholder="品牌" class="zi_dingyi_input">
                                            <div class="btn_conten">确定</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb10 rightEyeCustomized eyeCustomized">
                        <h4>右眼定制数量</h4>
                        <div class="reNum clearfix">
                            <input type="number" class='totalPrice num' placeholder="数量">
                            <div class="reMoney">
                                <span>￥</span>
                                <input type="number" class="totalPrice numMoney" placeholder="单价">
                            </div>
                        </div>
                    </div>
                    <div class="mb10 leftEyeCustomized eyeCustomized">
                        <h4>左眼定制数量</h4>
                        <div class="reNum clearfix">
                            <input type="number" class='totalPrice num' placeholder="数量">
                            <div class="reMoney">
                                <span>￥</span>
                                <input type="number" class="totalPrice numMoney" placeholder="单价">
                            </div>
                        </div>
                    </div>
                    <div class="eyeDegrees">
                        <div class="leftDegrees">
                            <span>右</span>
                            <b>S：-3.50</b>
                        </div>
                        <div class="rightDegrees">
                            <span>左</span>
                            <b>S：-4.00</b>
                            <b>C：-0.50</b>
                        </div>
                    </div>
                </div>
                <div class="content boxEyeRack ">
                    <div class="mb10 brandSeries clearfix">
                        <div class="brand">
                            <h4>品牌</h4>
                            <div class="selectBox brandSelect">
                                <div class="select-box-header">
                                    <span class="text">品牌</span>
                                    <i class="iconfont icon-ico_arrow_down"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL">
                                        <li value="01">1</li>
                                        <li value="02">2</li>
                                        <li value="03">3</li>
                                        <li value="04">4</li>
                                        <li value="05">5</li>
                                    </ul>
                                    <div class="zi_dingyi">
                                        <span class="zdy_pingpai">自定义品牌</span>
                                        <div class="zi_dingyi_input_Box">
                                            <input type="text" placeholder="品牌" class="zi_dingyi_input">
                                            <div class="btn_conten">确定</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="series">
                            <h4>系列</h4>
                            <div class="selectBox seriesSelect">
                                <div class="select-box-header">
                                    <span class="text">品牌</span> <i class="iconfont icon-ico_arrow_down"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL">
                                        <li value="01">1</li>
                                        <li value="02">2</li>
                                        <li value="03">3</li>
                                        <li value="04">4</li>
                                        <li value="05">5</li>
                                    </ul>
                                    <div class="zi_dingyi">
                                        <span class="zdy_pingpai">自定义品牌</span>
                                        <div class="zi_dingyi_input_Box">
                                            <input type="text" placeholder="品牌" class="zi_dingyi_input">
                                            <div class="btn_conten">确定</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb10 colorModel eyeCustomized clearfix">
                        <div class="model">
                            <h4>型号</h4>
                            <input type="text" placeholder="型号">
                        </div>
                        <div class="colorNum">
                            <h4>色号</h4>
                            <input type="text" placeholder="色号">
                        </div>
                    </div>
                    <div class="mb10 eyeCustomizedNum eyeCustomized">
                        <h4>定制数量</h4>
                        <div class="reNum clearfix">
                            <input type="number" class='totalPrice num' placeholder="数量">
                            <div class="reMoney">
                                <span>￥</span>
                                <input type="number" class="totalPrice numMoney" placeholder="单价">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="content boxInvisibleEye ">
                    <div class="mb10 brandSeries clearfix">
                        <div class="brand">
                            <h4>品牌</h4>
                            <div class="selectBox brandSelect">
                                <div class="select-box-header">
                                    <span class="text">品牌</span>
                                    <i class="iconfont icon-ico_arrow_down"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL">
                                        <li value="01">1</li>
                                        <li value="02">2</li>
                                        <li value="03">3</li>
                                        <li value="04">4</li>
                                        <li value="05">5</li>
                                    </ul>
                                    <div class="zi_dingyi">
                                        <span class="zdy_pingpai">自定义品牌</span>
                                        <div class="zi_dingyi_input_Box">
                                            <input type="text" placeholder="品牌" class="zi_dingyi_input">
                                            <div class="btn_conten">确定</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="series">
                            <h4>系列</h4>
                            <div class="selectBox seriesSelect">
                                <div class="select-box-header">
                                    <span class="text">品牌</span> <i class="iconfont icon-ico_arrow_down"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL">
                                        <li value="01">1</li>
                                        <li value="02">2</li>
                                        <li value="03">3</li>
                                        <li value="04">4</li>
                                        <li value="05">5</li>
                                    </ul>
                                    <div class="zi_dingyi">
                                        <span class="zdy_pingpai">自定义品牌</span>
                                        <div class="zi_dingyi_input_Box">
                                            <input type="text" placeholder="品牌" class="zi_dingyi_input">
                                            <div class="btn_conten">确定</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb10 cycle">
                        <h4>周期</h4>
                        <div class="selectBox cycleSelect">
                            <div class="select-box-header">
                                <span class="text">周期</span>
                                <i class="iconfont icon-ico_arrow_down"></i>
                            </div>
                            <div class="optionBox">
                                <ul class="optionUL">
                                    <li value="01">1</li>
                                    <li value="02">2</li>
                                    <li value="03">3</li>
                                    <li value="04">4</li>
                                    <li value="05">5</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="mb10 rightEyeCustomized eyeCustomized">
                        <h4>右眼定制数量</h4>
                        <div class="reNum clearfix">
                            <input type="text" class='totalPrice num' placeholder="数量">
                            <div class="reMoney">
                                <span>￥</span>
                                <input type="text" class="totalPrice numMoney" placeholder="单价">
                            </div>
                        </div>
                    </div>
                    <div class="mb10 leftEyeCustomized eyeCustomized">
                        <h4>左眼定制数量</h4>
                        <div class="reNum clearfix">
                            <input type="text" class='totalPrice num' placeholder="数量">
                            <div class="reMoney">
                                <span>￥</span>
                                <input type="text" class="totalPrice numMoney" placeholder="单价">
                            </div>
                        </div>
                    </div>
                    <div class="eyeDegrees">
                        <div class="leftDegrees">
                            <span>右</span>
                            <b>S：-3.50</b>
                        </div>
                        <div class="rightDegrees">
                            <span>左</span>
                            <b>S：-4.00</b>
                            <b>C：-0.50</b>
                        </div>
                    </div>
                </div>
                <div class="content boxSunglasses ">
                    <div class="mb10 brandSeries clearfix">
                        <div class="brand">
                            <h4>品牌</h4>
                            <div class="selectBox brandSelect">
                                <div class="select-box-header">
                                    <span class="text">品牌</span>
                                    <i class="iconfont icon-ico_arrow_down"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL">
                                        <li value="01">1</li>
                                        <li value="02">2</li>
                                        <li value="03">3</li>
                                        <li value="04">4</li>
                                        <li value="05">5</li>
                                    </ul>
                                    <div class="zi_dingyi">
                                        <span class="zdy_pingpai">自定义品牌</span>
                                        <div class="zi_dingyi_input_Box">
                                            <input type="text" placeholder="品牌" class="zi_dingyi_input">
                                            <div class="btn_conten">确定</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="series">
                            <h4>系列</h4>
                            <div class="selectBox seriesSelect">
                                <div class="select-box-header">
                                    <span class="text">品牌</span> <i class="iconfont icon-ico_arrow_down"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL">
                                        <li value="01">1</li>
                                        <li value="02">2</li>
                                        <li value="03">3</li>
                                        <li value="04">4</li>
                                        <li value="05">5</li>
                                    </ul>
                                    <div class="zi_dingyi">
                                        <span class="zdy_pingpai">自定义品牌</span>
                                        <div class="zi_dingyi_input_Box">
                                            <input type="text" placeholder="品牌" class="zi_dingyi_input">
                                            <div class="btn_conten">确定</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb10 colorModel eyeCustomized clearfix">
                        <div class="model">
                            <h4>型号/色号</h4>
                            <input type="text" placeholder="型号">
                        </div>
                    </div>
                    <div class="mb10 eyeCustomizedNum eyeCustomized">
                        <h4>定制数量</h4>
                        <div class="reNum clearfix">
                            <input type="text" class='totalPrice num' placeholder="数量">
                            <div class="reMoney">
                                <span>￥</span>
                                <input type="text" class="totalPrice numMoney" placeholder="单价">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!-- 历史消费记录弹窗 -->
        <div class="historyRecord">
            <div class="content">
                <table border="0" cellpadding="0" cellspacing="0" data-toggle="table"
                    class="cmMain-table1 table table-border" id="cmMain-table1"></table>
            </div>
        </div>
        <!-- 添加积分商品 -->
        <div class="branchCommodity">
            <div class="bcHeader clearfix">
                <h3>添加积分商品</h3>
                <input type="text" class="seachInput" placeholder="搜索商品名称">
                <div class="selectBox branchCommoditySelect">
                    <div class="select-box-header">
                        <span class="text">商品名称</span>
                        <i class="iconfont icon-ico_arrow_down"></i>
                    </div>
                    <div class="optionBox">
                        <ul class="optionUL">
                            <li value="01">1</li>
                            <li value="02">2</li>
                            <li value="03">3</li>
                            <li value="04">4</li>
                            <li value="05">5</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="content">
                <table border="0" cellpadding="0" cellspacing="0" data-toggle="table"
                    class="cmMain-table2 table table-border"></table>
            </div>
        </div>
        <!-- 添加常规商品 （SPU） -->
        <div class="addRoutineCommodityPop">
            <div class="routineHeader clearfix">
                <h3>选择商品</h3>
                <input type="text" class="seachRoutine" placeholder="搜索系列...">
            </div>
            <div class="content">
                <div class="recommendList">
                    <h4><i class="iconfont icon-ico_fire_filled"></i>日常使用TOP</h4>
                    <ul class="recommendUL">
                        <!--<li><input type="button" value="明月2018新款 X2478874437" class="btn-blue"></li>
                        <li><input type="button" value="明月限量款 C24黑色" class="btn-red"></li>
                        <li><input type="button" value="暴龙复仇者联盟特…哈哈" class="btn-green"></li>
                        <li><input type="button" value="明月2018新款 C24…" class="btn-blue"></li>-->
                    </ul>
                </div>
                <div class="dataListForm">
                    <ul class="tab-ul" id="listClass">
                    </ul>
                    <div class="brandTabBox">
                        <div class="brandRightTab">
                            <ul id="listBrand">
                            </ul>
                        </div>
                        <div class="formBox">
                            <table border="0" cellpadding="0" cellspacing="0" data-toggle="table" data-height="432px"
                                   class="cmMain-table3 table table-border" id="spuTable"></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 添加常规商品 （SKU） -->
        <div class="addRoutineCommodityPro">
            <div class="content">
                <table border="0" cellpadding="0" cellspacing="0" data-toggle="table" data-height="432px" class="cmMain-table3 table table-border" id="skuTable"></table>
            </div>
        </div>
        <!-- 意向客户 -->
        <div class="intentionalCustomer">
            <div class="content">
                <table border="0" cellpadding="0" cellspacing="0" data-toggle="table"
                    class="cmMain-table4 table table-border" id="JFProTable"></table>
            </div>
        </div>
        <!-- 付款结算横向小票 -->
        <div class="uncollectedFunds uncollectedFundsPop">
            <h3 class="title">付款结算</h3>
            <div class="ufHeader">
                <ul>
                    <li>原价共计 <span>￥55</span></li>
                    <li>折后金额 <span>￥47.5</span></li>
                    <li>特惠减免 <span>-￥10</span></li>
                    <li>实收金额 <span>￥37.5</span></li>
                </ul>
            </div>
            <div style="width: 100%;padding: 10px 16px;">
                <div class="content">
                    <div class="conTitle">
                        <h4>结算清单</h4>
                        <span>未收金额：<i>￥7.5</i></span>
                    </div>
                    <div class="formBox">
                        <ul>
                            <li>
                                <div class="topic">支付宝</div>
                                <div class="valueBox btnBlue">
                                    <span id="topicZFB">点击支付</span>
                                </div>
                            </li>
                            <li>
                                <div class="topic">微信</div>
                                <div class="valueBox btnBlue">
                                    <span id="topicWX">点击支付</span>
                                </div>
                            </li>
                            <li>
                                <div class="topic">微信</div>
                                <div class="valueBox"><input type="text" placeholder="输入"></div>
                            </li>
                            <li>
                                <div class="topic">现金</div>
                                <div class="valueBox btnBlue">点击支付</div>
                            </li>
                            <li>
                                <div class="topic">银行卡</div>
                                <div class="valueBox"><input type="text" placeholder="输入"></div>
                            </li>
                            <li>
                                <div class="topic">积分</div>
                                <div class="valueBox">1800积分可用</div>
                            </li>
                            <li>
                                <div class="topic">储存卡</div>
                                <div class="valueBox">400元可用</div>
                            </li>
                            <li>
                                <div class="topic">他人储存值<span>验证</span></div>
                                <div class="valueBox">输入</div>
                            </li>
                            <li>
                                <div class="topic">礼券</div>
                                <div class="valueBox"><input type="text" placeholder="输入"></div>
                            </li>
                        </ul>
                    </div>
                    <div class="conTail">
                        <div class="total">￥30</div>
                        <span>总计</span>
                    </div>
                    <textarea class="noteNote" placeholder="小票备注"></textarea>
                </div>
            </div>
        </div>
        <!-- 订单竖向小票 -->
        <div class="wholeParagraph uncollectedFunds" id="payDiaVertical">

        </div>
        <!-- 支付/三种状态 -->
        <div class="paymentPopup">
            <div class="inputNumber ">
                <div class="speedProgress">
                    <ul>
                        <li class="active">1.输入金额 <i class="iconfont icon-ico_arrow_down"></i></li>
                        <li>2.扫码支付 <i class="iconfont icon-ico_arrow_down"></i></li>
                        <li>3.完成支付</li>
                    </ul>
                </div>
                <ul class="payContent">
                    <li class="content-item first active">
                        <div class="inputBox">
                            <span>输入需要支付的金额</span>
                            <input type="number" placeholder="0" class="moneyNum" id="payNum">
                        </div>
                        <div class="btn-pay">
                            <button class="first-next" type="button" onclick="firstNext()">下一步</button>
                            <button class="cancel" type="button" onclick="closePay()">取消</button>
                        </div>
                    </li>
                    <li class="content-item second">
                        <div class="sweepCodeImg">
                            <img src="../resource//images/pay_01.jpg" alt="付款码" id="sweepCode">
                            <span>扫描顾客的付款码</span>
                            <input type="number" placeholder="或输入付款码" id="testCode">
                        </div>
                        <div class="btn-pay">
                            <button class="second-next" type="button" onclick="secondNext()">下一步</button>
                            <button class="second-pre" type="button" onclick="secondPre()">上一步</button>
                        </div>
                    </li>
                    <li class="content-item third">
                        <div class="successBox">
                            <img src="../resource//images/pay_02.jpg" alt="付款码" id="successImg">
                            <span>支付成功 <u id="reimburse" onclick="reimburse()">退款</u></span>
                        </div>
                        <div class="btn-pay">
                            <button class="third-end" type="button" onclick="finish()">完成</button>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <!-- 退款弹窗 -->
        <div class="content-view content-view-removeStaff" style="display:none">
            <p>确定退款20元？</p>
        </div>
        <!-- 横向小票 -->
        <div class="horizontalTicket">
            <div class="titleBox br">
                <div class="ov">
                    <h2 class="fl">精益眼镜旗舰店</h2>
                    <h2 class="fr">No.<i class="btnRed">0003926</i></h2>
                </div>
                <div class="huiColor">黔北大道二高西门人行岛天桥处将军大酒店附近
                    <span class="ml16">0571-20193819</span>
                </div>
            </div>
            <div class="pd10 ov br">
                <div class="fl mr10">订单状态<span class="btnRed ml4">未取货</span></div>
                <div class="fl ml16">销售员<span class="huiColor ml4"></span></div>
                <div class="fr huiColor">2018年10月11日 12点</div>
            </div>
            <div class="pd10 ov br">
                <h3 class="info fl">商品信息</h3>
                <h3 class="info fr pd12">验光信息</h3>
            </div>
            <div class="infoContent ov br">
                <div class="purchaseItems fl">
                    <ul class="pd10 ov br" style="min-height:137px;">
                        <li>
                            <span class="text">HYDRON 海昌透明黑色单片年抛</span>
                            <span class="num">X1</span>
                            <span class="price">￥30</span>
                        </li>
                        <li>
                            <span class="text">明月隐形眼镜1.50左眼</span>
                            <span class="num">X2</span>
                            <span class="price">￥10</span>
                        </li>
                        <li>
                            <span class="text">明月隐形眼镜1.40右眼</span>
                            <span class="num">X2</span>
                            <span class="price">￥15</span>
                        </li>
                        <li>
                            <span class="text">护眼灯</span>
                            <span class="num">X1</span>
                            <span class="price">￥0</span>
                        </li>
                        <li>
                            <span class="text">HYDRON 海昌透明黑色单片年抛</span>
                            <span class="num">X1</span>
                            <span class="price">￥0</span>
                        </li>
                        <li>
                            <span class="text">HYDRON 海昌透明黑色单片月抛</span>
                            <span class="num">X1</span>
                            <span class="price">￥0</span>
                        </li>
                    </ul>
                    <div class="ov pd10 br">
                        <span class="fl">金额减免</span>
                        <span class="huiColor fr"></span>
                    </div>
                    <div class="ov pd10" style="min-height: 60px;">
                        <div class="ov btnRed mb10">
                            <span class="fl fs14">总计</span>
                            <span class="fr" style="margin-right: 4px;">￥37.5</span>
                        </div>
                        <div class="huiColor">
                            微信支付: ￥20 现金支付: ￥10 他人储值支付: ￥7.5
                        </div>
                    </div>
                </div>
                <div class="optInfo fr ov">
                    <div class="item br">
                        <div class="pl12">右眼</div>
                        <div class="ml16 huiColor">
                            <span>S: -3.50</span>
                        </div>
                    </div>
                    <div class="item br">
                        <div class="pl12">左眼</div>
                        <div class="ml16 huiColor">
                            <span>S: -3.50</span>
                            <span>C: -0.50</span>
                            <span>A: 195</span>
                        </div>
                    </div>
                    <div class="item">
                        <div class="pl12">瞳距</div>
                        <div class="ml16 huiColor">
                            <span>2</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pd10 ov br">
                小票备注
                <span class="pl12 huiColor">
                    这位顾客人很好，下次再来！这位顾客人很好，下次再来！
                </span>
            </div>
            <div class="pd10 ov">
                三包政策
                <span class="pl12 huiColor">
                    详细内容详细内容详细内容详细内容详细内容
                </span>
            </div>
        </div>
    </div>
    <!--全局js-->
    <!-- jq库 -->
    <script src="../resource/js/jquery.min.js"></script>
    <!-- bootstrap UI需要依赖的js -->
    <script src="../resource/js/bootstrap.js?v=3.3.6"></script>
    <script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table.js"></script>
    <script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table-zh-CN.min.js"></script>
    <!-- layui需要依赖的js -->
    <script src="../resource/js/plugins/layer/layer.js"></script>
    <script src="../resource/layui/layui.js"></script>
    <!-- 公司内部库 -->
    <script src="../resource/js/lib/quakooLib/QuakooBase-1.0.0.js"></script>
    <script src="../resource/js/lib/quakooLib/QuakooConfig-1.0.0.js"></script>
    <script src="../resource/js/lib/quakooLib/QuakooBasePc-1.0.0.js"></script>
    <script src="../resource/js/lib/quakoo/Config.js"></script>
    <script src="../resource/js/lib/quakoo/project.js"></script>
    <script src="../resource/common/common.js?" +Math.random()></script>
    <script src="../resource/js/template-native.js"></script>
    <!-- 全局公共js -->
    <script src="../resource/js/yanjing.js"></script>
    <!-- 时间插件js -->
    <script src="../resource/js/mobiscroll.2.13.2.js"></script>
    <!-- 当前页面逻辑 -->
    <!--临时订单列表-->
    <script type="text/html" id="proOrderData">
        <%for(var i=0; i < list.length;i++){%>
            <li value="<%=list[i].uname%>"><%=list[i].uname%><i class="rem iconfont ico_circle_cross_fil">&#xe6aa;</i></li>
        <%}%>
    </script>
<!--
    &lt;!&ndash;手机号列表&ndash;&gt;
    <script type="text/html" id="shopPhoneData">
        <%for(var i=0; i < list.length;i++){%>
        <li value="<%=list[i].id%>@<%=list[i].phone%>@<%=list[i].score%>@<%=list[i].discount%>"><%=list[i].phone%></li>
        <%}%>
    </script>
-->
    <!--顾客职业列表-->
    <script type="text/html" id="shopOccupationData">
        <%for(var i=0; i < list.length;i++){%>
        <li value="<%=list[i]%>"><%=list[i]%></li>
        <%}%>
    </script>
    <!--推荐人-->
    <script type="text/html" id="recommenderBoxUl">
        <%for(var i=0;i< list.length;i++){%>
            <li value="<%=list[i].id%>"><%=list[i].name%></li>
        <%}%>
    </script>
    <!--验光信息表格-->
    <script type="text/html" id="ygTmp">
        <%if(list.defShow){%>
            <table border="" cellpadding="1" cellspacing="0" style="width:100%;padding:5px;" class="<%=className%>">
        <%}else{%>
            <table border="" cellpadding="1" cellspacing="0" style="width:100%;padding:5px;" class="<%=className%> hide">
        <%}%>
            <thead>
                <tr>
                    <th></th>
                    <%for(var i=0; i < list.length;i++){%>
                        <th><%=list[i].name%></th>
                    <%}%>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th>R</th>
                    <%for(var i=0;i< list.length;i++){%>
                        <td><input data-attr1="rightResItem" data-attr2="<%=list[i].value%>" type="number" placeholder="请输入"></td>
                    <%}%>
                </tr>
                <tr>
                    <th>L</th>
                    <%for(var i=0;i< list.length;i++){%>
                        <td><input data-attr1="leftResItem" data-attr2="<%=list[i].value%>" type="number" placeholder="请输入"></td>
                    <%}%>
                </tr>
            </tbody>
        </table>
    </script>
    <!--验光记录列表-->
    <script type="text/html" id="tagDateList">
        <li onclick="renderYgInfo(1,'now',this)" class="active">本次</li>
        <%for(var i=0; i < list.length;i++){%>
            <li onclick="renderYgInfo(2,'<%=list[i].showTime%>',this)"><%=list[i].showTime%><%=list[i].span%></li>
        <%}%>
    </script>
    <!--验光记录下拉框-->
    <script type="text/html" id="ygRecord">
        <%for(var i=0;i < list.length;i++){%>
            <li onclick="renderYgInfo(2,'<%=list[i].showTime%>','select')"><%=list[i].showTime%><%=list[i].span%></li>
        <%}%>
    </script>
    <!--订单信息表格-->
    <script type="text/html" id="orderFormList">
        <div class="rightHeadBox clearfix">
            <!--<input type="text" placeholder="输入条码" class="barCode" id="authCode">-->
            <!--<button class="btnCustomized">定制商品</button>-->
        </div>
        <div class="rightFormBox">
            <table width="100%" border="1">

        <thead>
            <tr>
                <th>商品名称</th>
                <th>数量</th>
                <th>零售价</th>
                <th>会员折扣</th>
                <th>小计</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody class="active">
        <!--type? 1=>金钱商品 1=>积分商品 3=>附加费用 4=>促销方式-->
            <%if(price){%>
                <%for(var i in list){%>
                    <%if(list[i].type ==1){%>
                        <tr>
                            <td>
                                <div><%=list[i].productName%></div>
                            </td>
                            <td><%=list[i].number%></td>
                            <td>¥<%=(list[i].price/100).toFixed(2)%></td>
                            <%if(0< list[i].discount <= 10){%>
                                <td><input type="text" placeholder="<%=list[i].discount%>" value="<%=list[i].discount%>" readonly="readonly"></td>
                            <%}else{%>
                                <td><input type="text" placeholder="无折扣" value="" readonly="readonly"></td>
                            <%}%>
                            <td>¥<%=list[i].subtotal%></td>
                            <td><u onclick="delOrderItem('<%=i%>')">移除</u></td>
                        </tr>
                    <%}else if(list[i].type ==2){%>
                        <tr>
                            <td>
                                <div><%=list[i].productName%></div>
                            </td>
                            <td><%=list[i].number%></td>
                            <td><%=list[i].price%>积分</td>
                            <%if(0< list[i].discount <= 10){%>
                            <td><input type="text" placeholder="<%=list[i].discount%>" value="<%=list[i].discount%>" readonly="readonly"></td>
                            <%}else{%>
                            <td><input type="text" placeholder="无折扣" value="" readonly="readonly"></td>
                            <%}%>
                            <td><%=list[i].subtotal%>积分</td>
                            <td><u onclick="delOrderItem('<%=i%>')">移除</u></td>
                        </tr>
                    <%}else if(list[i].type ==3){%>
                        <tr class="discount">
                            <td>
                                <div><%=list[i].name%></div>
                            </td>
                            <td>¥<%=list[i].money%></td>
                            <td><u onclick="delOrderItem('<%=i%>')">移除</u></td>
                        </tr>
                    <%}else if(list[i].type ==4){%>
                        <tr class="discount">
                            <td>
                                <div><%=list[i].name%></div>
                            </td>
                            <td>-¥<%=list[i].money%></td>
                            <td><u onclick="delOrderItem('<%=i%>')">移除</u></td>
                        </tr>
                    <%}%>
                <%}%>
            <%}else{%>
                <tr style="height: 100%;">
                    <td class="nullInfo" style="width:100%;height: 100%; vertical-align: middle;line-height: 216px;" colspan="2">暂无商品信息</td>
                </tr>
            <%}%>
        </tbody>
            </table>
        </div>
        <div class="rightFooterBox clearfix">
            <%if(price){%>
                <div class="amountMoney">
                    <div>原价共计 <span id="totalPrice">¥<%=price.totalPriceYuan%></span></div>
                    <div>折后金额 <span id="dicountPrice">¥<%=price.dicountPriceYuan%></span></div>
                </div>
                <div class="actualMoney">
                    <div>实收金额<span> <b>¥</b> <input type="text" id="PaidMoney" value="<%=price.dicountPriceYuan%>"></span></div>
                    <div >折扣<i id="userDiscount"><%=price.userDiscount%></i></div>
                </div>
            <%}else{%>
                <div class="amountMoney">
                    <div>原价共计 <span id="totalPrice">¥0</span></div>
                    <div>折后金额 <span id="dicountPrice">¥0</span></div>
                </div>
                <div class="actualMoney">
                    <div>实收金额<span> <b>¥</b> <input type="text" id="PaidMoney"></span></div>
                    <div>折扣<i id="userDiscount">10.0</i></div>
                </div>
            <%}%>
        </div>

    </script>
    <script type="text/html" id="payDiaVerticalList">
        <h3 class="title">付款结算</h3>
        <div class="ufHeader">
            <ul>
                <li>原价共计 <span>¥<%=list.yuanjia%></span></li>
                <li>折后金额 <span>¥<%=list.zhehoujia%></span></li>
                <li>特惠减免 <span>-¥<%=list.tehuijianmian%></span></li>
                <li>实收金额 <span>¥<%=list.shishou%></span></li>
            </ul>
        </div>

        <div style="width: 100%;padding: 10px 16px;overflow: hidden;height: 435px;">
            <div class="content" style="width:55%;float: left;">
                <div class="conTitle">
                    <h4>结算清单</h4>
                    <span>未收金额：<i>¥0</i></span>
                </div>
                <div class="formBox">
                    <ul>
                        <li>
                            <div class="topic">支付宝</div>
                            <%if(list.returnData&&list.returnData.payType==1&&list.returnData.status==1){%>
                                <div class="valueBox btnBlack"><%=list.returnData.price%> <span class="btnRed fr mr10" onclick="reimburse('<%=list.returnData.id%>',1)">退款</span></div>
                            <%}else if(list.returnData&&list.returnData.payType==1&&list.returnData.status==3){%>
                            <div class="valueBox btnBlack"><span class="btnRed fr mr10">已退款</span></div>
                            <%}else{%>
                                <div class="valueBox btnBlue" onclick="payDialog(1)">点击支付</div>
                            <%}%>
                        </li>
                        <li>
                            <%if(list.returnData&&list.returnData.payType==2){%>
                            <div class="valueBox btnBlack"><%=list.returnData.price%><span class="btnRed fr mr10" onclick="reimburse('<%=list.returnData.id%>',2)">退款</span></div>
                            <%}else{%>
                            <div class="valueBox btnBlue" onclick="payDialog(2)">点击支付</div>
                            <%}%>
                            <div class="topic">微信</div>
                        </li>
                        <li>
                            <div class="topic">现金</div>
                            <div class="valueBox"><input type="text" placeholder="输入"></div>
                        </li>
                        <li>
                            <div class="topic">银行卡</div>
                            <div class="valueBox"><input type="text" placeholder="输入"></div>
                        </li>
                        <li>
                            <div class="topic">积分</div>
                            <div class="valueBox">1800积分可用</div>
                        </li>
                        <li>
                            <div class="topic">储存卡</div>
                            <div class="valueBox">400元可用</div>
                        </li>
                        <li>
                            <div class="topic">他人储存值<span>验证</span></div>
                            <div class="valueBox">输入</div>
                        </li>
                        <li>
                            <div class="topic">礼券</div>
                            <div class="valueBox"><input type="text" placeholder="输入"></div>
                        </li>
                    </ul>
                </div>
                <div class="conTail">
                    <%if(list.returnData){%>
                        <div class="total btnBlue">¥<%=list.returnData.price%></div>
                    <%}else{%>
                        <div class="total btnBlue">¥0</div>
                    <%}%>
                    <span>总计</span>
                </div>
                <%if(list.returnData){%>
                <textarea class="noteNote" placeholder="小票备注" value="<%=list.returnData.desc%>" readonly="readonly"></textarea>
                <%}else{%>
                <textarea class="noteNote" placeholder="小票备注"></textarea>
                <%}%>
            </div>
            <%if(list.returnData){%>
            <!--startprint1-->
                <div class="smallTicket h" id="printTmp">
                    <i id="smallTicketBg"></i>
                    <div class="stHeader">
                        <div class="stTitle"><span></span>
                            <h3><%=list.returnData.subName%></h3><span></span>
                        </div>
                        <ul>
                            <li><span class="fl">下单时间</span><span class="fr"><%=getDateTimeDian(list.returnData.payTime)%></span></li>
                            <li><span class="fl">订单号</span><span class="fr"><%=list.returnData.orderNo%></span></li>
                            <li><span class="fl">销售员</span><span class="fr"><%=list.returnData.uName%></span></li>
                            <%if(list.returnData.status==0){%>
                                <li class="btnRed"><span class="fl">订单状态</span><span class="fr" >未交费</span></li>
                            <%}else if(list.returnData.status==1){%>
                                <li class="btnRed"><span class="fl">订单状态</span><span class="fr" >已缴费</span></li>
                            <%}else if(list.returnData.status==2){%>
                                <li class="btnRed"><span class="fl">订单状态</span><span class="fr" >已过期</span></li>
                            <%}else if(list.returnData.status==3){%>
                                <li class="btnRed"><span class="fl">订单状态</span><span class="fr" >已退款</span></li>
                            <%}%>
                        </ul>
                    </div>
                    <%if(list.returnData.info){%>
                    <div class="infoOptometry">
                        <h3>验光信息</h3>
                        <%if(list.returnData.info&&list.returnData.info.yuanYongRes){%>
                        <div class="name">远用</div>
                        <%if(list.returnData.info.yuanYongRes.rightResItem){%>
                        <div class="eye">
                            <span class="eyeText">右眼</span>
                            <span class="eyeContent"><%=list.returnData.info.yuanYongRes.rightResItemHtml%></span>
                        </div>
                        <%}%>
                        <%if(list.returnData.info.yuanYongRes.leftResItem){%>
                        <div class="eye">
                            <span class="eyeText">左眼</span>
                            <span class="eyeContent"><%=list.returnData.info.yuanYongRes.leftResItemHtml%></span>
                        </div>
                        <%}%>
                        <%}%>
                        <%if(list.returnData.info&&list.returnData.info.jinYongRes){%>
                        <div class="name">近用</div>
                        <%if(list.returnData.info.jinYongRes.rightResItem){%>
                        <div class="eye">
                            <span class="eyeText">右眼</span>
                            <span class="eyeContent"><%=list.returnData.info.jinYongRes.rightResItemHtml%></span>
                        </div>
                        <%}%>
                        <%if(list.returnData.info.jinYongRes.leftResItem){%>
                        <div class="eye">
                            <span class="eyeText">左眼</span>
                            <span class="eyeContent"><%=list.returnData.info.jinYongRes.leftResItemHtml%></span>
                        </div>
                        <%}%>
                        <%}%>
                        <%if(list.returnData.info&&list.returnData.info.yinXingRes){%>
                        <div class="name">隐形</div>
                        <%if(list.returnData.info.yinXingRes.rightResItem){%>
                        <div class="eye">
                            <span class="eyeText">右眼</span>
                            <span class="eyeContent"><%=list.returnData.info.yinXingRes.rightResItemHtml%></span>
                        </div>
                        <%}%>
                        <%if(list.returnData.info.yinXingRes.leftResItem){%>
                        <div class="eye">
                            <span class="eyeText">左眼</span>
                            <span class="eyeContent"><%=list.returnData.info.yinXingRes.leftResItemHtml%></span>
                        </div>
                        <%}%>
                        <%}%>
                        <%if(list.returnData.info&&list.returnData.info.jianJinDuoJiaoDianRes){%>
                        <div class="name">渐进多焦点</div>
                        <%if(list.returnData.info.jianJinDuoJiaoDianRes.rightResItem){%>
                        <div class="eye">
                            <span class="eyeText">右眼</span>
                            <span class="eyeContent"><%=list.returnData.info.jianJinDuoJiaoDianRes.rightResItemHtml%></span>
                        </div>
                        <%}%>
                        <%if(list.returnData.info.jianJinDuoJiaoDianRes.leftResItem){%>
                        <div class="eye">
                            <span class="eyeText">左眼</span>
                            <span class="eyeContent"><%=list.returnData.info.jianJinDuoJiaoDianRes.leftResItemHtml%></span>
                        </div>
                        <%}%>
                        <%}%>
                        <div class="tongju">
                            <span class="eyeText">瞳距</span>
                            <span class="eyeContent"><%=list.returnData.info.farPd%></span>
                        </div>
                    </div>
                    <%}%>
                    <div class="purchaseItems">
                        <ul>
                            <%for(var i = 0;i < list.returnData.skuids.length;i++){%>
                                <li>
                                    <span class="text"><%=list.returnData.skuids[i].code%></span>
                                    <span class="num">X<%=list.returnData.skuids[i].num%></span>
                                    <span class="price">¥<%=list.returnData.skuids[i].price%></span>
                                </li>
                            <%}%>
                        </ul>
                    </div>

                    <div class="reduction">
                        <ul>
                            <%if(list.surcharges&&list.surcharges.name){%>
                                <li><span class="fl"><%=list.surcharges.name%></span><span class="fr">-¥<%=list.surcharges.price%></span></li>
                            <%}%>
                            <%if(list.descSubtract){%>
                                <li><span class="fl">促销减免</span><span class="fr">-¥<%=list.descSubtract%></span></li>
                            <%}%>
                        </ul>
                    </div>
                    <div style="width: 100%;overflow: hidden;padding: 16px 0;">
                        <span class="fl btnRed" style="font-size:14px;font-weight: 600;">总计</span>
                        <span class="fr btnRed" style="font-size:14px;font-weight: 600;">¥<%=list.returnData.price%></span>
                    </div>
                    <div class="payment">
                        <%if(list.returnData.payType==1){%>
                            <li>
                                <span class="fl">支付宝支付</span>
                                <span class="fr">¥<%=list.returnData.price%></span>
                            </li>
                        <%}else if(list.returnData.payType==2){%>
                            <li>
                                <span class="fl">微信支付</span>
                                <span class="fr">¥<%=list.returnData.price%></span>
                            </li>
                        <%}%>
                    </div>
                    <div class="noteText">
                        <h6>小票备注</h6>
                        <%=list.returnData.desc%>
                    </div>
                    <div class="threePacks">
                        <h6>三包政策</h6>
                        <%=list.returnData.threePolicy%>
                    </div>
                    <div class="address">
                        <ul>
                            <li>
                                <span class="fl">地址</span>
                                <span class="fr "><%=list.returnData.address%></span>
                            </li>
                            <li>
                                <span class="fl">电话</span>
                                <span class="fr"><%=list.returnData.phone%></span>
                            </li>
                        </ul>
                    </div>
                </div>
            <!--endprint1-->
            <%}else{%>
                <div class="smallTicket h">
                    <i id="smallTicketBg"></i>
                </div>
            <%}%>
        </div>

    </script>
    <script>
        var psid;                                             //企业id
        var subid;                                            //门店id
        var cusId;                                            //用户id
        var cusPhone;                                         //用户手机号
        var cusJob;                                           //用户职业
        var proOrderId;                                       //临时订单ID
        var cusInfoType = 1;                                  //顾客信息选择框类型1=>手机号搜索；2=>会员卡号搜索
        var referrer;                                         //推荐人
        var ygSaveBtn = true;                                 //验光记录状态(是保存还是修改)
        var ygNowStatus = true;                               //本次验光记录状态true:保存，false:修改
        var presubTime = 'now';                               //验光信息时间下标
        var LocYgInfo = {};                                   //验光信息对象
        var optUid = 0;                                       //验光师ID
        var ygData = {};                                      //保存验光数据
        var ygwearProp;                                       //验光佩戴属性
        var ygResults;                                        //验光结果
        var ygAdvise;                                         //验光建议
        var saleUid;                                          //销售员ID
        var processUid;                                       //加工师ID
        var couponData ={};                                   //订单抵用券数据
        var locOrder = {};                                    //订单的属性存储
        var orderFormData = {};                               //订单表格数据
        var ygInfo = {now:{}};                                //验光信息数据
        var nowGoodData = {};                                 //添加常规商品sku数据
        var priceData = false;                                //计算金额
        var userScore = 0;                                    //会员积分
        var userDiscount=10.0;                                //会员折扣
        var couponid;                                         //促销方式（优惠券id）
        var authCode;                                         //条形码
        var countdown = 30, isRen = true;                     //倒计时
        var submitInfo;                                       //提交订单信息
        var onlinePayMoney;                                   //支付金额
        var payType;                                          //支付类型
        var payOrderData ={};                                 //支付返回值
        var refundType;                                       //退款类型
        var printId;                                          //打印小票的ID
        LocYgInfo.yuanTable={class:'yuan-table',data:[{name:'裸眼视力',value:'nakedEyesight'},{name:'球镜(S)',value:'s'},{name:'柱镜(C)',value:'c'},{name:'轴位(A)',value:'a'},{name:'矫正视力',value:'correctEyesight'},{name:'瞳距(PD)',value:'pd'},{name:'瞳高',value:'ph'},{name:'棱镜(V)',value:'v'},{name:'基底(SC)',value:'sc'}]};
        LocYgInfo.yinTable={class:'yin-table',data:[{name:'裸眼视力',value:'nakedEyesight'},{name:'球镜(S)',value:'s'},{name:'柱镜(C)',value:'c'},{name:'轴位(A)',value:'a'},{name:'矫正视力',value:'correctEyesight'},{name:'曲率',value:'q'},{name:'直径',value:'d'}]};
        LocYgInfo.jinTable={class:'jin-table',data:[{name:'裸眼视力',value:'nakedEyesight'},{name:'球镜(S)',value:'s'},{name:'柱镜(C)',value:'c'},{name:'轴位(A)',value:'a'},{name:'矫正视力',value:'correctEyesight'},{name:'瞳距(PD)',value:'pd'},{name:'瞳高',value:'ph'},{name:'棱镜(V)',value:'v'},{name:'基底(SC)',value:'sc'}]};
        LocYgInfo.jianTable={class:'jian-table',data:[{name:'裸眼视力',value:'nakedEyesight'},{name:'球镜(S)',value:'s'},{name:'柱镜(C)',value:'c'},{name:'轴位(A)',value:'a'},{name:'矫正视力',value:'correctEyesight'},{name:'远瞳距',value:'fpd'},{name:'近瞳距',value:'npd'},{name:'ADD',value:'add'},{name:'瞳高',value:'ph'}]};
        $(function () {
            psid = quakooUser.getUserInfo().psid;             //企业ID(公司ID)
            subid = quakooDb.getItem("sel_ShopId");           //门店ID
            console.log("门店ID",subid);
            initPage();                                       //页面初始化
            getListClass();                 //类目
            getListBrand();                 //品牌
        });
        template.helper('getDateTimeDian', function (l,formatStr) {
            if(!formatStr){
                formatStr = 'yyyy年MM月dd日 hh点';
            }
            return new Date(l).format(formatStr);
        });
        function initPage(){
            //年龄计算
            $("#tests").on("change",function () {
               var brithYear = $(this).val().slice(0,4);
               var nowYear = new Date().getFullYear();
               $("#autoAge").val(nowYear-brithYear+"岁");
            });
            //切换性别
            $('.benderBox>span').on('click', function () {
                $(this).removeClass('active').siblings().addClass('active');
            });
            selectTag($("#searchTypeBox"),function (ret) {
                cusInfoType = ret.value;
                if(cusInfoType == 1){
                    $('#searchPhoneUser').attr('placeholder','搜索手机号')
                }else if(cusInfoType == 2){
                    $('#searchPhoneUser').attr('placeholder','搜索会员卡号')
                }
            });
            getTemporaryOrder();                                 //获取门店下临时订单
            getShopStaff();                                      //获取门店下员工列表（推荐人==员工）
            getUsersByJob("验光师",1,1);                         //获取门店下的验光师
            renderYgTable(LocYgInfo.yuanTable,"#tableContent",true);  //验光信息远用table
            renderYgTable(LocYgInfo.yinTable,"#tableContent");   //验光信息隐形table
            renderYgTable(LocYgInfo.jinTable,"#tableContent");   //验光信息近用table
            renderYgTable(LocYgInfo.jianTable,"#tableContent");  //验光信息渐进多焦点table
            getUsersByJob("销售员",1,2);                         //获取门店下的销售员
            getUsersByJob("加工师",1,3);                         //获取门店下的加工师
            getListPromotions();                                 //获取促销方式
            renderOrderForm();                                   //订单表格
        }
        /**接口——获取门店下的临时订单*/
        function getTemporaryOrder(){
            quakooData.ajaxGetData(config.getUrl_order_getTemporaryOrder(),{subid:subid},function (ret) {
                console.log("临时订单",ret);
                if(ret&&ret.data){
                    document.querySelector("#selectBox .text").innerHTML = "临时订单";
                    var data = {list:ret.data};
                    var html = template("proOrderData",data);
                    document.getElementById("proOrderList").innerHTML = html;
                    selectTag($("#selectBox"),function (ret) {
                        //切换订单
                    })
                }else{
                    document.querySelector("#selectBox .text").innerHTML = "无临时订单";
                }
            })
        }
/***************************************************顾客信息开始*****************************************************/
        /**顾客搜索*/
        function searchCus() {
            var phone = $('#searchPhoneUser').val();
            if(quakooUtils.isBlack(phone)){
                layer.msg("请输入搜索内容");
                return;
            }
            if(cusInfoType==1){
                alert("搜索手机号");
                /**接口——根据手机号查询用户信息*/
                quakooData.ajaxGetData(config.getUrl_user_getUserByPhone(),{phone:phone},function (ret) {
                    console.log(ret);
                    if(ret&&ret.success){
                        if(quakooUtils.isNotBlack(ret.data)){
                            showCus(ret.data);
                        }else{
                            showCus();
                        }
                    }
                });
            }else if(cusInfoType == 2){
                alert("搜索会员卡号");
                return;

            }
        }
        /**接口——获取意向顾客*/
        function intentionCustomers() {
            layer.open({
                type: 1,
                skin: 'layui-layer-demo', //样式类名
                area: ['720px','560px'],
                anim: 0,
                closeBtn: 0,
                title: '意向顾客',
                shade: 0.1,
                shadeClose: true, //开启遮罩关闭
                scrollbar: false,
                content: $('.intentionalCustomer'),
                resize:false,
                btn: '关闭窗口',
                move:'.layui-layer-title',
                yes: function (index,layero) {
                    layer.close(index);
                },
                success: function (layero, index) {
                    showIntention()
                }
            });
        }
        function showIntention(){
            var table = $('#JFProTable');
            table.bootstrapTable('destroy');
            table.bootstrapTable({
                url:config.getUrl_user_getCustomerPager(),
                classes:"table",
                pagination:true,                    //是否显示分页
                sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                pageNumber:1,                       //初始化加载第一页，默认第一页
                pageSize: 10,
                pageList: [5, 10, 15, 20],
                sortable: false,
                sortOrder: "asc",
                showColumns: true,
                strictSearch: true,
                locale: "zh-CN",
                paginationHAlign:"center",
                clickToSelect:true,
                paginationLoop:false,
                columns:[{field: "ctime", title: "时间", align: "left", valign: "middle",formatter:function(value,row,index){
                        var showTime = quakooUtils.formatTimeToDateDianLY(value);
                        return showTime;
                    }},
                    {field: "name", title: "姓名", align: "left", valign: "middle"},
                    {field: "sex", title: "性别", align: "left", valign: "middle",formatter:function (value,row,index) {
                            if(value === 0){
                                return "-"
                            }else if(value === 1){
                                return "男"
                            }else if(value === 2){
                                return "女"
                            }
                        }},
                    {field: "age", title: "年龄", align: "left", valign: "middle"},
                    {field: "phone", title: "手机号", align: "left", valign: "middle",formatter:function (value, row, index) {
                        var html = value;
                            if(row.weixinId==null){
                                html = html + ' <span class="unbound">未绑定</span>';
                            }else{
                                html = html + ' <span class="bounding">已绑定</span>';
                            }
                            return html;
                        }},
                    {field: "subName", title: "来源", align: "left", valign: "middle"},
                    {field: "", title: "操作", align: "left", valign: "middle",formatter: function (value, row, index) {
                            var html = "<div class='btnSeeHistory' onclick='showCus("+JSON.stringify(row)+")'>选择</div>";
                            return html;
                        }
                    }],
                queryParams:function (param) {
                    param.subid = quakooUser.getUserInfo().psid;
                    param.userType = 0;
                    param.token = quakooUser.getUserInfo().token;
                    param.page = param.offset / param.limit + 1;
                    param.size = param.limit;
                    return param
                }
            });

        }

/*
        /!**接口——获取门店下的顾客的职业（暂时改为输入框）*!/
        function getShopJob(){
            quakooData.ajaxGetData(config.getUrl_user_getAllUserJob(),{sid:subid,userType:0},function (ret) {
                console.log("2er",ret);
                var data = {list:ret.data};
                var html = template("shopOccupationData",data);
                document.getElementById("shopOccupationList").innerHTML = html;
                //职业
                selectTag($("#occupationTypeBox"),function (ret) {
                    cusJob = ret.value;
                });
            })
        }
*/

/*
        /!**接口——获取门店下的顾客手机号*!/
        function getShopPhone(){
            quakooData.ajaxGetData(config.getUrl_user_getAllUser(),{sid:subid,userType:0},function (ret) {
                if(ret&&ret.success){
                    if(quakooUtils.isNotBlack(ret.data)){
                        var data = {list:ret.data};
                        var html = template("shopPhoneData",data);
                        console.log(html)
                        document.getElementById("shopPhoneList").innerHTML = html;
                        selectTag($("#searchTypeBox"),function (ret) {
                            cusId =(ret.value).split("@")[0];
                            cusPhone =(ret.value).split("@")[1];
                            userScore =(ret.value).split("@")[2];
                            userDiscount =(ret.value).split("@")[3];
                            getUserByPhone();
                        });
                    }else{
                        layer.msg("门店下暂无顾客");
                        return
                    }
                }else{
                    layer.msg(ret.data);
                    return
                }
            })
        }
*/
        /**接口——获取门店下的员工(获取推荐人)*/
        /** 顾客信息弹窗*/
        /**注册成为会员*/
        function regMember() {
            var name = $("#cusInfoName").val();
            var phone = $("#cusInfoPhone").val();
            var sex = $("#cusInfoSex span.active").attr("data-value");
            var strTime = $("#tests").val().split("-");
            var birthdate = new Date(strTime[0],strTime[1],strTime[2]).getTime();
            var autoAge = $("#autoAge").val();
            var cusJob = $("#cusJob").val();
            var recommender = referrer;
            if(quakooUtils.isBlack(name)){
                layer.msg("请输入姓名");
                return;
            }
            if(quakooUtils.isBlack(phone)){
                layer.msg("请输入手机号");
                return;
            }
            if(!quakooUtils.isMobileNum(phone)){
                layer.msg("请输入正确的手机号");
                return;
            }
            if(quakooUtils.isBlack(birthdate)||isNaN(birthdate)){
                layer.msg("请选择出生日期");
                return;
            }
            if(quakooUtils.isBlack(cusJob)){
                layer.msg("请输入用户职业");
                return;
            }
            if(quakooUtils.isBlack(recommender)){
                layer.msg("请选择推荐人");
                return;
            }
            /**注册会员弹窗*/
            var index = layer.open({
                type: 1,
                skin: 'layui-register-member',
                area: '240px',
                anim: 0,
                closeBtn: 0,
                title: '注册成为会员',
                shade: 0.4,
                shadeClose: true, //开启遮罩关闭
                scrollbar: false,
                content: $('.register-member'),
                btn: ['注册成为会员', '取消'],
                yes: function () {
                    checkPhoneCode(name,phone,sex,birthdate,cusJob,recommender);
                },
                btn2: function () {
                    //取消
                },
                success: function (layero, index) {
                }
            });
        }
        /**获取门店下推荐人*/
        function getShopStaff(){
            quakooData.ajaxGetData(config.getUrl_user_getAllUser(),{sid:subid,userType:1},function (ret) {
                if(ret&&ret.success){
                    var data = {list:ret.data};
                    var html = template("recommenderBoxUl",data);
                    document.getElementById("referer").innerHTML = html;
                    selectTag($("#recommenderBox"),function (ret) {
                        referrer = ret.value;
                    })
                }
            })
        }
        /**接口——获取短信验证码*/
        function getSms(){
            if(!isRen){return}
            var phone = $("#reg-phoneNum").val();
            if(quakooUtils.isBlack(phone)){
                layer.msg("请输入手机号！",{icon:1});
                return
            }
            if(!quakooUtils.isMobileNum(phone)){
                layer.msg("请输入正确的手机号！",{icon:1});
                return
            }
            quakooData.ajaxGetData(config.getUrl_user_createAuthCodeOnReg(),{phone:phone},function (ret) {
                if(ret){
                    countDown($('#sendSmsText'));
                    layer.msg("短信已发送，请注意查收！",{icon:1});
                }
            })
        }
        /**接口——注册成为会员*/
        function getMember(name,phone,sex,birthdate,cusJob,recommender){
            quakooData.ajaxGetData(config.getUrl_user_becomeVip(),{name:name,phone:phone,sex:sex,birthdate:birthdate,job:cusJob,psid:psid,sid:subid,recommender:recommender},function (ret) {
                if(ret && ret.success){
                    if(ret.data){
                        cusId = ret.data.id;
                        layer.msg("注册成功", {icon: 1});
                        showCus(ret.data);
                        getYgInfo(ret.data.id);
                        setTimeout(function () {
                            $(".register-member input").val('');
                            layer.closeAll();
                        },500)
                    }
                }else{
                    layer.msg(ret.msg,{icon:2});
                }
            })

        }
        /**回显顾客信息*/
        function showCus(data) {
            console.log("顾客信息：",data);
            if(quakooUtils.isNotBlack(data)){//渲染
                cusId = data.id;
                cusPhone =data.phone;
                userScore = data.score;
                userDiscount = data.discount;
                $('#userDiscount').html(userDiscount);
                getYgInfo(data.id);
                $('#cusInfoReferrer')[0].style.display = "inline-block";
                $('#cusInfoName').val(data.name);
                $('#cusInfoPhone').val(data.phone);
                if(data.sex==2){
                    $('#cusInfoSex span').first().removeClass('active');
                    $('#cusInfoSex span').last().addClass('active');
                }else{
                    $('#cusInfoSex span').first().addClass('active');
                    $('#cusInfoSex span').last().removeClass('active');
                }
                $('#tests').val(quakooUtils.formatTimeToDateDianLY(data.birthdate));
                $('#autoAge').val(data.age);
                $('#cusJob').val(data.job);
                $('#recommenderBox .text').html(data.tname);
                $('.memberInfo.noRegister')[0].style.display = "block";
                $('.memberInfo.noRegisterWx')[0].style.display = "none";
                if(quakooUtils.isNotBlack(data.member)){//已注册
                    $('#cusInfoReferrer')[0].style.display = "none";
                    $('.memberInfo.noRegister')[0].style.display = "none";
                    $('.memberInfo.noRegisterWx')[0].style.display = "block";
                    if(data.weixinId == null){//未绑定微信
                        $(".noRegisterWx .weiyanzheng")[0].style.display = "block";
                        $(".noRegisterWx .yiyanzheng")[0].style.display = "none";
                        $("#memcard-num").html(data.cardNumber);
                        $("#mem-grade").html(data.member);
                        $("#mem-money").html(data.money+"元");
                        $("#mem-integral").html(data.score+"分");
                        $("#last-contime").html(data.lastMoney);
                        $("#con-num").html(data.payCount+"次");
                        $("#tname").html(data.tname);
                        $("#tphone").html(data.tphone);
                    }else{//已绑定微信
                        $(".noRegisterWx .weiyanzheng")[0].style.display = "none";
                        $(".noRegisterWx .yiyanzheng")[0].style.display = "block";
                    }
                }
            }else{
                layer.msg("未查到该顾客!",{icon:1});
                $('#cusInfoName').val('');
                $('#cusInfoPhone').val('');
                $('#cusInfoSex span').first().addClass('active');
                $('#cusInfoSex span').last().removeClass('active');
                $('#tests').val('');
                $('#autoAge').val('');
                $('#occupationTypeBox .text').html('');
                $('#recommenderBox .text').html('');
                $('.memberInfo.noRegister')[0].style.display = "block";
                $('.memberInfo.noRegisterWx')[0].style.display = "none";
            }
        }
        /**接口——检查手机号验证码*/
        function checkPhoneCode(name,phone,sex,birthdate,cusJob,recommender){
            var phonesms = $("#reg-phoneNum").val();
            var code = $("#reg-code").val();
            if(quakooUtils.isBlack(phonesms)){
                layer.msg("请输入手机号！",{icon:1});
                return
            }
            if(!quakooUtils.isMobileNum(phonesms)){
                layer.msg("请输入正确的手机号！",{icon:1});
                return
            }
            if(quakooUtils.isBlack(code)){
                layer.msg("请输入验证码！",{icon:1});
                return
            }
            quakooData.ajaxGetData(config.getUrl_user_checkCode(),{phone:phonesms,code:code},function (ret) {
                if(ret&&ret.success){
                    getMember(name,phone,sex,birthdate,cusJob,recommender);
                }else{
                    layer.msg(ret.msg);
                }
            })
        }
        //倒计时
        function countDown(ele) {
            isRen = false;
            ele.addClass('active');
            ele.text(countdown + "s");
            var timer = setInterval(function () {
                countdown = countdown - 1;
                ele.text(countdown + "s");
                if (countdown <= 0) {
                    countdown = 30;
                    isRen = true;
                    ele.text('发送验证码');
                    ele.removeClass('active');
                    clearInterval(timer);
                }
            }, 1000)
        }

/***************************************************顾客信息结束*****************************************************/

/***************************************************验光模块开始*****************************************************/

        /**接口——保存验光信息*/
        function saveYgInfo(){
            var param = {};
            param.pSubid = psid;
            param.subid = subid;
            if(quakooUtils.isBlack(cusId)){
                layer.msg("请完善注册用户信息");
                return;
            }
            param.uid = cusId;
            param.optUid = optUid;
            var time = $("#tests2").val();
            var year = time.substring(0,4);
            var month = time.substring(5,7)-1;
            var day = time.substring(8,10);
            var hour = time.substring(time.length - 5,time.length - 3);
            param.optTime = new Date(year,month,day,hour).getTime();
            if(param.optTime<0||quakooUtils.isBlack(param.optTime)){
                layer.msg("请选择验光时间");
                return;
            }
            param.desc = $("#optometryRemarks").val();
            if(quakooUtils.isBlack(param.desc)){
                layer.msg("请输入验光备注");
                return;
            }
            param.farPd = $(".rightFooterBox .companyBox input.text").val();
            if(quakooUtils.isBlack(param.farPd)){
                layer.msg("请输入远用瞳距");
                return;
            }
            param.wearProp = ygwearProp;
            param.res = ygResults;
            param.support = ygAdvise;
            param.yuanYongResJson = {};
            param.yinXingResJson = {};
            param.jinYongResJson = {};
            param.jianJinDuoJiaoDianResJson = {};
            param.yuanYongResJson.rightResItem = {};
            param.yuanYongResJson.leftResItem = {};
            param.yinXingResJson.rightResItem = {};
            param.yinXingResJson.leftResItem = {};
            param.jinYongResJson.rightResItem = {};
            param.jinYongResJson.leftResItem = {};
            param.jianJinDuoJiaoDianResJson.rightResItem = {};
            param.jianJinDuoJiaoDianResJson.leftResItem = {};
            $('.yuan-table input').each(function (index,item) {
                if(item.value){
                    param.yuanYongResJson[$(item).attr('data-attr1')][$(item).attr('data-attr2')] = item.value;
                }
            });
            $('.yin-table input').each(function (index,item) {
                if(item.value){
                    param.yinXingResJson[$(item).attr('data-attr1')][$(item).attr('data-attr2')] = item.value;
                }
            });
            $('.jin-table input').each(function (index,item) {
                if(item.value){
                    param.jinYongResJson[$(item).attr('data-attr1')][$(item).attr('data-attr2')] = item.value;
                }
            });
            $('.jian-table input').each(function (index,item) {
                if(item.value){
                    param.jianJinDuoJiaoDianResJson[$(item).attr('data-attr1')][$(item).attr('data-attr2')] = item.value;
                }
            });
            param.yuanYongResJson = JSON.stringify(param.yuanYongResJson);
            param.yinXingResJson = JSON.stringify(param.yinXingResJson);
            param.jinYongResJson = JSON.stringify(param.jinYongResJson);
            param.jianJinDuoJiaoDianResJson = JSON.stringify(param.jianJinDuoJiaoDianResJson);
            if(ygSaveBtn == true){
                quakooData.ajaxGetData(config.getUrl_optometryinfo_add(),param,function (ret) {
                    console.log(ret)
                    if(ret&&ret.success){
                        ygInfo.now = ret.data;
                        layer.msg('验光信息已保存',{icon:1});
                        ygSaveBtn = false;
                        ygNowStatus = false;
                    }else{
                        layer.msg(ret.data)
                    }
                })
            }else{
                quakooData.ajaxGetData(config.getUrl_optometryinfo_update(),param,function (ret) {
                    if(ret&&ret.success){
                        layer.msg("验光信息已修改",{icon:1});
                    }else{
                        layer.msg(ret.data);
                    }
                })
            }
        }
        /**接口——获取验光记录*/
        function getYgInfo(cusId) {
            ygSaveBtn = true;
            ygNowStatus = true;
            clearYgInfo(true);
            var param = {};
            if(quakooUtils.isBlack(cusId)){
                layer.msg("请完善用户信息");
                return;
            }
            param.uid = cusId;
            param.size = 10;
            quakooData.ajaxGetData(config.getUrl_optometryinfo_getList(),param,function (ret) {
                if(ret&&ret.success){
                    var html = "";
                    var data = [];
                    var selHtml = "";
                    var selData = [];
                    for(var i=0;i<ret.data.length;i++){
                        ret.data[i].showTime = quakooUtils.formatTimeToDateDianLY(ret.data[i].optTime);
                        ygInfo[ret.data[i].showTime] = ret.data[i];
                        var str = [];
                        if(quakooUtils.isNotBlack(ret.data[i].yuanYongRes) && (quakooUtils.isNotBlack(ret.data[i].yuanYongRes.leftResItem) || quakooUtils.isNotBlack(ret.data[i].yuanYongRes.rightResItem))){
                            str.push('<span>远用</span>')
                        }
                        if(quakooUtils.isNotBlack(ret.data[i].jinYongRes) && (quakooUtils.isNotBlack(ret.data[i].jinYongRes.leftResItem) || quakooUtils.isNotBlack(ret.data[i].jinYongRes.rightResItem))){
                            str.push('<span>近用</span>')
                        }
                        if(quakooUtils.isNotBlack(ret.data[i].yinXingRes) && (quakooUtils.isNotBlack(ret.data[i].yinXingRes.leftResItem) || quakooUtils.isNotBlack(ret.data[i].yinXingRes.rightResItem))){
                            str.push('<span>隐形</span>')
                        }
                        if(quakooUtils.isNotBlack(ret.data[i].jianJinDuoJiaoDianRes) && (quakooUtils.isNotBlack(ret.data[i].jianJinDuoJiaoDianRes.leftResItem) || quakooUtils.isNotBlack(ret.data[i].jianJinDuoJiaoDianRes.rightResItem))){
                            str.push('<span>渐进多焦点</span>')
                        }
                        ret.data[i].span = str.join('');
                        if(i<2){
                            data.push(ret.data[i]);
                        }
                        if(i>=2){
                            selData.push(ret.data[i]);
                        }
                    }
                    html= template("tagDateList",{list:data});
                    $("#tagDataBox").html(html);
                    if(quakooUtils.isBlack(selData)){
                        selHtml = template("ygRecord",{list:selData});
                        $("#moreYgList").html(selHtml);
                    }
                }
            })
        }
        /**保存表格信息为本地对象*/
        function savaTableToObj(time){
            ygInfo[time].optUid = optUid;
            var t = $("#tests2").val();
            if(quakooUtils.isNotBlack(t)){
                var year = t.substring(0,4);
                var month = t.substring(5,7)-1;
                var day = t.substring(8,10);
                var hour = t.substring(t.length - 5,t.length - 3);
                ygInfo[time].optTime = new Date(year,month,day,hour).getTime();
            }
            ygInfo[time].desc = $("#optometryRemarks").val();
            ygInfo[time].farPd = $(".rightFooterBox .companyBox input.text").val();
            ygInfo[time].wearProp = ygwearProp;
            ygInfo[time].res = ygResults;
            ygInfo[time].support = ygAdvise;
            ygInfo[time].yuanYongRes = {};
            ygInfo[time].yinXingRes = {};
            ygInfo[time].jinYongRes = {};
            ygInfo[time].jianJinDuoJiaoDianRes = {};
            ygInfo[time].yuanYongRes.rightResItem = {};
            ygInfo[time].yuanYongRes.leftResItem = {};
            ygInfo[time].yinXingRes.rightResItem = {};
            ygInfo[time].yinXingRes.leftResItem = {};
            ygInfo[time].jinYongRes.rightResItem = {};
            ygInfo[time].jinYongRes.leftResItem = {};
            ygInfo[time].jianJinDuoJiaoDianRes.rightResItem = {};
            ygInfo[time].jianJinDuoJiaoDianRes.leftResItem = {};
            $('.yuan-table input').each(function (index,item) {
                if(item.value){
                    ygInfo[time].yuanYongRes[$(item).attr('data-attr1')][$(item).attr('data-attr2')] = item.value;
                }
            });
            $('.yin-table input').each(function (index,item) {
                if(item.value){
                    ygInfo[time].yinXingRes[$(item).attr('data-attr1')][$(item).attr('data-attr2')] = item.value;
                }
            });
            $('.jin-table input').each(function (index,item) {
                if(item.value){
                    ygInfo[time].jinYongRes[$(item).attr('data-attr1')][$(item).attr('data-attr2')] = item.value;
                }
            });
            $('.jian-table input').each(function (index,item) {
                if(item.value){
                    ygInfo[time].jianJinDuoJiaoDianRes[$(item).attr('data-attr1')][$(item).attr('data-attr2')] = item.value;
                }
            });
        }

        /**根据本地时间下标对象回显验光数据*/
        function renderYgInfo(type,time,_self){
            savaTableToObj(presubTime);//保存上一个时间下标的数据到本地
            presubTime = time;
            if(type === 1&& ygNowStatus){
                ygSaveBtn = true;
            }
            if(type === 2){
                ygSaveBtn = false;
            }
            $('#tableContent input').val('');
            $(_self).addClass('active').siblings().removeClass('active');
            if(_self == "select"){
                $("#tagDataBox li").removeClass('active');
            }
            var data = ygInfo[time];
            //验光师
            if(data.optUserName){
                $("#optometristName .text").html(data.optUserName);
            }else{
            }
            //验光时间
            if(data.optTime){
                $("#tests2").val(quakooUtils.formatTimeToDateDian(data.optTime));
            }else{
                $('#tests2').val('');
            }
            //验光备注
            if(data.desc){
                $("#optometryRemarks").val(data.desc);
            }else{
                $('#optometryRemarks').val('');
            }
            //远用瞳距
            if(data.farPd){
                $(".rightFooterBox .companyBox input.text").val(data.farPd);
            }else{
                $(".rightFooterBox .companyBox input.text").val('');
            }
            //属性
            if(data.wearProp==1){
                $("#glasses .text").html("近视眼镜");
            }else if(data.wearProp ==2){
                $("#glasses .text").html("远视眼镜");
            }else if(data.wearProp ==3){
                $("#glasses .text").html("隐形眼镜");
            }
            //结果和建议
            if(data.res){
                $("#result .text").html(data.res);
            }
            if(data.support){
                $("#proposal .text").html(data.support);
            }
            if(quakooUtils.isNotBlack(data.yuanYongRes)){
                for(var i in data.yuanYongRes){
                    for(var j in data.yuanYongRes[i]){
                        $(".yuan-table input[data-attr1="+i+"][data-attr2="+j+"]").val(data.yuanYongRes[i][j]);
                    }
                }
            }
            if(quakooUtils.isNotBlack(data.jinYongRes)){
                for(var i in data.jinYongRes){
                    for(var j in data.jinYongRes[i]){
                        $(".jin-table input[data-attr1="+i+"][data-attr2="+j+"]").val(data.jinYongRes[i][j]);
                    }
                }
            }
            if(quakooUtils.isNotBlack(data.yinXingRes)){
                for(var i in data.yinXingRes){
                    for(var j in data.yinXingRes[i]){
                        $(".yin-table input[data-attr1="+i+"][data-attr2="+j+"]").val(data.yinXingRes[i][j]);
                    }
                }
            }
            if(quakooUtils.isNotBlack(data.jianJinDuoJiaoDianRes)){
                for(var i in data.jianJinDuoJiaoDianRes){
                    for(var j in data.jianJinDuoJiaoDianRes[i]){
                        $(".jian-table input[data-attr1="+i+"][data-attr2="+j+"]").val(data.jianJinDuoJiaoDianRes[i][j]);
                    }
                }
            }
        }
        /**清空验光信息*/
        function clearYgInfo(type) {
            $('#tableContent input').val('');
            $('#tests2').val('');
            $('#optometryRemarks').val('');
            $(".rightFooterBox .companyBox input.text").val('');
            if(!type){
                setTimeout(function () {
                    layer.msg('验光信息已清空',{icon:1});
                },100);
            }
        }
        /**渲染表格信息*/
        function renderYgTable(data,eleId,defShow){

            data.data.defShow = defShow;
            var html = template("ygTmp",{list:data.data,className:data.class});
            var oldHtml = $(eleId).html();
            $(eleId).html(oldHtml+html);
        }
        getResult();//渲染结果和建议
        /**接口——获取用户列表(根据职位)*/
        function getUsersByJob(job,userType,index){
            //index:1=>验光师；index:2=>销售员；index:3=>加工师
            quakooData.ajaxGetData(config.getUrl_user_getUsersByJob(),{job:job,userType:userType},function (ret) {
                if(ret&&ret.success){
                    if(index === 1){
                        //验光师下拉框
                        if(quakooUtils.isNotBlack(ret.data)){
                            console.log('验光师',ret.data);
                            document.querySelector("#optometristName .text").innerHTML = ret.data[0].name;
                            optUid = ret.data[0].id;
                            var html="";
                            for(var i=0;i < ret.data.length;i++){
                                html += '<li value="'+ret.data[i].id+'">'+ret.data[i].name+'</li>'
                            }
                            document.querySelector("#optometristList").innerHTML = html;
                            selectTag($("#optometristName"),function (ret) {
                                optUid = ret.value;
                            })
                        }else{
                            document.querySelector("#optometristName .text").innerHTML = "验光师";
                        }
                    }
                    if(index ===2){
                        //销售员下拉框
                        if(quakooUtils.isNotBlack(ret.data)){
                            document.querySelector("#salePeople .text").innerHTML = ret.data[0].name;
                            saleUid = ret.data[0].id;
                            var html="";
                            for(var i=0;i < ret.data.length;i++){
                                html += '<li value="'+ret.data[i].id+'">'+ret.data[i].name+'</li>'
                            }
                            document.querySelector("#saleUl").innerHTML = html;
                            selectTag($("#salePeople"),function (ret) {
                                saleUid = ret.value;
                            })
                        }else{
                            document.querySelector("#salePeople .text").innerHTML = "销售员";
                        }
                    }
                    if(index ===3){
                        console.log("加工师",ret.data);
                        //加工师下拉框
                        if(quakooUtils.isNotBlack(ret.data)){
                            document.querySelector("#machiningPeople .text").innerHTML = ret.data[0].name;
                            processUid = ret.data[0].id;
                            var html="";
                            for(var i=0;i < ret.data.length;i++){
                                html += '<li value="'+ret.data[i].id+'">'+ret.data[i].name+'</li>'
                            }
                            document.querySelector("#processUl").innerHTML = html;
                            selectTag($("#machiningPeople"),function (ret) {
                                processUid = ret.value;
                            })
                        }else{
                            document.querySelector("#machiningPeople .text").innerHTML = "加工师";
                        }
                    }

                }
            })
        }
        /**接口——获取验光结果建议*/
        function getResult(){
            //查结果
            quakooData.ajaxGetData(config.getUrl_optometryinfo_getResult(),{type:1},function(ret){
                if(ret&&ret.success){
                    if(quakooUtils.isNotBlack(ret.data)){
                        var html = "";
                        for(var i=0;i<ret.data.length;i++){
                            html += '<li value="'+ret.data[i]+'">'+ret.data[i]+'</li>';
                        }
                        $("#result .text").html(ret.data[0]);
                        ygResults = ret.data[0];
                        $("#resultList").html(html);
                        selectTag($("#result"),function (ret) {
                            ygResults = ret.value;
                        });
                    }else{
                        $("#result .text").html("结果");
                    }
                }
            });
            //建议
            quakooData.ajaxGetData(config.getUrl_optometryinfo_getResult(),{type:2},function(ret){
                if(ret&&ret.success){
                    if(quakooUtils.isNotBlack(ret.data)){
                        var html = "";
                        for(var i=0;i<ret.data.length;i++){
                            html += '<li value="'+ret.data[i]+'">'+ret.data[i]+'</li>';
                        }
                        $("#proposal .text").html(ret.data[0]);
                        ygAdvise = ret.data[0];
                        $("#proposalList").html(html);
                        selectTag($("#proposal"),function (ret) {
                            ygAdvise = ret.value;
                        });
                    }else{
                        $("#proposal .text").html("建议");
                    }
                }
            });
        }
        //表单滚动条
        var type = true;
        $('#tableContent').hover(function () {
            $(this).addClass('active');
            type = false;
        }, function () {
            $(this).removeClass('active');
        })
        //验光Tag
        $("#ygType li").click(function () {
            $(this).addClass('active').siblings().removeClass('active');
            $('#tableContent>table').eq($(this).index()).removeClass('hide').siblings().addClass('hide');
        });
        ygwearProp =1;
        selectTag($("#glasses"),function (ret) {
            ygwearProp = ret.value;
        });
/***************************************************验光模块结束*****************************************************/
/***************************************************订单信息开始*****************************************************/
        /**附加费用*/
        function extraCharges(){
            if(!cusId){
                layer.msg("请完善用户信息");
                return;
            }
            var hasProduct = false;
            for(var i in orderFormData){
                orderFormData[i].type==1;
                hasProduct = true;
                break;
            }
            if(!hasProduct){
                layer.msg("请先选择商品",{icon:7})
                return;
            }
            var markup = "extra";
            var extraId = "1";
            if(quakooUtils.isNotBlack(orderFormData[markup+extraId])){
                layer.msg("此项已添加,移除后可重新添加",{icon:7});
                return;
            }
            var money = $("#extraCharges").val();
            if(quakooUtils.isBlack(money)){
                layer.msg("请填写价格");
                return;
            }
            orderFormData[markup+extraId] = {};
            orderFormData[markup+extraId].type = 3;
            orderFormData[markup+extraId].id = extraId;
            orderFormData[markup+extraId].name = "加工费";
            orderFormData[markup+extraId].money = money;
            renderOrderForm();
        }
        selectTag($("#costAdditional"),function (ret) {
        });
        /**促销方式*/
        function getListPromotions(){
            var markup = "promotion";
            var param = {};
            param.subid = psid;//公司ID
            quakooData.ajaxGetData(config.getUrl_marketingcoupon_getCanUseList(),param,function(ret){
                console.log("促销方式：",ret);
                if(ret&&ret.success){
                    if(quakooUtils.isNotBlack(ret.data)){
                        var html = '';
                        for(var i=0;i<ret.data.length;i++){
                            couponData[ret.data[i].id] = ret.data[i];
                            html += '<li value="'+ret.data[i].id+'">'+ret.data[i].title+'</li>'
                        }
                        $("#ListPromotions").html(html);
                        selectTag($("#promotion"),function (ret) {
                            if(!cusId){
                                layer.msg("请完善用户信息");
                                return;
                            }
                            var hasProduct = false;
                            for(var i in orderFormData){
                                orderFormData[i].type==1;
                                hasProduct = true;
                                break;
                            }
                            if(!hasProduct){
                                layer.msg("请先选择商品",{icon:7});
                                return;
                            }
                            if(quakooUtils.isNotBlack(orderFormData[markup])){
                                layer.msg('已选择促销方式',{icon:7});
                                return;
                            }
                            couponid = ret.value;
                            orderFormData[markup] = {};
                            orderFormData[markup].type = 4;
                            orderFormData[markup].id = ret.value;
                            orderFormData[markup].name = couponData[ret.value].title;
                            orderFormData[markup].money = couponData[ret.value].descSubtract;
                            renderOrderForm();
                        });
                    }else{
                        $("#ListPromotions").html("暂无促销方式");
                    }
                }
            })
        }
        /**接口——获取企业类目列表*/
        function getListClass(){
            quakooData.ajaxGetData(config.getUrl_productCategory_getSubAllList(),{subid:psid},function (ret) {
                if(ret&&ret.success){
                    if(quakooUtils.isNotBlack(ret.data)){
                        locOrder.class = ret.data[0].id;
                        locOrder.className = ret.data[0].name;
                        var html = "";
                        for(var i=0;i<ret.data.length;i++){
                            html += '<li onclick="selClass(this,'+ret.data[i].id+',\''+ret.data[i].name+'\')">'+ret.data[i].name+'</li>';
                        }
                        $("#listClass").html(html);
                        $("#listClass li").first().addClass("active");
                    }else{
                        layer.msg("没有类目");
                    }
                }
            })
        }/**接口——获取企业品牌列表*/
        function getListBrand(){
            quakooData.ajaxGetData(config.getUrl_productBrand_getSubAllList(),{subid:psid},function (ret) {
                if(ret&&ret.success){
                    if(quakooUtils.isNotBlack(ret.data)){
                        locOrder.brand = ret.data[0].id;
                        locOrder.brandName = ret.data[0].name;
                        var html = "";
                        for(var i=0;i<ret.data.length;i++){
                            html += '<li onclick="selBrand(this,'+ret.data[i].id+',\''+ret.data[i].name+'\')"><span>'+ret.data[i].name+'</span></li>';
                        }
                        $("#listBrand").html(html);
                        $("#listBrand li").first().addClass("active");
                    }else{
                        layer.msg("没有品牌");
                    }
                }
            })
        }
        //选择商品类目
        function selClass(_self,id,name) {
            $(_self).addClass("active").siblings().removeClass("active");
            locOrder.class = id;
            locOrder.className = name;
            getSPU();
        }
        //选择商品品牌
        function selBrand(_self,id,name) {
            $(_self).addClass("active").siblings().removeClass("active");
            locOrder.brand = id;
            locOrder.brandName = name;
            getSPU();
        }
        /**获取商品SPU*/
        function getSPU() {
            $("#spuTable").bootstrapTable('destroy');
            $("#spuTable").bootstrapTable({
                url: config.getUrl_product_getSaleSPUBackPager(),
                method: 'get',
                classes: "table",
                pagination: true,                     //是否显示分页
                sidePagination: "server",             //分页方式：client客户端分页，server服务端分页（*）
                pageNumber: 1,                        //初始化加载第一页，默认第一页
                pageSize: 8,
                pageList: [5, 10, 15, 20],
                sortable: false,
                sortOrder: "asc",
                showColumns: true,
                strictSearch: true,
                locale: "zh-CN",
                paginationHAlign: "center",
                clickToSelect: true,
                columns: [
                    {field: "seriesName", title: "系列", align: "left", valign: "middle"},
                    {field: "canUseNum", title: "库存", align: "left", valign: "middle"},
                    {field: "providerName", title: "来源", align: "left", valign: "middle"},
                    {field: "", title: "操作", align: "left", valign: "middle",formatter: function (value, row, index) {
                            var html;
                            if(locOrder.type == 0){
                                html = "<div class='btnSeeHistory' onclick='getSKU("+locOrder.type+","+ JSON.stringify(row.id) +","+JSON.stringify(row.seriesName)+","+JSON.stringify(row.categoryName)+")'>选择</div>";
                            }else if(locOrder.type == 1){
                                html = "<div class='btnSeeHistory' onclick='getSKU("+locOrder.type+","+ JSON.stringify(row.id) +","+JSON.stringify(row.seriesName)+","+JSON.stringify(row.categoryName)+","+JSON.stringify(row.integralNum)+")'>选择</div>";
                            }
                            return html;
                    }},
                ],
                queryParams: function (params) {
                    params.page = this.pageNumber;
                    params.size = this.pageSize;
                    params.token = quakooUser.getUserInfo().token;
                    params.subid = subid;                                 //门店ID
                    params.cid = locOrder.class;
                    params.bid = locOrder.brand;
                    params.type = locOrder.type;
                    return params;
                },
                success: function () {

                },
                onLoadSuccess: function (data) {
                }
            });
        }
        /**获取SKU*/
        function getSKU(type,spuid,spuName,categoryName,integralNum){
            locOrder.series = spuName||"";
            var title = "";
            if(type==0){
                title = '添加常规商品'
            }else if(type ==1){
                title =  '添加积分商品'
            }
            var index = layer.open({
                type: 1,
                skin: 'layui-layer-demo', //样式类名
                area: '800px',
                anim: 0,
                closeBtn: 0,
                title: title,
                shade: 0.1,
                shadeClose: true, //开启遮罩关闭
                scrollbar: false,
                content: $('.addRoutineCommodityPro'),
                resize:false,
                btn: '关闭窗口',
                move:".layui-layer-title",
                yes: function (index) {
                    layer.close(index)
                },
                success: function () {
                    renderSku(type,spuid,categoryName,integralNum);
                },
            });
        }
        /**渲染SKU*/
        function renderSku(type,spuid,categoryName,integralNum){
            var params ={};
            params.subid = subid;
            params.spuid = spuid;
            if(cusId){
                params.uid = spuid;
            }
            quakooData.ajaxGetData(config.getUrl_product_getSaleSKUAllList(),{subid:subid,spuid:spuid,uid:cusId},function (ret) {
                if(ret && ret.success){
                    var column;
                    if(ret.data){
                        nowGoodData = ret.data;
                        if(type == 0){
                            if(categoryName === '镜片'){
                                column = [
                                    { field: 'code', title: '产品编码'},
                                    { field: 'properties', title: '球' , formatter: function (value) {
                                            return value[15];
                                        }  },
                                    { field: 'properties', title: '柱', formatter: function (value) {
                                            return value[16];
                                        }},
                                    { field: 'costPrice', title: '成本价',formatter:function(value){
                                            return "¥"+(value/100).toFixed(2);
                                        }},
                                    { field: 'retailPrice', title: '零售价',formatter:function(value){
                                            return "¥"+(value/100).toFixed(2);
                                        }},
                                    { field: 'num', title: '备货量'},
                                    { field: 'canUseNum', title: '库存',formatter:function (value) {
                                            return '<span class="inventory" >'+value+'</span>';
                                        }},
                                    {field: '', title: '数量'  , formatter: function (value,row,index) {
                                            return '<input type="number" class="in-yj-input" placeholder="数量">';
                                        }
                                    },
                                    { field: '', title: '来源',formatter:function (value, row, index) {
                                            return '<div>本店</div>'
                                        }},
                                    {field: '', title: '操作'  , formatter: function (value,row,index) {
                                            return '<div class="btnSeeHistory" onclick="addConventionalProducts('+type+','+spuid+','+row.id+','+row.code+','+row.retailPrice+','+index+')">添加</div>';
                                        }
                                    }
                                ]
                            }else if(categoryName === '镜架' || categoryName === '太阳镜' ){
                                column = [
                                    { field: 'code', title: '产品编码'},
                                    /*{field: '', title: '型号'  , formatter: function (value,row,index) {
                                            return '<input type="text" class="in-yj-input-xinghao" data-index="'+index+'" placeholder="型号">';
                                        }
                                    },
                                    {field: '', title: '色号'  , formatter: function (value,row,index) {
                                            return '<input type="text" class="in-yj-input-sehao" data-index="'+index+'" placeholder="色号">';
                                        }
                                    },*/
                                    { field: 'costPrice', title: '成本价',formatter:function(value){
                                        return "¥"+(value/100).toFixed(2);
                                    }},
                                    { field: 'retailPrice', title: '零售价',formatter:function(value){
                                        return "¥"+(value/100).toFixed(2);
                                    }},
                                    { field: 'num', title: '备货量'},
                                    { field: 'canUseNum', title: '库存',formatter:function (value) {
                                            return '<span class="inventory" >'+value+'</span>';
                                        }},
                                    {field: '', title: '数量'  , formatter: function (value,row,index) {
                                            return '<input type="number" class="in-yj-input" placeholder="数量">';
                                        }
                                    },
                                    { field: '', title: '来源',formatter:function (value, row, index) {
                                            return '<div>本店</div>'
                                        }},
                                    {field: '', title: '操作'  , formatter: function (value,row,index) {
                                            return '<div class="btnSeeHistory" onclick="addConventionalProducts('+type+','+spuid+','+row.id+','+row.code+','+row.retailPrice+','+index+')">添加</div>';
                                        }
                                    }
                                ]
                            }else if(categoryName === '隐形眼镜'){
                                column = [
                                    { field: 'code', title: '产品编码'},
                                    { field: 'properties', title: '球' , formatter: function (value) {
                                            return value[15];
                                        }  },
                                    { field: 'properties', title: '柱', formatter: function (value) {
                                            return value[16];
                                        }},
                                    /* {field: '', title: '生产批号'  , formatter: function (value,row,index) {
                                             return '<input type="number" class="in-yj-input-shengchanpihao" data-index="'+index+'" placeholder="生产批号">';
                                         }
                                     },
                                     {field: '', title: '保质期'  , formatter: function (value,row,index) {
                                             return '<input type="number" class="in-yj-input-time yj-date" readonly="readonly" onfocus="selectTime(this)" data-index="'+index+'" placeholder="保质期">';
                                         }
                                     },*/
                                    { field: 'costPrice', title: '成本价',formatter:function(value){
                                        return "¥"+(value/100).toFixed(2);
                                    }},
                                    { field: 'retailPrice', title: '零售价',formatter:function(value){
                                        return "¥"+(value/100).toFixed(2);
                                    }},
                                    { field: 'num', title: '备货量'},
                                    { field: 'canUseNum', title: '库存',formatter:function (value) {
                                            return '<span class="inventory" >'+value+'</span>';
                                        }},
                                    {field: '', title: '数量'  , formatter: function (value,row,index) {
                                            return '<input type="number" class="in-yj-input" placeholder="数量">';
                                        }
                                    },
                                    { field: '', title: '来源',formatter:function (value, row, index) {
                                            return '<div>本店</div>'
                                        }},
                                    {field: '', title: '操作'  , formatter: function (value,row,index) {
                                            return '<div class="btnSeeHistory" onclick="addConventionalProducts('+type+','+spuid+','+row.id+','+row.code+','+row.retailPrice+','+index+')">添加</div>';
                                        }
                                    }
                                ]
                            }else if(categoryName === '护理产品'){
                                column = [
                                    { field: 'code', title: '产品编码'},
                                    /*{field: '', title: '生产批号'  , formatter: function (value,row,index) {
                                            return '<input type="text" class="in-yj-input-shengchanpihao" data-index="'+index+'" placeholder="生产批号">';
                                        }
                                    },
                                    {field: '', title: '保质期'  , formatter: function (value,row,index) {
                                            return '<input type="text" class="in-yj-input-time yj-date" readonly="readonly" onfocus="selectTime(this)" data-index="'+index+'" placeholder="保质期">';
                                        }
                                    },*/
                                    { field: 'costPrice', title: '成本价',formatter:function(value){
                                        return "¥"+(value/100).toFixed(2);
                                    }},
                                    { field: 'retailPrice', title: '零售价',formatter:function(value){
                                        return "¥"+(value/100).toFixed(2);
                                    }},
                                    { field: 'num', title: '备货量'},
                                    { field: 'canUseNum', title: '库存',formatter:function (value) {
                                            return '<span class="inventory" >'+value+'</span>';
                                        }},
                                    {field: '', title: '数量'  , formatter: function (value,row,index) {
                                            return '<input type="number" class="in-yj-input" placeholder="数量">';
                                        }
                                    },
                                    { field: '', title: '来源',formatter:function (value, row, index) {
                                            return '<div>本店</div>'
                                        }},
                                    {field: '', title: '操作'  , formatter: function (value,row,index) {
                                            return '<div class="btnSeeHistory" onclick="addConventionalProducts('+type+','+spuid+','+row.id+','+row.code+','+row.retailPrice+','+index+')">添加</div>';
                                        }
                                    }
                                ]
                            }else if(categoryName === '其它商品'){
                                column = [
                                    { field: 'code', title: '产品编码'},
                                    /* {field: '', title: '型号'  , formatter: function (value,row,index) {
                                             return '<input type="text" class="in-yj-input-xinghao" data-index="'+index+'" placeholder="型号">';
                                         }
                                     },*/
                                    { field: 'costPrice', title: '成本价',formatter:function(value){
                                        return "¥"+(value/100).toFixed(2);
                                    }},
                                    { field: 'retailPrice', title: '零售价',formatter:function(value){
                                        return "¥"+(value/100).toFixed(2);
                                    }},
                                    { field: 'num', title: '备货量'},
                                    { field: 'canUseNum', title: '库存',formatter:function (value) {
                                            return '<span class="inventory" >'+value+'</span>';
                                        }},
                                    {field: '', title: '数量'  , formatter: function (value,row,index) {
                                            return '<input type="number" class="in-yj-input" placeholder="数量">';
                                        }
                                    },
                                    { field: '', title: '来源',formatter:function (value, row, index) {
                                            return '<div>本店</div>'
                                        }},
                                    {field: '', title: '操作'  , formatter: function (value,row,index) {
                                            return '<div class="btnSeeHistory" onclick="addConventionalProducts('+type+','+spuid+','+row.id+','+row.code+','+row.retailPrice+','+index+')">添加</div>';
                                        }
                                    }
                                ]
                            }else if(categoryName === '特殊商品'){
                                column = [
                                    { field: 'code', title: '产品编码'},
                                    /* {field: '', title: '型号'  , formatter: function (value,row,index) {
                                             return '<input type="text" class="in-yj-input-xinghao" data-index="'+index+'" placeholder="型号">';
                                         }
                                     },*/
                                    { field: 'costPrice', title: '成本价',formatter:function(value){
                                        return "¥"+(value/100).toFixed(2);
                                    }},
                                    { field: 'retailPrice', title: '零售价',formatter:function(value){
                                        return "¥"+(value/100).toFixed(2);
                                    }},
                                    { field: 'num', title: '备货量'},
                                    { field: 'canUseNum', title: '库存',formatter:function (value) {
                                            return '<span class="inventory" >'+value+'</span>';
                                        }},
                                    {field: '', title: '数量'  , formatter: function (value,row,index) {
                                            return '<input type="number" class="in-yj-input" placeholder="数量">';
                                        }
                                    },
                                    { field: '', title: '来源',formatter:function (value, row, index) {
                                            return '<div>本店</div>'
                                        }},
                                    {field: '', title: '操作'  , formatter: function (value,row,index) {
                                            return '<div class="btnSeeHistory" onclick="addConventionalProducts('+type+','+spuid+','+row.id+','+row.code+','+row.retailPrice+','+index+')">添加</div>';
                                        }
                                    }
                                ]
                            }
                        }else if(type == 1){
                            column = [
                                { field: 'code', title: '产品编码'},
                                { field: 'integralPrice', title: '积分价',formatter:function(value){
                                        return '<span><i class="jfPrice">'+value+'</i>积分</span>';
                                    }},
                                { field: 'canUseNum', title: '库存',formatter:function (value) {
                                        return '<span class="inventory" >'+value+'</span>';
                                    }},
                                {field:'',title:'上限',formatter:function () {
                                        return '<span class="shangxian" >'+integralNum+'</span>';
                                    }},
                                {field:'',title:'可用积分',formatter:function () {
                                        if(userScore){
                                            return '<span><i class="jifen">'+userScore+'</i>积分</span>';
                                        }else{
                                            return '<span><i class="jifen">0</i>积分</span>';
                                        }
                                    }},
                                {field: '', title: '数量'  , formatter: function (value,row,index) {
                                        return '<input type="number" class="in-yj-input" placeholder="数量">';
                                    }
                                },
                                { field: '', title: '来源',formatter:function (value, row, index) {
                                        return '<div>本店</div>'
                                    }},
                                {field: '', title: '操作'  , formatter: function (value,row,index) {
                                    if(type ==0){
                                        return '<div class="btnSeeHistory" onclick="addConventionalProducts('+type+','+spuid+','+row.id+','+row.code+','+row.retailPrice+','+index+')">添加</div>';
                                    }else if(type ==1){
                                        return '<div class="btnSeeHistory" onclick="addConventionalProducts('+type+','+spuid+','+row.id+','+row.code+','+row.integralPrice+','+index+')">添加</div>';
                                    }
                                }}
                            ]
                        }
                        $("#skuTable").bootstrapTable('destroy');
                        $("#skuTable").bootstrapTable({
                            data: nowGoodData,                 //被加载的数据。
                            classes: "table",
                            sortable: false,
                            sortOrder: "asc",
                            showColumns: true,
                            strictSearch: true,
                            locale: "zh-CN",
                            paginationHAlign: "center",
                            clickToSelect: true,
                            columns: column
                        });
                    }
                }else{
                    layer.msg(ret.data)
                }
            })
        }
        /**添加常规商品*/
        function addPro(type) {
//            debugger;
            var index = layer.open({
                type: 1,
                skin: 'layui-layer-demo', //样式类名
                area: '960px',
                anim: 0,
                closeBtn: 0,
                title: '',
                shade: 0.1,
                shadeClose: true, //开启遮罩关闭
                scrollbar: false,
                content: $('.addRoutineCommodityPop'),
                resize:false,
                btn: '关闭窗口',
                move:$('.addRoutineCommodityPop h3'),
                yes: function (index) {
                    layer.close(index)
                },
                success: function (layero) {
                    if(type==0){
                        $('.addRoutineCommodityPop h3').html("选择常规商品");
                    }else if(type==1){
                        $('.addRoutineCommodityPop h3').html("选择积分商品");
                    }
                    locOrder.type = type;
                    getSPU();                       //获取类目和品牌下的SPU


                },
            });
        }
        /**添加常规商品到订单*/
        function addConventionalProducts(type,spuid,skuid,code,price,i){
            if(!cusId){
                layer.msg("请完善用户信息");
                return;
            }
            var markup = "";
            if(type == 0){
                markup = "changgui";
            }else if(type == 1){
                markup = "jifen";
            }
            var inventory = $("#skuTable tr[data-index='"+i+"'] .inventory").html()*1;//库存
            var quantity = $("#skuTable tr[data-index='"+i+"'] input").val()*1; //数量
            if(quakooUtils.isBlack(quantity)){
                layer.msg("请输入添加数量");
                return
            }else{
                if(inventory<quantity){
                    layer.msg("没有这么多库存");
                    return;
                }
            }
            if(quakooUtils.isBlack(orderFormData[markup+skuid])){
                orderFormData[markup+skuid] = {};
                if(type == 0){
                    orderFormData[markup+skuid].type = 1;
                    orderFormData[markup+skuid].discount = 10.0;//积分商品暂时没有折扣
                }else if(type == 1){
                    orderFormData[markup+skuid].type = 2;
                }
                orderFormData[markup+skuid].spuid = spuid;
                orderFormData[markup+skuid].skuid = skuid;
                if(locOrder.series){
                    orderFormData[markup+skuid].productName = locOrder.className+'-'+locOrder.brandName+'-'+locOrder.series+'-'+code;
                }
                orderFormData[markup+skuid].productName = locOrder.className+'-'+locOrder.brandName+'-'+code;
                orderFormData[markup+skuid].number = quantity;
                orderFormData[markup+skuid].price = price;
            }else if(quakooUtils.isNotBlack(orderFormData[markup+skuid])){
                orderFormData[markup+skuid].number = parseInt(quantity)+parseInt(orderFormData[markup+skuid].number);
            }
                renderOrderForm(markup+skuid);
        }
        /**查看历史记录*/
        function hisOrder() {
            var index = layer.open({
                type: 1,
                skin: '',
                area: ['720px','500px'],
                anim: 0,
                closeBtn: 0,
                title: '历史消费记录',
                shade: 0.1,
                shadeClose: true,
                scrollbar: false,
                content: $('.historyRecord'),
                resize:false,
                btn: '关闭窗口',
                move:'.layui-layer-title',
                yes: function (index,layero) {
                    layer.close(index);
                },
                success: function (layero) {
                    renderHistory()
                },
            });
            function renderHistory(){
                //历史消费记录
                $("#cmMain-table1").bootstrapTable('destroy');
                $("#cmMain-table1").bootstrapTable({
                    url: config.getUrl_order_getAllOrder(),
                    method: 'get',
                    classes: "table",
                    pagination: true,                     //是否显示分页
                    sidePagination: "server",             //分页方式：client客户端分页，server服务端分页（*）
                    pageNumber: 1,                        //初始化加载第一页，默认第一页
                    pageSize: 8,
                    pageList: [5, 10, 15, 20],
                    sortable: false,
                    sortOrder: "asc",
                    showColumns: true,
                    strictSearch: true,
                    locale: "zh-CN",
                    paginationHAlign: "center",
                    clickToSelect: true,
                    columns: [
                        { field: "payTime", title: "时间", align: "left", valign: "middle" },
                        { field: "subName", title: "门店", align: "left", valign: "middle" },
                        { field: "personnelName", title: "销售员", align: "left", valign: "middle" },
                        { field: "title", title: "订单明细", align: "left", valign: "middle", width: '31.5%' },
                        { field: "priceYuan", title: "消费金额", align: "left", valign: "middle" },
                        {
                            field: "btn", title: "操作", align: "left", valign: "middle", formatter: function () {
                                return '<div class="btnSeeHistory">查看</div>'
                            }
                        }
                    ],
                    queryParams: function (params) {
                        params.page = this.pageNumber;
                        params.size = this.pageSize;
                        params.token = quakooUser.getUserInfo().token;
                        params.uid = cusId;
                        params.subid = subid;
                        return params;
                    },
                    success: function () {

                    },
                    onLoadSuccess: function (data) {
                    }
                });

            }
        }
        var countSkuList;
        /**获取订单金额之后渲染订单表格数据*/
        function renderOrderForm(nowObj){
            /*获取金额*/
            if(quakooUtils.isNotBlack(orderFormData)){
                var params = {};
                params.uid = cusId;
                params.skuidsList=[];
                params.surchargesJson=[];
                for(var i in orderFormData){
                    if(orderFormData[i].type == 1||orderFormData[i].type == 2){
                        var obj ={};
                        obj.skuid = orderFormData[i].skuid;
                        obj.spuid = orderFormData[i].spuid;
                        obj.num = orderFormData[i].number;
                        params.skuidsList.push(obj);
                    }else if(orderFormData[i].type == 3){//附加费用
                        var obj = {};
                        obj.name = orderFormData[i].name;
                        obj.price = orderFormData[i].money*100;
                        params.surchargesJson.push(obj);
                    }else if(orderFormData[i].type == 4){//促销方式
                        params.couponid = orderFormData[i].id;
                    }
                }
                params.skuidsList=JSON.stringify(params.skuidsList);
                params.surchargesJson = JSON.stringify(params.surchargesJson);
                quakooData.ajaxGetData(config.getUrl_order_countPrice(),params,function (ret) {
                    if(ret&&ret.success){
                        layer.msg("添加成功",{icon:1});
                        countSkuList = ret.data.skuids
                        priceData = ret.data;
                        for(var i in priceData.skuids){
                            for(var j in orderFormData){
                                if(priceData.skuids[i].spuid==orderFormData[j].spuid&&priceData.skuids[i].skuid==orderFormData[j].skuid){
                                    orderFormData[j].discount = priceData.skuids[i].discount;//折扣
                                    orderFormData[j].subtotal = priceData.skuids[i].subtotal;//小计
                                }
                            }
                        }
                        priceData.userDiscount = userDiscount;
                        var data = {list: orderFormData,price:priceData};
                        var html = template("orderFormList", data);
                        $("#orderForm").html(html);

                    }else{
                        delete orderFormData[nowObj];
                        var data = {list: orderFormData,price:priceData};
                        var html = template("orderFormList", data);
                        $("#orderForm").html(html);

                        layer.msg(ret.data,{icon:4});
                        return
                    }
                })
            }else{
                priceData = false;
            }
            console.log("orderFormData",orderFormData);
            var data = {list: orderFormData,price:priceData};
            var html = template("orderFormList", data);
            $("#orderForm").html(html);

        }
        /**删除订单表格数据*/
        function delOrderItem(index){
            delete orderFormData[index];
            renderOrderForm();
        }
        /**保存订单*/
        function saveOrder(type){
            var param = {};
            if(quakooUtils.isBlack(saleUid)){//销售员
                layer.msg("请选择销售员",{icon:4});
                return;
            }
            param.personnelid = saleUid;
            if(quakooUtils.isNotBlack(processUid)){//加工师
                param.machiningid = processUid;
            }
            console.log("werwe:::",ygInfo);
            param.oiId = ygInfo['now'].id||0;
            if(quakooUtils.isBlack(subid)){
                layer.msg('请选择门店',{icon:4});
                return;
            }
            param.subid = subid;//门店id
            param.desc = $('#optometryRemarks2').html();
            param.marketingType = 1;//
            if(couponid){
                param.couponid = couponid;
            }
            authCode = $('#authCode').val();
            /*if(quakooUtils.isBlack(authCode)){
                layer.msg("请键入条形码",{icon:4});
                return;
            }*/
            param.authCode = authCode;
            param.price = parseInt($('#PaidMoney').val()*100);
            if(quakooUtils.isBlack($('#dicountPrice').html())){
                layer.msg("请选择商品",{icon:4});
                return;
            }
            param.dicountPrice = parseInt(($('#dicountPrice').html().substring(1,$('#dicountPrice').html().length))*100);
            if(quakooUtils.isBlack($('#totalPrice').html())){
                layer.msg("请选择商品",{icon:4});
                return;
            }
            param.totalPrice = parseInt(($('#totalPrice').html().substring(1,$('#totalPrice').html().length))*100);
            param.makeStatus = 6;
            if(quakooUtils.isBlack(orderFormData)){
                layer.msg('请选择商品',{icon:4});
                return;
            }
            if(quakooUtils.isBlack($('#PaidMoney').val())){
                layer.msg('请输入实收金额',{icon:4});
                return;
            }

            param.skuidsList = [];
            for(var i in orderFormData){
                if(i.indexOf('changgui')>=0||i.indexOf('jifen')>=0){
                    var obj = {};
                    obj.skuid = orderFormData[i].skuid;
                    obj.spuid = orderFormData[i].spuid;
                    obj.num = orderFormData[i].number;
                    obj.price = parseInt(orderFormData[i].price*100);
                    obj.subtotal = orderFormData[i].subtotal;
                    param.skuidsList.push(obj);
                }
                if(i.indexOf('extra')>=0){
                    param.surchargesJson = [];
                    param.surchargesJson[0] = {};
                    param.surchargesJson[0].name = orderFormData[i].name;
                    param.surchargesJson[0].price = parseInt(orderFormData[i].money*100);
                }
            }
//            param.skuidsList = JSON.stringify(param.skuidsList);
            param.skuidsList = JSON.stringify(countSkuList);
            param.surchargesJson = JSON.stringify(param.surchargesJson);
            console.log("保存订单传参：",param);
            if(type){//提交订单
                submitInfo = param;
                submitOrder();//提交订单弹窗
                return;
            }else{//保存订单
                quakooData.ajaxGetData(config.getUrl_order_saveOrder(),param,function (ret) {
                    console.log(ret);
                    if(ret&&ret.success){
                        layer.msg("订单已保存成功")
                        // layer.msg(ret.data)
                    }
                })
            }
        }
        /**提交订单*/
        function submitOrder(){
            console.log("提交订单页面间的传参:",submitInfo);
            if(submitInfo){
                printId = 0;
                layer.open({
                    type: 1,
                    skin: 'submit-Payment', //样式类名
                    area: ['600px','560px'],
                    anim: 0,
                    closeBtn: 0,
                    title: false,
                    shade: 0.01,
                    shadeClose: true, //开启遮罩关闭
                    scrollbar: false,
                    content: $('.wholeParagraph '),
                    resize:false,
                    btn: ['结算并打印小票', '取消'],
                    move:$('.title'),
                    yes: function (index, layero) {
                        if(printId){
                            printReceipts(1);
                        }else{
                            layer.msg("请先完成支付");
                        }
                        return false
                    },
                    btn2: function (index, layero) {
                        layer.close(index);
                    },
                    success: function (layero, index) {
                        //底部取货勾选框
//                        $('.layui-layer-btn').prepend('<div class="noPickUp"><input type="checkbox" id="week" /><label for="week">未取货</label></div>')
                        //渲染订单数据
                        renderSubmit(submitInfo);
                    }

                });
            }
        }
        /**渲染提交订单信息*/
        function renderSubmit(data){
            if(data){
                payOrderData.yuanjia = (data.totalPrice/100).toFixed(2);
                payOrderData.zhehoujia = (data.dicountPrice/100).toFixed(2);
                payOrderData.tehuijianmian = 0;
                payOrderData.shishou = (data.price/100).toFixed(2);
                // payOrderData.weishou = (data.dicountPrice/100-data.price/100).toFixed(2);
                payOrderData.weishou = (data.dicountPrice/100).toFixed(2);
            }
            var html = template('payDiaVerticalList',{list:payOrderData});
            $('#payDiaVertical').html(html);
        }
        /**线上付款*/
        function payDialog(type) {
            payType = type;
            var title;
            if(type == 1){
                title = '<h3 class="set-title">支付宝支付</h3>';
            }else if(type == 2){
                title = '<h3 class="set-title">微信支付</h3>';
            }
            layer.open({
                type: 1,
                skin: '', //样式类名
                area: '600px',
                anim: 0,
                closeBtn: 0,
                title: title,
                shade: 0.1,
                shadeClose: true, //开启遮罩关闭
                scrollbar: false,
                content: $('.paymentPopup'),
                resize:false,
                btn: false,
                move:$('.title'),
                success: function (layero, index) {
                    payDialogIndex = index;
                    redraw();
                }
            });
        }
        function closePay() {
            layer.close(payDialogIndex);
        }
        //重绘
        function redraw(){
            $('.paymentPopup .speedProgress li').removeClass("active").eq(0).addClass("active");
            $('.paymentPopup .payContent .content-item').removeClass('active');
            $('.paymentPopup .payContent .content-item.first').addClass('active');
            $('.paymentPopup .payContent input').val('');
        }
        //btn——输入金额下一步
        function firstNext() {
            onlinePayMoney = $('#payNum').val();
            if(quakooUtils.isBlack(onlinePayMoney)){
                layer.msg("请输入金额");
                return;
            }
            $('.paymentPopup .speedProgress li').removeClass("active").eq(1).addClass("active");
            $('.paymentPopup .payContent .content-item').removeClass('active');
            $('.paymentPopup .payContent .content-item.second').addClass('active');
            $('.paymentPopup .payContent .content-item.second input').val('');
        }
        //btn——扫码支付上一步
        function secondPre() {
            $('.paymentPopup .speedProgress li').removeClass("active").eq(0).addClass("active");
            $('.paymentPopup .payContent .content-item').removeClass('active');
            $('.paymentPopup .payContent .content-item.first').addClass('active');
        }
        //btn——扫码支付下一步
        function secondNext() {
            var authCode = $('#testCode').val();
            if(quakooUtils.isBlack(authCode)){
                layer.msg('请输入条形码',{icon:1});
                return;
            }
            submitInfo.uid = cusId;
            submitInfo.price = 1;
            submitInfo.authCode = authCode;
            submitInfo.type = 1;
            submitInfo.desc = "desc";
            console.log("支付接口参数：",submitInfo);
            if(payType == 1){
                quakooData.ajaxGetData(config.getUrl_order_handleAliBarcodeOrder(),submitInfo,function (ret) {
                    console.log("支付宝付款返回值：",ret);
                    if(ret&&ret.success){
                        printId = ret.data.id;
                        layer.msg("支付成功",{icon:1});
                        // payOrderData.weishou = payOrderData.weishou-ret.data.;
                        ret.data.price = (ret.data.price/100).toFixed(2);
                        if(quakooUtils.isNotBlack(ret.data.info)){
                            if(quakooUtils.isBlack(ret.data.info.yuanYongRes)||(quakooUtils.isBlack(ret.data.info.yuanYongRes.leftResItem)&&quakooUtils.isBlack(ret.data.info.yuanYongRes.rightResItem))){
                                ret.data.info.yuanYongRes = null;
                            }else{
                                ret.data.info.yuanYongRes.leftResItemHtml ='';
                                ret.data.info.yuanYongRes.rightResItemHtml ='';
                                for(var i in ret.data.info.yuanYongRes.leftResItem){
                                    ret.data.info.yuanYongRes.leftResItemHtml+= i+':'+ret.data.info.yuanYongRes.leftResItem[i]+'&nbsp';
                                }
                                for(var i in ret.data.info.yuanYongRes.rightResItem){
                                    ret.data.info.yuanYongRes.rightResItemHtml += i+':'+ret.data.info.yuanYongRes.rightResItem[i]+'&nbsp';
                                }
                            }
                            if(quakooUtils.isBlack(ret.data.info.yinXingRes)||(quakooUtils.isBlack(ret.data.info.yinXingRes.leftResItem)&&quakooUtils.isBlack(ret.data.info.yinXingRes.rightResItem))){
                                ret.data.info.yinXingRes = null;
                            }else{
                                ret.data.info.yinXingRes.leftResItemHtml ='';
                                ret.data.info.yinXingRes.rightResItemHtml ='';
                                for(var i in ret.data.info.yinXingRes.leftResItem){
                                    ret.data.info.yinXingRes.leftResItemHtml+= i+':'+ret.data.info.yinXingRes.leftResItem[i]+'&nbsp';
                                }
                                for(var i in ret.data.info.yinXingRes.rightResItem){
                                    ret.data.info.yinXingRes.rightResItemHtml += i+':'+ret.data.info.yinXingRes.rightResItem[i]+'&nbsp';
                                }
                            }
                            if(quakooUtils.isBlack(ret.data.info.jinYongRes)||(quakooUtils.isBlack(ret.data.info.jinYongRes.leftResItem)&&quakooUtils.isBlack(ret.data.info.jinYongRes.rightResItem))){
                                ret.data.info.jinYongRes = null;
                            }else{
                                ret.data.info.jinYongRes.leftResItemHtml ='';
                                ret.data.info.jinYongRes.rightResItemHtml ='';
                                for(var i in ret.data.info.jinYongRes.leftResItem){
                                    ret.data.info.jinYongRes.leftResItemHtml+= i+':'+ret.data.info.jinYongRes.leftResItem[i]+'&nbsp';
                                }
                                for(var i in ret.data.info.jinYongRes.rightResItem){
                                    ret.data.info.jinYongRes.rightResItemHtml += i+':'+ret.data.info.jinYongRes.rightResItem[i]+'&nbsp';
                                }
                            }
                            if(quakooUtils.isBlack(ret.data.info.jianJinDuoJiaoDianRes)||(quakooUtils.isBlack(ret.data.info.jianJinDuoJiaoDianRes.leftResItem)&&quakooUtils.isBlack(ret.data.info.jianJinDuoJiaoDianRes.rightResItem))){
                                ret.data.info.jianJinDuoJiaoDianRes = null;
                            }else{
                                ret.data.info.jianJinDuoJiaoDianRes.leftResItemHtml ='';
                                ret.data.info.jianJinDuoJiaoDianRes.rightResItemHtml ='';
                                for(var i in ret.data.info.jianJinDuoJiaoDianRes.leftResItem){
                                    ret.data.info.jianJinDuoJiaoDianRes.leftResItemHtml+= i+':'+ret.data.info.jianJinDuoJiaoDianRes.leftResItem[i]+'&nbsp';
                                }
                                for(var i in ret.data.info.jianJinDuoJiaoDianRes.rightResItem){
                                    ret.data.info.jianJinDuoJiaoDianRes.rightResItemHtml += i+':'+ret.data.info.jianJinDuoJiaoDianRes.rightResItem[i]+'&nbsp';
                                }
                            }
                        }
                        console.log("支付渲染数据",ret.data);
                        payOrderData.returnData = ret.data;
                        renderSubmit();
                        $('.paymentPopup .speedProgress li').removeClass("active").eq(2).addClass("active");
                        $('.paymentPopup .payContent .content-item').removeClass('active');
                        $('.paymentPopup .payContent .content-item.third').addClass('active');
                    }else{
                        layer.msg(ret.data);
                    }
                });
            }else if(payType == 2){
                alert("微信");
                quakooData.ajaxGetData(config.getUrl_order_handleWxBarcodeOrder(),submitInfo,function(ret){
                    console.log("微信支付返回值：",ret);
                    if(ret&&ret.success){
                        printId = ret.data.id;
                        layer.msg("支付成功",{icon:1});
                        // payOrderData.weishou = payOrderData.weishou-ret.data.;
                        ret.data.price = (ret.data.price/100).toFixed(2);
                        if(quakooUtils.isNotBlack(ret.data.info)){
                            if(quakooUtils.isBlack(ret.data.info.yuanYongRes)||(quakooUtils.isBlack(ret.data.info.yuanYongRes.leftResItem)&&quakooUtils.isBlack(ret.data.info.yuanYongRes.rightResItem))){
                                ret.data.info.yuanYongRes = null;
                            }else{
                                ret.data.info.yuanYongRes.leftResItemHtml ='';
                                ret.data.info.yuanYongRes.rightResItemHtml ='';
                                for(var i in ret.data.info.yuanYongRes.leftResItem){
                                    ret.data.info.yuanYongRes.leftResItemHtml+= i+':'+ret.data.info.yuanYongRes.leftResItem[i]+'&nbsp';
                                }
                                for(var i in ret.data.info.yuanYongRes.rightResItem){
                                    ret.data.info.yuanYongRes.rightResItemHtml += i+':'+ret.data.info.yuanYongRes.rightResItem[i]+'&nbsp';
                                }
                            }
                            if(quakooUtils.isBlack(ret.data.info.yinXingRes)||(quakooUtils.isBlack(ret.data.info.yinXingRes.leftResItem)&&quakooUtils.isBlack(ret.data.info.yinXingRes.rightResItem))){
                                ret.data.info.yinXingRes = null;
                            }else{
                                ret.data.info.yinXingRes.leftResItemHtml ='';
                                ret.data.info.yinXingRes.rightResItemHtml ='';
                                for(var i in ret.data.info.yinXingRes.leftResItem){
                                    ret.data.info.yinXingRes.leftResItemHtml+= i+':'+ret.data.info.yinXingRes.leftResItem[i]+'&nbsp';
                                }
                                for(var i in ret.data.info.yinXingRes.rightResItem){
                                    ret.data.info.yinXingRes.rightResItemHtml += i+':'+ret.data.info.yinXingRes.rightResItem[i]+'&nbsp';
                                }
                            }
                            if(quakooUtils.isBlack(ret.data.info.jinYongRes)||(quakooUtils.isBlack(ret.data.info.jinYongRes.leftResItem)&&quakooUtils.isBlack(ret.data.info.jinYongRes.rightResItem))){
                                ret.data.info.jinYongRes = null;
                            }else{
                                ret.data.info.jinYongRes.leftResItemHtml ='';
                                ret.data.info.jinYongRes.rightResItemHtml ='';
                                for(var i in ret.data.info.jinYongRes.leftResItem){
                                    ret.data.info.jinYongRes.leftResItemHtml+= i+':'+ret.data.info.jinYongRes.leftResItem[i]+'&nbsp';
                                }
                                for(var i in ret.data.info.jinYongRes.rightResItem){
                                    ret.data.info.jinYongRes.rightResItemHtml += i+':'+ret.data.info.jinYongRes.rightResItem[i]+'&nbsp';
                                }
                            }
                            if(quakooUtils.isBlack(ret.data.info.jianJinDuoJiaoDianRes)||(quakooUtils.isBlack(ret.data.info.jianJinDuoJiaoDianRes.leftResItem)&&quakooUtils.isBlack(ret.data.info.jianJinDuoJiaoDianRes.rightResItem))){
                                ret.data.info.jianJinDuoJiaoDianRes = null;
                            }else{
                                ret.data.info.jianJinDuoJiaoDianRes.leftResItemHtml ='';
                                ret.data.info.jianJinDuoJiaoDianRes.rightResItemHtml ='';
                                for(var i in ret.data.info.jianJinDuoJiaoDianRes.leftResItem){
                                    ret.data.info.jianJinDuoJiaoDianRes.leftResItemHtml+= i+':'+ret.data.info.jianJinDuoJiaoDianRes.leftResItem[i]+'&nbsp';
                                }
                                for(var i in ret.data.info.jianJinDuoJiaoDianRes.rightResItem){
                                    ret.data.info.jianJinDuoJiaoDianRes.rightResItemHtml += i+':'+ret.data.info.jianJinDuoJiaoDianRes.rightResItem[i]+'&nbsp';
                                }
                            }
                        }
                        console.log("支付渲染数据",ret.data);
                        payOrderData.returnData = ret.data;
                        renderSubmit();

                        $('.paymentPopup .speedProgress li').removeClass("active").eq(2).addClass("active");
                        $('.paymentPopup .payContent .content-item').removeClass('active');
                        $('.paymentPopup .payContent .content-item.third').addClass('active');
                    }else{
                        layer.msg(ret.data);
                    }

                })
            }
        }
        //btn——完成支付
        function finish(){
            closePay();
        }
        //渲染提交订单
        function redrawSubmitOrder(data){

        }
        /**退款弹窗*/
        function reimburse(oid,type) {
            layer.open({
                type: 1,
                shade: 0.01,
                title: '确定退款？',
                skin: 'layui-layer-removeStaff-tan', //样式类名
                anim: 0,
                area: ['240px', '130px'],
                closeBtn: 0, //不显示关闭按钮
                resize:false,
                resize: false,
                shadeClose: true, //开启遮罩关闭
                content: $('.content-view-removeStaff'),
                btn: ['确定', '取消'],
                yes: function (index) {
                    if(type==1){
                        quakooData.ajaxGetData(config.getUrl_order_createAliRefundOrder(),{oid:oid},function(ret){
                            console.log('创建支付订单',ret);
                            if(ret&&ret.data){
                                quakooData.ajaxGetData(config.getUrl_order_handleAliRefundOrder(),{roid:ret.data.id},function(ret){
                                    console.log("支付宝退款：",ret);
                                    if(ret&&ret.success&&ret.data){

                                        layer.msg("退款成功",{icon:1});
                                        layer.close(index);

                                    }
                                })
                            }
                        })
                    }else if(type == 2){
                        quakooData.ajaxGetData(config.getUrl_order_createWxRefundOrder(),{oid:oid},function(ret){
                            console.log('创建支付订单',ret);
                            if(ret&&ret.data){
                                quakooData.ajaxGetData(config.getUrl_order_handleWxRefundOrder(),{roid:ret.data.id},function(ret){
                                    console.log("微信退款：",ret);
                                    if(ret&&ret.success&&ret.data){
                                        layer.msg("退款成功",{icon:1});
                                        layer.close(index);

                                    }else{
                                        layer.msg("退款失败");
                                        layer.close(index);
                                    }
                                })
                            }else{
                                layer.msg("退款失败");
                                layer.close(index);
                            }
                        })
                    }
                },
                btn2: function (index) {

                }
            });
        }

        /**结算并打印小票*/
        function printReceipts(oper){
            bdhtml=window.document.body.innerHTML;	//获取当前页的html代码
            sprnstr="<!--startprint"+oper+"-->";	//设置打印开始区域
            eprnstr="<!--endprint"+oper+"-->";	//设置打印结束区域
            prnhtml=bdhtml.substring(bdhtml.indexOf(sprnstr)+18); //从开始代码向后取html
            prnhtml=prnhtml.substring(0,prnhtml.indexOf(eprnstr));//从结束代码向前取html
            window.document.body.innerHTML=prnhtml;
            window.print();
            window.document.body.innerHTML=bdhtml;
        }
        /***************************************************订单信息结束*****************************************************/




        //弹窗开始
/*
            title: '<h3 class="set-title">
        $('.noRegisterYZ').bind('click', {验证会员</h3>',
            popupBox: $('.verify'),
            area: ['240px'],
            btn: ['验证', '取消']
        }, addAlert);
        $('.btnYesRegister').bind('click', {
            title: ' <h3 class="set-title">储值卡充值</h3>',
            popupBox: $('.card-pay'),
            btn: ['充值', '取消'],
            area: ['240px'],
            fn: function () {
                console.log(1);
            }
        }, addAlert);
*/
        //付款结算弹窗
/*******************************************公共开始**********************************************/
        /**
         * 时间插件
         * */
        $(function () {
            var curr = new Date().getFullYear();
            var opt = {};
            opt.date = { preset: 'date' };
            opt.datetime = { preset: 'datetime' };
            opt.time = { preset: 'time' };

            opt.default = {
                theme: 'mbsc-android-holo', //皮肤样式
                display: 'bubble', //显示方式
                mode: 'scroller', //日期选择模式
                dateFormat: 'yyyy-mm-dd',
                lang: 'zh',
                showNow: true,
                nowText: "今天",
                typeNum: 'day',//day：获取到日，time：获取到时，branch：获取到分；默认是获取到分
            };
            $('.settings2').bind('change', function () {
                var demo = 'datetime';
                if (!demo.match(/select/i)) {
                    $('.demo-test-' + demo).val('');
                }
                $('.demo-test-' + demo).scroller('destroy').scroller($.extend(opt['datetime'], opt['default']));
                $('.demo').hide();
                $('.demo-' + demo).show();
            });
            $('#demo2').trigger('change');
            return curr;
        });
/****************************公共结束*******************************/

    </script>
</body>

</html>