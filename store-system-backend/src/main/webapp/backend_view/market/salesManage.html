<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <title>营销管理</title>
    <!--Bootstrap样式引入开始-->
    <link rel="stylesheet" href="../resource/css/bootstrap.min.css">
    <link href="../resource/js/plugins/bootstarp-table/css/bootstrap-table.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../resource/js/plugins/bootstrapzTree/bootstrapStyle.css" type="text/css">
    <link rel="stylesheet" href="../resource/js/plugins/bootstrap-select/css/bootstrap-select.min.css" type="text/css">
    <link href="../resource/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
    <link rel="stylesheet" href="../resource/layui/css/layui.css">
    <link href="../resource/css/yanjing/mobiscroll.2.13.2.css" rel="stylesheet">
    <link href="../resource/css/yanjing/myDate.css" rel="stylesheet">
    <!--Bootstrap样式引入结束-->
    <!--字体样式文件引用开始-->
    <link rel="stylesheet" href="../resource/fonts/iconfont.css">
    <!--字体样式文件引用结束-->
    <!--标签样式重置开始-->
    <link rel="stylesheet" href="../resource/css/reset.css">
    <!--标签样式重置结束-->
    <!--公用组件样式-->
    <link rel="stylesheet" href="../resource/css/common.css">
    <!--公用组件样式结束-->
    <!--单页样式-->
    <link rel="stylesheet" href="../resource/css/yanjing/market.css">
    <!--单页样式结束-->

</head>
<body class="body-bg">
<div class="header clear">
    <ul class="tab-ul clear">
        <li class="active" onclick="changeType(1)">抵用券营销</li>
        <!--<li>短信营销</li>-->
        <li data-id="send" onclick="changeType(2)">短信群发</li>
        <li onclick="changeType(3)">任务奖励</li>
    </ul>
    <ol>
        <li class="right-info active">
            <button onclick="voucherDialog()">新增抵用券</button>
        </li>
        <!--<li class="right-info">-->
        <!--&lt;!&ndash;<span>剩余 1200 条信息可用</span>&ndash;&gt;-->
        <!--</li>-->
        <li class="right-info">
            <!--<span>剩余 1200 条信息可用</span>-->
            <button onclick="newVouchers3()">新增短信群发</button>
        </li>
        <li class="right-info">
            <button onclick="createTask()">创建任务</button>
        </li>
    </ol>
</div>
<div class="content">
    <ul>
        <li class="tab-item first active">
            <ol class="clear" id="card-list1">
            </ol>
            <table id="yj-page-table" data-toggle="table" class="table table-border"></table>
        </li>
        <!--<li class="tab-item section ">
            <ol class="clear" id="yj-page-note-table">
                <li class="card-item">
                    <div class="inner">
                        <div class="top">
                            <div class="text">
                                <div class="main">消费信息提醒</div>
                                <div class="vice">消费后发送信息至顾客的手机或微信中</div>
                            </div>
                            <div class="switch">
                                <span class="off">未开启</span>
                                <span class="on">已启用</span>
                                <span class="switch-btn"><i></i></span>
                            </div>
                        </div>
                        <div class="cont">
                            <div class="off"  onclick="newVouchers2()">
                                <i class="iconfont icon-ico_setting_filled"></i>
                                <span>设置</span>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="card-item">
                    <div class="inner">
                        <div class="top">
                            <div class="text">
                                <div class="main">消费信息提醒</div>
                                <div class="vice">消费后发送信息至顾客的手机或微信中</div>
                            </div>
                            <div class="switch active">
                                <span class="off">未开启</span>
                                <span class="on">已启用</span>
                                <span class="switch-btn"><i></i></span>
                            </div>
                        </div>
                        <div class="cont">
                            <div class="on">
                                <div class="message-top">
                                    <span class="fl">短信内容</span>
                                    <input class="fr button-thin" type="button" onclick="newVouchers2()" value="编辑">
                                </div>
                                <div class="message-cont">
                                    尊敬的xxx你好，你在xxxx你好，你在xxxxx消费了xx尊敬的xxx你好，你在xxxxx消费了xxx元，欢迎你下次再来。
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
            </ol>
        </li>-->
        <li class="tab-item">
            <table id="dxqf-table" data-toggle="table" class="table table-border"></table>
        </li>
        <li class="tab-item">
            <table id="rwjl-table" data-toggle="table" class="table table-border"></table>
        </li>
    </ul>
</div>
<div class="content-view1" id="voucherDiaUl">
</div>
<div class="content-view2">
    <div class="top-name layui-layer-title ">
        编辑隐形眼镜药水消费提醒
    </div>

</div>
<div class="content-view3" id="groupMessagingUl">
</div>


<!--任务奖励弹窗——创建任务弹窗-->
<div class="create-task" id="taskDialogHtml">
</div>
<!--任务奖励弹窗——选择任务对象-->
<div class="task-object">
    <div class="content">
        <div class="table">
            <table id="object-table" data-toggle="table" class="table"></table>
        </div>
    </div>
</div>
<div class="task-object2" style="display: none;">
    <div class="content">
        <div class="table">
            <table id="object-table2" data-toggle="table" class="table"></table>
        </div>
    </div>
</div>
<!--任务奖励弹窗——选择任务门店-->
<div class="task-shop scroll-content">
    <div class="task-header">选择任务门店</div>
    <div class="content">
        <div class="table-box">
            <table id="shop-table" data-toggle="table" class="table"></table>
        </div>
    </div>
</div>
<!--任务奖励弹窗——选择任务产品-->
<div class="task-product" id="product">
</div>
<!--任务奖励弹窗——确定删除任务-->
<div class="delete-task">
    <div class="delete-header layui-layer-title">确定删除任务？</div>
    <div class="content">此操作不可撤销</div>
</div>
<!--全局JS引用-->
<!-- jq库 -->
<script src="../resource/js/jquery.min.js"></script>
<!-- bootstrap UI需要依赖的js -->
<script src="../resource/js/bootstrap.js?v=3.3.6"></script>
<script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table.js"></script>
<script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table-zh-CN.min.js"></script>
<!-- layui需要依赖的js -->
<script src="../resource/js/plugins/layer/layer.js"></script>
<script src="../resource/layui/layui.js"></script>
<!-- 公司内部库 -->
<script src="../resource/js/lib/quakooLib/QuakooBase-1.0.0.js"></script>
<script src="../resource/js/lib/quakooLib/QuakooConfig-1.0.0.js"></script>
<script src="../resource/js/lib/quakooLib/QuakooBasePc-1.0.0.js"></script>
<script src="../resource/js/lib/quakoo/Config.js"></script>
<script src="../resource/js/lib/quakoo/project.js"></script>
<script src="../resource/js/template-native.js"></script>

<!-- 全局公共js -->
<script src="../resource/js/yanjing.js"></script>
<!--单个时间插件-->
<script src="../resource/js/mobiscroll.2.13.2.js"></script>
<!--//日期范围插件开始-->
<script src="../resource/js/yanjing/daterange.js"></script>
<!--//日期范围插件结束-->
<script src="../resource/js/yanjing/tuodong.js"></script>

<!--抵用券营销卡片Table-->
<script type="text/html" id="voucherList">
    <%for(var i = 0; i < list.length; i++){%>
        <li class="card-item">
            <div class="top">
                <%if(list[i].open == 1){%>
                <div class="switch active fr" attr-open="2" onclick="updateOpen('<%=list[i].id%>',this)">
                    <span class="on">已启用</span>
                    <span class="switch-btn"><i></i></span>
                </div>
                <%}else if(list[i].open == 2){%>
                <div class="switch fr" attr-open="1" onclick="updateOpen('<%=list[i].id%>',this)">
                    <span class="off">未开启</span>
                    <span class="switch-btn"><i></i></span>
                </div>
                <%}%>
                <div class="text fl"><%=list[i].title%></div>
            </div>
            <div class="middle-cont">
                <div class="item">
                    <div class="text-top">获取条件</div>
                    <%if(list[i].conditionType == 1){%>
                    <div class="text-bot">全场通用</div>
                    <%}else if(list[i].conditionType == 2){%>
                    <div class="text-bot">消费满<%=list[i].conditionFull%>元</div>
                    <%}else if(list[i].conditionType == 3){%>
                    <div class="text-bot">消费满<%=list[i].conditionFull%>个</div>
                    <%}%>
                </div>
                <div class="item">
                    <div class="text-top">抵用券描述</div>
                    <%if(list[i].descFullType == 1&&list[i].descSubtractType ==1){%>
                    <div class="text-bot">消费满<%=list[i].descFull%>元减<%=list[i].descSubtract%>元</div>
                    <%}else if(list[i].descFullType == 1&&list[i].descSubtractType ==2){%>
                    <div class="text-bot">消费满<%=list[i].descFull%>元减<%=list[i].descSubtract%>%</div>
                    <%}else if(list[i].descFullType == 2&&list[i].descSubtractType ==1){%>
                    <div class="text-bot">消费满<%=list[i].descFull%>个减<%=list[i].descSubtract%>元</div>
                    <%}else if(list[i].descFullType == 1&&list[i].descSubtractType ==1){%>
                    <div class="text-bot">消费满<%=list[i].descFull%>个减<%=list[i].descSubtract%>%</div>
                    <%}%>
                </div>
                <div class="item">
                    <div class="text-top">有效期</div>
                    <div class="text-bot"><%=list[i].startTimeText%> - <%=list[i].endTimeText%></div>
                </div>
            </div>
            <div class="bot-cont">
                <span class="button button-thin-blue" onclick="voucherDialog('<%=list[i].id%>')">编辑</span>
                <span class="button button-thin-red" onclick="delVoucher('<%=list[i].id%>')">删除</span>
            </div>
        </li>
    <%}%>
</script>
<!--抵用券营销弹窗-->
<script type="text/html" id="voucherDiaTem">
    <form action="">
        <div class="lay-header">
            <%if(list.id){%>
                <span class="lay-title" id="voucher-title">编辑抵用券</span>
                <%if(list.open == 1){%>
                    <div class="switch active fr" id="voucherSwitch">
                        <span class="off">未开启</span>
                        <span class="on">已启用</span>
                        <span class="switch-btn"><i></i></span>
                    </div>
                <%}else if(list.open == 2){%>
                    <div class="switch fr" id="voucherSwitch">
                        <span class="off">未开启</span>
                        <span class="on">已启用</span>
                        <span class="switch-btn"><i></i></span>
                    </div>
                 <%}%>
            <%}else{%>
                <span class="lay-title" id="voucher-title">新增抵用券</span>
                <div class="switch active fr" id="voucherSwitch">
                    <span class="off">未开启</span>
                    <span class="on">已启用</span>
                    <span class="switch-btn"><i></i></span>
                </div>
            <%}%>
        </div>
        <div class="lay-content">
            <ol>
                <li class="lay-row title clear">
                    <div class="left">抵用券标题</div>
                    <%if(list.id){%>
                        <input class="right" type="text" placeholder="抵用券标题"  value="<%=list.title%>" id="voucherTitle">
                    <%}else{%>
                    <input class="right" type="text" placeholder="抵用券标题" id="voucherTitle">
                    <%}%>
                </li>
                <li class="lay-row describe clear">
                    <div class="left">抵用券描述</div>
                    <div class="right">
                        <strong>消费满</strong>
                        <%if(list.descFull){%>
                            <input type="number" placeholder="数值" value="<%=list.descFull%>" id="describefull">
                        <%}else{%>
                            <input type="number" placeholder="数值" id="describefull">
                        <%}%>
                        <div class="selectBox" id="selectBox1">
                            <div class="select-box-header">
                                <%if(list.descFullType == 1){%>
                                <span class="text">元</span><i class="iconfont icon-ico_arrow_down"></i>
                                <%}else if(list.descFullType == 2){%>
                                <span class="text">个</span><i class="iconfont icon-ico_arrow_down"></i>
                                <%}%>
                            </div>
                            <div class="optionBox">
                                <ul class="optionUL">
                                    <li value="1">元</li>
                                    <li value="2">个</li>
                                </ul>
                            </div>
                        </div>
                        <strong>减</strong>
                        <%if(list.descSubtract){%>
                            <input type="number" placeholder="数值" value="<%=list.descSubtract%>" id="describeSubtract">
                        <%}else{%>
                            <input type="number" placeholder="数值" id="describeSubtract">
                        <%}%>
                        <div class="selectBox" id="selectBox2">
                            <div class="select-box-header">
                                <%if(list.descSubtractType == 1){%>
                                    <span class="text">元</span><i class="iconfont icon-ico_arrow_down"></i>
                                <%}else if(list.descSubtractType == 2){%>
                                    <span class="text">%</span><i class="iconfont icon-ico_arrow_down"></i>
                                <%}%>
                            </div>
                            <div class="optionBox">
                                <ul class="optionUL">
                                    <li value="1">元</li>
                                    <li value="2">%</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="lay-row clear">
                    <div class="left">获取条件</div>
                    <div class="right radio-button">
                        <%if(list.conditionType == 1){%>
                            <div class="box">
                                <input type="radio" name="condition" id="condition1" data-id="1" checked>
                                <label for="condition1">
                                    <div class="selectBox" id="selectBox3">
                                        <div class="select-box-header">
                                            <span class="text">全场通用</span><i class="iconfont icon-ico_arrow_down"></i>
                                        </div>
                                        <div class="optionBox">
                                            <ul class="optionUL">
                                                <li value="1">全场通用</li>
                                            </ul>
                                        </div>
                                    </div>
                                </label>
                            </div>
                            <div class="box" id="voucherCondition">
                                <input type="radio" name="condition" id="condition2" data-id="2">
                                <label for="condition2">
                                    <span>消费满</span>
                                    <input type="number" placeholder="数值" id="conditionFull"/>
                                    <span class="condition-type">元</span>
                                    <div class="selectBox" id="selectBox4">
                                        <div class="select-box-header">
                                            <span class="text">元</span><i class="iconfont icon-ico_arrow_down"></i>
                                        </div>
                                        <div class="optionBox">
                                            <ul class="optionUL">
                                                <li value="1">元</li>
                                                <li value="2">个</li>
                                            </ul>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        <%}else{%>
                            <div class="box">
                                <input type="radio" name="condition" id="condition1" data-id="1">
                                <label for="condition1">
                                    <div class="selectBox" id="selectBox3">
                                        <div class="select-box-header">
                                            <span class="text">全场通用</span><i class="iconfont icon-ico_arrow_down"></i>
                                        </div>
                                        <div class="optionBox">
                                            <ul class="optionUL">
                                                <li value="1">全场通用</li>
                                            </ul>
                                        </div>
                                    </div>
                                </label>
                            </div>
                            <div class="box" id="voucherCondition">
                                <input type="radio" name="condition" id="condition2" data-id="2" checked>
                                <label for="condition2">
                                    <span>消费满</span>
                                    <%if(list.conditionFull){%>
                                        <input type="number" placeholder="数值" value="<%=list.conditionFull%>" id="conditionFull"/>
                                    <%}else{%>
                                        <input type="number" placeholder="数值" id="conditionFull"/>
                                    <%}%>
                                    <span class="condition-type">元</span>
                                    <div class="selectBox" id="selectBox4">
                                        <div class="select-box-header">
                                            <%if(list.conditionType == 2){%>
                                            <span class="text">元</span><i class="iconfont icon-ico_arrow_down"></i>
                                            <%}else if(list.conditionType == 3){%>
                                            <span class="text">个</span><i class="iconfont icon-ico_arrow_down"></i>
                                            <%}%>
                                        </div>
                                        <div class="optionBox">
                                            <ul class="optionUL">
                                                <li value="1">元</li>
                                                <li value="2">个</li>
                                            </ul>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        <%}%>
                    </div>
                </li>
                <li class="lay-row time clear">
                    <div class="left">有效期</div>
                    <div class="right">
                        <div class="yj-demo-time">
                            <div class="yj-date">
                                <%if(list.startTime && list.startTimeText){%>
                                    <span id="voucherTime"><%=list.startTimeText%>-<%=list.endTimeText%></span><i class="iconfont icon-ico_calendar"></i>
                                <%}else{%>
                                    <span id="voucherTime">开始时间-结束时间</span><i class="iconfont icon-ico_calendar"></i>
                                <%}%>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="lay-row clear">
                    <div class="left">排序</div>
                    <%if(list.sort){%>
                        <input type="number" class="right" placeholder="数字序号" value="<%=list.sort%>" id="voucherSort">
                    <%}else{%>
                        <input type="number" class="right" placeholder="数字序号" id="voucherSort">
                    <%}%>
                </li>
            </ol>
        </div>
    </form>
</script>
<!--短信群发弹窗-->
<script type="text/html" id="groupMessagingTem">
        <div class="customer">
            <div class="title">面向顾客</div>
            <div class="contents">
                <ol>
                    <li class="item clear">
                        <div class="left">属性</div>
                        <div class="right radio-button" id="pro">
                            <%if(list.range==1){%>
                                <input type="radio" name="property" id="pro1" value="0">
                                <label for="pro1">全部</label>
                                <input type="radio" name="property" id="pro2" value="1" checked>
                                <label for="pro2">会员</label>
                                <input type="radio" name="property" id="pro3" value="2">
                                <label for="pro3">非会员</label>
                            <%}else if(list.range==2){%>
                                <input type="radio" name="property" id="pro1" value="0">
                                <label for="pro1">全部</label>
                                <input type="radio" name="property" id="pro2" value="1">
                                <label for="pro2">会员</label>
                                <input type="radio" name="property" id="pro3" value="2" checked>
                                <label for="pro3">非会员</label>
                            <%}else{%>
                                <input type="radio" name="property" id="pro1" value="0" checked>
                                <label for="pro1">全部</label>
                                <input type="radio" name="property" id="pro2" value="1">
                                <label for="pro2">会员</label>
                                <input type="radio" name="property" id="pro3" value="2">
                                <label for="pro3">非会员</label>
                            <%}%>

                        </div>
                    </li>
                    <li class="item clear">
                        <div class="left">性别</div>
                        <div class="right radio-button" id="sex">
                            <%if(list.sex==1){%>
                            <input type="radio" name="sex" id="sex1" value="0">
                            <label for="sex1">全部</label>
                            <input type="radio" name="sex" value="1" id="sex2" checked>
                            <label for="sex2">男</label>
                            <input type="radio" name="sex" value="2" id="sex3">
                            <label for="sex3">女</label>
                            <%}else if(list.sex==2){%>
                            <input type="radio" name="sex" id="sex1" value="0">
                            <label for="sex1">全部</label>
                            <input type="radio" name="sex" value="1" id="sex2">
                            <label for="sex2">男</label>
                            <input type="radio" name="sex" value="2" id="sex3" checked>
                            <label for="sex3">女</label>
                            <%}else{%>
                            <input type="radio" name="sex" id="sex1" value="0" checked>
                            <label for="sex1">全部</label>
                            <input type="radio" name="sex" value="1" id="sex2">
                            <label for="sex2">男</label>
                            <input type="radio" name="sex" value="2" id="sex3">
                            <label for="sex3">女</label>
                            <%}%>
                        </div>
                    </li>
                    <li class="item clear">
                        <div class="left">职业</div>
                        <div class="right">
                            <div class="selectBox" id="selectBox5">
                                <div class="select-box-header">
                                    <%if(list.job){%>
                                        <span class="text"><%=list.job%></span><i class="iconfont icon-ico_arrow_down"></i>
                                    <%}else{%>
                                        <span class="text">全部职业</span><i class="iconfont icon-ico_arrow_down"></i>
                                    <%}%>
                                </div>
                                <div class="optionBox">
                                    <%if(jobList.length>0){%>
                                        <ul class="optionUL" id="jobUl">
                                            <%for(var i =0;i< jobList.length;i++){%>
                                            <li value="<%=jobList[i]%>"><%=jobList[i]%></li>
                                            <%}%>
                                        </ul>
                                    <%}%>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="item clear">
                        <div class="left">年龄</div>
                        <div id="slide1" class=" right"></div>
                    </li>
                </ol>
            </div>
        </div>
        <div class="sms">
            <div class="title">短信内容</div>
            <div id="moveBox">
                <div id="moveBar" ondragover="allowDrop(event)" ondrop="drop(event)">
                    <%if(list.content.indexOf('@var(user_name)')<0){%>
                    <div class="movebar" id="moveBar2" draggable="true" ondragstart="drag(event)">顾客姓名</div>
                    <%}%>
                    <%if(list.content.indexOf('@var(sub_name)')<0){%>
                    <div class="movebar" id="moveBar1" draggable="true" ondragstart="drag(event)">门店名称</div>
                    <%}%>
                </div>
                <div class="fill">
                    <div class="fill-tip">编辑输入框中的内容或拖动字段</div>
                    <div class="fill-box">
                        <%if(list.content.indexOf('@var(sub_name)')>=0 || list.content.indexOf('@var(user_name)')>=0){%>
                        <div class="fill-div" id="fill-div" onclick="changeArea()" ondragover="allowDrop(event)"
                             ondrop="drop(event)"><%=changeContent(list.content)%>
                        </div>
                        <%}else{%>
                        <div class="fill-div" id="fill-div" onclick="changeArea()" ondragover="allowDrop(event)"
                             ondrop="drop(event)">尊敬的你好，你在消费了元，欢迎你下次再来。
                        </div>
                        <%}%>
                        <%if(list.content.indexOf('@var(sub_name)')>=0 || list.content.indexOf('@var(user_name)')>=0){%>
                        <textarea name="" onclick="textareaClick()" onblur="textareaBlur()" class="fill-text"
                                  id="fill-text"><%=changeContentText(list.content)%></textarea>
                        <%}else{%>
                        <textarea name="" onclick="textareaClick()" onblur="textareaBlur()" class="fill-text"
                                  id="fill-text">尊敬的你好，你在消费了元，欢迎你下次再来。</textarea>
                        <%}%>

                    </div>
                </div>
            </div>
        </div>
        <div class="time">
            <div class="title">发送时间</div>
            <div class="send-time">
                <div class="settings" style="display:none;">
                    <select name="demo" id="demo">
                        <option value="date"></option>
                    </select>
                </div>
                <input name="test" id="send-time"
                       class="demo-test-date demo-test-datetime demo-test-time demo-test-credit" placeholder="发送时间"
                       data-type="time"/>
                <i class="iconfont icon-ico_calendar"></i>
            </div>
        </div>
        <input type="reset" id="sendMsgResetBtn" placeholder="" value="" class="resetFormBtn">
</script>
<!--任务产品类型-->
<script type="text/html" id="categoryTmp">
    <div class="task-header">选择任务产品</div>
    <ul class="product-tab clear" id="product-tab">
        <%for(var i=0;i< list.length;i++){%>
            <%if(list[i].pid==0){%>
                <li class="product-item" id="category<%=list[i].id%>" onclick="chooseGoodsType('<%=list[i].id%>')"><%=list[i].name%></li>
            <%}%>
        <%}%>

    </ul>
    <ol class="product-list-tab">
        <%for(var i=0;i< list.length;i++){%>
            <%if(list[i].pid == 0){%>
                <li class="product-list-item active" id="product-wrap<%=list[i].id%>">
                    <table id="jp-table<%=list[i].id%>" data-toggle="table" class="table" ></table>
                </li>
            <%}%>
        <%}%>
    </ol>

</script>

<!--任务奖励弹窗-->
<script type="text/html" id="taskDialogTem">
    <div class="create-task-header">
        <ul class="create-task-header-tab clear">
            <%if(list.type == 1){%>
                <li class="active" data-type="1">创建团队任务</li>
                <li id="person-task" data-type="2">创建个人任务</li>
            <%}else if(list.type == 2){%>
                <li data-type="1">创建团队任务</li>
                <li id="person-task" class="active" data-type="2">创建个人任务</li>
            <%}%>
            <li class="move"></li>
        </ul>
    </div>
    <ul class="task-tab">
        <li class="task-item">
            <div class="task-first clear">
                <div class="first-item fl">
                    <div class="text">任务名称</div>
                    <%if(list.name){%>
                        <input type="text" class="name" placeholder="名称" value="<%=list.name%>" id="taskName">
                    <%}else{%>
                        <input type="text" class="name" placeholder="名称" id="taskName">
                    <%}%>
                </div>
                <div class="first-item fr" id="selObjects">
                    <%if(list.type==1){%>
                        <div class="text">任务门店</div>
                        <button type="button" class="shop" onclick="selectShop()">选择门店<i class="iconfont icon-ico_list"></i>
                        </button>
                        <button type="button" class="obj" style="display: none" onclick="selectObject()">选择<i class="iconfont icon-ico_list"></i>
                        </button>
                    <%}else if(list.type==2){%>
                        <div class="text">任务对象</div>
                        <button type="button" class="shop" style="display: none;" onclick="selectShop()">选择门店<i class="iconfont icon-ico_list"></i>
                        </button>
                        <button type="button" class="obj" onclick="selectObject()">选择<i class="iconfont icon-ico_list"></i>
                        </button>
                    <%}%>
                </div>
            </div>
            <div class="task-second">
                <%if(list.amountType==1){%>
                    <input type="radio" name="sales" id="money" data-id="1">
                    <label for="money">销售额奖励</label>
                    <input type="radio" name="sales" id="number" data-id="2" checked="checked">
                    <label for="number">销售量奖励</label>
                <%}else{%>
                    <input type="radio" name="sales" id="money" data-id="1" checked="checked">
                    <label for="money">销售额奖励</label>
                    <input type="radio" name="sales" id="number" data-id="2">
                    <label for="number">销售量奖励</label>
                <%}%>
            </div>
            <div class="task-third">
                <%if(list.amountType == 1){%>
                    <div id="saleVolume-box">
                <%}else{%>
                    <div id="saleVolume-box" style="display: none">
                <%}%>
                    <input type="radio" name="" id="selectProduct1">
                    <label for="selectProduct1">
                        <button type="button" onclick="selectProduct()">选择任务产品 <i class="iconfont icon-ico_list"></i>
                        </button>
                        <span>销售量达到</span>
                        <%if(list.target){%>
                        <input type="number" placeholder="数量" id="target1" value="<%=list.target%>">
                        <%}else{%>
                        <input type="number" placeholder="数量" id="target1">
                        <%}%>
                    </label>
                </div>
                <%if(list.amountType == 1){%>
                <div id="saleroom-box" style="display: none">
                <%}else{%>
                <div id="saleroom-box">
                <%}%>
                    <%if(list.amountType == 2){%>
                        <input type="radio" name="salesNum" id="allShop" data-id="1">
                        <label for="allShop">
                            <span>全店总销售额达到</span>
                            <input type="number" placeholder="金额" id="target3">
                            <span>元</span>
                        </label>
                        <input type="radio" name="salesNum" id="selectProduct" data-id="2" checked="checked">
                        <label for="selectProduct">
                            <button type="button" onclick="selectProduct()">选择任务产品 <i class="iconfont icon-ico_list"></i>
                            </button>
                            <span>销售额达到</span>
                            <%if(list.target){%>
                            <input type="number" placeholder="金额" id="target2" value="<%=list.target%>">
                            <%}else{%>
                            <input type="number" placeholder="金额" id="target2">
                            <%}%>
                            <span>元</span>
                        </label>
                    <%}else if(list.amountType == 3){%>
                        <input type="radio" name="salesNum" id="allShop" data-id="1" checked="checked">
                        <label for="allShop">
                            <span>全店总销售额达到</span>
                            <%if(list.target){%>
                            <input type="number" placeholder="金额" id="target3" value="<%=list.target%>">
                            <%}else{%>
                            <input type="number" placeholder="金额" id="target3">
                            <%}%>
                            <span>元</span>
                        </label>
                        <input type="radio" name="salesNum" id="selectProduct" data-id="2">
                        <label for="selectProduct">
                            <button type="button" onclick="selectProduct()">选择任务产品<i class="iconfont icon-ico_list"></i>
                            </button>
                            <span>销售额达到</span>
                            <input type="number" placeholder="金额" id="target2">
                            <span>元</span>
                        </label>
                    <%}else{%>
                        <input type="radio" name="salesNum" id="allShop" data-id="1" >
                        <label for="allShop">
                            <span>全店总销售额达到</span>
                            <input type="number" placeholder="金额" id="target3">
                            <span>元</span>
                        </label>
                        <input type="radio" name="salesNum" id="selectProduct" data-id="2">
                        <label for="selectProduct">
                            <button type="button" onclick="selectProduct()">选择任务产品<i class="iconfont icon-ico_list"></i>
                            </button>
                            <span>销售额达到</span>
                            <input type="number" placeholder="金额" id="target2">
                            <span>元</span>
                        </label>
                    <%}%>
                </div>
                <div class="award">
                    <div class="award-left">
                        <div class="award-text">奖励</div>
                        <%if(list.amount){%>
                        <input type="number" placeholder="输入金额" id="amount" value="<%=list.amount%>">
                        <%}else{%>
                        <input type="number" placeholder="输入金额" id="amount">
                        <%}%>
                    </div>
                    <div class="award-right">
                        <div class="award-text">处罚金额</div>
                        <%if(list.amount){%>
                        <input type="number" placeholder="输入金额" id="amount" value="<%=list.amount%>">
                        <%}else{%>
                        <input type="number" placeholder="输入金额" id="amount">
                        <%}%>
                        <div class="tishi">未完成任务扣除当月工资</div>
                    </div>
                </div>
                <div class="mission-time clear">
                    <div class="mission-text">任务时间</div>
                    <div class="left">
                        <div class="yj-demo2-time">
                            <div class="yj-date">
                                <%if(list.startTime&&list.endTime&&list.timeText){%>
                                    <span class="sel-time"><%=list.timeText%></span><i class="iconfont icon-ico_calendar"></i>
                                <%}else{%>
                                    <span >开始时间-结束时间</span><i class="iconfont icon-ico_calendar"></i>
                                <%}%>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </li>
    </ul>
</script>
<script>
    template.helper('changeContent',function (str) {
        str = str.replace('@var(sub_name)','<div class="movebar" id="moveBar1" draggable="true" ondragstart="drag(event)">门店名称</div>')
        str = str.replace('@var(user_name)','<div class="movebar" id="moveBar2" draggable="true" ondragstart="drag(event)">顾客姓名</div>')
        return str
    })
    template.helper('changeContentText',function (str) {
        str = str.replace('@var(sub_name)','&门店名称&')
        str = str.replace('@var(user_name)','&顾客姓名&')
        return str
    })
    var psid;                                             //企业ID
    var subid;                                            //门店ID
    var cid = '';                                         //类目id
    var vouchertableData = [];                            //抵用券数据
    var voucherDiaData ={};                               //抵用券弹窗接口
    var diaMsgJob;                                        //短信群发职位
    var jobList = []; //短信群发数组
    var messageLocData = {}; //本地短信数据
    var executor = [];                                    //公司下门店（选择任务门店）
    var type;                                             //1 抵用券营销   2短信群发   3任务奖励
    var classIds;                                         //所有的类目ID
    var skuIds = [];
    var date1,date2;
    var selObject = {};
    var personArr;
    var taskLocData ={};
    /**初始化页面*/
    $(function () {
        psid = quakooUser.getUserInfo().psid;             //企业ID(公司ID)
        subid = quakooDb.getItem("sel_ShopId");          //门店ID
        manage();
        quakooData.ajaxGetData(config.getUrl_user_getAllUserJob(), {sid: subid, userType: 0}, function (ret) {
            if (ret && ret.success) {
                if (quakooUtils.isNotBlack(ret.data)) {
                    for(var i=0;i<ret.data.length;i++){
                        jobList[i] = ret.data[i];
                    }
                }
            }
        });
        //获取一级类目
        quakooData.ajaxGetData(config.getUrl_productCategory_getSubAllList(),{subid:subid},function (ret) {
            console.log("类目ID",ret);
            classIds = [];
            if(ret && ret.success){
                if(quakooUtils.isNotBlack(ret.data)){
                    for(var i=0;i<ret.data.length;i++){
                        classIds.push(ret.data[i].id);
                    }
                    var html = template('categoryTmp',{list:ret.data});
                    $('#product').html(html);
                }
            }
        });
    });

    function changeType(t) {
        type = t;
        if(type==1){
            manage()
        }else if(type==2){
            getSendList();
        }else if(type==3){
            missionRewards();
        }
        $(".tab-ul li").eq(type-1).addClass('active').siblings().removeClass('active');
        $(".tab-item").hide().eq(type-1).show();
        $(".right-info").hide().eq(type-1).show();
    }

    /************************************<抵用券营销开始>******************************************/
    /*卡片分页-抵用券营销*/
    function manage() {
        $("#yj-page-table").bootstrapTable('destroy');
        $("#yj-page-table").bootstrapTable({
            url: config.getUrl_marketingcoupon_getAllList(),
            method: 'get',
            classes: "table",
            pagination: true,                    //是否显示分页
            sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
            pageNumber: 1,                       //初始化加载第一页，默认第一页
            pageSize: 6,
            pageList: [6, 12, 18],
            sortable: false,
            sortOrder: "asc",
            showColumns: true,
            strictSearch: true,
            locale: "zh-CN",
            paginationHAlign: "center",
            clickToSelect: true,
            paginationLoop: false,
            columns: [],
            queryParams: function (param) {
                param.subid = psid;
                param.token = quakooUser.getUserInfo().token;
                return param
            },
            onPreBody: function (data) {
                console.log("抵用券数据",this);
                vouchertableData = [];
                for (var i = (this.pageNumber - 1) * this.pageSize; i < this.pageNumber * this.pageSize; i++) {
                    if(this.data[i]){
                        this.data[i].startTimeText = quakooUtils.formatTimeToDateDianLY(this.data[i].startTime);
                        this.data[i].endTimeText = quakooUtils.formatTimeToDateDianLY(this.data[i].endTime);
                        vouchertableData.push(this.data[i])
                    }
                }
                var html = template("voucherList", {list: vouchertableData});
                $("#card-list1").html(html);
            }
        });

    }

    /**弹窗——新增抵用券(编辑)*/
    function voucherDialog(voucherId) {
        var btn;
        if (quakooUtils.isBlack(voucherId)) {
            btn = ['取消', '新增'];
        } else {
            btn = ['取消', '编辑'];
        }
        var index = layer.open({
            type: 1,
            shade: 0.01,
            shadeClose: true,
            skin: 'dialog-voucher', //样式类名
            area: ['360px','375px'],
            anim: 0,
            closeBtn: 0,
            resize: false,
            title: null,
            move: ".lay-header",
            content: $('.content-view1'),
            btn: btn,
            yes: function (index) {
                layer.close(index)
            },
            btn2: function (index,layero) {
                addVoucher(index);
                return false
            },
            success: function (layero, index) {
                renderVouDia(voucherId);
            }
        });
    }

    /**渲染抵用券弹窗*/
    function renderVouDia(voucherId) {
        voucherDiaData = {};//重置本地对象
        if(voucherId){
            for(var i in vouchertableData){
                if(vouchertableData[i].id == voucherId){
                    voucherDiaData = vouchertableData[i];
                }
            }
        }else{
            voucherDiaData.open = 1;//开关
            voucherDiaData.descFullType = 1;//描述-消费满 类型(1-金额 2-个数)
            voucherDiaData.descSubtractType = 1;//描述-消费减 类型(1-金额 2-百分比)
            voucherDiaData.conditionType = 1;//获取条件类型(1-全场通用 2-消费金额 3-消费个数)
            if (voucherDiaData.open == 1) {
                //开启
                $("#voucherSwitch").removeClass("active");
                $("#voucherSwitch").addClass("active");
            } else if (voucherDiaData.open == 2) {
                //不开启
                $("#voucherSwitch").removeClass("active");
            }
        }
        var data = {list:voucherDiaData};
        var html = template("voucherDiaTem",data);
        $("#voucherDiaUl").html(html);
        /**开关切换*/
        $(".switch-btn").click(function () {
            $(this).parent(".switch").toggleClass('active');
        });
        date1 = new dateRange(".yj-demo-time", true);
        date1.init();
        selectTag($("#selectBox1"), function (ret) {        //抵用券满类型
            voucherDiaData.descFullType = ret.value;
        });
        selectTag($("#selectBox2"), function (ret) {        //抵用券减类型
            voucherDiaData.descSubtractType = ret.value;
        });
        $("input:radio[name='condition']").click(function () {
            var type = $('input:radio[name="condition"]:checked').attr('data-id');
            if (type == 1) {
                voucherDiaData.conditionType = 1;
            } else if (type == 2) {
                voucherDiaData.conditionType = 2;
                selectTag($("#selectBox4"), function (ret) {        //抵用券减类型
                    if(ret.value == 1){
                        voucherDiaData.conditionType = 2;
                    }else if(ret.value == 2){
                        voucherDiaData.conditionType = 3;
                    }
                });
            }
        });
        $('.dialog-voucher .yj-date-btn .btn-primary').click(function () {
            voucherDiaData.startTime = date1.getTime()[2];
            voucherDiaData.endTime = date1.getTime()[3];
        })
    }
    /**接口——新增抵用券(编辑)*/
    function addVoucher(index) {
        var $voucherSwitch = $('#voucherSwitch');
        if($voucherSwitch.hasClass('active')){
            voucherDiaData.open = 1;
        }else{
            voucherDiaData.open = 2;
        }
        var title = $("#voucherTitle").val();              //抵用券名字
        var descFull = $("#describefull").val();           //抵用券满
        var descSubtract = $("#describeSubtract").val();   //描述-消费减
        if (voucherDiaData.conditionType == 2 || voucherDiaData.conditionType == 3) {           //获取条件消费满
            var conditionFull = $("#conditionFull").val();
        }
        var sort = $("#voucherSort").val();                //排序
        //判断是否为空
        if (quakooUtils.isBlack(title)) {
            layer.msg("抵用券名字不能为空");
            return
        }
        if (quakooUtils.isBlack(descFull) && descFull <= 0) {
            layer.msg("请输入正确的抵用券满金额");
            return
        }
        if (quakooUtils.isBlack(descSubtract) && descSubtract <= 0) {
            layer.msg("请输入正确的抵用券减金额");
            return
        }
        if (conditionFull && conditionFull < 0) {
            layer.msg("请输入正确的获取条件的满减数值！");
            return;
        }
        if (quakooUtils.isBlack(voucherDiaData.startTime) || quakooUtils.isBlack(voucherDiaData.endTime)) {
            layer.msg("请选择有效期");
            return;
        }
        if (quakooUtils.isBlack(sort)) {
            sort = 1;
        }
        if (sort < 0) {
            layer.msg("请输入正确的排序");
            return
        }
        var param = {};
        param.subid = psid;                          //公司id
        param.title = title;                         //标题
        if (conditionFull) {
            param.conditionFull = conditionFull;     //获取条件-消费满
        }
        param.conditionType = voucherDiaData.conditionType;         //获取条件类型(1-全场通用 2-消费金额 3-消费个数)
        param.descSubtract = descSubtract;           //描述-消费减
        param.descSubtractType = voucherDiaData.descSubtractType;   //描述-消费减 类型(1-金额 2-百分比)
        param.descFull = descFull;                   //描述-消费满
        param.descFullType = voucherDiaData.descFullType;           //描述-消费满 类型(1-金额 2-个数)
        param.sort = sort;                           //排序
        param.open = voucherDiaData.open;                           //抵用券开启||关闭
        param.startTime = voucherDiaData.startTime;                 //起始时间
        param.endTime = voucherDiaData.endTime;                     //起始时间
        if (quakooUtils.isNotBlack(voucherDiaData.id)) {
            param.id = voucherDiaData.id;
            quakooData.ajaxGetData(config.getUrl_marketingcoupon_updateMarketing(), param, function (ret) {
                if (ret && ret.success) {
                    manage();
                    layer.msg("成功编辑抵用券", {icon: 1});
                    layer.close(index);
                } else {
                    layer.msg(ret.data, {icon: 2});
                }
            })
        } else {
            quakooData.ajaxGetData(config.getUrl_marketingcoupon_add(), param, function (ret) {
                if (ret && ret.success) {
                    manage();
                    layer.msg("成功添加抵用券", {icon: 1});
                    layer.close(index);
                } else {
                    layer.msg(ret.data, {icon: 2});
                }
            })
        }
    }

    /**接口——删除抵用券*/
    function delVoucher(id) {
        layer.confirm('确定删除?', {icon: 3, title:'提示'}, function(index){
            quakooData.ajaxGetData(config.getUrl_marketingcoupon_del(), {id: id}, function (ret) {
                if (ret && ret.success) {
                    layer.msg("成功删除抵用券", {icon: 1});
                    manage();
                    layer.close(index);
                } else {
                    layer.msg(ret.data, {icon: 2});
                }
            })

        });
    }

    /**接口——启用/关闭抵用卷*/
    function updateOpen(id,_self) {
        var switchBox = $(_self);
        var switchText = switchBox.children('span')[0];
        var open = switchBox.attr("attr-open");
        quakooData.ajaxGetData(config.getUrl_marketingcoupon_updateOpen(), {open: open, id: id}, function (ret) {
            if (ret && ret.success) {
                if (open == 1) {
                    switchBox.attr("attr-open",2);
                    switchBox.addClass("active");
                    $(switchText).html("已启用");
                    $(switchText).attr('class','on');
                    layer.msg("抵用券已启用", {icon: 1});
                } else if (open == 2) {
                    switchBox.attr("attr-open",1);
                    switchBox.removeClass("active");
                    $(switchText).html("未开启");
                    $(switchText).attr('class','off');
                    layer.msg("抵用券已关闭", {icon: 1});
                }
            } else {
                layer.msg(ret.data, {icon: 2});
            }
        })
    }

    /************************************</抵用券营销结束>******************************************/



    /************************************<短信群发开始>******************************************/


    /**接口——获取短信群发列表*/
    function getSendList() {
        $("#dxqf-table").bootstrapTable('destroy');
        $("#dxqf-table").bootstrapTable({
            url: config.getUrl_marketingtimingsms_getCheckPager(),
            method: 'get',
            classes: "table",
            pagination: true,                     //是否显示分页
            sidePagination: "server",             //分页方式：client客户端分页，server服务端分页（*）
            pageNumber: 1,                        //初始化加载第一页，默认第一页
            pageSize: 10,
            pageList: [5, 10, 15, 20],
            sortable: false,
            sortOrder: "asc",
            showColumns: true,
            strictSearch: true,
            locale: "zh-CN",
            paginationHAlign: "center",
            clickToSelect: true,
            columns: [
                {
                    field: "ctime",
                    title: "创建时间",
                    align: "left",
                    valign: "middle",
                    formatter: function (value, row, index) {
                        return quakooUtils.formatTimeToDateDianLY(value);
                    }
                },
                {
                    field: "sendTime",
                    title: "发送时间",
                    align: "left",
                    valign: "middle",
                    formatter: function (value, row, index) {
                        return quakooUtils.formatTimeToDateDianLY(value);
                    }
                },
                {
                    field: "", title: "面向顾客", align: "left", valign: "middle", formatter: function (value, row, index) {
                        var range, sex, age, job;
                        if (row.range == 0) {
                            range = "全部";
                        } else if (row.range == 1) {
                            range = "会员";
                        } else if (row.range == 2) {
                            range = "非会员";
                        }
                        if (row.sex == 1) {
                            sex = "男";
                        } else if (row.sex == 2) {
                            sex = "女";
                        }
                        if (row.startAge && row.endAge && row.startAge > 0) {
                            age = row.startAge + "-" + row.endAge + "岁";
                        }
                        if (quakooUtils.isNotBlack(row.job)) {
                            job = row.job;
                        }
                        var html = (range ? range : "") + (sex ? "," + sex : "") + (age ? "," + age : "") + (job ? "," + job : "");
                        return html;
                    }
                },
                {
                    field: "content",
                    title: "短信内容",
                    align: "left",
                    valign: "middle",
                    formatter: function (value, row, index) {
                        var html = "";
                        html += value.replace(/@var\(user_name\)/g, "<span class='show-tags'>顾客姓名</span>").replace(/@var\(sub_name\)/g, "<span class='show-tags'>门店名称</span>");
                        return html;
                    }
                },
                {
                    field: "", title: "送达条数", align: "left", valign: "middle", formatter: function (value, row, index) {
                        return "暂无字段";
                    }
                },
                {
                    field: "status",
                    title: "操作",
                    align: "center",
                    valign: "middle",
                    formatter: function (value, row, index) {
                        var editEvent = "newVouchers3(" + JSON.stringify(row).replace(/\"/g, '\'').replace(/\'\'/g, '\'') + ")";
                        var html;
                        if (value == 0) {
                            /**正常*/
                            html = '<button class="btn btn-primary" onclick="' + editEvent + '">编辑</button>';
                        } else if (value == 1) {
                            /**删除*/
                            html = '-';
                        }
                        return html;
                    }
                }
            ],
            queryParams: function (params) {
                params.subid = subid;
                params.page = this.pageNumber;
                params.size = this.pageSize;
                params.token = quakooUser.getUserInfo().token;
                return params;
            },
            success: function () {
            },
            onLoadSuccess: function (data) {
            }
        });
        quakooData.ajaxGetData(config.getUrl_marketingtimingsms_getCheckPager(), {subid: subid}, function (ret) {
            if (ret && ret.success) {
                console.log(ret);
            }
        })
    }

    /**弹窗——新增（编辑）短信群发*/
    function newVouchers3(upData) {
        messageLocData = {};
        messageLocData.startAge = 30;
        messageLocData.endAge = 70;
        var title,btn;
        if (quakooUtils.isNotBlack(upData)) {//编辑
            title = "编辑短信群发";
            btn = ['取消', '编辑'];
            for(var i in upData){
                messageLocData[i] = upData[i];
            }
        }else {
            messageLocData.tags = [];
            messageLocData.content = "";
            title = "新增短信群发";
            btn = ['取消', '新增'];
        }
        var index = layer.open({
            type: 1,
            shade: 0.01,
            shadeClose: true,
            skin: 'layui-layer-demo', //样式类名
            area: ['360px', '633px'],
            anim: 0,
            closeBtn: 0,
            resize: false,
            title: title,
            content: $('#groupMessagingUl'),
            btn: btn,
            yes: function (index) {
                layer.close(index);
            },
            btn2: function (index) {
                addmessage(index);
                return false;
            },
            success: function (layero, index) {
                renderMessage();
            }
        });
    }

    /**弹窗成功之后*/
    function renderMessage() {
        console.log('messageLocData',messageLocData);
        var data = {list:messageLocData,jobList:jobList};
        console.log('data',data);
        var html = template("groupMessagingTem",data);
        $('#groupMessagingUl').html(html);
        barArr = [];
        if(messageLocData.content.indexOf('@var(sub_name)')>=0){
            barArr.push({text:"门店名称",html:'<div class="movebar" id="moveBar1" draggable="true" ondragstart="drag(event)">门店名称</div>'})
        }
        if(messageLocData.content.indexOf('@var(user_name)')>=0){
            barArr.push({text:"顾客姓名",html:'<div class="movebar" id="moveBar2" draggable="true" ondragstart="drag(event)">顾客姓名</div>'})
        }

        initDrag()
        /*时间开始*/
        // 时间插件JS开始(单个时间日期)
        var opt = {};
        opt.date = {preset: 'date'};
        opt.datetime = {preset: 'datetime'};
        opt.time = {preset: 'time'};
        opt.default = {
            theme: 'mbsc-android-holo', //皮肤样式
            display: 'bubble', //显示方式
            mode: 'scroller', //日期选择模式
            dateFormat: 'yyyy-mm-dd',
            lang: 'zh',
            showNow: true,
            nowText: "今天",
            typeNum: 'day',//day：获取到日，time：获取到时，branch：获取到分；默认是获取到分
        };
        $('.settings').bind('change', function () {
            var demo = 'datetime';
            if (!demo.match(/select/i)) {
                $('.demo-test-' + demo).val('');
            }
            $('.demo-test-' + demo).scroller('destroy').scroller($.extend(opt['datetime'], opt['default']));
            $('.demo').hide();
            $('.demo-' + demo).show();
        });

        /*时间结束*/



        selectTag($("#selectBox5"), function (ret) { //短信弹窗职业获取
            messageLocData.job = ret.value;
        });


        $("#send-time").attr("placeholder", "发送时间");
        $("#send-time").val('');
        if(quakooUtils.isNotBlack(messageLocData.id)) {//编辑

            //短信内容

/*
            if(quakooUtils.isNotBlack(messageLocData.tags)){
                if(messageLocData.tags.indexOf("@var(sub_name)")>-1){
                    $("#moveBar2").css('display','none');
                }
                if(messageLocData.tags.indexOf("@var(user_name)")>-1){
                    $("#moveBar1").css('display','none');
                }
                var html = upData.content.replace(/@var\(user_name\)/g,'<div class="movebar" id="moveBar2" draggable="true" ondragstart="drag(event)" style="display: block;">门店名称</div>').replace(/@var\(user_name\)/g,'<div class="movebar" id="moveBar1" draggable="true" ondragstart="drag(event)" style="display: block;">顾客名称</div>');
                $("#fill-div").html(html);
                content = upData.content;
            }
*/
            //时间
            var timeText = quakooUtils.formatTimeToDate(messageLocData.sendTime);
            $("#send-time").attr("placeholder",timeText);
        }

        layui.use('slider', function () {   //年龄范围
            var slider = layui.slider;
            slider.render({
                elem: '#slide1',
                value: [messageLocData.startAge, messageLocData.endAge],   //滑块默认值
                range: true,
                theme: 'rgba(130,130,151,0.4)',   //主题色
                change: function (value) {
                    messageLocData.startAge = value[0];
                    messageLocData.endAge = value[1];
                }
            });
        });
        $('#demo').trigger('change');
    }

    /**接口——新增编辑短信群发*/
    function addmessage(index) {
        messageLocData.tags = [];
        messageLocData.content = $('#fill-div').text();
        if(messageLocData.content.indexOf('门店名称')>=0){
            messageLocData.tags.push('@var(sub_name)')
            messageLocData.content =  messageLocData.content.replace('门店名称','@var(sub_name)');
        }
        if(messageLocData.content.indexOf('顾客姓名')>=0){
            messageLocData.tags.push('@var(user_name)')
            messageLocData.content =  messageLocData.content.replace('顾客姓名','@var(user_name)');
        }
        var param = {};
        var sendTime;
        var strTime = $("#send-time").attr("placeholder");
        if($("#send-time").val()){
            sendTime = $("#send-time").val();
        }else{
            if(strTime.indexOf(":")>=0){
                sendTime = $("#send-time").attr("placeholder");
            }else{
                layer.msg('请选择时间');
                return;
            }
        }
        sendTime = sendTime.replace(/-/g, ',').replace(/:/g, ',').replace(/\s/, ',').split(',');
        messageLocData.sendTime = new Date(sendTime[0], sendTime[1] - 1, sendTime[2], sendTime[3], sendTime[4]).getTime();
        param.subid = subid;
        param.job = messageLocData.job;
        param.startAge = messageLocData.startAge;
        param.endAge = messageLocData.endAge;
/*
        if(!id){
            var html = $('#fill-div').html();
            var tags = [];
            console.table(barArr);
            for (var i = 0; i < barArr.length; i++) {
                if (barArr[i].text == "顾客姓名") {
                    html = html.replace(barArr[i].html, "@var(user_name)");
                    tags.push("@var(user_name)");                                              //顾客姓名
                } else if (barArr[i].text == "门店名称") {
                    html = html.replace(barArr[i].html, "@var(sub_name)");
                    tags.push("@var(sub_name)");                                               //门店名称
                }
            }
            html = html.replace(/<span>/g,'').replace(/<\/span>/g,'');
            content = html;
        }
        if(quakooUtils.isBlack(content)){
            layer.msg("请编辑短信内容");
            return;
        }
*/
        if(quakooUtils.isBlack(messageLocData.sendTime)){
            layer.msg('请选择短信的发送时间');
            return;
        }
        param.sendTime = messageLocData.sendTime;
        param.content = messageLocData.content;                                                           //内容
        param.tagsJson = JSON.stringify(messageLocData.tags);                                             //标签
        param.range = $('#pro input:radio[name="property"]:checked').val();                //全部0，会员1，非会员2
        param.sex = $('#sex input:radio[name="sex"]:checked').val();                       //全部0，男1，女2
        if (messageLocData.id) {//编辑
            param.id = messageLocData.id;
            url = config.getUrl_marketingtimingsms_update();
        } else {
            url = config.getUrl_marketingtimingsms_add()
        }
        quakooData.ajaxGetData(url, param, function (ret) {
            if (ret && ret.success) {
                if (messageLocData.id) {
                    getSendList();
                    layer.msg("成功编辑短信群发", {icon: 1});
                } else {
                    getSendList();
                    layer.msg("成功新增短信群发", {icon: 1});
                }
                layer.close(index)
            } else {
                layer.msg(ret.data);
            }
        })
    }
    /************************************</短信群发结束>******************************************/

    /************************************<任务奖励开始>******************************************/
    /**
     * 任务奖励列表table
     * */
    function missionRewards() {
        $("#rwjl-table").bootstrapTable('destroy');
        $("#rwjl-table").bootstrapTable({
            url: config.getUrl_mission_getAllList(),
            method: 'get',
            classes: "table",
            pagination: true,            //是否显示分页
            pageNumber: 1,               //初始化加载第一页，默认第一页
            sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
            pageSize: 5,
            pageList: [5, 10, 15, 20],
            sortable: false,
            sortOrder: "asc",
            showColumns: true,
            strictSearch: true,
            locale: "zh-CN",
            paginationHAlign: "center",
            clickToSelect: true,
            columns: [
                {
                    field: "name", title: "任务名称", align: "left", valign: "middle"
                },
                {
                    field: "startTime", title: "截止时间", align: "left", valign: "middle", formatter: function (val, obj) {
                        return quakooUtils.formatTimeToDateDianLY(val) + '-' + quakooUtils.formatTimeToDateDianLY(obj.endTime);
                    }
                },
                {field: "amount", title: "奖励", align: "left", valign: "middle"},
                {
                    field: "target", title: "任务量", align: "left", valign: "middle", formatter: function (item, obj) {
                        var val = item + '元';
                        if (obj.amountType == 1) {
                            val = item + '个'
                        }
                        return val;
                    }
                },
                {field: "allAmount", title: "已完成", align: "left", valign: "middle"}, {
                    field: "type", title: "任务执行", align: "center", valign: "middle", formatter: function (val, obj) {
                        var item;
                        if (val == 1) {
                            item = '团队';
                        }
                        if (val == 2) {
                            item = '个人';
                        }
                        return item;
                    }
                },
                {
                    field: "allProgress",
                    title: "进度",
                    align: "left",
                    valign: "middle",
                    formatter: function (value, obj) {
                        var html;
                        if (value >= 100) {
                            html = "<span class='end'><i class='iconfont icon-ico_check'></i></span>"
                        } else {
                            html = "<canvas class='canvas' width='24' data-value='" + value + "' height='24'></canvas>";
                        }
                        return html;
                    }
                }, {
                    field: "",
                    title: "操作",
                    align: "center",
                    valign: "middle",
                    formatter: function (value, row, index) {
                        var data = JSON.stringify(row);
                        var html = "<button class='btn btn-primary' style='margin-right: 8px;' onclick='createTask("+data+")'>编辑</button><button class='btn btn-danger' style='margin-right: 8px;' data-id= \'"+ row.id + "\'>删除</button>";
                        return html;
                    }
                }
            ],
            onPostBody: function () {
                canvasFn();
                //删除任务
                $('.btn-danger').on('click', function () {
                    var id = parseFloat($(this).attr('data-id'));
                    layer.confirm('确定删除?', {icon: 3, title:'提示',shadeClose:true}, function(index){
                        quakooData.ajaxGetData(config.getUrl_mission_del(), {id: id}, function (ret) {
                            if (ret && ret.success) {
                                missionRewards();
                                layer.msg('删除成功', {icon: 1});
                                layer.close(index);
                            } else {
                                layer.msg(ret.data);
                            }
                        })

                    });
                })
            },
            queryParams: function (param) {
                param.sid = subid;
                param.page = param.offset / param.limit + 1;
                param.size = param.limit;
                param.token = quakooUser.getUserInfo().token;
                return param
            }
        });
        function canvasFn() {
            var element = document.getElementsByClassName('canvas');
            for (var i = 0; i < element.length; i++) {
                var item = element[i];
                canFor(item, item.getAttribute('data-value'));
            }
            function canFor(document, value) {
                var context = document.getContext('2d'), //获取画图环境，指明为2d
                    centerX = document.width / 2, //document中心点x轴坐标
                    centerY = document.height / 2, //Canvas中心点y轴坐标
                    rad = Math.PI * 2 / 100; //将360度分成100份，那么每一份就是rad度
                //speed = 10;加载的快慢就靠它了
                //绘制圆环背景
                function whiteCircle() {
                    context.save();
                    context.beginPath();
                    context.lineWidth = 2; //设置线宽
                    context.strokeStyle = "#FBEEED";
                    context.arc(centerX, centerY, 10, 0, Math.PI * 2, false);
                    context.stroke();
                    context.closePath();
                    context.restore();
                }

                //绘制进度
                function blueCircle(value) {
                    context.save();
                    context.strokeStyle = "#DD5B4B"; //设置描边样式
                    context.lineWidth = 2; //设置线宽
                    context.beginPath(); //路径开始
                    context.arc(centerX, centerY, 10, -Math.PI / 2, -Math.PI / 2 + rad * value, false); //用于绘制圆弧context.arc(x坐标，y坐标，半径，起始角度，终止角度，顺时针/逆时针)
                    context.stroke(); //绘制
                    context.closePath(); //路径结束
                    context.restore();
                }
                whiteCircle();
                blueCircle(value);
            }
        }
    }

    /**
     * 弹窗——创建任务
     * */
    function createTask(taskData) {
        console.log('tadafds',taskData);
        skuIds =[];
        var btn;
        if(taskData){
            btn = ['取消','编辑'];
        }else{
            btn = ['取消', '确定'];
        }
        layer.open({
            type: 1,
            shade: 0.01,
            shadeClose: true,
            skin: 'createTask', //样式类名
            area: ["360px","450px"],
            closeBtn: 0,
            resize: false,
            title: false,
            move: ".move",
            content: $('.create-task'),
            btn: btn,
            yes:function (index,layero) {
                layer.close(index);
            },
            btn2: function (index,layero) {
                if(taskData){
                    addTask(index,taskData.id)
                }else{
                    addTask(index);
                }
                return false
            },
            success: function (layero, index) {
                if(taskData){
                    renderTask(taskData)
                }else{
                    renderTask();
                }
            }
        });
    }
    function renderTask(taskData) {
        taskLocData = {};
        taskLocData.executor = [];
        if(taskData){
            for(var i in taskData.skuIds){
                skuIds[i] = taskData.skuIds[i];
            }
            for(var i in taskData){
                taskLocData[i] = taskData[i];
            }
            taskLocData.timeText = quakooUtils.formatTimeToDateDianLY(taskLocData.startTime)+"-"+quakooUtils.formatTimeToDateDianLY(taskLocData.endTime);
        }else{
            taskLocData.type = 1;//1=>团队任务；2=>个人任务
            taskLocData.amountType = 3;//1销售量-个 2销售额-元 3全店销售额
        }
        var data = {list:taskLocData};
        var html = template("taskDialogTem",data);
        $("#taskDialogHtml").html(html);
        $(".create-task-header-tab li").click(function () {
            $(this).addClass('active').siblings().removeClass('active');
            taskLocData.type = $(this).attr('data-type');
            if(taskLocData.type == 1){
                $('#selObjects div.text').html('任务门店');
                $('#selObjects button.shop')[0].style.display = "block";
                $('#selObjects button.obj')[0].style.display = "none";
            }else if(taskLocData.type == 2){
                $('#selObjects div.text').html('任务对象');
                $('#selObjects button.shop')[0].style.display = "none";
                $('#selObjects button.obj')[0].style.display = "block";
            }
        });
        $("input:radio[name='sales']").click(function () {
            var salesSelect = $('input:radio[name="sales"]:checked').attr('data-id');
            if (salesSelect == 1) {
                //销售额奖励
                taskLocData.amountType = 3;
                $("#saleroom-box")[0].style.display = "block";
                $("#saleVolume-box")[0].style.display = "none";
                $("input:radio[name='salesNum']").click(function(){
                    var salesNumSelect = $("input:radio[name='salesNum']:checked").attr("data-id");
                    if(salesNumSelect==1){//全店总销售额
                        taskLocData.amountType = 3;
                    }else if(salesNumSelect == 2){//销售额选
                        taskLocData.amountType = 2;
                    }
                })
            } else if (salesSelect == 2) {//销售量奖励
                taskLocData.amountType = 1;
                $("#saleroom-box")[0].style.display = "none";
                $("#saleVolume-box")[0].style.display = "block";
            }
        });
        $("input:radio[name='salesNum']").click(function(){
            var salesNumSelect = $("input:radio[name='salesNum']:checked").attr("data-id");
            if(salesNumSelect==1){//全店总销售额
                taskLocData.amountType = 3;
            }else if(salesNumSelect == 2){//销售额选
                taskLocData.amountType = 2;
            }
        });
        date2 = new dateRange(".yj-demo2-time", true);
        date2.init();
        $('.yj-date-btn .btn-primary').click(function () {
            taskLocData.startTime = date2.getTime()[2];
            taskLocData.endTime = date2.getTime()[3];
            console.log('taskLocData',taskLocData);
        });
    }
    /**接口——创建任务*/
    function addTask(index,id) {
        var param ={};
        var taskName = $('#taskName').val();
        var amount = $("#amount").val();
        if(taskLocData.amountType == 1){
            target = $("#target1").val();
        }else if(taskLocData.amountType == 2){
            target = $("#target2").val();
        }else if(taskLocData.amountType == 3){
            target = $("#target3").val();
        }
        if(quakooUtils.isBlack(taskName)){
            layer.msg("请输入任务名称");
            return;
        }
        if(quakooUtils.isBlack(taskLocData.executor)){
            if(taskLocData.type==1){
                layer.msg("请选择门店");
            }else if(taskLocData.type==2){
                layer.msg("请选择任务对象");
            }
            return;
        }
        if(quakooUtils.isBlack(target)){
            layer.msg("请输入目标数");
            return;
        }
        if(quakooUtils.isBlack(amount)){
            layer.msg("请输入奖励金额");
            return;
        }
        if(quakooUtils.isBlack(taskLocData.startTime)){
            layer.msg("请选择时间");
            return;
        }
        param.name = taskName;
        param.executorJson = JSON.stringify(taskLocData.executor);
        param.sid = psid;
        param.amount= amount*1;
        param.amountType= taskLocData.amountType;
        param.startTime = taskLocData.startTime;
        param.endTime = taskLocData.endTime;
        param.type = taskLocData.type;
        param.target = target*1;
        if(quakooUtils.isNotBlack(skuIds)){
            param.skuIdsJson = JSON.stringify(skuIds);
        }
        if(id){
            param.id = id;
            quakooData.ajaxGetData(config.getUrl_mission_update(),param,function(ret){
                console.log('任务奖励编辑',ret);
                if(ret&&ret.success&&ret.data){
                    missionRewards();
                    layer.msg('编辑成功',{icon:1});
                    layer.close(index);
                }else{
                    layer.msg(ret.data);
                }
            })
        }else{
            quakooData.ajaxGetData(config.getUrl_mission_add(),param,function (ret) {
                console.log("创建任务接口数据",ret);
                if(ret&&ret.success){
                    if(quakooUtils.isNotBlack(ret.data)){
                        missionRewards();
                        layer.msg('成功创建任务',{icon:1});
                        layer.close(index);
                    }else{
                        layer.msg(ret.data);
                    }
                }
            })
        }
    }

    /**任务奖励——创建任务——选择任务产品table选择一级类目*/
    function showTaskTable(){
        for(var i =0;i< classIds.length;i++){
            $('#jp-table'+classIds[i]).bootstrapTable('destroy');
            $('#jp-table'+classIds[i]).bootstrapTable({
                url: config.getUrl_product_getSPUPager(),
                classes: "table",
                pagination: true,                    //是否显示分页
                sidePagination: "server",            //分页方式：client客户端分页，server服务端分页（*）
                pageNumber: 1,                       //初始化加载第一页，默认第一页
                pageSize: 10,
                pageList: [5, 10, 15, 20],
                sortable: false,
                sortOrder: "asc",
                showColumns: true,
                strictSearch: true,
                locale: "zh-CN",
                paginationHAlign: "center",
                clickToSelect: true,
                paginationLoop: false,
                columns:[
                    {checkbox: true, valign: "middle",formatter: function (value, row, index) {
                        if(skuIds.indexOf(row.id)>=0){
                            return {
                                checked:true
                            }
                        }else{
                            return value
                        }
                    }},
                    {field: "brandName", title: "品牌", valign: "middle"},
                    {field: "seriesName", title: "系列", valign: "middle"},
                    {field: "canUseNum", title: "可用数量", valign: "middle"},
                    {
                        field: "", title: "提成", valign: "middle", formatter: function (value, row, index) {
                        return '<span class="goods-ticheng">团</span>';
                    }
                    },
                    {
                        field: "", title: "库存总值", valign: "middle", formatter: function (value, row, index) {
                        return '￥10000';
                    }
                    },
                    {
                        field: "", title: "操作", valign: "middle", formatter: function (value, row, index) {
                        return '<button class="btn btn-primary" style="margin-right: 8px;">选择</button>';
                    }
                    }
                ],
                queryParams: function (param) {
                    param.cid = classIds[i];
                    param.subid = quakooUser.getUserInfo().psid;
                    param.token = quakooUser.getUserInfo().token;
                    return param
                }
            });

        }
    }
    function chooseGoodsType(cid) {
        $('#category' + cid).addClass('active').siblings().removeClass('active');
        $('#product-wrap' + cid).addClass('active').siblings().removeClass('active');
    }
    /**
     * 选择任务门店(渲染)
     * */
    function renderTaskShop() {
        quakooData.ajaxGetData(config.getUrl_subordinate_getSubordinateStore(),{sid:psid},function (ret) {
            console.log("任务门店",ret);
            if(ret&&ret.success){
                $("#shop-table").bootstrapTable('destroy');
                $("#shop-table").bootstrapTable({
                    data: ret.data,
                    classes: "table",
                    pagination: false,//是否显示分页
                    sortable: false,
                    sortOrder: "asc",
                    showColumns: true,
                    strictSearch: true,
                    locale: "zh-CN",
                    paginationHAlign: "center",
                    clickToSelect: true,
                    columns: [
                        {checkbox: true, align: "center", valign: "middle",formatter: function (value, row, index) {
                                if(taskLocData.executor.indexOf(row.id)>=0){
                                    return {
                                        checked:true
                                    }
                                }else{
                                    return value
                                }
                            }
                        },
                        {field: "name", title: "门店名称",align:"center",valign:'middle'},
                        {
                            field: "", title: "操作", align: "center", valign: "middle", formatter: function (value, row, index) {
                                return '<button class="btn btn-primary" style="margin-right: 8px;">选择</button>';
                            }
                        }
                    ],
                    onCheck:function (row) {
                        if(taskLocData.executor.indexOf(row.id) < 0){
                            taskLocData.executor.push(row.id)
                        }
                    },
                    onUncheck:function (row) {
                        if(taskLocData.executor.indexOf(row.id)>=0){
                            taskLocData.executor.splice(taskLocData.executor.indexOf(row.id),1)
                        }
                    },
                    onCheckAll:function (row) {
                        for(var i=0;i<row.length;i++){
                            if(taskLocData.executor.indexOf(row[i].id) < 0){
                                taskLocData.executor.push(row[i].id)
                            }
                        }
                    },
                    onUncheckAll:function (row) {
                        for(var i=0;i<row.length;i++){
                            if(taskLocData.executor.indexOf(row[i].id)>=0){
                                taskLocData.executor.splice(taskLocData.executor.indexOf(row[i].id),1)
                            }
                        }
                    }

                });
            }
        });
    }

    /**
     * 弹窗选择任务产品
     * */
    function selectProduct() {
        var index = layer.open({
            type: 1,
            shade: 0.01,
            shadeClose: false,
            skin: 'layui-layer-demo', //样式类名
            area: ['720px', '600px'],
            anim: 0,
            closeBtn: 0,
            resize: false,
            title: null,
            move: ".task-header",
            content: $('.task-product'),
            btn: ['关闭窗口'],
            yes: function (index) {
                saveSkuids();
                console.log("选择任务产品选择的数据",skuIds);
                layer.close(index);
            },
            success: function (layero, index) {
                showTaskTable();
                chooseGoodsType(classIds[0]);
            }
        });
    }

    /**保存skuids*/
    function saveSkuids(){
        var data;
        skuIds = [];
        for(var i=0;i<classIds.length;i++){
            data = $("#jp-table"+classIds[i]).bootstrapTable('getAllSelections');
            for(var j=0;j< data.length;j++){
                skuIds.push(data[j].id);
            }
        }
    }
    /**
     * 弹窗选择任务对象
     * */
    function selectObject() {
        var index = layer.open({
            type: 1,
            shade: 0.01,
            shadeClose: true,
            skin: 'layui-layer-demo', //样式类名
            area: ['360px', '448px'],
            anim: 0,
            closeBtn: 0,
            resize: false,
            title: "选择任务对象门店列表",
            content: $('.task-object'),
            btn: ['关闭窗口'],
            yes: function (index) {
                layer.close(index);
            },
            success: function (layero, index) {
                quakooData.ajaxGetData(config.getUrl_subordinate_getSubordinateStore(),{sid:psid},function (ret) {
                    console.log("任务门店",ret);
                    if(ret&&ret.success){
                        $("#object-table").bootstrapTable('destroy');
                        $("#object-table").bootstrapTable({
                            data: ret.data,
                            classes: "table",
                            pagination: false,//是否显示分页
                            sortable: false,
                            sortOrder: "asc",
                            showColumns: true,
                            strictSearch: true,
                            locale: "zh-CN",
                            paginationHAlign: "center",
                            clickToSelect: true,
                            columns: [
                                {field: "name", title: "门店名称",align:"center",valign:'middle'},
                                {
                                    field: "", title: "操作", align: "center", valign: "middle", formatter: function (value, row, index) {
                                        return '<button class="btn btn-primary" style="margin-right: 8px;" onclick="selectPerson('+row.id+')">选择</button>';
                                    }
                                }
                            ]
                        });
                    }
                });

            }
        });
    }

    function selectPerson(id) {
        var index= layer.open({
            type: 1,
            shade: 0.01,
            shadeClose: true,
            skin: 'layui-layer-demo', //样式类名
            area: ['360px', '448px'],
            anim: 0,
            closeBtn: 0,
            resize: false,
            title: "选择任务对象员工列表",
            content: $('.task-object2'),
            btn: ['关闭窗口'],
            yes: function (index) {
                layer.close(index);
            },
            success: function (layero, index) {
                quakooData.ajaxGetData(config.getUrl_user_getAllUser(),{sid: id,userType: 1},function (ret) {
                    console.log("任务门店",ret);
                    if(ret&&ret.success){
                        $("#object-table2").bootstrapTable('destroy');
                        $("#object-table2").bootstrapTable({
                            data: ret.data,
                            classes: "table",
                            pagination: false,//是否显示分页
                            sortable: false,
                            sortOrder: "asc",
                            showColumns: true,
                            strictSearch: true,
                            locale: "zh-CN",
                            paginationHAlign: "center",
                            clickToSelect: true,
                            columns: [
                                {checkbox: true, align: "center", valign: "middle",formatter:function(value, row, index){
                                    if(taskLocData.executor.indexOf(row.id)>=0){
                                            return {
                                                checked: true
                                            }
                                        }else{
                                            return value;
                                        }
                                    }
                                },
                                {field: "name", title: "门店名称",align:"center",valign:'middle'},
                                {
                                    field: "", title: "操作", align: "center", valign: "middle", formatter: function (value, row, index) {
                                        return '<button class="btn btn-primary" style="margin-right: 8px;">选择</button>';
                                    }
                                }
                            ],
                            onCheck:function (row) {
                                if(taskLocData.executor.indexOf(row.id) < 0){
                                    taskLocData.executor.push(row.id)
                                }
                            },
                            onUncheck:function (row) {
                                if(taskLocData.executor.indexOf(row.id)>=0){
                                    taskLocData.executor.splice(taskLocData.executor.indexOf(row.id),1)
                                }
                            },
                            onCheckAll:function (row) {
                                for(var i=0;i<row.length;i++){
                                    if(taskLocData.executor.indexOf(row[i].id) < 0){
                                        taskLocData.executor.push(row[i].id)
                                    }
                                }
                            },
                            onUncheckAll:function (row) {
                                for(var i=0;i<row.length;i++){
                                    if(taskLocData.executor.indexOf(row[i].id)>=0){
                                        taskLocData.executor.splice(taskLocData.executor.indexOf(row[i].id),1)
                                    }
                                }
                            }
                        });
                    }
                });

            }
        });

    }
    /**
     * 弹窗选择任务门店
     * */
    function selectShop() {
        var index = layer.open({
            type: 1,
            shade: 0.01,
            shadeClose: true,
            skin: 'dialog-shop', //样式类名
            area: ['360px', '308px'],
            anim: 0,
            closeBtn: 0,
            resize: false,
            title: null,
            move: ".task-header",
            content: $('.task-shop'),
            btn: ["关闭窗口"],
            yes: function (index) {
                layer.close(index);
            },
            success: function (layero, index) {
                renderTaskShop();
            }
        });

    }

    /************************************</任务奖励结束>******************************************/

    /*卡片分页-短信营销*/
    /*
        var $tableNote = $("#yj-page-note-table");
        var data2 = [{id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}];
        var TableInit = function (callback) {
            var oTableInit = new Object();
            //初始化Table
            oTableInit.Init = function () {
                $tableNote.bootstrapTable('destroy');
                $tableNote.bootstrapTable({
                    data: data2,
                    classes: "table",
                    pagination: true,        //是否显示分页
                    pageNumber: 1,                       //初始化加载第一页，默认第一页
                    pageSize: 6,
                    pageList: [6, 12, 18],
                    sortable: false,
                    sortOrder: "asc",
                    showColumns: true,
                    strictSearch: true,
                    locale: "zh-CN",
                    paginationHAlign: "center",
                    clickToSelect: true,
                    paginationLoop: false,
                    columns: [],
                    onPreBody: function (data) {
                        if (callback) {
                            callback(data, this)
                        }
                    }
                });
            };
            return oTableInit;
        };
        var Table = new TableInit(note);
        Table.Init();
        function note(data, _this) {
            var html = '';
            for (var i = (_this.pageNumber - 1) * _this.pageSize; i < _this.pageNumber * _this.pageSize; i++) {
                if (i % 2 == 0) {
                    html += '<li class="card-item">' +
                            '<div class="inner">' +
                            '<div class="top">' +
                            '<div class="text">' +
                            '<div class="main">消费信息提醒</div>' +
                            '<div class="vice">消费后发送信息至顾客的手机或微信中</div>' +
                            '</div>' +
                            '<div class="switch">' +
                            '<span class="off">未开启</span>' +
                            '<span class="on">已启用</span>' +
                            '<span class="switch-btn"><i></i></span>' +
                            '</div>' +
                            '</div>' +
                            '<div class="cont">' +
                            '<div class="off"  onclick="newVouchers2()">' +
                            '<i class="iconfont icon-ico_setting_filled"></i>' +
                            '<span>设置</span>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</li>';
                } else if (i % 2 == 1) {
                    html += '<li class="card-item">' +
                            '<div class="inner">' +
                            '<div class="top">' +
                            '<div class="text">' +
                            '<div class="main">消费信息提醒</div>' +
                            '<div class="vice">消费后发送信息至顾客的手机或微信中</div>' +
                            '</div>' +
                            '<div class="switch active">' +
                            '<span class="off">未开启</span>' +
                            '<span class="on">已启用</span>' +
                            '<span class="switch-btn"><i></i></span>' +
                            '</div>' +
                            '</div>' +
                            '<div class="cont">' +
                            '<div class="on">' +
                            '<div class="message-top">' +
                            '<span class="fl">短信内容</span>' +
                            '<input class="fr button-thin" type="button" onclick="newVouchers2()" value="编辑">' +
                            '</div>' +
                            '<div class="message-cont">' +
                            '尊敬的xxx你好，你在xxxx你好，你在xxxxx消费了xx尊敬的xxx你好，你在xxxxx消费了xxx元，欢迎你下次再来。' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</li>';
                }
                html += '<li class="card-item">' +
                        '<div class="inner">' +
                        '<div class="top">' +
                        '<div class="text">' +
                        '<div class="main">消费信息提醒</div>' +
                        '<div class="vice">消费后发送信息至顾客的手机或微信中</div>' +
                        '</div>' +
                        '<div class="switch">' +
                        '<span class="off">未开启</span>' +
                        '<span class="on">已启用</span>' +
                        '<span class="switch-btn"><i></i></span>' +
                        '</div>' +
                        '</div>' +
                        '<div class="cont">' +
                        '<div class="off"  onclick="newVouchers2()">' +
                        '<i class="iconfont icon-ico_setting_filled"></i>' +
                        '<span>设置</span>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</li>';
            }
            $("#yj-page-note-table").html(html);
        }
    */


    /**
     * 弹窗编辑短信营销
     * */
    function newVouchers2() {
        var index = layer.open({
            type: 1,
            shade: 0.01,
            shadeClose: true,
            skin: 'layui-layer-demo layui-layer-dx', //样式类名
            area: ['360px', '290px'],
            anim: 0,
            closeBtn: 0,
            title: "",
            content: $('.content-view2'),
            resize: false,
            btn: ['取消', '保存修改'],
            yes: function (index, layero) {
                layer.close(index)
            },
            btn2: function () {

                return false;
            },
            success: function (layero, index) {
                $('.layui-layer-dx .layui-layer-content').css('height', 290 - 44 + 'px');
                $('.layui-layer-dx .layui-layer-btn').css({
                    'background-color': 'rgba(244, 244, 248, 1)',
                    'box-shadow': '0px -1px 0px 0px rgba(236, 236, 244, 1)'
                })
            }
        });
    }


    /**
     * 开关切换
     * */
    $(".switch-btn").click(function () {
        $(this).parent(".switch").toggleClass('active');
    });

</script>
</body>
</html>