<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <title>营销管理</title>
    <!--Bootstrap样式引入开始-->
    <link rel="stylesheet" href="../resource/css/bootstrap.min.css">
    <link href="../resource/js/plugins/bootstarp-table/css/bootstrap-table.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../resource/js/plugins/bootstrapzTree/bootstrapStyle.css" type="text/css">
    <link rel="stylesheet" href="../resource/js/plugins/bootstrap-select/css/bootstrap-select.min.css" type="text/css">
    <link href="../resource/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
    <link rel="stylesheet" href="../resource/layui/css/layui.css">
    <link href="../resource/css/yanjing/mobiscroll.2.13.2.css" rel="stylesheet">
    <link href="../resource/css/yanjing/myDate.css" rel="stylesheet">
    <!--Bootstrap样式引入结束-->
    <!--字体样式文件引用开始-->
    <link rel="stylesheet" href="../resource/fonts/iconfont.css">
    <!--字体样式文件引用结束-->
    <!--标签样式重置开始-->
    <link rel="stylesheet" href="../resource/css/reset.css">
    <!--标签样式重置结束-->
    <!--公用组件样式-->
    <link rel="stylesheet" href="../resource/css/common.css">
    <!--公用组件样式结束-->
    <!--单页样式-->
    <link rel="stylesheet" href="../resource/css/yanjing/market.css">
    <!--单页样式结束-->

</head>
<body class="body-bg">
<div class="header clear">
    <ul class="tab-ul clear">
        <li class="active">抵用券营销</li>
        <!--<li>短信营销</li>-->
        <li data-id="send">短信群发</li>
        <li>任务奖励</li>
    </ul>
    <ol>
        <li class="right-info active">
            <button onclick="newVouchers1()">新增抵用券</button>
        </li>
        <!--<li class="right-info">-->
        <!--&lt;!&ndash;<span>剩余 1200 条信息可用</span>&ndash;&gt;-->
        <!--</li>-->
        <li class="right-info">
            <!--<span>剩余 1200 条信息可用</span>-->
            <button onclick="newVouchers3()">新增短信群发</button>
        </li>
        <li class="right-info">
            <button onclick="createTask()">创建任务</button>
        </li>
    </ol>
</div>
<div class="content">
    <ul>
        <li class="tab-item first active">
            <ol class="clear" id="card-list1">
            </ol>
            <table id="yj-page-table" data-toggle="table" class="table table-border"></table>
        </li>
        <!--<li class="tab-item section ">
            <ol class="clear" id="yj-page-note-table">
                <li class="card-item">
                    <div class="inner">
                        <div class="top">
                            <div class="text">
                                <div class="main">消费信息提醒</div>
                                <div class="vice">消费后发送信息至顾客的手机或微信中</div>
                            </div>
                            <div class="switch">
                                <span class="off">未开启</span>
                                <span class="on">已启用</span>
                                <span class="switch-btn"><i></i></span>
                            </div>
                        </div>
                        <div class="cont">
                            <div class="off"  onclick="newVouchers2()">
                                <i class="iconfont icon-ico_setting_filled"></i>
                                <span>设置</span>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="card-item">
                    <div class="inner">
                        <div class="top">
                            <div class="text">
                                <div class="main">消费信息提醒</div>
                                <div class="vice">消费后发送信息至顾客的手机或微信中</div>
                            </div>
                            <div class="switch active">
                                <span class="off">未开启</span>
                                <span class="on">已启用</span>
                                <span class="switch-btn"><i></i></span>
                            </div>
                        </div>
                        <div class="cont">
                            <div class="on">
                                <div class="message-top">
                                    <span class="fl">短信内容</span>
                                    <input class="fr button-thin" type="button" onclick="newVouchers2()" value="编辑">
                                </div>
                                <div class="message-cont">
                                    尊敬的xxx你好，你在xxxx你好，你在xxxxx消费了xx尊敬的xxx你好，你在xxxxx消费了xxx元，欢迎你下次再来。
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
            </ol>
        </li>-->
        <li class="tab-item">
            <table id="dxqf-table" data-toggle="table" class="table table-border"></table>
        </li>
        <li class="tab-item">
            <table id="rwjl-table" data-toggle="table" class="table table-border"></table>
        </li>
    </ul>

</div>
<div class="content-view1">
    <form action="">
        <div class="lay-header">
            <span class="lay-title" id="voucher-title">新增抵用券</span>
            <div class="switch active fr" id="voucherSwitch">
                <span class="off">未开启</span>
                <span class="on">已启用</span>
                <span class="switch-btn"><i></i></span>
            </div>
        </div>
        <div class="lay-content">
            <ol>
                <li class="lay-row title clear">
                    <div class="left">抵用券标题</div>
                    <input class="right" type="text" placeholder="抵用券标题" id="voucherTitle">
                </li>
                <li class="lay-row describe clear">
                    <div class="left">抵用券描述</div>
                    <div class="right">
                        <strong>消费满</strong>
                        <input type="number" placeholder="数值" id="describefull">
                        <div class="selectBox" id="selectBox1">
                            <div class="select-box-header">
                                <span class="text">元</span><i class="iconfont icon-ico_arrow_down"></i>
                            </div>
                            <div class="optionBox">
                                <ul class="optionUL">
                                    <li value="1">元</li>
                                    <li value="2">个</li>
                                </ul>
                            </div>
                        </div>
                        <strong>减</strong>
                        <input type="number" placeholder="数值" id="describeSubtract">
                        <div class="selectBox" id="selectBox2">
                            <div class="select-box-header">
                                <span class="text">元</span><i class="iconfont icon-ico_arrow_down"></i>
                            </div>
                            <div class="optionBox">
                                <ul class="optionUL">
                                    <li value="1">元</li>
                                    <li value="2">%</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="lay-row clear">
                    <div class="left">获取条件</div>
                    <div class="right radio-button">
                        <div class="box">
                            <input type="radio" name="condition" id="condition1" checked="checked">
                            <label for="condition1">
                                <div class="selectBox" id="selectBox3">
                                    <div class="select-box-header">
                                        <span class="text">全场通用</span><i class="iconfont icon-ico_arrow_down"></i>
                                    </div>
                                    <div class="optionBox">
                                        <ul class="optionUL">
                                            <li value="1">全场通用</li>
                                            <li value="2">消费金额</li>
                                            <li value="3">消费个数</li>
                                        </ul>
                                    </div>
                                </div>
                            </label>
                        </div>
                        <div class="box" id="voucherCondition" style="display: none;">
                            <span>消费满</span>
                            <input type="number" placeholder="数值" id="conditionFull"/>
                            <span class="condition-type">元</span>
                        </div>
                    </div>
                </li>
                <li class="lay-row time clear">
                    <div class="left">有效期</div>
                    <div class="right">
                        <div class="yj-demo-time">
                            <div class="yj-date">
                                <span id="voucherTime">开始时间-结束时间</span><i class="iconfont icon-ico_calendar"></i>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="lay-row clear">
                    <div class="left">排序</div>
                    <input type="number" class="right" placeholder="数字序号" id="voucherSort">
                </li>
            </ol>
        </div>
        <input type="reset" id="voucherReset" value="" placeholder="" class="resetFormBtn">
    </form>
</div>
<div class="content-view2">
    <div class="top-name layui-layer-title ">
        编辑隐形眼镜药水消费提醒
    </div>

</div>
<div class="content-view3">
    <form action="">
        <div class="top-name">
            新增短信群发
        </div>
        <div class="customer">
            <div class="title">面向顾客</div>
            <div class="contents">
                <ol>
                    <li class="item clear">
                        <div class="left">属性</div>
                        <div class="right radio-button" id="pro">
                            <input type="radio" name="property" id="pro1" value="0" checked>
                            <label for="pro1">全部</label>
                            <input type="radio" name="property" id="pro2" value="1">
                            <label for="pro2">会员</label>
                            <input type="radio" name="property" id="pro3" value="2">
                            <label for="pro3">非会员</label>
                        </div>
                    </li>
                    <li class="item clear">
                        <div class="left">性别</div>
                        <div class="right radio-button" id="sex">
                            <input type="radio" name="sex" id="sex1" value="0" checked>
                            <label for="sex1">全部</label>
                            <input type="radio" name="sex" value="1" id="sex2">
                            <label for="sex2">男</label>
                            <input type="radio" name="sex" value="2" id="sex3">
                            <label for="sex3">女</label>
                        </div>
                    </li>
                    <li class="item clear">
                        <div class="left">职业</div>
                        <div class="right">
                            <div class="selectBox" id="selectBox5">
                                <div class="select-box-header">
                                    <span class="text">全部职业</span><i class="iconfont icon-ico_arrow_down"></i>
                                </div>
                                <div class="optionBox">
                                    <ul class="optionUL" id="jobUl">
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="item clear">
                        <div class="left">年龄</div>
                        <div id="slide1" class=" right"></div>
                    </li>
                </ol>
            </div>
        </div>
        <div class="sms">
            <div class="title">短信内容</div>
            <div id="moveBox">
                <div id="moveBar" ondragover="allowDrop(event)" ondrop="drop(event)">
                    <div class="movebar" id="moveBar1" draggable="true" ondragstart="drag(event)">顾客姓名</div>
                    <div class="movebar" id="moveBar2" draggable="true" ondragstart="drag(event)">门店名称</div>
                    <!--
                                    <div class="movebar" id="moveBar3" draggable="true" ondragstart="drag(event)">门店名称</div>
                                    <div class="movebar" id="moveBar4" draggable="true" ondragstart="drag(event)">消费金额</div>
                                    <div class="movebar" id="moveBar5" draggable="true" ondragstart="drag(event)">诸葛村夫</div>
                    -->
                </div>
                <div class="fill">
                    <div class="fill-tip">编辑输入框中的内容或拖动字段</div>
                    <div class="fill-box">
                        <div class="fill-div" id="fill-div" onclick="changeArea()" ondragover="allowDrop(event)"
                             ondrop="drop(event)">尊敬的你好，你在消费了元，欢迎你下次再来。
                        </div>
                        <textarea name="" onclick="textareaClick()" onblur="textareaBlur()" class="fill-text"
                                  id="fill-text">尊敬的你好，你在消费了元，欢迎你下次再来。</textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="time">
            <div class="title">发送时间</div>
            <div class="send-time">
                <div class="settings" style="display:none;">
                    <select name="demo" id="demo">
                        <option value="date"></option>
                    </select>
                </div>
                <input name="test" id="send-time"
                       class="demo-test-date demo-test-datetime demo-test-time demo-test-credit" placeholder="发送时间"
                       data-type="time"/>
                <i class="iconfont icon-ico_calendar"></i>
            </div>
        </div>
        <input type="reset" id="sendMsgResetBtn" placeholder="" value="" class="resetFormBtn">
    </form>
</div>


<!--创建任务-->
<div class="create-task">
    <div class="create-task-header">
        <ul class="create-task-header-tab clear">
            <li class="active">创建团队任务</li>
            <li id="person-task">创建个人任务</li>
            <li class="move"></li>
        </ul>
    </div>
    <ul class="task-tab">
        <li class="task-item">
            <div class="task-first clear">
                <div class="first-item fl">
                    <div class="text">任务名称</div>
                    <input type="text" class="name" placeholder="名称">
                </div>
                <div class="first-item fr">
                    <div class="text">任务门店</div>
                    <button type="button" class="shop" onclick="selectShop()">选择门店<i class="iconfont icon-ico_list"></i>
                    </button>
                </div>
            </div>
            <div class="task-second">
                <input type="radio" name="sales" id="money" checked="checked" data-id="1">
                <label for="money">销售额奖励</label>
                <input type="radio" name="sales" id="number" data-id="2">
                <label for="number">销售量奖励</label>
            </div>
            <div class="task-third">
                <div id="saleroom-box" style="display: block;">
                    <input type="radio" name="salesNum" id="allShop">
                    <label for="allShop">
                        <span>全店总销售额达到</span>
                        <input type="number" placeholder="金额">
                        <span>元</span>
                    </label>
                    <input type="radio" name="salesNum" id="selectProduct" checked="checked">
                    <label for="selectProduct">
                        <button type="button" onclick="selectProduct()">选择任务产品 <i class="iconfont icon-ico_list"></i>
                        </button>
                        <span>销售额达到</span>
                        <input type="number" placeholder="金额">
                        <span>元</span>
                    </label>
                </div>
                <div id="saleVolume-box" style="display: none">
                    <input type="radio" name="salesNum" id="selectProduct1" checked="checked">
                    <label for="selectProduct1">
                        <button type="button" onclick="selectProduct()">选择任务产品 <i class="iconfont icon-ico_list"></i>
                        </button>
                        <span>销售量达到</span>
                        <input type="number" placeholder="数量">
                    </label>
                </div>
                <div class="award">
                    <div class="award-text">奖励</div>
                    <input type="number" placeholder="输入金额">
                </div>
                <div class="mission-time clear">
                    <div class="mission-text">任务时间</div>
                    <div class="yj-demo-time">
                        <div class="yj-date">
                            <span>选择截止时间</span><i class="iconfont icon-ico_calendar"></i>
                        </div>
                    </div>
                    <div class="send-time">
                        <div class="settings" style="display:none;">
                            <select name="demo" id="demo1">
                                <option value="date">日期</option>
                            </select>
                        </div>
                        <input name="test" id="se-time"
                               class="demo-test-date demo-test-datetime demo-test-time demo-test-credit"
                               placeholder="选择截止时间" data-type="time"/>
                        <i class="iconfont icon-ico_calendar"></i>
                    </div>
                    <input type="checkbox" id="time-frame">
                    <label for="time-frame">选择时间段</label>
                </div>
            </div>
        </li>
    </ul>
</div>
<div class="task-object">
    <div class="tash-header layui-layer-title">选择任务对象</div>
    <div class="content">
        <div class="table">
            <table id="yj-table" data-toggle="table" class="table"></table>
        </div>
    </div>
</div>
<div class="task-shop scroll-content">
    <div class="task-header">选择任务门店</div>
    <div class="content">
        <div class="table-box">
            <table id="shop-table" data-toggle="table" class="table"></table>
        </div>
    </div>
</div>
<div class="task-product">
    <div class="task-header">选择任务产品</div>
    <ul class="product-tab clear" id="product-tab">
        <li class="product-item active">镜片</li>
        <li class="product-item">镜架</li>
        <li class="product-item">隐形眼镜</li>
        <li class="product-item">太阳镜</li>
        <li class="product-item">其他商品</li>
    </ul>
    <ol class="product-list-tab">
        <li class="product-list-item active">
            <table id="jp-table" data-toggle="table" class="table"></table>
        </li>
        <li class="product-list-item"></li>
        <li class="product-list-item"></li>
        <li class="product-list-item"></li>
        <li class="product-list-item"></li>
    </ol>
</div>
<div class="delete-task">
    <div class="delete-header layui-layer-title">确定删除任务？</div>
    <div class="content">此操作不可撤销</div>
</div>
<!--全局JS引用-->
<!-- jq库 -->
<script src="../resource/js/jquery.min.js"></script>
<!-- bootstrap UI需要依赖的js -->
<script src="../resource/js/bootstrap.js?v=3.3.6"></script>
<script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table.js"></script>
<script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table-zh-CN.min.js"></script>
<!-- layui需要依赖的js -->
<script src="../resource/js/plugins/layer/layer.js"></script>
<script src="../resource/layui/layui.js"></script>
<!-- 公司内部库 -->
<script src="../resource/js/lib/quakooLib/QuakooBase-1.0.0.js"></script>
<script src="../resource/js/lib/quakooLib/QuakooConfig-1.0.0.js"></script>
<script src="../resource/js/lib/quakooLib/QuakooBasePc-1.0.0.js"></script>
<script src="../resource/js/lib/quakoo/Config.js"></script>
<script src="../resource/js/lib/quakoo/project.js"></script>
<script src="../resource/js/template-native.js"></script>

<!-- 全局公共js -->
<script src="../resource/js/yanjing.js"></script>
<!--单个时间插件-->
<script src="../resource/js/mobiscroll.2.13.2.js"></script>
<!--//日期范围插件开始-->
<script src="../resource/js/yanjing/daterange.js"></script>
<!--//日期范围插件结束-->
<script src="../resource/js/yanjing/tuodong.js"></script>

<!--抵用券营销-->
<script type="text/html" id="voucherList">
    <%for(var i = 0; i < list.length; i++){%>
    <li class="card-item">
        <div class="top">
            <%if(list[i].open == 1){%>
            <div class="switch active fr" onclick="updateOpen('<%=list[i].id%>',2)">
                <span class="on">已启用</span>
                <span class="switch-btn"><i></i></span>
            </div>
            <%}else if(list[i].open == 2){%>
            <div class="switch fr" onclick="updateOpen('<%=list[i].id%>',1)">
                <span class="off">未开启</span>
                <span class="switch-btn"><i></i></span>
            </div>
            <%}%>
            <div class="text fl"><%=list[i].title%></div>
        </div>
        <div class="middle-cont">
            <div class="item">
                <div class="text-top">获取条件</div>
                <%if(list[i].conditionType == 1){%>
                <div class="text-bot">全场通用</div>
                <%}else if(list[i].conditionType == 2){%>
                <div class="text-bot">消费满<%=list[i].conditionFull%>元</div>
                <%}else if(list[i].conditionType == 3){%>
                <div class="text-bot">消费满<%=list[i].conditionFull%>个</div>
                <%}%>
            </div>
            <div class="item">
                <div class="text-top">抵用券描述</div>
                <%if(list[i].descFullType == 1&&list[i].descSubtractType ==1){%>
                <div class="text-bot">消费满<%=list[i].descFull%>元减<%=list[i].descSubtract%>元</div>
                <%}else if(list[i].descFullType == 1&&list[i].descSubtractType ==2){%>
                <div class="text-bot">消费满<%=list[i].descFull%>元减<%=list[i].descSubtract%>%</div>
                <%}else if(list[i].descFullType == 2&&list[i].descSubtractType ==1){%>
                <div class="text-bot">消费满<%=list[i].descFull%>个减<%=list[i].descSubtract%>元</div>
                <%}else if(list[i].descFullType == 1&&list[i].descSubtractType ==1){%>
                <div class="text-bot">消费满<%=list[i].descFull%>个减<%=list[i].descSubtract%>%</div>
                <%}%>
            </div>
            <div class="item">
                <div class="text-top">有效期</div>
                <div class="text-bot"><%=list[i].startTime%> - <%=list[i].endTime%></div>
            </div>
        </div>
        <div class="bot-cont">
            <span class="button button-thin-blue" onclick="newVouchers1('<%=list[i].id%>')">编辑</span>
            <span class="button button-thin-red" onclick="delVoucher('<%=list[i].id%>')">删除</span>
        </div>
    </li>

    <%}%>
</script>

<!--短信群发——职业下拉框-->
<script type="text/html" id="jobList">
    <%for(var i =0;i< list.length;i++){%>
    <li value="<%=list[i]%>"><%=list[i]%></li>
    <%}%>
</script>

<!--任务产品类型-->
<script type="text/html" id="categoryTmp">
    <%for(var i=0;i< list.length;i++){%>
    <%if(list[i].pid==0){%>
    <li class="product-item" id="category<%=list[i].id%>" onclick="chooseGoodsType('<%=list[i].id%>')"><%=list[i].name%></li>
    <%}%>
    <%}%>
</script>

<script>
    var psid;                                             //企业ID
    var subid;                                            //门店ID
    var cid = '';                                         //类目id
    var arr = [];                                         //抵用券数据
    var diaMsgJob;                                        //短信群发职位
    /**初始化页面*/
    $(function () {
        initPage();
    });

    /**初始化函数*/
    function initPage() {
        psid = quakooUser.getUserInfo().psid;             //企业ID(公司ID)
        subid = quakooDb.getItem("sel_ShopId");          //门店ID
        //获取一级类目
        quakooData.ajaxGetData(config.getUrl_productCategory_getSubAllList(),{subid:subid},function (ret) {
            if(ret && ret.success){
                if(ret.data.length>0){
                    var html = template('categoryTmp',{list:ret.data});
                    $('#product-tab').html(html);
                    chooseGoodsType(ret.data[0].id)
                }
            }
        })
        Table.Init();
        fromBox();
    }

    /************************************<抵用券营销开始>******************************************/
    /*卡片分页-抵用券营销*/
    var $table = $("#yj-page-table");
    var TableInit = function (callback) {
        var oTableInit = new Object();
        //初始化Table
        oTableInit.Init = function () {
            $table.bootstrapTable('destroy');
            $table.bootstrapTable({
                url: config.getUrl_marketingcoupon_getAllList(),
                method: 'get',
                classes: "table",
                pagination: true,                    //是否显示分页
                sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                pageNumber: 1,                       //初始化加载第一页，默认第一页
                pageSize: 6,
                pageList: [6, 12, 18],
                sortable: false,
                sortOrder: "asc",
                showColumns: true,
                strictSearch: true,
                locale: "zh-CN",
                paginationHAlign: "center",
                clickToSelect: true,
                paginationLoop: false,
                columns: [],
                queryParams: function (param) {
                    param.subid = psid;
                    param.token = quakooUser.getUserInfo().token;
                    return param
                },
                onPreBody: function () {
                    if (callback) {
                        callback(this)
                    }
                }
            });
        };
        return oTableInit;
    };
    var Table = new TableInit(manage);

    function manage(_this) {
        arr = [];
        for (var i = (_this.pageNumber - 1) * _this.pageSize; i < _this.pageNumber * _this.pageSize; i++) {
            if (_this.data[i]) {
                _this.data[i].oStartTime = _this.data[i].startTime;  //供编辑使用
                _this.data[i].oEndTime = _this.data[i].endTime;      //供编辑使用
                _this.data[i].startTime = quakooUtils.formatTimeToDateDianLY(_this.data[i].startTime);
                _this.data[i].endTime = quakooUtils.formatTimeToDateDianLY(_this.data[i].endTime);
                arr.push(_this.data[i])
            }
        }
        // console.log("抵用券数据：", arr);
        var html = template("voucherList", {list: arr});
        $("#card-list1").html(html);
    }

    /**接口——新增抵用券（编辑抵用券）*/
    function addVoucher(descFullType, descSubtractType, conditionType, startTime, endTime, voucherId) {
        alert(voucherId)
        var url;
        var title = $("#voucherTitle").val();              //抵用券名字
        var descFull = $("#describefull").val();           //抵用券满
        descFullType = descFullType || 1;                    //抵用券满类型
        var descSubtract = $("#describeSubtract").val();   //描述-消费减
        descSubtractType = descSubtractType || 1;            //抵用券减类型
        conditionType = conditionType || 1;                  //获取条件类型(1-全场通用 2-消费金额 3-消费个数)
        if (conditionType == 2 || conditionType == 3) {           //获取条件消费满
            var conditionFull = $("#conditionFull").val();
        }
        var sort = $("#voucherSort").val();                //排序
        var voucherSwitch = $("#voucherSwitch");
        if (voucherSwitch.hasClass("active")) {              //抵用券是否开启
            var open = 1;
        } else {
            var open = 2;
        }
        var startTime = date1.getTime()[2] || startTime;      //开始时间
        var endTime = date1.getTime()[3] || endTime;          //结束时间
        //判断是否为空
        if (quakooUtils.isBlack(startTime) || quakooUtils.isBlack(endTime)) {
            layer.msg("请选择有效期", {icon: 1});
            return
        }
        if (quakooUtils.isBlack(title)) {
            layer.msg("抵用券名字不能为空", {icon: 1});
            return
        }
        if (quakooUtils.isBlack(descFull) && descFull <= 0) {
            layer.msg("请输入正确的抵用券满金额", {icon: 1});
            return
        }
        if (quakooUtils.isBlack(descSubtract) && descSubtract <= 0) {
            layer.msg("请输入正确的抵用券减金额", {icon: 1});
            return
        }
        if (quakooUtils.isBlack(sort)) {
            sort = 1;
        }
        if (sort < 0) {
            layer.msg("请输入正确的排序");
            return
        } else {
            var param = {};
            param.subid = psid;                          //公司id
            param.title = title;                         //标题
            param.startTime = startTime;                 //起始时间
            param.endTime = endTime;                     //结束时间
            if (conditionFull) {
                if (conditionFull > 0) {
                    param.conditionFull = conditionFull; //获取条件-消费满
                } else {
                    layer.msg("请输入正确的获取条件的满减数值！");
                }
            }
            param.conditionType = conditionType;         //获取条件类型(1-全场通用 2-消费金额 3-消费个数)
            param.descSubtract = descSubtract;           //描述-消费减
            param.descSubtractType = descSubtractType;   //描述-消费减 类型(1-金额 2-百分比)
            param.descFull = descFull;                   //描述-消费满
            param.descFullType = descFullType;           //描述-消费满 类型(1-金额 2-个数)
            param.sort = sort;                           //排序
            param.open = open;                           //抵用券开启||关闭
            param.startTime = startTime;                 //起始时间
            param.endTime = endTime;                     //起始时间
        }
        if (quakooUtils.isNotBlack(voucherId)) {
            alert(voucherId)
            param.id = voucherId;
            url = config.getUrl_marketingcoupon_updateMarketing();
            quakooData.ajaxGetData(url, param, function (ret) {
                if (ret && ret.success) {
                    layer.msg("已重新编辑抵用券", {icon: 1});
                    Table.Init();
                } else {
                    layer.msg(ret.data, {icon: 2});
                }
            })
        } else {
            url = config.getUrl_marketingcoupon_add();
            quakooData.ajaxGetData(url, param, function (ret) {
                if (ret && ret.success) {
                    layer.msg("成功添加抵用券", {icon: 1});
                    Table.Init();
                } else {
                    layer.msg(ret.data, {icon: 2});
                }
            })
        }
    }

    /**接口——删除抵用券*/
    function delVoucher(id) {
        quakooData.ajaxGetData(config.getUrl_marketingcoupon_del(), {id: id}, function (ret) {
            if (ret && ret.success) {
                layer.msg("成功删除抵用券", {icon: 1});
            } else {
                layer.msg(ret.data, {icon: 2});
            }
            Table.Init();
        })
    }

    /**接口——启用/关闭抵用卷*/
    function updateOpen(id, open) {
        quakooData.ajaxGetData(config.getUrl_marketingcoupon_updateOpen(), {open: open, id: id}, function (ret) {
            if (ret && ret.success) {
                if (open == 1) {
                    layer.msg("抵用券已启用", {icon: 1});
                } else if (open == 2) {
                    layer.msg("抵用券已关闭", {icon: 1})
                }
                Table.Init();
            } else {
                layer.msg(ret.data, {icon: 2});
            }
        })
    }

    /**
     * 弹窗新增抵用券(编辑)
     * */
    function newVouchers1(data) {
        var descFullType = 1;                                   //描述-消费满 类型(1-金额 2-个数)
        var descSubtractType = 1;                               //描述-消费减 类型(1-金额 2-百分比)
        var conditionType = 1;                                  //获取条件类型(1-全场通用 2-消费金额 3-消费个数)
        if (data) {//编辑日期传值
            var startTime;
            var endTime;
        }
        selectTag($("#selectBox1"), function (ret) {        //抵用券满类型
            descFullType = ret.value;
        });
        selectTag($("#selectBox2"), function (ret) {        //抵用券减类型
            descSubtractType = ret.value;
        });
        if ($("#condition1").attr("checked")) {              //获取条件类型(1-全场通用 2-消费金额 3-消费个数)
            selectTag($("#selectBox3"), function (ret) {
                if (ret.value == 1) {
                    $("#voucherCondition").hide();
                } else if (ret.value == 2) {
                    $("#voucherCondition").show();
                    $("#voucherCondition .condition-type").html("元");
                } else if (ret.value == 3) {
                    $("#voucherCondition").show();
                    $("#voucherCondition .condition-type").html("个");
                }
                conditionType = ret.value;
            });
        }
        if (quakooUtils.isBlack(data)) {
            //新增按钮
            var btn = ['取消', '新增']
        } else {
            //编辑按钮
            var btn = ['取消', '编辑']
        }
        var index = layer.open({
            type: 1,
            shade: 0.01,
            shadeClose: true,
            skin: 'dialog-voucher', //样式类名
            area: '360px',
            anim: 0,
            closeBtn: 0,
            resize: false,
            title: null,
            move: ".lay-title",
            content: $('.content-view1'),
            btn: btn,
            yes: function (index) {
                layer.close(index)
            },
            btn2: function () {
                if (quakooUtils.isBlack(data)) {
                    //新增
                    addVoucher(descFullType, descSubtractType, conditionType);//提交抵用券
                } else {
                    //编辑
                    addVoucher(descFullType, descSubtractType, conditionType, startTime, endTime, data);
                }
            },
            success: function (layero, index) {
                document.getElementById("voucherReset").click(); //重置表单
                /**编辑*/
                if (quakooUtils.isNotBlack(data)) {
                    for (var i = 0; i < arr.length; i++) {  //获取对应的数据
                        if (arr[i].id == data) {
                            var obj = arr[i];
                        }
                    }
                    $("#voucher-title").html("编辑抵用券");
                    if (obj.open == 1) {
                        //开启
                        $("#voucherSwitch").addClass("active");
                    } else if (obj.open == 2) {
                        //不开启
                        $("#voucherSwitch").removeClass("active");
                    }
                    $("#voucherTitle").val(obj.title);
                    $("#describefull").val(obj.descFull);//消费满
                    $("#describeSubtract").val(obj.descSubtract);//消费减
                    descFullType = obj.descFullType;
                    descSubtractType = obj.descSubtractType;
                    conditionType = obj.conditionType;
                    if (obj.descFullType == 1) {
                        //描述-消费满 类型金额
                        $("#selectBox1 .text").html("元")
                    } else if (obj.descFullType == 2) {
                        //描述-消费满 类型个数
                        $("#selectBox1 .text").html("个")
                    }
                    if (obj.descSubtractType == 1) {
                        //描述-消费减 金额
                        $("#selectBox2 .text").html("元")
                    } else if (obj.descSubtractType == 2) {
                        //描述-消费减 百分比
                        $("#selectBox2 .text").html("%")
                    }
                    if (obj.conditionType == 1) {
                        //全场通用
                        $("#voucherCondition").hide();
                        $("#selectBox3 .text").html("全场通用");
                    } else if (obj.conditionType == 2) {
                        //消费金额
                        $("#voucherCondition").show();
                        $("#selectBox3 .text").html("消费金额");
                        $("#conditionFull").val(obj.conditionFull);
                        $("#voucherCondition .condition-type").html("元");
                    } else if (obj.conditionType == 3) {
                        //消费个数
                        $("#voucherCondition").show();
                        $("#selectBox3 .text").html("消费个数");
                        $("#conditionFull").val(obj.conditionFull);
                        $("#voucherCondition .condition-type").html("个");

                    }
                    startTime = obj.oStartTime;
                    endTime = obj.oEndTime;
                    var staTimeTxt = quakooUtils.formatTimeToDateDianLY(obj.startTime);
                    var endTimeTxt = quakooUtils.formatTimeToDateDianLY(obj.endTime);
                    $("#voucherTime").addClass("sel-time").html(staTimeTxt + "-" + endTimeTxt);
                    $("#voucherSort").val(obj.sort);
                } else {
                    $("#voucher-title").html("新增抵用券");
                    if ($("#voucherTime").hasClass("sel-time")) {
                        $("#voucherTime").removeClass("sel-time");
                    }
                    $("#voucherTime").html("开始时间-结束时间");
                }

            }
        });
        /*laydate.render({
            elem: '#startTime',
            type: 'datetime'
        });
        laydate.render({
            elem: '#endTime',
            type: 'datetime'
        });*/

    }

    /************************************</抵用券营销结束>******************************************/



    /************************************<短信群发开始>******************************************/
    /**接口——新增短信群发*/
    function addmessage(startAge, endAge, id) {
        var param = {};
        var content;
        var sendTime = $("#send-time").val();
        if (id) {
            sendTime = $("#send-time").attr("edit-time");
        } else {
            sendTime = sendTime.replace(/-/g, ',').replace(/:/g, ',').replace(/\s/, ',').split(',');
            sendTime = new Date(sendTime[0], sendTime[1] - 1, sendTime[2], sendTime[3], sendTime[4]).getTime();
        }
        param.subid = subid;                                                               //门店id
        if (diaMsgJob) {
            param.job = diaMsgJob;                                                         //职业
        }
        param.startAge = startAge;                                                         //起始年龄
        param.endAge = endAge;                                                             //结束年龄
        param.sendTime = sendTime;                                                         //发送时间
        var html = $('#fill-div').html();
        var tags = [];
        for (var i = 0; i < barArr.length; i++) {
            if (barArr[i].text == "顾客姓名") {
                html = html.replace(barArr[i].html, "@var(user_name)");
                tags.push("@var(user_name)");                                              //顾客姓名
            } else if (barArr[i].text == "门店名称") {
                html = html.replace(barArr[i].html, "@var(sub_name)");
                tags.push("@var(sub_name)");                                               //门店名称
            }
        }
        html = html.replace(/<span>/g, '').replace(/<\/span>/g, '');
        content = html;
        param.content = content;                                                           //内容
        param.tagsJson = JSON.stringify(tags);                                             //标签
        param.range = $('#pro input:radio[name="property"]:checked').val();                       //全部0，会员1，非会员2
        param.sex = $('#sex input:radio[name="sex"]:checked').val();                            //全部0，男1，女2
        if (id) {//编辑
            param.id = id;
            url = config.getUrl_marketingtimingsms_update();
        } else {
            url = config.getUrl_marketingtimingsms_add()
        }
        quakooData.ajaxGetData(url, param, function (ret) {
            if (ret && ret.success) {
                if (id) {
                    layer.msg("成功编辑短信群发", {icon: 1});
                } else {
                    layer.msg("成功新增短信群发", {icon: 1});
                }
            } else {
                layer.msg(ret.data, {icon: 2});
            }
        })
    }

    /**获取门店下顾客的所有职业(职业下拉框)*/
    function getAllUserJob() {
        quakooData.ajaxGetData(config.getUrl_user_getAllUserJob(), {sid: subid, userType: 0}, function (ret) {
            if (ret && ret.success) {
                if (quakooUtils.isNotBlack(ret.data)) {
                    var data = {list: ret.data};
                    var html = template("jobList", data);
                    document.getElementById("jobUl").innerHTML = html;
                    selectTag($("#selectBox5"), function (ret) {                       //职业获取
                        diaMsgJob = ret.value;
                    });
                } else {
                    layer.msg("暂无职业分类", {icon: 1});
                }
            }
        });
    }

    /**接口——获取短信群发列表*/
    function getSendList() {
        $("#dxqf-table").bootstrapTable('destroy');
        $("#dxqf-table").bootstrapTable({
            url: config.getUrl_marketingtimingsms_getCheckPager(),
            method: 'get',
            classes: "table",
            pagination: true,                     //是否显示分页
            sidePagination: "server",             //分页方式：client客户端分页，server服务端分页（*）
            pageNumber: 1,                        //初始化加载第一页，默认第一页
            pageSize: 10,
            pageList: [5, 10, 15, 20],
            sortable: false,
            sortOrder: "asc",
            showColumns: true,
            strictSearch: true,
            locale: "zh-CN",
            paginationHAlign: "center",
            clickToSelect: true,
            columns: [
                {
                    field: "ctime",
                    title: "创建时间",
                    align: "left",
                    valign: "middle",
                    formatter: function (value, row, index) {
                        return quakooUtils.formatTimeToDateDianLY(value);
                    }
                },
                {
                    field: "sendTime",
                    title: "发送时间",
                    align: "left",
                    valign: "middle",
                    formatter: function (value, row, index) {
                        return quakooUtils.formatTimeToDateDianLY(value);
                    }
                },
                {
                    field: "", title: "面向顾客", align: "left", valign: "middle", formatter: function (value, row, index) {
                        var range, sex, age, job;
                        if (row.range == 0) {
                            range = "全部";
                        } else if (row.range == 1) {
                            range = "会员";
                        } else if (row.range == 2) {
                            range = "非会员";
                        }
                        if (row.sex == 1) {
                            sex = "男";
                        } else if (row.sex == 2) {
                            sex = "女";
                        }
                        if (row.startAge && row.endAge && row.startAge > 0) {
                            age = row.startAge + "-" + row.endAge + "岁";
                        }
                        if (quakooUtils.isNotBlack(row.job)) {
                            job = row.job;
                        }
                        var html = (range ? range : "") + (sex ? "," + sex : "") + (age ? "," + age : "") + (job ? "," + job : "");
                        return html;
                    }
                },
                {
                    field: "content",
                    title: "短信内容",
                    align: "left",
                    valign: "middle",
                    formatter: function (value, row, index) {
                        var html = "";
                        html += value.replace(/@var\(user_name\)/g, "<span class='show-tags'>顾客姓名</span>").replace(/@var\(sub_name\)/g, "<span class='show-tags'>门店名称</span>");
                        return html;
                    }
                },
                {
                    field: "", title: "送达条数", align: "left", valign: "middle", formatter: function (value, row, index) {
                        return "暂无字段";
                    }
                },
                {
                    field: "status",
                    title: "操作",
                    align: "center",
                    valign: "middle",
                    formatter: function (value, row, index) {
                        var editEvent = "newVouchers3(" + JSON.stringify(row).replace(/\"/g, '\'').replace(/\'\'/g, '\'') + ")";
                        var html;
                        if (value == 0) {
                            /**正常*/
                            html = '<button class="btn btn-primary" onclick="' + editEvent + '">编辑</button>';
                        } else if (value == 1) {
                            /**删除*/
                            html = '-';
                        }
                        return html;
                    }
                }
            ],
            queryParams: function (params) {
                params.subid = subid;
                params.page = this.pageNumber;
                params.size = this.pageSize;
                params.token = quakooUser.getUserInfo().token;
                return params;
            },
            success: function () {
            },
            onLoadSuccess: function (data) {
            }
        });
        quakooData.ajaxGetData(config.getUrl_marketingtimingsms_getCheckPager(), {subid: subid}, function (ret) {
            if (ret && ret.success) {
                console.log(ret);
            }
        })
    }

    /**
     * 弹窗新增（编辑）短信群发
     * */
    function newVouchers3(data) {
        var startAge, endAge, btns;
        var starAgeNum = 30;
        var endAgeNum = 70;
        if (quakooUtils.isNotBlack(data)) {
            starAgeNum = data.startAge;
            endAgeNum = data.endAge;
        }
        if (quakooUtils.isBlack(data)) {
            btns = ['取消', '新增']
        } else {
            btns = ['取消', '编辑']
        }
        var index = layer.open({
            type: 1,
            shade: 0.01,
            shadeClose: true,
            skin: 'layui-layer-demo', //样式类名
            area: ['360px', 'auto'],
            anim: 0,
            closeBtn: 0,
            resize: false,
            title: null,
            move: ".top-name",
            content: $('.content-view3'),
            btn: btns,
            yes: function (index) {
                layer.close(index);
            },
            btn2: function () {
                if (quakooUtils.isBlack(data)) { //新增
                    addmessage(startAge, endAge);
                } else { //编辑
                    addmessage(startAge, endAge, data.id);
                }
            },
            success: function (layero, index) {
                getAllUserJob(psid);
                //重置表单
                $("#sendMsgResetBtn")[0].click();
                $("#selectBox5 .text").html = '全部职业';
                diaMsgJob = "";
                $("#moveBar1").css('display', 'block');
                $("#moveBar2").css('display', 'block');
                $("#send-time").attr("placeholder", "发送时间");
                $("#send-time").val('');

                if (quakooUtils.isNotBlack(data)) {//编辑
                    $(".content-view3 .top-name").html("编辑短信群发");//标题
                    //属性
                    if (data.range === 1) {
                        $("#pro2")[0].click();
                    } else if (data.range === 2) {
                        $("#pro3")[0].click();
                    } else {
                        $("#pro1")[0].click();
                    }
                    //性别
                    if (data.sex === 1) {
                        $("#sex2")[0].click();
                    } else if (data.sex === 2) {
                        $("#sex3")[0].click();
                    } else if (data.sex === 0) {
                        $("#sex1")[0].click();
                    }
                    //职业
                    if (quakooUtils.isNotBlack(data.job)) {
                        $("#selectBox5 .text").html(data.job);
                        diaMsgJob = data.job;
                    }
                    //短信内容
                    /*if(quakooUtils.isNotBlack(data.tags)){
                        if(data.tags.indexOf("@var(sub_name)")>-1){
                            $("#moveBar2").css('display','none');
                        }
                        if(data.tags.indexOf("@var(user_name)")>-1){
                            $("#moveBar1").css('display','none');
                        }
                        var html = data.content.replace(/@var\(user_name\)/g,'<div class="movebar" id="moveBar2" draggable="true" ondragstart="drag(event)" style="display: block;">门店名称</div>').replace(/@var\(user_name\)/g,'<div class="movebar" id="moveBar1" draggable="true" ondragstart="drag(event)" style="display: block;">顾客名称</div>');
                        $("#fill-div").html(html);
                        content = data.content;
                    }*/
                    //时间
                    var timeText = quakooUtils.formatTimeToDateDianLY(data.sendTime);
                    $("#send-time").attr("placeholder", timeText);
                    $("#send-time").attr("edit-time", data.sendTime);
                }
                layui.use('slider', function () {   //年龄范围
                    startAge = starAgeNum;
                    endAge = endAgeNum;
                    var slider = layui.slider;
                    slider.render({
                        elem: '#slide1',
                        value: [starAgeNum, endAgeNum],   //滑块默认值
                        range: true,
                        theme: 'rgba(130,130,151,0.4)',   //主题色
                        change: function (value) {
                            startAge = value[0];
                            endAge = value[1];
                        }
                    });
                });
                // 时间插件JS开始
                var opt = {};
                opt.date = {preset: 'date'};
                opt.datetime = {preset: 'datetime'};
                opt.time = {preset: 'time'};

                opt.default = {
                    theme: 'mbsc-android-holo', //皮肤样式
                    display: 'bubble', //显示方式
                    mode: 'scroller', //日期选择模式
                    dateFormat: 'yyyy-mm-dd',
                    lang: 'zh',
                    showNow: true,
                    nowText: "今天",
                    typeNum: 'day',//day：获取到日，time：获取到时，branch：获取到分；默认是获取到分
                };
                $('.settings').bind('change', function () {
                    var demo = 'datetime';
                    if (!demo.match(/select/i)) {
                        $('.demo-test-' + demo).val('');
                    }
                    $('.demo-test-' + demo).scroller('destroy').scroller($.extend(opt['datetime'], opt['default']));
                    $('.demo').hide();
                    $('.demo-' + demo).show();
                });
                $('#demo').trigger('change');

                // 时间插件JS结束


            }
        });

    }

    /************************************</短信群发结束>******************************************/



    /************************************<短信营销开始>******************************************/
    /************************************</短信营销结束>******************************************/


    /************************************<任务奖励开始>******************************************/
    //销售额奖励销售量奖励单选
    $("input:radio[name='sales']").click(function () {
        var salesSelect = $('input:radio[name="sales"]:checked').attr('data-id');
        if (salesSelect == 1) {
            $("#saleroom-box")[0].style.display = "block";
            $("#saleVolume-box")[0].style.display = "none";
        } else if (salesSelect == 2) {
            $("#saleroom-box")[0].style.display = "none";
            $("#saleVolume-box")[0].style.display = "block";
        }
    })

    /**
     * 选择任务产品
     * */
    var $table = $('#jp-table');//商品列表表格
    var TableInit = function (columns) {
        var oTableInit = new Object();
        //初始化Table
        oTableInit.Init = function () {
            $table.bootstrapTable('destroy')
            $table.bootstrapTable({
                url: config.getUrl_product_getSPUPager(),
                classes: "table",
                pagination: true,        //是否显示分页
                sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                pageNumber: 1,                       //初始化加载第一页，默认第一页
                pageSize: 10,
                pageList: [5, 10, 15, 20],
                sortable: false,
                sortOrder: "asc",
                showColumns: true,
                strictSearch: true,
                locale: "zh-CN",
                paginationHAlign: "center",
                clickToSelect: true,
                paginationLoop: false,
                columns: columns,
                queryParams: function (param) {
                    if (cid) {
                        param.cid = cid;
                    }
                    param.subid = quakooUser.getUserInfo().psid;
                    param.token = quakooUser.getUserInfo().token;
                    return param
                }
            });
        };
        return oTableInit;
    };
    columns = [
        {checkbox: true, valign: "middle"},
        {field: "brandName", title: "品牌", valign: "middle"},
        {field: "seriesName", title: "系列", valign: "middle"},
        {field: "canUseNum", title: "可用数量", valign: "middle"},
        {
            field: "", title: "提成", valign: "middle", formatter: function (value, row, index) {
                return '<span class="goods-ticheng">团</span>';
            }
        },
        {
            field: "", title: "库存总值", valign: "middle", formatter: function (value, row, index) {
                return '￥10000';
            }
        },
        {
            field: "", title: "操作", valign: "middle", formatter: function (value, row, index) {
                return '<button class="btn btn-primary" style="margin-right: 8px;">选择</button>';
            }
        }
    ];

    //选择一级类目
    function chooseGoodsType(value) {
        if (value) {
            cid = value;
        }
        var Table = new TableInit(columns);
        Table.Init();
        $('#category' + cid).addClass('active').siblings().removeClass('active');
    }

    // 数据表单初始化函数
    function fromBox() {
        /**
         * 任务奖励
         * */
        var data4 = [{
            taskName: "月销售额任务",
            deadline: "2018.01.20 - 2018.05.20",
            award: "2000元",
            taskNum: "50000元",
            completed: "50000元",
            taskTracker: "团队",
            progress: "60"
        },
            {
                taskName: "月销售额任务",
                deadline: "2018.01.20 - 2018.05.20",
                award: "2000元",
                taskNum: "50000元",
                completed: "50000元",
                taskTracker: "团队",
                progress: "10"
            },
            {
                taskName: "月销售额任务",
                deadline: "2018.01.20 - 2018.05.20",
                award: "2000元",
                taskNum: "50000元",
                completed: "50000元",
                taskTracker: "团队",
                progress: "50"
            },
            {
                taskName: "月销售额任务",
                deadline: "2018.01.20 - 2018.05.20",
                award: "2000元",
                taskNum: "50000元",
                completed: "50000元",
                taskTracker: "团队",
                progress: "60"
            },
            {
                taskName: "月销售额任务",
                deadline: "2018.01.20 - 2018.05.20",
                award: "2000元",
                taskNum: "50000元",
                completed: "50000元",
                taskTracker: "团队",
                progress: "80"
            },
            {
                taskName: "月销售额任务",
                deadline: "2018.01.20 - 2018.05.20",
                award: "2000元",
                taskNum: "50000元",
                completed: "50000元",
                taskTracker: "团队",
                progress: "80"
            },
            {
                taskName: "月销售额任务",
                deadline: "2018.01.20 - 2018.05.20",
                award: "2000元",
                taskNum: "50000元",
                completed: "50000元",
                taskTracker: "团队",
                progress: "20"
            },
            {
                taskName: "月销售额任务",
                deadline: "2018.01.20 - 2018.05.20",
                award: "2000元",
                taskNum: "50000元",
                completed: "50000元",
                taskTracker: "团队",
                progress: "0"
            },
            {
                taskName: "月销售额任务",
                deadline: "2018.01.20 - 2018.05.20",
                award: "2000元",
                taskNum: "50000元",
                completed: "50000元",
                taskTracker: "团队",
                progress: "80"
            },
            {
                taskName: "月销售额任务",
                deadline: "2018.01.20 - 2018.05.20",
                award: "2000元",
                taskNum: "50000元",
                completed: "50000元",
                taskTracker: "团队",
                progress: "80"
            },
            {
                taskName: "月销售额任务",
                deadline: "2018.01.20 - 2018.05.20",
                award: "2000元",
                taskNum: "50000元",
                completed: "50000元",
                taskTracker: "团队",
                progress: "100"
            },
            {
                taskName: "月销售额任务",
                deadline: "2018.01.20 - 2018.05.20",
                award: "2000元",
                taskNum: "50000元",
                completed: "50000元",
                taskTracker: "团队",
                progress: "100"
            },
            {
                taskName: "月销售额任务",
                deadline: "2018.01.20 - 2018.05.20",
                award: "2000元",
                taskNum: "50000元",
                completed: "50000元",
                taskTracker: "团队",
                progress: "100"
            },
            {
                taskName: "月销售额任务",
                deadline: "2018.01.20 - 2018.05.20",
                award: "2000元",
                taskNum: "50000元",
                completed: "50000元",
                taskTracker: "团队",
                progress: "80"
            },
            {
                taskName: "月销售额任务",
                deadline: "2018.01.20 - 2018.05.20",
                award: "2000元",
                taskNum: "50000元",
                completed: "50000元",
                taskTracker: "团队",
                progress: "50"
            },
            {
                taskName: "月销售额任务",
                deadline: "2018.01.20 - 2018.05.20",
                award: "2000元",
                taskNum: "50000元",
                completed: "50000元",
                taskTracker: "团队",
                progress: "70"
            }];
        //任务奖励
        $("#rwjl-table").bootstrapTable('destroy');
        $("#rwjl-table").bootstrapTable({
            url: config.getUrl_mission_getAllList(),
            method: 'get',
            classes: "table",
            pagination: true,            //是否显示分页
            pageNumber: 1,               //初始化加载第一页，默认第一页
            sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
            pageSize: 5,
            pageList: [5, 10, 15, 20],
            sortable: false,
            sortOrder: "asc",
            showColumns: true,
            strictSearch: true,
            locale: "zh-CN",
            paginationHAlign: "center",
            clickToSelect: true,
            columns: [
                {
                    field: "name", title: "任务名称", align: "left", valign: "middle"
                },
                {
                    field: "startTime", title: "截止时间", align: "left", valign: "middle", formatter: function (val, obj) {
                        return quakooUtils.formatTimeToDateDianLY(val) + '-' + quakooUtils.formatTimeToDateDianLY(obj.endTime);
                    }
                },
                {field: "amount", title: "奖励", align: "left", valign: "middle"},
                {
                    field: "target", title: "任务量", align: "left", valign: "middle", formatter: function (item, obj) {
                        var val = item + '元';
                        if (obj.amountType == 1) {
                            val = item + '个'
                        }
                        return val;
                    }
                },
                {field: "allAmount", title: "已完成", align: "left", valign: "middle"}, {
                    field: "type", title: "任务执行", align: "center", valign: "middle", formatter: function (val, obj) {
                        var item;
                        if (val == 1) {
                            item = '团队';
                        }
                        if (val == 2) {
                            item = '个人';
                        }
                        return item;
                    }
                },
                {
                    field: "allProgress",
                    title: "进度",
                    align: "left",
                    valign: "middle",
                    formatter: function (value, obj) {
                        var html;
                        if (value >= 100) {
                            html = "<span class='end'><i class='iconfont icon-ico_check'></i></span>"
                        } else {
                            html = "<canvas class='canvas' width='24' data-value='" + value + "' height='24'></canvas>";
                        }
                        return html;
                    }
                }, {
                    field: "id",
                    title: "操作",
                    align: "center",
                    valign: "middle",
                    formatter: function (value, row, index) {
                        return '<button class="btn btn-primary" style="margin-right: 8px;" onclick="newVouchers2()">编辑</button><button class="btn btn-danger" style="margin-right: 8px;" data-id="' + value + '">删除</button>';
                    }
                }
            ],
            onPostBody: function () {
                canvasFn();
                //删除任务
                $('.btn-danger').on('click', function () {
                    var id = parseFloat($(this).attr('data-id'));
                    quakooData.ajaxGetData(config.getUrl_mission_del(), {id: id}, function (ret) {
                        if (ret && ret.success) {
                            layer.msg('删除成功', {icon: 1, shade: 0.01});
                        }
                    })
                })
            },
            queryParams: function (param) {
                param.sid = subid;
                param.page = param.offset / param.limit + 1;
                param.size = param.limit;
                param.token = quakooUser.getUserInfo().token;
                return param
            }
        });

        function canvasFn() {
            var element = document.getElementsByClassName('canvas');
            for (var i = 0; i < element.length; i++) {
                var item = element[i];
                canFor(item, item.getAttribute('data-value'));
            }

            function canFor(document, value) {
                var context = document.getContext('2d'), //获取画图环境，指明为2d
                    centerX = document.width / 2, //document中心点x轴坐标
                    centerY = document.height / 2, //Canvas中心点y轴坐标
                    rad = Math.PI * 2 / 100; //将360度分成100份，那么每一份就是rad度
                //speed = 10;加载的快慢就靠它了
                //绘制圆环背景
                function whiteCircle() {
                    context.save();
                    context.beginPath();
                    context.lineWidth = 2; //设置线宽
                    context.strokeStyle = "#FBEEED";
                    context.arc(centerX, centerY, 10, 0, Math.PI * 2, false);
                    context.stroke();
                    context.closePath();
                    context.restore();
                }

                //绘制进度
                function blueCircle(value) {
                    context.save();
                    context.strokeStyle = "#DD5B4B"; //设置描边样式
                    context.lineWidth = 2; //设置线宽
                    context.beginPath(); //路径开始
                    context.arc(centerX, centerY, 10, -Math.PI / 2, -Math.PI / 2 + rad * value, false); //用于绘制圆弧context.arc(x坐标，y坐标，半径，起始角度，终止角度，顺时针/逆时针)
                    context.stroke(); //绘制
                    context.closePath(); //路径结束
                    context.restore();
                }

                whiteCircle();
                blueCircle(value);
            }
        };
        /**
         * 选择任务门店
         * */
        var data5 = [{shopName: "杭州市西湖区湖滨银泰店"}, {shopName: "杭州市旗舰店"}, {shopName: "杭州市西湖区湖滨银泰店"}, {shopName: "杭州市旗舰店"}, {shopName: "杭州市西湖区湖滨银泰店"}, {shopName: "杭州市旗舰店"}, {shopName: "杭州市西湖区湖滨银泰店"}, {shopName: "杭州市旗舰店"}, {shopName: "杭州市西湖区湖滨银泰店"}, {shopName: "杭州市旗舰店"}, {shopName: "杭州市西湖区湖滨银泰店"}, {shopName: "杭州市旗舰店"}];
        $("#yj-table").bootstrapTable({
            data: data5,
            classes: "table",
            pagination: false,//是否显示分页
            sortable: false,
            sortOrder: "asc",
            showColumns: true,
            strictSearch: true,
            locale: "zh-CN",
            paginationHAlign: "center",
            clickToSelect: true,
            columns: [
                {checkbox: true, align: "center", valign: "middle"},
                {field: "shopName", title: "门店名称", align: "left", valign: "middle"},
                {
                    field: "", title: "操作", align: "center", valign: "middle", formatter: function (value, row, index) {
                        return '<button class="btn btn-primary" style="margin-right: 8px;">选择</button>';
                    }
                }
            ]

        });

        /**
         * 选择任务对象
         * */
        var data7 = [{}];
        $("#shop-table").bootstrapTable('destroy');
        $("#shop-table").bootstrapTable({
            data: data5,
            classes: "table",
            pagination: false,//是否显示分页
            sortable: false,
            sortOrder: "asc",
            showColumns: true,
            strictSearch: true,
            locale: "zh-CN",
            paginationHAlign: "center",
            clickToSelect: true,
            columns: [
                {checkbox: true, align: "center", valign: "middle"},
                {field: "shopName", title: "门店名称", align: "left", valign: "middle"},
                {
                    field: "", title: "操作", align: "center", valign: "middle", formatter: function (value, row, index) {
                        return '<button class="btn btn-primary" style="margin-right: 8px;">选择</button>';
                    }
                }
            ]

        });
    }

    /**
     * 弹窗创建任务
     * */
    function createTask() {
        var index = layer.open({
            type: 1,
            shade: 0.01,
            shadeClose: true,
            skin: 'layui-layer-demo', //样式类名
            area: ['360px', 'auto'],
            anim: 0,
            closeBtn: 0,
            resize: false,
            title: null,
            move: ".move",
            content: $('.create-task'),
            btn: ['取消', '确定']
        });
    }

    /**
     * 弹窗选择任务产品
     * */
    function selectProduct() {
        var index = layer.open({
            type: 1,
            shade: 0.01,
            shadeClose: true,
            skin: 'layui-layer-demo', //样式类名
            area: ['720px', '600px'],
            anim: 0,
            closeBtn: 0,
            resize: false,
            title: null,
            move: ".task-header",
            content: $('.task-product'),
            btn: ['关闭窗口'],
            yes: function (index) {
                layer.close(index);
            },
            btn2: function () {
            },
            success: function (layero, index) {
            }
        });

    }

    /**
     * 弹窗选择任务对象
     * */
    function selectObject() {
        var index = layer.open({
            type: 1,
            shade: 0.01,
            shadeClose: true,
            skin: 'layui-layer-demo', //样式类名
            area: ['360px', '448px'],
            anim: 0,
            closeBtn: 0,
            resize: false,
            title: "",
            content: $('.task-object'),
            btn: ['关闭窗口'],
            yes: function (index) {
                layer.close(index);
            },
            btn2: function () {
            },
            success: function (layero, index) {
            }
        });

    }

    /**
     * 弹窗选择任务门店
     * */
    function selectShop() {
        var index = layer.open({
            width: 360,
            height: 308,
            type: 1,
            shade: 0.01,
            shadeClose: true,
            skin: 'dialog-shop', //样式类名
            area: ['360px', '308px'],
            anim: 0,
            closeBtn: 0,
            resize: false,
            title: null,
            move: ".task-header",
            content: $('.task-shop'),
            btn: ["关闭窗口"],
            yes: function (index) {
                layer.close(index);
            },
            btn2: function () {
            },
            success: function (layero, index) {
            }
        });

    }

    /**
     * 弹窗删除任务
     *
     function deleteTask() {
        var index = layer.open({
            type: 1,
            shade: 0.01,
            shadeClose: true,
            skin: 'layui-layer-demo', //样式类名
            area: ['360px', '308px'],
            anim: 0,
            closeBtn: 0,
            resize: false,
            title: "",
            content: $('.delete-task'),
            btn: ['关闭窗口'],
            yes: function (index) {
                layer.close(index);
            },
            btn2: function () {
            },
            success: function (layero, index) {
            }
        });
    }
     */
    /**
     * 创建任务弹窗tab切换
     * */
    $(".create-task-header-tab li").click(function () {
        $(this).addClass('active').siblings().removeClass('active');
        $(".task-item").hide().eq($(this).index()).show();
    });
    /**
     * 选择任务产品tab切换
     * */
    // $(".product-tab .product-item").click(function () {
    //     $(this).addClass("active").siblings().removeClass("active");
    //     $(".product-list-item").removeClass("active").eq($(this).index()).addClass("active");
    // });


    /************************************</任务奖励结束>******************************************/

    /*卡片分页-短信营销*/
    /*
        var $tableNote = $("#yj-page-note-table");
        var data2 = [{id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}, {id: 1}];
        var TableInit = function (callback) {
            var oTableInit = new Object();
            //初始化Table
            oTableInit.Init = function () {
                $tableNote.bootstrapTable('destroy');
                $tableNote.bootstrapTable({
                    data: data2,
                    classes: "table",
                    pagination: true,        //是否显示分页
                    pageNumber: 1,                       //初始化加载第一页，默认第一页
                    pageSize: 6,
                    pageList: [6, 12, 18],
                    sortable: false,
                    sortOrder: "asc",
                    showColumns: true,
                    strictSearch: true,
                    locale: "zh-CN",
                    paginationHAlign: "center",
                    clickToSelect: true,
                    paginationLoop: false,
                    columns: [],
                    onPreBody: function (data) {
                        if (callback) {
                            callback(data, this)
                        }
                    }
                });
            };
            return oTableInit;
        };
        var Table = new TableInit(note);
        Table.Init();
        function note(data, _this) {
            var html = '';
            for (var i = (_this.pageNumber - 1) * _this.pageSize; i < _this.pageNumber * _this.pageSize; i++) {
                if (i % 2 == 0) {
                    html += '<li class="card-item">' +
                            '<div class="inner">' +
                            '<div class="top">' +
                            '<div class="text">' +
                            '<div class="main">消费信息提醒</div>' +
                            '<div class="vice">消费后发送信息至顾客的手机或微信中</div>' +
                            '</div>' +
                            '<div class="switch">' +
                            '<span class="off">未开启</span>' +
                            '<span class="on">已启用</span>' +
                            '<span class="switch-btn"><i></i></span>' +
                            '</div>' +
                            '</div>' +
                            '<div class="cont">' +
                            '<div class="off"  onclick="newVouchers2()">' +
                            '<i class="iconfont icon-ico_setting_filled"></i>' +
                            '<span>设置</span>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</li>';
                } else if (i % 2 == 1) {
                    html += '<li class="card-item">' +
                            '<div class="inner">' +
                            '<div class="top">' +
                            '<div class="text">' +
                            '<div class="main">消费信息提醒</div>' +
                            '<div class="vice">消费后发送信息至顾客的手机或微信中</div>' +
                            '</div>' +
                            '<div class="switch active">' +
                            '<span class="off">未开启</span>' +
                            '<span class="on">已启用</span>' +
                            '<span class="switch-btn"><i></i></span>' +
                            '</div>' +
                            '</div>' +
                            '<div class="cont">' +
                            '<div class="on">' +
                            '<div class="message-top">' +
                            '<span class="fl">短信内容</span>' +
                            '<input class="fr button-thin" type="button" onclick="newVouchers2()" value="编辑">' +
                            '</div>' +
                            '<div class="message-cont">' +
                            '尊敬的xxx你好，你在xxxx你好，你在xxxxx消费了xx尊敬的xxx你好，你在xxxxx消费了xxx元，欢迎你下次再来。' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</div>' +
                            '</li>';
                }
                html += '<li class="card-item">' +
                        '<div class="inner">' +
                        '<div class="top">' +
                        '<div class="text">' +
                        '<div class="main">消费信息提醒</div>' +
                        '<div class="vice">消费后发送信息至顾客的手机或微信中</div>' +
                        '</div>' +
                        '<div class="switch">' +
                        '<span class="off">未开启</span>' +
                        '<span class="on">已启用</span>' +
                        '<span class="switch-btn"><i></i></span>' +
                        '</div>' +
                        '</div>' +
                        '<div class="cont">' +
                        '<div class="off"  onclick="newVouchers2()">' +
                        '<i class="iconfont icon-ico_setting_filled"></i>' +
                        '<span>设置</span>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</li>';
            }
            $("#yj-page-note-table").html(html);
        }
    */


    /**
     * 弹窗编辑短信营销
     * */
    function newVouchers2() {
        var index = layer.open({
            type: 1,
            shade: 0.01,
            shadeClose: true,
            skin: 'layui-layer-demo layui-layer-dx', //样式类名
            area: ['360px', '290px'],
            anim: 0,
            closeBtn: 0,
            title: "",
            content: $('.content-view2'),
            resize: false,
            btn: ['取消', '保存修改'],
            yes: function (index, layero) {
                layer.close(index)
            },
            btn2: function () {

                return false;
            },
            success: function (layero, index) {
                $('.layui-layer-dx .layui-layer-content').css('height', 290 - 44 + 'px')
                $('.layui-layer-dx .layui-layer-btn').css({
                    'background-color': 'rgba(244, 244, 248, 1)',
                    'box-shadow': '0px -1px 0px 0px rgba(236, 236, 244, 1)'
                })
            }
        });

    }


    /**
     * tab切换
     * */
    $(".tab-ul li").click(function () {
        $(this).addClass('active').siblings().removeClass('active');
        $(".tab-item").hide().eq($(this).index()).show();
        $(".right-info").hide().eq($(this).index()).show();
        if ($(this).attr("data-id") == "send") {
            getSendList();
        }
    });
    /**
     * 开关切换
     * */
    $(".switch-btn").click(function () {
        $(this).parent(".switch").toggleClass('active');
    });
    /**
     * 下拉框
     * */


        //日期范围插件开始
    var date1 = new dateRange(".yj-demo-time", true);
    date1.init();
    //日期范围插件结束


</script>
</body>
</html>