<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <title>顾客管理</title>
    <!-- bootstrap样式开始 -->
    <link href="../resource/css/bootstrap.min.css" rel="stylesheet">
    <link href="../resource/js/plugins/bootstarp-table/css/bootstrap-table.min.css" rel="stylesheet">
    <link href="../resource/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
    <!-- bootstrap样式结束 -->
    <!--时间插件引用的css-->
    <link href="../resource/css/yanjing/mobiscroll.2.13.2.css" rel="stylesheet">
    <link href="../resource/css/yanjing/myDate.css" rel="stylesheet">
    <!--时间插件引用的css结束-->
    <!-- layui样式 -->
    <link rel="stylesheet" href="../resource/layui/css/layui.css">
    <!-- 字体图标 -->
    <link rel="stylesheet" href="../resource/fonts/iconfont.css">
    <!-- 清除默认样式 -->
    <link rel="stylesheet" href="../resource/css/reset.css">
    <!-- 公共样式 -->
    <link href="../resource/css/common.css" rel="stylesheet">
    <!-- 当前页面样式 -->
    <link rel="stylesheet" href="../resource/css/yanjing/custManagement.css">
</head>

<body>
    <!--头部 &#45;&#45; 开始-->
    <header>
        <ul>
            <li><i class="ruku"
                    style="background: url(../resource/img/ruku.jpg)no-repeat;background-size: 100% 100%;"></i>顾客管理</li>
        </ul>
        <div>
            <button class="btnLevelSetting">会员等级设置</button>
            <button>导出Excel</button>
            <button>导入顾客</button>
            <div class="selectBox" id="searchTypeBox">
                <div class="select-box-header">
                    <span class="text">手机号</span> <i class="iconfont icon-ico_arrow_down"></i>
                </div>
                <div class="optionBox">
                    <ul class="optionUL">
                        <li value="01">1</li>
                        <li value="02">2</li>
                        <li value="03">3</li>
                        <li value="04">4</li>
                        <li value="05">5</li>
                    </ul>
                </div>
            </div>
            <input type="text" placeholder="搜索手机号">
        </div>
    </header>
    <!-- 二级头部 -->
    <div class="headerTwo clearfix">
        <div class="selectBox hdTwo" id="grade">
            <div class="select-box-header">
                <span class="text">全部会员等级</span> <i class="iconfont icon-ico_arrow_down"></i>
            </div>
            <div class="optionBox">
                <ul class="optionUL">
                    <li value="01">1</li>
                    <li value="02">2</li>
                    <li value="03">3</li>
                    <li value="04">4</li>
                    <li value="05">5</li>
                </ul>
            </div>
        </div>
        <div class="selectBox hdTwo" id="gender">
            <div class="select-box-header">
                <span class="text">全部性别</span> <i class="iconfont icon-ico_arrow_down"></i>
            </div>
            <div class="optionBox">
                <ul class="optionUL" id="sexUl">
                    <li value="1">男</li>
                    <li value="2">女</li>
                </ul>
            </div>
        </div>
        <div class="selectBox hdTwo" id="occupation">
            <div class="select-box-header">
                <span class="text">全部职业</span> <i class="iconfont icon-ico_arrow_down"></i>
            </div>
            <div class="optionBox">
                <ul class="optionUL" id="jobUl">
                </ul>
            </div>
        </div>
    </div>

    <!-- 主体内容 -->
    <div class="main">
        <!-- 主体内容头部 -->
        <div class="mainHeader">
            <div class="titleBox clearfix">
                <ul class="tab-ul fl">
                    <li class="active">全部订单</li>
                    <li>未完成订单</li>
                    <li>作废订单</li>
                </ul>
                <div class="yj-demo-time fr">
                    <div class="yj-date">
                        <span>开始时间-结束时间</span><i class="iconfont icon-ico_calendar"></i>
                    </div>
                </div>
            </div>
            <div class="dataStatistics clearfix">
                <div class="menWomenProportion">
                    <div class="totalNum">
                        <h1>2192</h1>
                        <span class="fcHui">顾客数&nbsp;|&nbsp;人</span>
                    </div>
                    <div class="vertical"></div>
                    <div class="menWomenBox">
                        <div class="men mb16">
                            <i class="iconfont  ico_male icon-ico_male menC"></i>
                            <span class="menC">&nbsp;男</span>
                            <span class="ml8 fs14">48%</span>
                        </div>
                        <div class="women">
                            <i class="iconfont  ico_female icon-ico_female womenC"></i>
                            <span class="womenC">&nbsp;女</span>
                            <span class="ml8 fs14">58%</span>
                        </div>
                    </div>
                </div>
                <ul class="dataDetailed clearfix">
                    <li>
                        <h1>41%</h1>
                        <span class="fcHui">老客户占比</span>
                    </li>
                    <li>
                        <h1>572</h1>
                        <span class="fcHui">微信认证&nbsp;|&nbsp;人</span>
                    </li>
                    <li>
                        <h1>899</h1>
                        <span class="fcHui">手机号认证&nbsp;|&nbsp;人</span>
                    </li>
                    <li>
                        <h1>210</h1>
                        <span class="fcHui">储值顾客&nbsp;|&nbsp;人</span>
                    </li>
                </ul>
            </div>
        </div>

        <div class="formBox">
            <table id="yj-table" data-toggle="table" class="table table-border"></table>
        </div>
    </div>

    <!-- 全局弹窗盒子 -->
    <div class="popup">
        <!-- 会员等级 -->
        <div class="memberLevelPop">
            <table id="memberLevelPop" data-toggle="table" class="table table-border"></table>
        </div>
        <!-- 会员等级设置 -->
        <div class="addLevelPop">
            <ul class="settingBox">
                <li>
                    <div class="topic">等级称号</div>
                    <div class="inputContent">
                        <input type="text" placeholder="称号" style="width: 100%;">
                    </div>
                </li>
                <li>
                    <div class="topic">等级条件</div>
                    <div class="inputContent">
                        满&nbsp;<input type="number" placeholder="数值">&nbsp;积分获取此称号
                    </div>
                </li>
                <li>
                    <div class="topic">积分抵现</div>
                    <div class="inputContent">
                        <input type="number" placeholder="数值">&nbsp;积分=&nbsp;<input type="number"
                            placeholder="金额">&nbsp;元
                    </div>
                </li>
                <li>
                    <div class="topic">&nbsp;</div>
                    <div class="inputContent">
                        最高可抵现百分之&nbsp;<input type="number" placeholder="数值">
                    </div>
                </li>
                <li>
                    <div class="topic">积分获取</div>
                    <div class="inputContent">
                        <input type="number" placeholder="金额">&nbsp;元=&nbsp;<input type="number">&nbsp;积分
                    </div>
                </li>
                <li class="m0">
                    <div class="topic">会员默认折扣</div>
                    <div class="inputContent">
                        <input type="number" placeholder="数值" style="width: 100%;">
                    </div>
                </li>
            </ul>
            <div class="pd10 mb16">
                <input type="checkbox" id="jsrChecked">
                <label for="jsrChecked" id="jsrCheckedLab">介绍人<i class="iconfont"></i></label>
            </div>
            <form action="" class="jsrForm hide">
                <div class="jsrSet clearfix">
                    <input type="radio" name="condition" id="condition1" checked="checked">
                    <label for="condition1">
                        <div class="textInput fl">
                            被介绍人每次消费，介绍人可以获得百分之&nbsp;<input type="number" placeholder="数值">&nbsp;比例的积分
                        </div>
                    </label>
                </div>
                <div class="jsrSet clearfix">
                    <input type="radio" name="condition" id="condition2">
                    <label for="condition2">
                        <div class="textInput fl">
                            被介绍人每次消费，介绍人可以获得百分之&nbsp;<input type="number" placeholder="数值">&nbsp;比例的积分
                        </div>
                    </label>

                </div>
            </form>
        </div>
    </div>


    <!--全局js-->
    <!-- jq库 -->
    <script src="../resource/js/jquery.min.js"></script>
    <!-- bootstrap UI需要依赖的js -->
    <script src="../resource/js/bootstrap.js?v=3.3.6"></script>
    <script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table.js"></script>
    <script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table-zh-CN.min.js"></script>
    <!-- layui需要依赖的js -->
    <script src="../resource/js/plugins/layer/layer.js"></script>
    <script src="../resource/layui/layui.js"></script>
    <!-- 公司内部库 -->
    <script src="../resource/js/lib/quakooLib/QuakooBase-1.0.0.js"></script>
    <script src="../resource/js/lib/quakooLib/QuakooConfig-1.0.0.js"></script>
    <script src="../resource/js/lib/quakooLib/QuakooBasePc-1.0.0.js"></script>
    <script src="../resource/js/lib/quakoo/Config.js"></script>
    <script src="../resource/js/lib/quakoo/project.js"></script>
    <script src="../resource/js/template-native.js"></script>

    <!-- 全局公共js -->
    <script src="../resource/js/yanjing.js"></script>
    <!--//日期范围插件开始-->
    <script src="../resource/js/yanjing/daterange.js"></script>
    <!-- 当前页面逻辑 -->

    <!--职业下拉框-->
    <script type="text/html" id="jobList">
        <%for(var i =0;i< list.length;i++){%>
            <li value="'<%=list[i]%>'"><%=list[i]%></li>
        <%}%>


    </script>

    <script>
        var data = [];//用户数据
        /**初始化页面*/
        $(function () {
            initPage();
        });
        function initPage(){
            var subid;
            if(window.localStorage){
                subid = window.localStorage.sel_ShopId;
            }
            getAllUserJob(subid);  //获取职业
            getSubCustomerPager(subid);        //用户表单
        }


        /**获取门店下顾客的所有职业*/
        function getAllUserJob(subid){
            quakooData.ajaxGetData(config.getUrl_user_getAllUserJob(),{subid:subid},function (ret) {
                console.log(JSON.stringify(ret));
                if(ret&&ret.success){
                    if(quakooUtils.isNotBlack(ret.data)){
                        var data = {list:ret.data};
                        var html = template("jobList", data);
                        document.getElementById("jobUl").innerHTML = html;
                        // 全部职业
                        selectTag($("#occupation"),function (ret) {
                            alert(JSON.stringify(ret));
                        });
                    }
                }
            });
        }
        /**获取门店下所有顾客*/
        function getSubCustomerPager(subid){
            quakooData.ajaxGetData(config.getUrl_user_getSubCustomerPager(),{subid:subid,userType:0},function (ret) {
                    if(quakooUtils.isNotBlack(ret.rows)){
                        /*for(var i=0;i<ret.rows.length;i++){
                            data[i] = {};
                            data[i].name = ret.rows[i].userName;
                            data[i].number = ret.rows[i].phone;
                            if(ret.rows[i].sex==0){
                                data[i].gender = "-";
                            }else if(ret.rows[i].sex ==1){
                                data[i].gender = "男";
                            }else if(ret.rows[i].sex ==2){
                                data[i].gender = "女";
                            }
                            data[i].grade = "等待接口";
                            data[i].integral = "等待接口";
                            data[i].money = ret.rows[i].money;
                            if(ret.rows[i].weixinId){
                                data[i].wxrz = true;
                            }else{
                                data[i].wxrz = false;
                            }
                            data[i].freq= ret.rows[i].payCount;
                        }
                        console.log(JSON.stringify(data));*/
                        data = [{"name":"1788888888","number":"1788888888","gender":"-","grade":"等待接口","integral":"等待接口","money":0,"wxrz":false,"freq":0},{"name":"1799999999","number":"1799999999","gender":"-","grade":"等待接口","integral":"等待接口","money":0,"wxrz":false,"freq":0}]
                        $("#yj-table").bootstrapTable({
                            data: data,
                            classes: "table",
                            pagination: true,        //是否显示分页
                            pageNumber: 1,                       //初始化加载第一页，默认第一页
                            pageSize: 8,
                            pageList: [5, 10, 15, 20],
                            sortable: false,
                            sortOrder: "asc",
                            showColumns: true,
                            strictSearch: true,
                            locale: "zh-CN",
                            paginationHAlign: "center",
                            clickToSelect: true,
                            columns: [
                                { field: "name", title: "姓名", align: "left", valign: "middle" },
                                { field: "number", title: "手机号", align: "left", valign: "middle" },
                                { field: "gender", title: "性别", align: "left", valign: "middle" },
                                { field: "grade", title: "会员等级", align: "left", valign: "middle" },
                                { field: "integral", title: "积分", align: "left", valign: "middle" },
                                { field: "money", title: "储存金额", align: "left", valign: "middle" },
                                { field: "wxrz", title: "微信认证", align: "left", valign: "middle", formatter: function (value, row, index) { return value ? '<span class="certified">已认证</span>' : '<span class="uncertified">未认证</span>' } },
                                { field: "freq", title: "消费次数", align: "left", valign: "middle" },
                                {
                                    field: "btn", title: "操作", align: "left", valign: "middle", width: '180px', formatter: function () {
                                        return '<button class="btn btnEedit">编辑</button><button class="btn btnRecord ml8">历史订单</button>'
                                    }
                                }
                            ]

                        });
                    }

            });
        }
        /**from表单函数执行*/
        function formBox(subid) {
            getSubCustomerPager(subid);    //获取门店下所有顾客

            // 全部统计from
/*
            var data = [
                { name: '李默然', number: "18782918293", gender: '男', grade: '一级会员', integral: '2837', money: '￥1200', wxrz: false, freq: '2', btn: '' },
                { name: '李默然', number: "18782918293", gender: '男', grade: '一级会员', integral: '2837', money: '￥1200', wxrz: false, freq: '2', btn: '' }
            ];
*/


            // 会员等级from
            var memberLevelPop = [
                { name: '地主', condition: '满0积分', integral: '1积分=10000元', getinteg: '1元=10000积分', btn: '' }, { name: '地主', condition: '满0积分', integral: '1积分=10000元', getinteg: '1元=10000积分', btn: '' }, { name: '地主', condition: '满0积分', integral: '1积分=10000元', getinteg: '1元=10000积分', btn: '' }, { name: '地主', condition: '满0积分', integral: '1积分=10000元', getinteg: '1元=10000积分', btn: '' }, { name: '地主', condition: '满0积分', integral: '1积分=10000元', getinteg: '1元=10000积分', btn: '' }, { name: '地主', condition: '满0积分', integral: '1积分=10000元', getinteg: '1元=10000积分', btn: '' }, { name: '地主', condition: '满0积分', integral: '1积分=10000元', getinteg: '1元=10000积分', btn: '' }, { name: '地主', condition: '满0积分', integral: '1积分=10000元', getinteg: '1元=10000积分', btn: '' }, { name: '地主', condition: '满0积分', integral: '1积分=10000元', getinteg: '1元=10000积分', btn: '' }]
            $("#memberLevelPop").bootstrapTable({
                data: memberLevelPop,
                classes: "table",
                pagination: true,        //是否显示分页
                pageNumber: 1,                       //初始化加载第一页，默认第一页
                pageSize: 5,
                pageList: [5, 10, 15, 20],
                sortable: false,
                sortOrder: "asc",
                showColumns: true,
                strictSearch: true,
                locale: "zh-CN",
                paginationHAlign: "center",
                clickToSelect: true,
                columns: [
                    { field: "name", title: "等级称号", align: "left", valign: "middle" },
                    { field: "condition", title: "等级条件", align: "left", valign: "middle" },
                    { field: "integral", title: "积分抵现", align: "left", valign: "middle" },
                    { field: "getinteg", title: "积分获取", align: "left", valign: "middle" },
                    {
                        field: "btn", title: "操作", align: "left", valign: "middle", width: '180px',
                        formatter: function () {
                            return '<button class="btn btnEedit">编辑</button><button class="btn btnRemove ml8">删除</button>';
                        }
                    }
                ]
            });

        }

        var custManagement = (function () {

            //头部js
            var header = function header() {
                // 时间范围开始
                var date1 = new dateRange(".yj-demo-time");
                date1.init()
                // 时间范围结束
            }


            // 弹窗函数执行
            var popup = function popup() {
                // 会员等级设置
                function levelSetting(a) {
                    var layerIndex = layer.open({
                        type: 1,
                        skin: 'layui-layer-demo', //样式类名
                        area: a.data.area,
                        anim: 0,
                        closeBtn: 0,
                        title: a.data.title,
                        shade: 0.3,
                        shadeClose: true, //开启遮罩关闭
                        scrollbar: false,
                        content: a.data.popupBox,
                        btn: a.data.btn,
                        resize:false,
                        move: '.sMove',
                        yes: function () {
                            layer.close()
                        },
                        btn2: function () {
                        },
                        success: function (layero, index) {
                            a.data.fn();
                        },
                    });
                }
                $('.btnLevelSetting').bind('click', {
                    area: ['720px'],
                    title: '<div class="titleBox"><span class="sMove">会员等级设置</span><button class="addLevel fr">新增等级</button></div>',
                    popupBox: $('.memberLevelPop'),
                    btn: ['', '关闭窗口'],
                    fn: function () {
                        $('.layui-layer-btn0').hide();
                    }
                }, levelSetting);
                $(document).on('click', '.addLevel', {
                    area: ['360px'],
                    title: '<div class="titleBox"><span  class="sMove">会员等级设置</span></div>',
                    popupBox: $('.addLevelPop'),
                    btn: ['新增', '取消'],
                    fn: function () {
                        $('.layui-layer-btn0').css('float', 'right');
                    }
                }, levelSetting);

                $('#jsrChecked').change(function () {
                    $('.jsrForm')[0].className = ($(this).is(":checked")) ? 'jsrForm' : 'jsrForm hide';
                })


            }

            //下拉框执行函数区
            var selectImplementBox = function selectImplementBox() {
                // 头部手机号
                selectTag($("#searchTypeBox"));
                // 全部会员等级
                selectTag($("#grade"));
                // 全部性别
                selectTag($("#gender"));
                // 全部职业
                selectTag($("#occupation"));
            }

            return {
                init: function () {
                    header();
                    selectImplementBox();

                    popup();
                }
            }
        })();
        custManagement.init();
    </script>

</body>

</html>