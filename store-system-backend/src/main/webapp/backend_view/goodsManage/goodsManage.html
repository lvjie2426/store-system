<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <title>眼睛-商品管理-商品列表</title>
    <!--Bootstrap样式引入开始-->
    <link rel="stylesheet" href="../resource/css/bootstrap.min.css">
    <link href="../resource/js/plugins/bootstarp-table/css/bootstrap-table.min.css" rel="stylesheet">
    <link href="../resource/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
    <link href="../resource/layui/css/layui.css" rel="stylesheet">
    <!--字体样式文件引用开始-->
    <link rel="stylesheet" href="../resource/fonts/iconfont.css">
    <!--字体样式文件引用结束-->
    <!--标签样式重置开始-->
    <link rel="stylesheet" href="../resource/css/reset.css">
    <link rel="stylesheet" href="../resource/css/style.css">
    <link rel="stylesheet" href="../resource/css/common.css">
    <!--标签样式重置结束-->
    <!--本页面样式开始-->
    <link rel="stylesheet" href="../resource/css/yanjing/goodsManage.css">
    <!--本页面样式结束-->
    <style>
        body{
            background-color: #ECECF3;
        }
    </style>
</head>
<body>
    <div class="yj-header">
        <ul class="tab-ul" id="categoryDom">
            <!--<li onclick="chooseGoodsType(this,1)" class="active">镜片</li>
            <li onclick="chooseGoodsType(this,2)">镜架</li>
            <li onclick="chooseGoodsType(this,3)">隐形眼镜</li>
            <li onclick="chooseGoodsType(this,4)">太阳镜</li>
            <li onclick="chooseGoodsType(this,5)">护理产品</li>
            <li onclick="chooseGoodsType(this,6)">其它商品</li>
            <li onclick="chooseGoodsType(this,7)">特殊商品</li>-->
        </ul>
        <div class="yj-header-right">
            <button class="btn btn-info" onclick="suppliers()">设置供应商</button>
            <!--<div class="selectBox" id="selectBox">
                <div class="select-box-header">
                    <span class="text">系列</span> <i class="iconfont icon-ico_arrow_down" ></i>
                </div>

                <div class="optionBox">
                    <ul class="optionUL">
                        <li value="01">系列1</li>
                        <li value="02">系列2</li>
                        <li value="03">系列3</li>
                        <li value="04">系列4</li>
                        <li value="05">系列5</li>
                    </ul>
                </div>
            </div>-->
            <input type="text" placeholder="搜索商品" id="search" class="yj-input">
            <button class="btn btn-primary" onclick="addGoods(false)">新增商品</button>
        </div>
    </div>
    <div class="goods-header">
        <div class="selectBox" id="select-form">

        </div>
        <div class="selectBox" id="select-type">

        </div>
        <div class="selectBox" id="select-series">

        </div>
        <div class="selectBox" id="select-status">
            <div class="select-box-header">
                <span class="text">全部销售状态</span> <i class="iconfont icon-ico_arrow_down" ></i>
            </div>
            <div class="optionBox">
                <ul class="optionUL">
                    <li value="0">已销售</li>
                    <li value="1">未销售</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="goods-body">
        <table id="yj-table" data-toggle="table"  class="table table-border"></table>
    </div>
    <!--新增镜片-->
    <div class="content-view content-view-addgoods" id="addGoodsDom">

    </div>

    <!--设置会员折扣的弹出框-->
    <div class="content-view content-view-yj">
        <table class="table  table-self" id="vipDom">

        </table>
    </div>
    <!--设置提成的弹出框-->
    <div class="content-view content-view-ticheng">
        <div class="ticheng-checkbox">
            <form class="layui-form" action="">
                <div class="layui-input-block" style="float:left;">
                    <input type="checkbox" name="" lay-skin="primary"  title="团体统一提成" >
                </div>
                <div class="layui-input-block" style="float:left;">
                    <input type="checkbox" name="" lay-skin="primary" title="个人统一提成" >
                </div>
            </form>
        </div>
        <table class="table  table-self table-ticheng">
            <tr>
                <th>门店名称</th>
                <th>团体</th>
                <th>个人</th>
            </tr>
            <tr>
                <td>A门店</td>
                <td><input type="text" placeholder="0"></td>
                <td><input type="text" placeholder="0"></td>
            </tr>
            <tr>
                <td>A门店</td>
                <td><input type="text" placeholder="0"></td>
                <td><input type="text" placeholder="0"></td>
            </tr>
            <tr>
                <td>A门店</td>
                <td><input type="text" placeholder="0"></td>
                <td><input type="text" placeholder="0"></td>
            </tr>
            <tr>
                <td>A门店</td>
                <td><input type="text" placeholder="0"></td>
                <td><input type="text" placeholder="0"></td>
            </tr>
            <tr>
                <td>A门店</td>
                <td><input type="text" placeholder="0"></td>
                <td><input type="text" placeholder="0"></td>
            </tr>
        </table>
    </div>
    <!--设置现货范围-->
    <div class="content-view content-view-range">
        <div class="yj-content-body">
            <div class="range-header">
               <!-- <div class="now-goods-range">
                    <em></em>现货范围
                </div>-->
                <div class="dingzhi-range">
                    <em></em>定制范围
                </div>
            </div>
            <table class="layui-hide yj-layui-table" id="rangeEvent" lay-filter="rangeEvent"></table>
        </div>
    </div>
    <!--设定价格-->
    <div class="content-view content-view-price">

        <ul class="tab-ul" id="setPriceBtn">
            <li class="active" onclick="setPrice(1)">产品编码</li>
            <li onclick="setPrice(2)">零售价/元</li>
            <li onclick="setPrice(3)">批发价/元</li>
            <li onclick="setPrice(4)">备货量/片</li>
            <li onclick="setPrice(5)">积分价/分</li>
        </ul>
        <div class="price-table-box">
            <table class="layui-hide yj-layui-table" id="priceEvent" lay-filter="priceEvent"></table>
        </div>
    </div>
    <!--设置预警库存-->
    <div class="content-view content-view-yujing">
        <div class="goods-type">
            <form class="layui-form" action="">
                <div class="layui-form-item" pane="">
                    <div class="layui-input-block yj-check-input">
                        <input type="checkbox" name="" lay-filter="kucun" lay-skin="primary" title="当现货库存为0的产品达到<input readonly='' class='yj-input' placeholder='数量'>个提醒" >
                    </div>
                </div>
                <div class="layui-form-item" pane="">
                    <div class="layui-input-block yj-check-input">
                        <input type="checkbox" name="" lay-filter="kucun" lay-skin="primary" title="当总库存少于备货量百分之<input readonly='' class='yj-input' placeholder='数量'>提醒" >
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!--镜片库存详情-->
    <div class="content-view content-view-numInfo">
        <div class="layui-yj-header">
            <div class="layui-layer-title">
                <div>A品牌A系列<span>9217个</span></div>
            </div>
            <div class="title-right title-num-info-right" >
                <div class="iconfont icon-ico_table active" onclick="setNumInfo(1)"></div>
                <div class="iconfont icon-ico_list" onclick="setNumInfo(2)"></div>
            </div>
        </div>
        <div class="price-table-box">
            <div class="numInfoBox">
                <table class="yj-layui-table" id="numInfoEvent" lay-filter="numInfoEvent"></table>
            </div>
            <div class="numInfoBox">
                <table class="yj-layui-table" id="numInfoTable"></table>
            </div>
        </div>
    </div>

    <form style="opacity: 0" action="" id="uploadForm" autocomplete="off" enctype="multipart/form-data">
        <input style="height: 0;width: 0;" type="file" name="file" accept="image/jpeg，image/jpg，image/png,image/jp2，image/jpe"/>
    </form>

    <!--js依赖开始-->
    <!--bootstrap依赖于jQuery，jQuery.js必须放在BS.js之前-->
    <script src="../resource/js/jquery.min.js"></script>
    <script src="../resource/js/bootstrap.js"></script>
    <!--js依赖结束-->

    <!-- Bootstrap table -->
    <script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table.js"></script>
    <script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table-zh-CN.min.js"></script>

    <script src="../resource/js/plugins/layer/layer.js"></script>
    <script src="../resource/layui/layui.js"></script>

    <script src="../resource/js/lib/quakooLib/QuakooBase-1.0.0.js"></script>
    <script src="../resource/js/lib/quakooLib/QuakooConfig-1.0.0.js"></script>
    <script src="../resource/js/lib/quakooLib/QuakooBasePc-1.0.0.js"></script>
    <script src="../resource/js/lib/quakoo/Config.js"></script>
    <script src="../resource/js/lib/quakoo/project.js"></script>
    <script src="../resource/common/common.js?" +Math.random()></script>
    <script src="../resource/js/template-native.js"></script>
    <script src="../resource/js/yanjing.js"></script>
    <script src="../resource/js/yanjing/daterange.js"></script>
    <!--一级类别-->
    <script type="text/html" id="categoryTmp">
        <%for(var i=0;i< list.length;i++){%>
            <%if(list[i].pid==0){%>
                <li id="category<%=list[i].id%>" onclick="chooseGoodsType('<%=list[i].id%>')"><%=list[i].name%></li>
            <%}%>
        <%}%>
    </script>
    <!--下拉选择模板带全部-->
    <script type="text/html" id="selectTagTmpAll">
        <div class="select-box-header">
            <span class="text"><%=title%></span> <i class="iconfont icon-ico_arrow_down" ></i>
        </div>
        <div class="optionBox">
            <ul class="optionUL">
                <li value="-1">全部</li>
                <%for(var i=0;i< list.length;i++){%>
                <li value="<%=list[i].id%>" data-pnid="<%if(list[i].pnid){%><%=list[i].pnid%><%}%>"><%if(list[i].name){%><%=list[i].name%><%}else{%><%=list[i].content%><%}%></li>
                <%}%>
            </ul>
        </div>
    </script>
    <!--下拉选择模板-->
    <script type="text/html" id="selectTagTmp">
        <div class="select-box-header">
            <span class="text"><%=title%></span> <i class="iconfont icon-ico_arrow_down" ></i>
        </div>
        <div class="optionBox">
            <ul class="optionUL">
                <%for(var i=0;i< list.length;i++){%>
                <li value="<%=list[i].id%>" data-pnid="<%if(list[i].pnid){%><%=list[i].pnid%><%}%>"><%if(list[i].name){%><%=list[i].name%><%}else{%><%=list[i].content%><%}%></li>
                <%}%>
            </ul>
        </div>
    </script>
    <!--会员等级-->
    <script type="text/html" id="vipTmp">
        <tr>
            <th>会员等级</th>
            <th>折扣</th>
        </tr>
        <%for(var i=0;i< list.length;i++){%>
        <tr>
            <td><%=list[i].title%></td>
            <%if(list[i].value){%>
                <td><input type="text" value="<%=list[i].value%>" data-id="<%=list[i].id%>" class="vipInput" placeholder=""></td>
            <%}else{%>
                <td><input type="text" data-id="<%=list[i].id%>" class="vipInput" placeholder=""></td>
            <%}%>
        </tr>
        <%}%>
    </script>
    <!--增加商品弹出框-->
    <script type="text/html" id="addGoodsTmp">
        <div class="goods-select-box">
            <%if(list.categoryName=='特殊商品'){%>
            <div class="goods-select goods-select-img" style="width: 100%">
                <div class="goods-select-title">商品主图</div>
                <div class="selectBox"  onclick="uploadTsspIcon()">
                    <%if(list.icon){%>
                    <div style="display: block;">
                        <img src="<%=list.newIcon%>" id="cover" alt="" style="<%=list.style%>">
                    </div>
                    <%}%>
                    <i class="iconfont icon-ico_plus"></i>
                </div>
            </div>
            <%}%>

            <div class="goods-select">
                <div class="goods-select-title">品牌</div>
                <div class="selectBox" id="yj-add-brand">
                    <div class="select-box-header">
                        <span class="text"><%if(list.brandName){%><%=list.brandName%><%}else{%>品牌<%}%></span> <i class="iconfont icon-ico_arrow_down" ></i>
                    </div>
                    <div class="optionBox">
                        <ul class="optionUL">
                            <%for(var i=0;i< brandData.length;i++){%>
                            <li value="<%=brandData[i].id%>"><%=brandData[i].name%></li>
                            <%}%>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="goods-select">
                <div class="goods-select-title">系列</div>
                <div class="selectBox" id="yj-add-series">
                    <div class="select-box-header">
                        <span class="text"><%if(list.seriesName){%><%=list.seriesName%><%}else{%>系列<%}%></span> <i class="iconfont icon-ico_arrow_down" ></i>
                    </div>
                </div>
            </div>
            <div class="goods-select">
                <div class="goods-select-title">供应商</div>
                <div class="selectBox" id="yj-add-provider">
                    <div class="select-box-header">
                        <span class="text"><%if(list.providerName){%><%=list.providerName%><%}else{%>供应商<%}%></span> <i class="iconfont icon-ico_arrow_down" ></i>
                    </div>
                    <div class="optionBox">
                        <ul class="optionUL">
                            <%for(var i=0;i< providerData.length;i++){%>
                            <li value="<%=providerData[i].id%>"><%=providerData[i].name%></li>
                            <%}%>
                        </ul>
                    </div>
                </div>
            </div>
            <%if(list.categoryName=='镜片'){%>
            <div class="goods-select">
                <div class="goods-select-title">焦点</div>
                <div class="selectBox" id="yj-add-jiaodian">
                    <div class="select-box-header">
                        <span class="text">
                            <%if(list.properties && list.properties[1]){%>
                                <%for(var i=0;i< jiaodianData.length;i++){%>
                                    <%if(list.properties[1]==jiaodianData[i].id){%>
                                        <%=jiaodianData[i].content%>
                                    <%}%>
                                <%}%>
                            <%}else{%>
                                焦点
                            <%}%>
                        </span> <i class="iconfont icon-ico_arrow_down" ></i>
                    </div>
                    <div class="optionBox">
                        <ul class="optionUL">
                            <%for(var i=0;i< jiaodianData.length;i++){%>
                            <li value="<%=jiaodianData[i].id%>" data-pnid="<%=jiaodianData[i].pnid%>"><%=jiaodianData[i].content%></li>
                            <%}%>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="goods-select">
                <div class="goods-select-title">折射率</div>
                <div class="selectBox" id="yj-add-zheshelv">
                    <div class="select-box-header">
                        <span class="text">
                            <%if(list.properties && list.properties[2]){%>
                                <%for(var i=0;i< zheshelvData.length;i++){%>
                                    <%if(list.properties[2]==zheshelvData[i].id){%>
                                        <%=zheshelvData[i].content%>
                                    <%}%>
                                <%}%>
                            <%}else{%>
                                折射率
                            <%}%>
                        </span> <i class="iconfont icon-ico_arrow_down" ></i>
                    </div>
                    <div class="optionBox">
                        <ul class="optionUL">
                            <%for(var i=0;i< zheshelvData.length;i++){%>
                            <li value="<%=zheshelvData[i].id%>" data-pnid="<%=zheshelvData[i].pnid%>"><%=zheshelvData[i].content%></li>
                            <%}%>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="goods-select">
                <div class="goods-select-title">功能</div>
                <div class="selectBox" id="yj-add-gongneng">
                    <div class="select-box-header">
                        <span class="text">
                            <%if(list.properties && list.properties[3]){%>
                                <%for(var i=0;i< gongnengData.length;i++){%>
                                    <%if(list.properties[3]==gongnengData[i].id){%>
                                        <%=gongnengData[i].content%>
                                    <%}%>
                                <%}%>
                            <%}else{%>
                                功能
                            <%}%>
                        </span> <i class="iconfont icon-ico_arrow_down" ></i>
                    </div>
                    <div class="optionBox">
                        <ul class="optionUL">
                            <%for(var i=0;i< gongnengData.length;i++){%>
                            <li value="<%=gongnengData[i].id%>" data-pnid="<%=gongnengData[i].pnid%>"><%=gongnengData[i].content%></li>
                            <%}%>
                        </ul>
                    </div>
                </div>
            </div>
            <%}%>
            <%if(list.categoryName=='隐形眼镜'){%>
            <div class="goods-select">
                <div class="goods-select-title">类型</div>
                <div class="selectBox" id="yj-add-type">
                    <div class="select-box-header">
                        <span class="text">
                            <%if(list.properties && list.properties[5]){%>
                                <%for(var i=0;i< typeData.length;i++){%>
                                    <%if(list.properties[5]==typeData[i].id){%>
                                        <%=typeData[i].content%>
                                    <%}%>
                                <%}%>
                            <%}else{%>
                                类型
                            <%}%>
                        </span> <i class="iconfont icon-ico_arrow_down" ></i>
                    </div>
                    <div class="optionBox">
                        <ul class="optionUL">
                            <%for(var i=0;i< typeData.length;i++){%>
                            <li value="<%=typeData[i].id%>" data-pnid="<%=typeData[i].pnid%>"><%=typeData[i].content%></li>
                            <%}%>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="goods-select">
                <div class="goods-select-title">更换周期</div>
                <div class="selectBox" id="yj-add-zhouqi">
                    <div class="select-box-header">
                        <span class="text">
                            <%if(list.properties && list.properties[5]){%>
                                <%for(var i=0;i< zhouqiData.length;i++){%>
                                    <%if(list.properties[5]==zhouqiData[i].id){%>
                                        <%=zhouqiData[i].content%>
                                    <%}%>
                                <%}%>
                            <%}else{%>
                                更换周期
                            <%}%>
                        </span> <i class="iconfont icon-ico_arrow_down" ></i>
                    </div>
                    <div class="optionBox">
                        <ul class="optionUL">
                            <%for(var i=0;i< zhouqiData.length;i++){%>
                            <li value="<%=zhouqiData[i].id%>" data-pnid="<%=zhouqiData[i].pnid%>"><%=zhouqiData[i].content%></li>
                            <%}%>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="goods-select">
                <div class="goods-select-title">包装</div>
                <div class="selectBox" id="yj-add-baozhuang">
                    <div class="select-box-header">
                        <span class="text">
                            <%if(list.properties && list.properties[5]){%>
                                <%for(var i=0;i< baozhuangData.length;i++){%>
                                    <%if(list.properties[5]==baozhuangData[i].id){%>
                                        <%=baozhuangData[i].content%>
                                    <%}%>
                                <%}%>
                            <%}else{%>
                                包装
                            <%}%>
                        </span> <i class="iconfont icon-ico_arrow_down" ></i>
                    </div>
                    <div class="optionBox">
                        <ul class="optionUL">
                            <%for(var i=0;i< baozhuangData.length;i++){%>
                            <li value="<%=baozhuangData[i].id%>" data-pnid="<%=baozhuangData[i].pnid%>"><%=baozhuangData[i].content%></li>
                            <%}%>
                        </ul>
                    </div>
                </div>
            </div>
            <%}%>
            <%if(list.categoryName=='镜架' || list.categoryName=='隐形眼镜' || list.categoryName=='太阳镜'|| list.categoryName=='护理产品' || list.categoryName=='其它商品'){%>
            <div class="goods-select">
                <div class="goods-select-title">质保时长/天</div>
                <div class="selectBox" >
                    <%if(list.categoryName=='镜架'){%>
                        <%if(list.properties && list.properties[4]){%>
                            <input type="text" placeholder="天数" value="<%=list.properties[4]%>" class="yj-input" id="yj-add-day" data-pnid="4">
                        <%}else{%>
                            <input type="text" placeholder="天数"  class="yj-input" id="yj-add-day" data-pnid="4">
                        <%}%>
                    <%}else if(list.categoryName=='隐形眼镜'){%>
                        <%if(list.properties && list.properties[5]){%>
                        <input type="text" placeholder="天数" value="<%=list.properties[5]%>" class="yj-input" id="yj-add-day" data-pnid="5">
                        <%}else{%>
                        <input type="text" placeholder="天数"  class="yj-input" id="yj-add-day" data-pnid="5">
                        <%}%>
                    <%}else if(list.categoryName=='太阳镜'){%>
                        <%if(list.properties && list.properties[9]){%>
                        <input type="text" placeholder="天数" value="<%=list.properties[9]%>" class="yj-input" id="yj-add-day" data-pnid="9">
                        <%}else{%>
                        <input type="text" placeholder="天数"  class="yj-input" id="yj-add-day" data-pnid="9">
                        <%}%>
                    <%}else if(list.categoryName=='护理产品'){%>
                    <%if(list.properties && list.properties[13]){%>
                        <input type="text" placeholder="天数" value="<%=list.properties[13]%>" class="yj-input" id="yj-add-day" data-pnid="13">
                        <%}else{%>
                        <input type="text" placeholder="天数"  class="yj-input" id="yj-add-day" data-pnid="13">
                        <%}%>
                    <%}else{%>
                        <%if(list.properties && list.properties[14]){%>
                        <input type="text" placeholder="天数" value="<%=list.properties[14]%>" class="yj-input" id="yj-add-day" data-pnid="14">
                        <%}else{%>
                        <input type="text" placeholder="天数"  class="yj-input" id="yj-add-day" data-pnid="14">
                        <%}%>
                    <%}%>
                </div>
            </div>
            <%}%>

            <%if(list.categoryName=='护理产品'){%>
            <div style="clear: both"></div>
            <div class="goods-select">
                <div class="goods-select-title">类型</div>
                <div class="selectBox" id="yj-add-type-10">
                    <div class="select-box-header">
                        <span class="text">
                            <%if(list.properties && list.properties[10]){%>
                                <%for(var i=0;i< type10Data.length;i++){%>
                                    <%if(list.properties[10]==type10Data[i].id){%>
                                        <%=type10Data[i].content%>
                                    <%}%>
                                <%}%>
                            <%}else{%>
                                类型
                            <%}%>
                        </span> <i class="iconfont icon-ico_arrow_down" ></i>
                    </div>
                    <div class="optionBox">
                        <ul class="optionUL">
                            <%for(var i=0;i< type10Data.length;i++){%>
                            <li value="<%=type10Data[i].id%>" data-pnid="<%=type10Data[i].pnid%>"><%=type10Data[i].content%></li>
                            <%}%>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="goods-select">
                <div class="goods-select-title">包装</div>
                <div class="selectBox" id="yj-add-baozhuang-11">
                    <div class="select-box-header">
                        <span class="text">
                            <%if(list.properties && list.properties[11]){%>
                                <%for(var i=0;i< baozhuang11Data.length;i++){%>
                                    <%if(list.properties[11]==baozhuang11Data[i].id){%>
                                        <%=baozhuang11Data[i].content%>
                                    <%}%>
                                <%}%>
                            <%}else{%>
                                包装
                            <%}%>
                        </span> <i class="iconfont icon-ico_arrow_down" ></i>
                    </div>
                    <div class="optionBox">
                        <ul class="optionUL">
                            <%for(var i=0;i< baozhuang11Data.length;i++){%>
                            <li value="<%=baozhuang11Data[i].id%>" data-pnid="<%=baozhuang11Data[i].pnid%>"><%=baozhuang11Data[i].content%></li>
                            <%}%>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="goods-select">
                <div class="goods-select-title">开瓶寿命/天*</div>
                <div class="selectBox">
                    <%if(list.properties && list.properties[12]){%>
                    <input type="text" placeholder="天数" value="<%=list.properties[12]%>" class="yj-input" id="yj-add-shouming" data-pnid="12">
                    <%}else{%>
                    <input type="text" placeholder="天数"  class="yj-input" id="yj-add-shouming" data-pnid="12">
                    <%}%>
                </div>
                <span>*设定后会短信自动提醒顾客</span>
            </div>

            <%}%>

            <%if(list.categoryName=='特殊商品'){%>
            <div class="goods-select">
                <div class="goods-select-title">名称</div>
                <div class="selectBox" >
                    <%if(list.name){%>
                    <input type="text" value="<%=list.name%>" class="yj-input" placeholder="名称" id="yj-add-name">
                    <%}else{%>
                    <input type="text"  class="yj-input" placeholder="名称" id="yj-add-name">
                    <%}%>
                </div>
            </div>
            <div style="clear: both"></div>
            <div class="goods-select">
                <div class="goods-select-title">产品编码</div>
                <div class="selectBox" >
                    <%if(list.skuJson && list.skuJson.length>0 && list.skuJson[0].code){%>
                    <input type="text" placeholder="产品编码"  value="<%=list.skuJson[0].code%>" class="yj-input" id="yj-add-code">
                    <%}else{%>
                    <input type="text" placeholder="产品编码"  class="yj-input" id="yj-add-code">
                    <%}%>
                </div>
            </div>
            <div class="goods-select">
                <div class="goods-select-title">库存</div>
                <div class="selectBox" >
                    <%if(list.skuJson && list.skuJson.length>0 && list.skuJson[0].num){%>
                    <input type="text" placeholder="库存"  value="<%=list.skuJson[0].code%>" class="yj-input" id="yj-add-num">
                    <%}else{%>
                    <input type="text" placeholder="库存"  class="yj-input" id="yj-add-num">
                    <%}%>
                </div>
            </div>
            <div class="goods-select">
                <div class="goods-select-title">成本价</div>
                <div class="selectBox" >
                    <%if(list.skuJson && list.skuJson.length>0 && list.skuJson[0].costPrice){%>
                    <input type="text" placeholder="成本价"  value="<%=list.skuJson[0].code%>" class="yj-input" id="yj-add-costPrice">
                    <%}else{%>
                    <input type="text" placeholder="成本价"  class="yj-input" id="yj-add-costPrice">
                    <%}%>
                </div>
            </div>
            <%}%>




            <%if(list.categoryName=='镜片'){%>
            <!--<div class="goods-select goods-range">
                <div class="goods-select-title">现货范围</div>
                <div class="goods-range-body" onclick="openGoodsRange('现货')">设定现货范围</div>
            </div>-->
            <div class="goods-select goods-range">
                <div class="goods-select-title">定制范围</div>
                <div class="goods-range-body" onclick="openGoodsRange('定制',<%=isUpdate%>)">设定定制范围</div>
            </div>
            <%}%>
            <div style="clear: both"></div>
        </div>
        <form class="layui-form" action="">
            <div class="goods-type">
                <div class="layui-form-item" pane="">
                    <div class="layui-input-block">
                        <%if(list.type==0){%>
                        <input type="radio" lay-filter="defaultGoods"  name="type" value="0" lay-skin="primary" title="常规商品" checked >
                        <%}else{%>
                        <input type="radio" lay-filter="defaultGoods"  name="type" value="0" lay-skin="primary" title="常规商品" >
                        <%}%>
                    </div>
                </div>
            </div>
            <%if(list.type==0){%>
            <div class="yj-from" style="display: block;">
            <%}else{%>
            <div class="yj-from" style="display: none;">
            <%}%>
                <%if(list.categoryName!='特殊商品'){%>
                <div class="goods-vip-btn">
                    <div class="goods-vip-left">会员折扣</div>
                    <%if(list.ugDiscount && list.ugDiscount.length>0){%>
                    <div class="goods-vip-right active" onclick="changeVipStatus(this)">
                    <%}else{%>
                    <div class="goods-vip-right" onclick="changeVipStatus(this)">
                    <%}%>
                        <div class="yj-radio"></div>
                        <span>参与会员折扣</span>
                        <em onclick="openSettingVip(this)">设置</em>
                    </div>
                </div>

                <div class="goods-select-box">
                    <%if(list.categoryName=='镜片' || list.categoryName=='隐形眼镜'){%>
                    <div class="goods-select goods-range">
                        <div class="goods-select-title">零售价</div>
                        <div class="goods-range-body" onclick="openZeroPrice()">设定零售价</div>
                    </div>
                    <%}%>
                    <%if(list.categoryName=='镜架' || list.categoryName=='太阳镜' || list.categoryName=='其它商品'|| list.categoryName=='护理产品'){%>
                    <div class="goods-select">
                        <div class="goods-select-title">产品编码</div>
                        <div class="selectBox" >
                            <%if(list.skuJson && list.skuJson.length>0 && list.skuJson[0].code){%>
                            <input type="text" placeholder="产品编码" value="<%=list.skuJson[0].code%>" class="yj-input" id="yj-add-code">
                            <%}else{%>
                            <input type="text" placeholder="产品编码" class="yj-input" id="yj-add-code">
                            <%}%>
                        </div>
                    </div>
                    <div class="goods-select">
                        <div class="goods-select-title">零售价</div>
                        <div class="selectBox">
                            <%if(list.skuJson && list.skuJson.length>0 && list.skuJson[0].retailPrice){%>
                            <input type="text" placeholder="零售价" value="<%=list.skuJson[0].retailPrice%>" class="yj-input" id="yj-add-retailPrice">
                            <%}else{%>
                            <input type="text" placeholder="零售价" class="yj-input" id="yj-add-retailPrice">
                            <%}%>
                        </div>
                    </div>
                    <div class="goods-select">
                        <div class="goods-select-title">成本价</div>
                        <div class="selectBox">
                            <%if(list.skuJson && list.skuJson.length>0 && list.skuJson[0].costPrice){%>
                            <input type="text" placeholder="成本价" value="<%=list.skuJson[0].retailPrice%>" class="yj-input" id="yj-add-costPrice">
                            <%}else{%>
                            <input type="text" placeholder="成本价" class="yj-input" id="yj-add-costPrice">
                            <%}%>
                        </div>
                    </div>
                    <%}%>

                    <div class="goods-select goods-range">
                        <div class="goods-select-title">提成</div>
                        <div class="goods-range-body" onclick="openSettingTicheng()">设定提成</div>
                    </div>
                    <div style="clear: both"></div>
                </div>
                <%}%>

            </div>
            <div class="goods-type">
                <div class="layui-form-item" pane="">
                    <div class="layui-input-block">
                        <%if(list.type==0){%>
                        <input type="radio" name="type" value="1" lay-filter="scoreGoods" lay-skin="primary" title="积分商品" >
                        <%}else{%>
                        <input type="radio" name="type" value="1" lay-filter="scoreGoods" lay-skin="primary" title="积分商品" checked >
                        <%}%>
                    </div>
                </div>
            </div>
            <%if(list.type==0){%>
            <div class="yj-from goods-select-box" style="display: none">
            <%}else{%>
            <div class="yj-from goods-select-box" style="display: block">
            <%}%>
                <%if(list.categoryName=='镜片' || list.categoryName=='隐形眼镜'){%>
                <div class="goods-select goods-range">
                    <div class="goods-select-title">积分价</div>
                    <div class="goods-range-body" onclick="openZeroPrice(1)">设定积分价</div>
                </div>
                <%}else {%>
                    <%if(list.categoryName!='特殊商品'){%>
                    <div class="goods-select">
                        <div class="goods-select-title">产品编码</div>
                        <div class="selectBox" >
                            <%if(list.skuJson && list.skuJson.length>0 && list.skuJson[0].code){%>
                            <input type="text" placeholder="产品编码" value="<%=list.skuJson[0].code%>" class="yj-input" id="yj-add-code-1">
                            <%}else{%>
                            <input type="text" placeholder="产品编码" class="yj-input" id="yj-add-code-1">
                            <%}%>
                        </div>
                    </div>
                    <%}%>
                    <div class="goods-select">
                        <div class="goods-select-title">积分价</div>
                        <div class="">
                            <%if(list.skuJson && list.skuJson.length>0 && list.skuJson[0].integralPrice){%>
                            <input type="text" placeholder="积分价" value="<%=list.skuJson[0].integralPrice%>" class="yj-input" id="yj-add-integralPrice">
                            <%}else{%>
                            <input type="text" placeholder="积分价" class="yj-input" id="yj-add-integralPrice">
                            <%}%>
                        </div>
                    </div>
                <%}%>
                <div class="goods-select">
                    <div class="goods-select-title">兑换数量上限</div>
                    <div class="">
                        <%if(list.integralNum){%>
                        <input type="text" placeholder="数量" value="<%=list.integralNum%>" id="yj-add-integralNum" class="yj-input">
                        <%}else{%>
                        <input type="text" placeholder="数量"  id="yj-add-integralNum" class="yj-input">
                        <%}%>
                    </div>
                </div>
                <div class="goods-select " style="width: 100%;height: auto;">
                    <div class="goods-select-title">有效期</div>
                    <div class="yj-demo-time" id="yj-add-time">
                        <div class="yj-date">
                            <%if(list.integralStartTimeNew){%>
                            <span><%=list.integralStartTimeNew%>-<%=list.integralEndTimeNew%></span><i class="iconfont icon-ico_calendar"></i>
                            <%}else{%>
                            <span>开始时间-结束时间</span><i class="iconfont icon-ico_calendar"></i>
                            <%}%>
                        </div>
                    </div>
                </div>
                <div class="goods-select goods-youxiaoqi" style="width: 100%;height: auto;">
                    <form class="layui-form" action="">
                        <div class="layui-form-item" pane="">
                            <div class="layui-input-block yj-check-input">
                                <input type="checkbox" name=""  lay-filter="kucun-jp" lay-skin="primary" title="当库存低于<input readonly='' class='yj-input' placeholder='数量'>触发警报" >
                            </div>
                        </div>
                    </form>
                </div>
                <div style="clear: both"></div>
            </div>
        </form>
    </script>

    <script>
        var subid = quakooUser.getUserInfo().psid;//企业id
        var cid = '';//类目id
        var pid = '';//供应商ID
        var bid = '';//品牌ID
        var sid = '';//系列ID
        var name = '';//搜索关键字
        var saleStatus = '';//筛选条件的销售状态0开启1关闭


        var ballData = '';//球数据
        var columnData = '';//柱数据
        var brandData = '';//品牌数据
        var providerData = '';//供应商数据
        var jiaodianData;//焦点数据1
        var zheshelvData;//折射率数据2
        var gongnengData;//功能数据3
        var typeData;//隐形眼镜类型数据5
        var zhouqiData;//更换周期6数据
        var baozhuangData;//更换周期包装7数据
        var type10Data;//护理产品类型数据10
        var baozhuang11Data;//护理产品包装11数据

        var yjDate;//时间范围
        var params = {};//添加商品所需要的参数  key  类目id；value：所需参数
        var updateParams;//当前被编辑的数据

        var columns;        //其它商品的表格
        var columnsTeshu;   //特殊商品的表格
        var $table =  $('#yj-table');//商品列表表格
        var TableInit = function (columns) {
            var oTableInit = new Object();
            //初始化Table
            oTableInit.Init = function () {
                $table.bootstrapTable('destroy')
                $table.bootstrapTable({
                    url:config.getUrl_product_getSPUPager(),
                    classes:"table",
                    pagination:true,        //是否显示分页
                    sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                    pageNumber:1,                       //初始化加载第一页，默认第一页
                    pageSize: 10,
                    pageList: [5, 10, 15, 20],
                    sortable: false,
                    sortOrder: "asc",
                    showColumns: true,
                    strictSearch: true,
                    locale: "zh-CN",
                    paginationHAlign:"center",
                    clickToSelect:true,
                    paginationLoop:false,
                    columns:columns,
                    queryParams:function (param) {
                        if(cid){param.cid = cid;}
                        if(bid){param.bid = bid;}
                        if(pid){param.pid = pid;}
                        if(sid){param.sid = sid;}
                        if(name){param.name = name;}
                        if(saleStatus){param.saleStatus = saleStatus;}
                        param.subid = quakooUser.getUserInfo().psid;
                        param.token = quakooUser.getUserInfo().token;
                        return param
                    }
                });
            };
            return oTableInit;
        };
        columns = [
            {checkbox: true, valign:"middle"},
            {field: "brandName", title: "品牌", valign:"middle"},
            {field: "seriesName", title: "系列", valign:"middle"},
            /*{field: "", title: "实际·挂起", valign:"middle",formatter: function (value, row, index) {
                    return '100·2';
                }
            },*/
            {field: "canUseNum", title: "可用数量", valign:"middle"},
            /*{field: "", title: "零售价", valign:"middle",formatter: function (value, row, index) {
                    return '￥10';
                }
            },
            {field: "", title: "成本价", valign:"middle",formatter: function (value, row, index) {
                    return '￥10';
                }
            },*/
            {field: "", title: "提成", valign:"middle",formatter: function (value, row, index) {
                    return '<span class="goods-ticheng">团</span>';
                }
            },
            {field: "", title: "库存总值", valign:"middle",formatter: function (value, row, index) {
                    return '￥10000';
                }
            },
            {field: "saleStatus", title: "销售状态", valign:"middle",formatter: function (value, row, index) {
                    if(value==0){
                        return '<div class="yj-search active" onclick="updateSaleStatus(this,'+row.id+')"><i></i></div>';
                    }else{
                        return '<div class="yj-search" onclick="updateSaleStatus(this,'+row.id+')"><i></i></div>';
                    }
                }
            },
            {field: "", title: "操作", valign:"middle",formatter: function (value, row, index) {
                    return '<button class="btn btn-primary" type="button" onclick="openNumInfo()" style="margin-right: 8px;">库存详情</button>' +
                        '<button class="btn btn-info" type="button" onclick="updateGoods('+row.id+')">编辑</button>';
                }
            }
        ];

        columnsTeshu = [
            {checkbox: true,valign:"middle"},
            {field: "icon", title: "主图", valign:"middle",formatter: function (value, row, index) {
                    return '<img class="yj-table-img" src="'+value+'">';
                }
            },
            {field: "name", title: "名称", valign:"middle"},
            /*{field: "", title: "实际·挂起", valign:"middle",formatter: function (value, row, index) {
                    return '100·2';
                }
            },*/
            {field: "canUseNum", title: "可用数量", valign:"middle"},
            /*{field: "", title: "积分价", valign:"middle",formatter: function (value, row, index) {
                    return '￥10';
                }
            },
            {field: "", title: "成本价", valign:"middle",formatter: function (value, row, index) {
                    return '￥10';
                }
            },*/

            {field: "", title: "库存总值", valign:"middle",formatter: function (value, row, index) {
                    return '￥10000';
                }
            },
            {field: "saleStatus", title: "销售状态", valign:"middle",formatter: function (value, row, index) {
                    if(value==0){
                        return '<div class="yj-search active" onclick="updateSaleStatus(this,'+row.id+')"><i></i></div>';
                    }else{
                        return '<div class="yj-search" onclick="updateSaleStatus(this,'+row.id+')"><i></i></div>';
                    }
                }
            },
            {field: "", title: "操作", valign:"middle",formatter: function (value, row, index) {
                    return '<button class="btn btn-primary" style="margin-right: 8px;" onclick="updateGoods('+row.id+')">编辑</button>' +
                        '<button class="btn btn-danger" type="button" onclick="delGoods('+row.id+')">删除</button>';
                }
            }
        ];

        //搜索
        document.getElementById('search').onkeypress = function(e){
            var keycode = e.keyCode;
            if(keycode=='13') {
                document.getElementById('search').blur();
                e.preventDefault();
                name =  document.getElementById('search').value;
                chooseGoodsType()
            }
        }

        //获取一级类目
        quakooData.ajaxGetData(config.getUrl_productCategory_getSubAllList(),{subid:subid},function (ret) {
            if(ret && ret.success){
                if(ret.data.length>0){
                    var html = template('categoryTmp',{list:ret.data});
                    $('#categoryDom').html(html);
                    chooseGoodsType(ret.data[0].id)
                }
            }
        })
        //获取供应商
        quakooData.ajaxGetData(config.getUrl_productProvider_getSubAllList(),{subid:subid},function (ret) {
            if(ret && ret.success){
                providerData = ret.data;
                //商品列表的筛选
                var html = template('selectTagTmpAll',{title:'供应商',list:ret.data});
                $('#select-form').html(html);
                selectTag($("#select-form"),function (ret) {
                    pid = ret.value;
                    chooseGoodsType()
                })
            }
        })
        //获取品牌
        quakooData.ajaxGetData(config.getUrl_productBrand_getSubAllList(),{subid:subid},function (ret) {
            if(ret && ret.success){
                brandData = ret.data;
                var html = template('selectTagTmpAll',{title:'全部商品类型',list:ret.data});
                //商品列表的筛选
                $('#select-type').html(html);
                selectTag($("#select-type"),function (data) {
                    if(data.value){
                        bid = data.value;
                        chooseGoodsType()
                        //获取品牌下的系列列表
                        quakooData.ajaxGetData(config.getUrl_productSeries_getSubAllList(),{subid:quakooUser.getUserInfo().psid,bid:data.value},function (ret1) {
                            if(ret1 && ret1.success){
                                if(ret1.data.length>0){
                                    var html2 = template('selectTagTmpAll',{title:'系列',list:ret1.data});
                                    $('#select-series').html(html2).show();
                                    selectTag($("#select-series"),function (series) {
                                        sid = series.value;
                                        chooseGoodsType()
                                    })
                                }else{
                                    $('#select-series').hide();
                                }
                            }
                        })
                    }else{
                        $('#select-series').hide();
                    }
                })
            }
        })

        //获取属性-球
        quakooData.ajaxGetData(config.getUrl_productPropertyvalue_getAllList(),{pnid:15},function (ret) {
            if(ret && ret.success){
                ballData = ret.data.sort(function (a,b) {
                    return b.content-a.content;
                });
            }
        })
        //获取属性-柱
        quakooData.ajaxGetData(config.getUrl_productPropertyvalue_getAllList(),{pnid:16},function (ret) {
            if(ret && ret.success){
                columnData = ret.data.sort(function (a,b) {
                    return b.content-a.content;
                });
            }
        })
        //获取属性-焦点
        quakooData.ajaxGetData(config.getUrl_productPropertyvalue_getAllList(),{pnid:1},function (ret) {
            jiaodianData = ret.data;
        })
        //获取属性-折射率
        quakooData.ajaxGetData(config.getUrl_productPropertyvalue_getAllList(),{pnid:2},function (ret) {
            zheshelvData = ret.data;
        })
        //获取属性-功能
        quakooData.ajaxGetData(config.getUrl_productPropertyvalue_getAllList(),{pnid:3},function (ret) {
            gongnengData = ret.data;
        })

        //获取属性-隐形眼镜类型/5
        quakooData.ajaxGetData(config.getUrl_productPropertyvalue_getAllList(),{pnid:5},function (ret) {
            typeData = ret.data
        })
        //获取属性-隐形眼镜更换周期/6
        quakooData.ajaxGetData(config.getUrl_productPropertyvalue_getAllList(),{pnid:6},function (ret) {
            zhouqiData = ret.data;
        })
        //获取属性-隐形眼镜包装/7
        quakooData.ajaxGetData(config.getUrl_productPropertyvalue_getAllList(),{pnid:7},function (ret) {
            baozhuangData = ret.data
        })
        //获取属性-护理产品:类型/10
        quakooData.ajaxGetData(config.getUrl_productPropertyvalue_getAllList(),{pnid:10},function (ret) {
            type10Data = ret.data;
        })
        //获取属性-护理产品:包装11
        quakooData.ajaxGetData(config.getUrl_productPropertyvalue_getAllList(),{pnid:11},function (ret) {
            baozhuang11Data = ret.data;
        })

        //选择销售状态
        selectTag($("#select-status"),function (ret) {
            saleStatus = ret.value;
            chooseGoodsType()
        })

        layui.use('form', function(){
            var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
            form.render();
        });

        //选择一级类目
        function chooseGoodsType(value){
            if(value){
                cid = value;
            }
            if($('#category'+cid).text()=='特殊商品'){
                var Table = new TableInit(columnsTeshu);
                Table.Init();
            }else{
                var Table = new TableInit(columns);
                Table.Init();
            }
            $('#category'+cid).addClass('active').siblings().removeClass('active');
        }

        //设置供应商
        function suppliers(){

        }
        //添加商品
        function addGoods(isUpdate) {
            var btn = ['取消','新增'];
            var title = '新增'
            if(isUpdate){
                btn = ['取消','编辑'];
                title = '编辑';
            }
            params[cid] = {};
            if(isUpdate){
                params[cid] = updateParams;
                params[cid].skuJson = [];
                if(params[cid].skuList && params[cid].skuList.length>0){
                    for(var i=0;i<params[cid].skuList.length;i++){
                        var obj = {};
                        obj.properties = params[cid].skuList[i].properties;
                        obj.code = params[cid].skuList[i].code;
                        obj.integralPrice = params[cid].skuList[i].integralPrice;
                        obj.retailPrice = params[cid].skuList[i].retailPrice;
                        obj.costPrice = params[cid].skuList[i].costPrice;
                        obj.num = params[cid].skuList[i].num;
                        obj.id = params[cid].skuList[i].id;
                        params[cid].skuJson.push(obj)
                    }
                }
                params[cid].ugDiscount = updateParams.userGradeCategoryDiscountList;
                if( params[cid].integralEndTime ){
                    params[cid].integralEndTimeNew = quakooUtils.formatTimeToDateDianLY(params[cid].integralEndTime)
                }
                if(params[cid].integralStartTime){
                    params[cid].integralStartTimeNew = quakooUtils.formatTimeToDateDianLY(params[cid].integralStartTime)
                }
                if(params[cid].icon){
                    var obj = quakooImg.processImg(params[cid].icon,60,60);
                    params[cid].newIcon = obj.url;
                    params[cid].style = obj.style;
                }
            }else{
                params[cid].subid = subid;
                params[cid].cid = cid;
                params[cid].properties = {};
                params[cid].skuJson = [];
                params[cid].productCustomRangeList = [];
                params[cid].ugDiscount = [];
                params[cid].type = params[cid].type? params[cid].type:0;
            }
            params[cid].categoryName = $('#category'+cid).text();
            momentPriceData = {}
            momentRangeData = {}
            var html = [];
            html.push('<div class="layui-yj-header"><div class="layui-layer-title mine-title"><div>');
            html.push(title+params[cid].categoryName)
            html.push('</div> </div><div class="title-right" >销售状态');
            html.push('<div class="yj-search ');
            if(params[cid].saleStatus==0){
                html.push('active')
            }
            html.push('" id="yj-add-status" onclick="changeYjStatus(this)"><i></i></div></div></div>')

            console.log(params[cid])
            layer.open({
                type: 1,shade: 0.01,title:html.join(''),
                skin: 'layui-layer-add-goods  layui-layer-addtsgoods', //样式类名
                area: ['360px', '550px'],
                move:'.mine-title',
                anim: 0,
                maxWidth:'360',
                closeBtn: 0, //不显示关闭按钮
                resize:false,
                shadeClose: true, //开启遮罩关闭
                content: $('.content-view-addgoods'),
                btn: btn,
                yes: function(index, layero){
                    layer.close(index)
                },
                btn2: function(index){
                    addYjGoods(isUpdate,index)
                    return false;
                },
                success: function(layero, index){
                    openYjGoods(isUpdate);
                }
            });
        }
        //编辑商品
        function updateGoods(id) {
            quakooUtils.stopEventBubble()
            quakooData.ajaxGetData(config.getUrl_product_loadSPU(),{id:id},function (ret) {
                console.log(ret)
                if(ret.success){
                    updateParams = ret.data;
                    addGoods(true)
                }
            })
        }

        //更新销售状态
        function updateSaleStatus(self,id) {
            quakooUtils.stopEventBubble()
            var status;
            if($(self).hasClass('active')){
                status = 1;
            }else{
                status = 0;
            }
            quakooData.ajaxGetData(config.getUrl_product_updateSaleStatus(),{id:id,open:status},function (data) {
                if(data.success){
                    if($(self).hasClass('active')){
                        layer.msg('销售状态已关闭',{icon:1})
                    }else{
                        layer.msg('销售状态已开启',{icon:1})
                    }
                    $(self).toggleClass('active')
                }
            })
        }
        //改变会员折扣
        function changeVipStatus(self) {
            quakooUtils.stopEventBubble()
            $(self).toggleClass('active')
        }
        //打开会员折扣
        function openSettingVip(self) {
            if($(self).parent().hasClass('active')){
                layer.open({
                    type: 1,shade: 0.01,title:'设置会员折扣',
                    skin: 'layui-layer-yj layui-layer-vip', //样式类名
                    anim: 0,
                    area:['360px','336px'],
                    closeBtn: 0, //不显示关闭按钮
                    resize:false,
                    shadeClose: true, //开启遮罩关闭
                    content: $('.content-view-yj'),
                    btn: ['取消','确定'],
                    yes: function(index, layero){
                        layer.close(index)
                    },
                    btn2: function(){
                        var arr = [];
                        $('.vipInput').each(function (index,item) {
                            if(quakooUtils.isNotBlack(item.value)){
                                var obj = {};
                                obj.ugid = item.getAttribute('data-id');
                                obj.discount = item.value;
                                arr.push(obj)
                            }
                        })
                        params[cid].ugDiscount = arr;
                    },
                    success: function(layero, index){
                        quakooData.ajaxGetData(config.getUrl_usergrade_getAllList(),{subid:subid},function (ret) {
                            if(params[cid].ugDiscount && params[cid].ugDiscount.length>0){
                                for(var i=0;i<ret.rows.length;i++){
                                    for(var j=0;j<params[cid].ugDiscount.length;j++){
                                        if(ret.rows[i].id == params[cid].ugDiscount[j].ugid){
                                            ret.rows[i].value = params[cid].ugDiscount[j].discount;
                                        }
                                    }
                                }
                            }
                            console.log(ret.rows)

                            var html = template('vipTmp',{list:ret.rows});
                            $('#vipDom').html(html);
                            $('.vipInput').each(function (index,item) {
                                item.oninput = function(){
                                    if(!quakooUtils.isNum(this.value)){
                                        layer.msg('折扣必须是数字');
                                        this.value = ''
                                    }
                                }
                            })
                        })
                    }
                });
            }
            quakooUtils.stopEventBubble()
        }
        //设定现货范围
        var momentRangeData = {};//暂时存储定位范围信息
        function openGoodsRange(title,isUpdate) {
            layer.open({
                type: 1,shade: 0.01,title:'设定'+title+'范围<span>点击或框选单元格来设定</span>',
                skin: 'layui-layer-yj', //样式类名
                anim: 0,
                area:['720px','560px'],
                closeBtn: 0, //不显示关闭按钮
                resize:false,
                shadeClose: true, //开启遮罩关闭
                content: $('.content-view-range'),
                btn: ['取消','保存'],
                yes: function(index, layero){
                    layer.close(index)
                },
                btn2: function(index, layero){
                    params[cid].productCustomRangeList = [];
                    for(var i in momentRangeData){
                        if(momentRangeData[i]){
                            params[cid].productCustomRangeList.push(momentRangeData[i])
                        }
                    }
                    momentRangeData = {};
                },
                success: function(layero, index){
                    setRange(title,isUpdate)
                }
            });
        }

        //设定零售价/积分价
        var momentPriceData = {};//暂时存储价格信息
        function openZeroPrice(type) {
            var html = [];
            html.push('<div class="layui-yj-header"> <div class="layui-layer-title mine-title"> <div>设定价格<span>规格: 片</span></div> </div>');
            html.push('<div class="title-right" onclick="openRedTip()" > 设置预警库存 </div> </div>');
            type = type?type:1;
            layer.open({
                type: 1,shade: 0.01,title:html.join(''),
                skin: 'layui-layer-yj layui-layer-add-goods layui-layer-view-price', //样式类名
                anim: 0,
                move:'.mine-title',
                area:['720px','560px'],
                closeBtn: 0, //不显示关闭按钮
                resize:false,
                shadeClose: true, //开启遮罩关闭
                content: $('.content-view-price'),
                btn: ['取消','保存'],
                yes: function(index, layero){
                    layer.close(index)
                },
                btn2: function(){
                    params[cid].skuJson = [];
                    for(var i in momentPriceData){
                        if(momentPriceData[i]){
                            params[cid].skuJson.push(momentPriceData[i])
                        }
                    }
                    momentPriceData = {};
                },
                success: function(layero, index){
                    $('.layui-layer-view-price .layui-layer-btn').append('<div class="view-price-add"><input class="yj-input" placeholder="输入数量" type="number"><button class="btn btn-primary">键入</button></div>')
                    setPrice(type)
                }
            });
        }
        //设置预警库存
        function openRedTip() {
            layer.open({
                type: 1,shade: 0.01,title:"设置预警库存",
                skin: 'layui-layer-yj layui-layer-yujing', //样式类名
                anim: 0,
                area:['360px','188px'],
                closeBtn: 0, //不显示关闭按钮
                resize:false,
                shadeClose: true, //开启遮罩关闭
                content: $('.content-view-yujing'),
                btn: ['取消','确定'],
                yes: function(index, layero){
                    layer.close(index)
                },
                btn2: function(){
                    return false;
                },
                success: function(layero, index){

                }
            });
        }
        //设定提成
        function openSettingTicheng() {
            layer.open({
                type: 1,shade: 0.01,title:'设定提成',
                skin: 'layui-layer-yj layui-layer-ticheng', //样式类名
                anim: 0,
                area:['360px','auto'],
                closeBtn: 0, //不显示关闭按钮
                resize:false,
                shadeClose: true, //开启遮罩关闭
                content: $('.content-view-ticheng'),
                btn: ['取消','确定'],
                yes: function(index, layero){
                    layer.close(index)
                },
                btn2: function(){
                    return false;
                },
                success: function(layero, index){

                }
            });
        }
        //初始化范围表格
        function setRange(title,isUpdate) {
            if(params[cid] && params[cid].productCustomRangeList){
                for(var i=0;i<params[cid].productCustomRangeList.length;i++){
                    momentRangeData[params[cid].productCustomRangeList[i].ballId+''+params[cid].productCustomRangeList[i].columnId] = params[cid].productCustomRangeList[i];
                }
            }
            var cols = [];//球
            var rangeData = [];//柱
            cols.push({field:'num', minWidth:60,align:'center', title: '<div class="yj-layui-table-header"><span>球</span><span>柱</span></div>', fixed: 'left'})
            for(var i=0;i<ballData.length;i++){
                (function (i) {
                    cols.push({field:'', minWidth:60,align:'center', title: ballData[i].content, id:ballData[i].id, event: 'setSign',unresize:true,templet:function (d) {
                            if(momentRangeData[ballData[i].id+''+d.id]){
                                return '<div class="active"></div>'
                            }else{
                                return '<div></div>'
                            }
                        }})
                })(i)
            }
            for(var i=0;i<columnData.length;i++){
                rangeData.push({num:columnData[i].content,id:columnData[i].id})
            }
            layui.use('table', function(){
                var table = layui.table;
                table.render({
                    elem: '#rangeEvent'
                    ,data:rangeData
                    ,width: 688
                    ,height: 416
                    ,unresize:true
                    ,cols: [cols]
                });
                //监听单元格事件
                table.on('tool(rangeEvent)', function(obj){
                    if(title=='现货'){
                        $(this).find('div').toggleClass('active')
                    }else if(title=='定制'){
                        if(obj.event === 'setSign'){
                            if($(this).find('div').hasClass('active')){
                                momentRangeData[ballData[$(this).index()-1].id+''+obj.data.id] = '';
                            }else{
                                momentRangeData[ballData[$(this).index()-1].id+''+obj.data.id] = {ballId:ballData[$(this).index()-1].id,columnId:obj.data.id}
                            }
                            $(this).find('div').toggleClass('active')
                        }
                    }
                });
            });
        }
        //初始化价格表格 type  1产品编码   2零售价  3批发价  4备货量   5积分价
        function setPrice(type) {
            if(params[cid].type==0){
                $('#setPriceBtn li').eq(4).hide().siblings().show();
            }else{
                $('#setPriceBtn li').hide()
                $('#setPriceBtn li').eq(0).show();
                $('#setPriceBtn li').eq(4).show();
            }
            var cols = [];//球
            var rangeData = [];//柱
            var codeArr = [];//所有的产品编码
            cols.push({field:'num', minWidth:60, title: '<div class="yj-layui-table-header"><span>球</span><span>柱</span></div>', fixed: 'left'})
            if(type==1){
                if(quakooUtils.isNullJson(momentPriceData)){
                    if(params[cid] && params[cid].skuJson.length){
                        for(var i=0;i<params[cid].skuJson.length;i++){
                            momentPriceData[params[cid].skuJson[i].properties[15]+''+params[cid].skuJson[i].properties[16]] = params[cid].skuJson[i];
                            codeArr.push(params[cid].skuJson[i].code)
                        }
                    }
                }
                for(var i=0;i<ballData.length;i++){
                    (function (i) {
                        cols.push({field:'', minWidth:60, title: ballData[i].content, edit:'text',unresize:true,templet:function (d) {
                            if(momentPriceData[ballData[i].content+''+d.num] && momentPriceData[ballData[i].content+''+d.num].code){
                                    return momentPriceData[ballData[i].content+''+d.num].code
                                }else{
                                    return ''
                                }
                            }})
                    })(i)
                }
                $('#setPriceBtn li').eq(type-1).addClass('active').siblings().removeClass('active');
            }else{
                if(quakooUtils.isNotBlack(momentPriceData)){
                    $('#setPriceBtn li').eq(type-1).addClass('active').siblings().removeClass('active');
                    for(var i=0;i<ballData.length;i++){
                        (function (i) {
                            cols.push({field: '', minWidth: 60, title: ballData[i].content, edit: 'text', unresize: true,
                                templet: function (d) {
                                    if(type==2) {
                                        if (momentPriceData[ballData[i].content + '' + d.num] && momentPriceData[ballData[i].content + '' + d.num].retailPrice!=undefined) {
                                            return momentPriceData[ballData[i].content + '' + d.num].retailPrice
                                        } else {
                                            return ''
                                        }
                                    }else if(type==3){
                                        if (momentPriceData[ballData[i].content + '' + d.num] && momentPriceData[ballData[i].content + '' + d.num].costPrice!=undefined) {
                                            return momentPriceData[ballData[i].content + '' + d.num].costPrice
                                        } else {
                                            return ''
                                        }
                                    }else if(type==4){
                                        if (momentPriceData[ballData[i].content + '' + d.num] && momentPriceData[ballData[i].content + '' + d.num].num) {
                                            return momentPriceData[ballData[i].content + '' + d.num].num
                                        } else {
                                            return ''
                                        }
                                    }else if(type==5){
                                        if (momentPriceData[ballData[i].content + '' + d.num] && momentPriceData[ballData[i].content + '' + d.num].integralPrice) {
                                            return momentPriceData[ballData[i].content + '' + d.num].integralPrice
                                        } else {
                                            return ''
                                        }
                                    }
                                }
                            })
                        })(i)
                    }
                }else{
                    layer.msg('请先设置产品编码');
                    setPrice(1)
                    return
                }
            }
            for(var i=0;i<columnData.length;i++){
                rangeData.push({num:columnData[i].content,id:columnData[i].id})
            }
            layui.use('table', function(){
                var table = layui.table;
                table.render({
                    elem: '#priceEvent'
                    ,data:rangeData
                    ,width: 688
                    ,height: 416
                    ,limit:40
                    ,unresize:true
                    ,cols: [cols]
                });
                //监听单元格事件
                table.on('edit(priceEvent)', function (obj) { //注：edit是固定事件名，test是table原始容器的属性 lay-filter="对应的值"
                    console.log(obj)
                    console.log(this)
                    if(type==1){
                        if(!quakooUtils.isNum(obj.value)){
                            layer.msg('产品编码必须为数字');
                            this.value = '';
                            return
                        }
                        if(momentPriceData[ballData[obj.field-1].content+''+obj.data.num]){
                            codeArr.remove(momentPriceData[ballData[obj.field-1].content+''+obj.data.num].code);
                            if(obj.value==''){
                                var param = {};
                                param.properties = {};
                                param.properties[ballData[0].pnid] = ballData[obj.field-1].content;
                                param.properties[columnData[0].pnid] = obj.data.num;
                                param.id = momentPriceData[ballData[obj.field-1].content+''+obj.data.num].id;
                                param.del = true;
                                momentPriceData[ballData[obj.field-1].content+''+obj.data.num] = param;
                            }else{
                                if(codeArr.indexOf(obj.value)>=0){
                                    layer.msg('产品编码重复');
                                    this.value = momentPriceData[ballData[obj.field-1].content+''+obj.data.num].code;
                                    codeArr.push(momentPriceData[ballData[obj.field-1].content+''+obj.data.num].code);
                                    return
                                }
                                momentPriceData[ballData[obj.field-1].content+''+obj.data.num].code = obj.value;
                                codeArr.push(obj.value)
                            }
                        }else{
                            if(codeArr.indexOf(obj.value)>=0){
                                layer.msg('产品编码重复');
                                if(momentPriceData[ballData[obj.field-1].content+''+obj.data.num]){
                                    this.value = momentPriceData[ballData[obj.field-1].content+''+obj.data.num].code;
                                }else{
                                    this.value = '';
                                }
                                return
                            }
                            var param = {};
                            param.properties = {};
                            param.properties[ballData[0].pnid] = ballData[obj.field-1].content;
                            param.properties[columnData[0].pnid] = obj.data.num;
                            param.code = obj.value;
                            momentPriceData[ballData[obj.field-1].content+''+obj.data.num] = param;
                            codeArr.push(obj.value)
                        }

                    }else if(type==2){
                        if(momentPriceData[ballData[obj.field-1].content+''+obj.data.num] && momentPriceData[ballData[obj.field-1].content+''+obj.data.num].code){
                            if(!quakooUtils.isNum(obj.value)){
                                layer.msg('零售价必须为数字');
                                this.value = '';
                                return
                            }
                            momentPriceData[ballData[obj.field-1].content+''+obj.data.num].retailPrice = obj.value
                        }else{
                            layer.msg('请先设置该球柱的产品编码')
                            this.value = ''
                            return
                        }
                    }else if(type==3){
                        if(momentPriceData[ballData[obj.field-1].content+''+obj.data.num] && momentPriceData[ballData[obj.field-1].content+''+obj.data.num].code){
                            if(!quakooUtils.isNum(obj.value)){
                                layer.msg('批发价必须为数字');
                                this.value = '';
                                return
                            }
                            momentPriceData[ballData[obj.field-1].content+''+obj.data.num].costPrice = obj.value
                        }else{
                            layer.msg('请先设置该球柱的产品编码')
                            this.value = ''
                            return
                        }
                    }else if(type==4){
                        if(momentPriceData[ballData[obj.field-1].content+''+obj.data.num] && momentPriceData[ballData[obj.field-1].content+''+obj.data.num].code){
                            if(!quakooUtils.isNum(obj.value)){
                                layer.msg('备货量必须为数字');
                                this.value = '';
                                return
                            }
                            momentPriceData[ballData[obj.field-1].content+''+obj.data.num].num = obj.value
                        }else{
                            layer.msg('请先设置该球柱的产品编码')
                            this.value = ''
                            return
                        }
                    }else if(type==5){
                        if(momentPriceData[ballData[obj.field-1].content+''+obj.data.num] && momentPriceData[ballData[obj.field-1].content+''+obj.data.num].code){
                            if(!quakooUtils.isNum(obj.value)){
                                layer.msg('积分价必须为数字');
                                this.value = '';
                                return
                            }
                            momentPriceData[ballData[obj.field-1].content+''+obj.data.num].integralPrice = obj.value
                        }else{
                            layer.msg('请先设置该球柱的产品编码')
                            this.value = ''
                            return
                        }
                    }

                    // console.log(obj.value); //得到修改后的值
                    // console.log(obj.field); //当前编辑的字段名
                    // console.log(obj.data); //所在行的所有相关数据
                });
            });

        }
        //打开库存详情弹窗
        function openNumInfo() {
            layer.open({
                type: 1,shade: 0.01,
                skin: 'layui-layer-yj layui-layer-add-goods layui-layer-view-price', //样式类名
                anim: 0,
                area:['720px','560px'],
                closeBtn: 0, //不显示关闭按钮
                resize:false,
                shadeClose: true, //开启遮罩关闭
                content: $('.content-view-numInfo'),
                btn: ['关闭窗口','打印条码'],
                yes: function(index, layero){
                    layer.close(index)
                },
                btn2:function(){

                },
                success: function(layero, index){
                    setNumInfo(1)
                }
            });
        }
        var numInfoColumn = [
            {checkbox: true, valign:"middle"},
            {field: "id", title: "商品编码", valign:"middle",formatter: function (value, row, index) {
                    return '298183848318';
                }},
            {field: "", title: "球镜度数", valign:"middle",formatter: function (value, row, index) {
                    return '+0.00';
                }
            },
            {field: "", title: "柱镜度数", valign:"middle",formatter: function (value, row, index) {
                    return '-0.50';
                }
            },
            {field: "", title: "数量", valign:"middle",formatter: function (value, row, index) {
                    return '100';
                }
            },
            {field: "", title: "打印条码数量", valign:"middle",formatter: function (value, row, index) {
                    return '<input type="text" placeholder="数量"/>';
                }
            }
        ];
        //打开库存详情表格
        function setNumInfo(type) {
            if(type==1){
                var cols = [];//球
                var rangeData = [];//柱
                cols.push({field:'num', minWidth:60, title: '<div class="yj-layui-table-header"><span>球</span><span>柱</span></div>', fixed: 'left'})
                for(var i=0;i<ballData.length;i++){
                    (function (i) {
                        cols.push({field:'', minWidth:60, title: ballData[i].content,unresize:true,templet:function (d) {
                                return ''
                            }})
                    })(i)
                }
                for(var i=0;i<columnData.length;i++){
                    rangeData.push({num:columnData[i].content,id:columnData[i].id})
                }
                layui.use('table', function(){
                    var table = layui.table;
                    table.render({
                        elem: '#numInfoEvent'
                        ,data:rangeData
                        ,width: 688
                        ,height: 416
                        ,limit:40
                        ,unresize:true
                        ,cols: [cols]
                    });
                });
            }else if(type==2){
                var table = $('#numInfoTable');
                table.bootstrapTable('destroy')
                table.bootstrapTable({
                    url:config.getUrl_product_getSPUPager(),
                    classes:"table",
                    pagination:true,        //是否显示分页
                    sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                    pageNumber:1,                       //初始化加载第一页，默认第一页
                    pageSize: 10,
                    pageList: [5, 10, 15, 20],
                    sortable: false,
                    sortOrder: "asc",
                    showColumns: true,
                    strictSearch: true,
                    locale: "zh-CN",
                    paginationHAlign:"center",
                    clickToSelect:true,
                    paginationLoop:false,
                    columns:numInfoColumn,
                    queryParams:function (param) {
                        if(cid){param.cid = cid;}
                        if(bid){param.bid = bid;}
                        if(pid){param.pid = pid;}
                        if(sid){param.sid = sid;}
                        if(name){param.name = name;}
                        if(saleStatus){param.saleStatus = saleStatus;}
                        param.subid = quakooUser.getUserInfo().psid;
                        param.token = quakooUser.getUserInfo().token;
                        return param
                    }
                });
            }
            $('.title-num-info-right div').eq(type-1).addClass('active').siblings().removeClass('active');
            $('.numInfoBox').eq(type-1).show().siblings().hide();
        }
        //新增眼睛弹出框弹出后执行的操作
        function openYjGoods(isUpdate) {
            $('.yj-check-input input').click(function (e) {
                quakooUtils.stopEventBubble(e)
            })
            var data = {
                list:params[cid],isUpdate:isUpdate,
                brandData:brandData,providerData:providerData,jiaodianData:jiaodianData,
                gongnengData:gongnengData,zheshelvData:zheshelvData,
                typeData:typeData,zhouqiData:zhouqiData,baozhuangData:baozhuangData,
                type10Data:type10Data,baozhuang11Data:baozhuang11Data
            }
            console.log(data)
            var html = template('addGoodsTmp',data);
            document.getElementById('addGoodsDom').innerHTML = html;
            layui.use('form', function(){
                var form = layui.form;
                form.render();
                //选择积分还是常规
                form.on('radio()', function(data){
                    if(params[cid].type == data.value){
                        return
                    }
                    $('.yj-from').slideUp();
                    $('.yj-from').eq(data.value).slideDown();
                    params[cid].type = data.value;
                });
                //库存
                form.on('checkbox(kucun-jj)', function(data){
                    if(data.elem.checked){
                        //是否被选中，true或者false
                        $(data.othis).find('input').attr('readonly',false)
                    }else{
                        $(data.othis).find('input').attr('readonly','readonly').val('')
                    }
                });
            });
            //品牌/系列
            selectTag($("#yj-add-brand"),function (ret) {
                params[cid].bid = ret.value;
                $('#select-jj-series').html('');
                params[cid].sid = -1;
                //获取品牌下的系列列表
                quakooData.ajaxGetData(config.getUrl_productSeries_getSubAllList(),{subid:quakooUser.getUserInfo().psid,bid:ret.value},function (ret1) {
                    if(ret1 && ret1.success){
                        if(ret1.data.length>0){
                            var html = template('selectTagTmp',{title:'系列',list:ret1.data});
                            $('#yj-add-series').html(html);
                            selectTag($("#yj-add-series"),function (series) {
                                params[cid].sid = series.value;
                            })
                        }
                    }
                })
            })
            //供应商
            selectTag($("#yj-add-provider"),function (ret) {
                params[cid].pid = ret.value;
            })
            if($('#category'+cid).text()=='镜片'){
                //焦点
                selectTag($("#yj-add-jiaodian"),function (ret) {
                    params[cid].properties[ret.el.find('.optionUL li').attr('data-pnid')] = ret.value;
                })
                //折射率
                selectTag($("#yj-add-zheshelv"),function (ret) {
                    params[cid].properties[ret.el.find('.optionUL li').attr('data-pnid')] = ret.value;
                })
                //功能
                selectTag($("#yj-add-gongneng"),function (ret) {
                    params[cid].properties[ret.el.find('.optionUL li').attr('data-pnid')] = ret.value;
                })
            }else if($('#category'+cid).text()=='隐形眼镜'){
                //类型5
                selectTag($("#yj-add-type"),function (ret) {
                    params[cid].properties[ret.el.find('.optionUL li').attr('data-pnid')] = ret.value;
                })
                //周期
                selectTag($("#yj-add-zhouqi"),function (ret) {
                    params[cid].properties[ret.el.find('.optionUL li').attr('data-pnid')] = ret.value;
                })
                //包装
                selectTag($("#yj-add-baozhuang"),function (ret) {
                    params[cid].properties[ret.el.find('.optionUL li').attr('data-pnid')] = ret.value;
                })
            }else if($('#category'+cid).text()=='护理产品'){
                //类型10
                selectTag($("#yj-add-type-10"),function (ret) {
                    params[cid].properties[ret.el.find('.optionUL li').attr('data-pnid')] = ret.value;
                })

                //包装11
                selectTag($("#yj-add-baozhuang-11"),function (ret) {
                    params[cid].properties[ret.el.find('.optionUL li').attr('data-pnid')] = ret.value;
                })
            }
            //时间范围
            yjDate = new dateRange('#yj-add-time',true);
            yjDate.init()
        }
        // 新增眼镜
        function addYjGoods(isUpdate,index) {
            //销售状态  0开启  1关闭
            if($('#yj-add-status').hasClass('active')){
                params[cid].saleStatus = 0;
            }else{
                params[cid].saleStatus = 1;
            }
            if($('#category'+cid).text()=='镜片'){
                params[cid].productCustomRangeList = JSON.stringify(params[cid].productCustomRangeList);
            }else if($('#category'+cid).text()=='特殊商品'){
                params[cid].skuJson = [{}];
                params[cid].skuJson[0].num = $('#yj-add-num').val();
                params[cid].skuJson[0].code = $('#yj-add-code').val();
                params[cid].skuJson[0].costPrice = $('#yj-add-costPrice').val();
                params[cid].icon = $('#cover').attr('real-src');
                params[cid].name = $('#yj-add-name').val();
                if(params[cid].type==1){
                    params[cid].skuJson[0].integralPrice = $('#yj-add-integralPrice').val();
                }
            }else{
                params[cid].properties[$('#yj-add-day').attr('data-pnid')] = $('#yj-add-day').val();
                if($('#category'+cid).text()=='护理产品'){
                    params[cid].properties[$('#yj-add-shouming').attr('data-pnid')] = $('#yj-add-shouming').val();
                }
                if($('#category'+cid).text()!='隐形眼镜'){
                    params[cid].skuJson = [{}];
                    if(params[cid].type==1){
                        params[cid].skuJson[0].code = $('#yj-add-code-1').val();
                        params[cid].skuJson[0].integralPrice = $('#yj-add-integralPrice').val();
                    }else{
                        params[cid].skuJson[0].retailPrice = $('#yj-add-retailPrice').val();
                        params[cid].skuJson[0].costPrice = $('#yj-add-costPrice').val();
                        params[cid].skuJson[0].code = $('#yj-add-code').val();
                    }
                }
            }
            if(params[cid].type==1){
                //积分商品
                //有效期
                if(yjDate.getTime()[2]){
                    params[cid].integralStartTime = yjDate.getTime()[2];
                }
                if(yjDate.getTime()[3]){
                    params[cid].integralEndTime = yjDate.getTime()[3];
                }
                //兑换数量上限
                if($('#yj-add-integralNum').val()){
                    params[cid].integralNum = $('#yj-add-integralNum').val();
                }
            }
            if(quakooUtils.isArray(params[cid].ugDiscount)){
                params[cid].ugDiscount = JSON.stringify(params[cid].ugDiscount);
            }
            delete params[cid].categoryName;
            if(isUpdate){
                delete params[cid].skuList;
                delete params[cid].userGradeCategoryDiscountList;
                delete params[cid].providerName;
                delete params[cid].categoryName;
                delete params[cid].seriesName;
                delete params[cid].brandName;
                delete params[cid].canUseNum;
                delete params[cid].ctime;
                delete params[cid].utime;
                delete params[cid].sort;
                delete params[cid].integralEndTimeNew;
                delete params[cid].integralStartTimeNew;

                var skuJson = params[cid].skuJson;
                console.log(skuJson)
                params[cid].addSkuJson = [];
                params[cid].updateSkuJson = [];
                params[cid].delSkuIdJson = [];
                for(var i=0;i<skuJson.length;i++){
                    if(skuJson[i].id){
                        if(skuJson[i].del){
                            params[cid].delSkuIdJson.push(skuJson[i].id)
                        }else{
                            params[cid].updateSkuJson.push(skuJson[i])
                        }
                    }else{
                        params[cid].addSkuJson.push(skuJson[i])
                    }
                }
                params[cid].addSkuJson = JSON.stringify(params[cid].addSkuJson);
                params[cid].updateSkuJson = JSON.stringify(params[cid].updateSkuJson);
                params[cid].delSkuIdJson = JSON.stringify(params[cid].delSkuIdJson);

                console.log(params[cid])
                quakooData.ajaxGetData(config.getUrl_product_change(),params[cid],function (ret) {
                    if(ret.success){
                        layer.msg('修改成功',{icon: 1})
                        layer.close(index)
                        chooseGoodsType();
                    }else{
                        layer.msg(ret.data,{icon: 2})
                    }
                })
            }else{
                params[cid].skuJson = JSON.stringify(params[cid].skuJson);
                console.log(params[cid])
                quakooData.ajaxGetData(config.getUrl_product_add(),params[cid],function (ret) {
                    if(ret.success){
                        layer.msg('添加成功',{icon: 1})
                        layer.close(index)
                        chooseGoodsType();
                    }else{
                        layer.msg(ret.data,{icon: 2})
                    }
                })
            }

        }
        //特殊商品添加主图
        function uploadTsspIcon() {
            quakooImg.open(function (data) {
                var obj = quakooImg.processImg(data.ok,60,60)
                $('#cover').attr('src',obj.url)
                $('#cover').attr('real-src',data.ok)
                $('#cover')[0].style.cssText = obj.style;
                $('#cover').parent().show();
            })
        }
        //删除商品spu
        function delGoods(id) {
            quakooUtils.stopEventBubble()
            layer.confirm('确认删除?', {icon: 2, title:'提示'}, function(index){
                quakooData.ajaxGetData(config.getUrl_product_delSPU(),{id:id},function (data) {
                    if(data.success){
                        layer.msg('删除成功',{icon:1})
                        chooseGoodsType();
                        layer.close(index);
                    }else{
                        layer.msg(data.msg,{icon:2})
                    }
                })
            });
        }

    </script>
</body>
</html>