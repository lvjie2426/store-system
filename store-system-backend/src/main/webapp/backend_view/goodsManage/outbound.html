<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <title>眼睛-商品管理-出库</title>
    <!--Bootstrap样式引入开始-->
    <link rel="stylesheet" href="../resource/css/bootstrap.min.css">
    <link href="../resource/js/plugins/bootstarp-table/css/bootstrap-table.min.css" rel="stylesheet">
    <link href="../resource/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
    <link href="../resource/layui/css/layui.css" rel="stylesheet">
    <!--字体样式文件引用开始-->
    <link href="../resource/css/animate.css" rel="stylesheet">
    <link rel="stylesheet" href="../resource/fonts/iconfont.css">
    <!--字体样式文件引用结束-->
    <!--标签样式重置开始-->
    <link rel="stylesheet" href="../resource/css/reset.css">
    <link rel="stylesheet" href="../resource/css/style.css">
    <link rel="stylesheet" href="../resource/css/common.css">
    <!--标签样式重置结束-->
    <!--本页面样式开始-->
    <link rel="stylesheet" href="../resource/css/yanjing/goodsManage.css">
    <link rel="stylesheet" href="../resource/css/yanjing/chuku.css">
    <link rel="stylesheet" href="../resource/css/yanjing/statistics.css">
    <!--本页面样式结束-->
    <style>
        body {
            background-color: #ECECF3;
        }
    </style>
</head>

<body>
    <div class="yj-header">
        <div class="yj-header-left">
            <div>
                <i class="iconfont icon-ico_stock_out_filled"></i>
            </div>
            商品出库
        </div>
        <div class="yj-header-right">
            <button class="btn btn-primary" onclick="addGoods()">新增出库</button>
        </div>
    </div>
    <div class="goods-header">
        <div class="selectBox" >
            <div class="yj-header-time" id="select-date">
                <div class="yj-date">
                    <span>开始时间-结束时间</span><i class="iconfont icon-ico_calendar"></i>
                </div>
            </div>
        </div>
        <div class="selectBox" id="select-type">
            <div class="select-box-header">
                <span class="text">全部类型</span> <i class="iconfont icon-ico_arrow_down" ></i>
            </div>
            <div class="optionBox">
                <ul class="optionUL">
                    <li value="-1">全部类型</li>
                    <li value="0">普通仓库</li>
                    <li value="1">赠品仓库</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="goods-body">
        <ul class="contUl" id="showUl">
            <!--<li class="item">
                <div class="head">
                    <span class="mainCont-head-left red"><em></em>常规出库</span>
                    <span>发起人:<em>总仓</em></span>
                </div>
                <div class="body">
                    <div class="top">
                        <ul>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X10</span>
                            </li>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X20</span>
                            </li>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X200</span>
                            </li>
                            <li>
                                <span class="txtOverflow">商品A</span>
                                <span>-20</span>
                            </li>
                            <li style="color:#828297">
                                ...
                            </li>
                        </ul>
                    </div>
                    <div class="bottom">
                        <div>共15种商品</div>
                        <div>数量总计:100</div>
                    </div>
                </div>
                <div class="foot">
                    <span class="txt">2018.01.21<em>18:49:57</em></span>
                    <button class="btn btn-danger">等待确认</button>
                </div>
            </li>
            <li class="item">
                <div class="head">
                    <span class="mainCont-head-left blue"><em></em>常规出库</span>
                    <span>发起人:<em>总仓</em></span>
                </div>
                <div class="body">
                    <div class="top">
                        <ul>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X10</span>
                            </li>
                            <li>
                                <span class="txtOverflow">商品A</span>
                                <span>-20</span>
                            </li>
                            <li>
                                <span class="txtOverflow">商品B</span>
                                <span>+9</span>
                            </li>
                        </ul>
                    </div>
                    <div class="bottom">
                        <div>共3种商品</div>
                        <div>数量总计:100</div>
                    </div>
                </div>
                <div class="foot">
                    <span class="txt">2018.01.21<em>18:49:57</em></span>
                    <button class="btn btn-primary">编辑</button>
                </div>
            </li>
            <li class="item">
                <div class="head">
                    <span class="mainCont-head-left blue"><em></em>常规出库</span>
                    <span>发起人:<em>总仓</em></span>
                </div>
                <div class="body">
                    <div class="top">
                        <ul>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X10</span>
                            </li>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X20</span>
                            </li>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X200</span>
                            </li>
                            <li>
                                <span class="txtOverflow">商品A</span>
                                <span>-20</span>
                            </li>
                            <li>
                                <span class="txtOverflow">商品B</span>
                                <span>+9</span>
                            </li>
                        </ul>
                    </div>
                    <div class="bottom">
                        <div>共5种商品</div>
                        <div>数量总计:100</div>
                    </div>
                </div>
                <div class="foot">
                    <span class="txt">2018.01.21<em>18:49:57</em></span>
                    <button class="btn btn-primary">编辑</button>
                </div>
            </li>
            <li class="item">
                <div class="head">
                    <span class="mainCont-head-left purple"><em></em>订单出库</span>
                    <span>发起人:<em>总仓</em></span>
                </div>
                <div class="body">
                    <div class="top">
                        <ul>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X10</span>
                            </li>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X20</span>
                            </li>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X200</span>
                            </li>
                            <li>
                                <span class="txtOverflow">商品A</span>
                                <span>-20</span>
                            </li>
                            <li>
                                <span class="txtOverflow">商品B</span>
                                <span>+9</span>
                            </li>
                        </ul>
                    </div>
                    <div class="bottom">
                        <div>共15种商品</div>
                        <div>数量总计:100</div>
                    </div>
                </div>
                <div class="foot">
                    <span class="txt">2018.01.21<em>18:49:57</em></span>
                    <button class="btn btn-order">查看</button>
                </div>
            </li>
            <li class="item">
                <div class="head">
                    <span class="mainCont-head-left red"><em></em>调货出库</span>
                    <span>发起人:<em>总仓</em></span>
                </div>
                <div class="body">
                    <div class="top">
                        <ul>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X10</span>
                            </li>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X20</span>
                            </li>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X200</span>
                            </li>
                            <li>
                                <span class="txtOverflow">商品A</span>
                                <span>-20</span>
                            </li>
                            <li>
                                <span class="txtOverflow">商品B</span>
                                <span>+9</span>
                            </li>
                        </ul>
                    </div>
                    <div class="bottom">
                        <div>共15种商品</div>
                        <div>数量总计:100</div>
                    </div>
                </div>
                <div class="foot">
                    <span class="txt">2018.01.21<em>18:49:57</em></span>
                    <button class="btn btn-order">查看</button>
                </div>
            </li>
            <li class="item">
                <div class="head">
                    <span class="mainCont-head-left blue"><em></em>常规出库</span>
                    <span>发起人:<em>总仓</em></span>
                </div>
                <div class="body">
                    <div class="top">
                        <ul>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X10</span>
                            </li>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X20</span>
                            </li>
                            <li>
                                <span class="txtOverflow">HYDRON海昌透明黑色单片年抛</span>
                                <span>X200</span>
                            </li>
                            <li>
                                <span class="txtOverflow">商品A</span>
                                <span>-20</span>
                            </li>
                            <li>
                                <span class="txtOverflow">商品B</span>
                                <span>+9</span>
                            </li>
                        </ul>
                    </div>
                    <div class="bottom">
                        <div>共5种商品</div>
                        <div>数量总计:100</div>
                    </div>
                </div>
                <div class="foot">
                    <span class="txt">2018.01.21<em>18:49:57</em></span>
                    <button class="btn btn-order">查看</button>
                </div>
            </li>-->
        </ul>
        <table id="yj-table" data-toggle="table" class="table table-border"></table>
    </div>

    <!--出库-->
    <div class="content-view content-view-enter content-view-outbound" id="addDom">

    </div>
    <!-- 出库单 -->
    <div class="outbound-left outbound-right outbound-single">
        <div class="outbound-right-head">
            <div class="orhTitle">出库单</div>
            <div class="outbound-right-head-right">
                <span>出库人</span>
                <div class="selectBox" id="selectBox2">
                    <div class="select-box-header">
                        <span class="text">李小东</span> <i class="iconfont icon-ico_arrow_down" id="jt"></i>
                    </div>
                    <div class="optionBox">
                        <ul class="optionUL">
                            <li value="01">1</li>
                            <li value="02">2</li>
                            <li value="03">3</li>
                            <li value="04">4</li>
                            <li value="05">5</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="outbound-right-content">
            <div class="item">
                <h5>镜片</h5>
                <table width="100%">
                    <thead>
                        <tr>
                            <th width="15%">名称</th>
                            <th>生产批号</th>
                            <th>保质期</th>
                            <th>数量</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>名称A</td>
                            <td>946208</td>
                            <td>
                                2018.03.30 <br>
                                2019.03.30
                            </td>
                            <td>8</td>
                            <td>
                                <u class="rem">移除</u>
                            </td>
                        </tr>
                        <tr>
                            <td>名称B</td>
                            <td>54845</td>
                            <td>
                                2018.03.30 <br>
                                2019.03.30
                            </td>
                            <td>85</td>
                            <td>
                                <u class="rem">移除</u>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="item">
                <h5>镜片</h5>
                <table width="200%">
                    <thead>
                        <tr>
                            <th width="15%">名称</th>
                            <th>球镜度数</th>
                            <th>散光度数</th>
                            <th>生产批号</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>名称B</td>
                            <td>54845</td>
                            <td>
                                2018.03.30 <br>
                                2019.03.30
                            </td>
                            <td>85</td>
                            <td class="brL">
                                <u class="rem">移除</u>
                            </td>
                        </tr>
                        <tr>
                            <td>名称B</td>
                            <td>54845</td>
                            <td>
                                2018.03.30 <br>
                                2019.03.30
                            </td>
                            <td>85</td>
                            <td class="brL">
                                <u class="rem">移除</u>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="btnBox">
            <button class="btn btn-yj">关闭窗口</button>
            <button class="btn btn-primary fr">确认出库</button>
            <button class="btn btn-rem fr">删除出库</button>
        </div>
    </div>


    <!--js依赖开始-->
    <!--bootstrap依赖于jQuery，jQuery.js必须放在BS.js之前-->
    <script src="../resource/js/jquery.min.js"></script>
    <script src="../resource/js/bootstrap.js"></script>
    <!--js依赖结束-->

    <!-- Bootstrap table -->
    <script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table.js"></script>
    <script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table-zh-CN.min.js"></script>

    <script src="../resource/js/plugins/layer/layer.js"></script>
    <script src="../resource/layui/layui.js"></script>


    <script src="../resource/js/lib/quakooLib/QuakooBase-1.0.0.js"></script>
    <script src="../resource/js/lib/quakooLib/QuakooConfig-1.0.0.js"></script>
    <script src="../resource/js/lib/quakooLib/QuakooBasePc-1.0.0.js"></script>
    <script src="../resource/js/lib/quakoo/Config.js"></script>
    <script src="../resource/js/lib/quakoo/project.js"></script>
    <script src="../resource/common/common.js?" +Math.random()></script>

    <script src="../resource/js/yanjing.js"></script>
    <script src="../resource/js/yanjing/daterange.js"></script>
    <script src="../resource/js/template-native.js"></script>
    <!--下拉选择模板带全部-->
    <script type="text/html" id="selectTagTmpAll">
        <div class="select-box-header">
            <span class="text"><%=title%></span> <i class="iconfont icon-ico_arrow_down" ></i>
        </div>
        <div class="optionBox">
            <ul class="optionUL">
                <li value="-1">全部</li>
                <%for(var i=0;i< list.length;i++){%>
                <li value="<%=list[i].id%>" data-pnid="<%if(list[i].pnid){%><%=list[i].pnid%><%}%>"><%if(list[i].name){%><%=list[i].name%><%}else{%><%=list[i].content%><%}%></li>
                <%}%>
            </ul>
        </div>
    </script>
    <!--下拉选择模板-->
    <script type="text/html" id="selectTagTmp">
        <div class="select-box-header">
            <span class="text"><%=title%></span> <i class="iconfont icon-ico_arrow_down" ></i>
        </div>
        <div class="optionBox">
            <ul class="optionUL">
                <%for(var i=0;i< list.length;i++){%>
                <li value="<%=list[i].id%>" data-pnid="<%if(list[i].pnid){%><%=list[i].pnid%><%}%>"><%if(list[i].name){%><%=list[i].name%><%}else{%><%=list[i].content%><%}%></li>
                <%}%>
            </ul>
        </div>
    </script>
    <script type="text/html" id="dataTmp">
        <%for(var i=0;i< list.length;i++){%>
        <li class="item">
            <div class="head">
                <span class="mainCont-head-left blue"><em></em>常规出库</span>
                <span>发起人:<em><%=list[i].outUserName%></em></span>
            </div>
            <div class="body">
                <div class="top">
                    <ul>
                        <%if(list[i].clientItems.length>5){%>
                        <%for(var j=0;j< list[i].clientItems.length;j++){%>
                        <%if(j< 4 ){%>
                        <li>
                            <span class="txtOverflow"><%=list[i].clientItems[j].seriesName%><%=list[i].clientItems[j].code%></span>
                            <span>X<%=list[i].clientItems[j].num%></span>
                        </li>
                        <%}%>
                        <%}%>
                        <li style="color:#828297">
                            ...
                        </li>
                        <%}else{%>
                        <%for(var j=0;j< list[i].clientItems.length;j++){%>
                        <li>
                            <span class="txtOverflow"><%=list[i].clientItems[j].seriesName%><%=list[i].clientItems[j].code%></span>
                            <span>X<%=list[i].clientItems[j].num%></span>
                        </li>
                        <%}%>
                        <%}%>
                    </ul>
                </div>
                <div class="bottom">
                    <div>共<%=list[i].clientItems.length%>种商品</div>
                    <div>数量总计:<%=list[i].clientItemsNum%></div>
                </div>
            </div>
            <div class="foot">
                <span class="txt"><%=list[i].time%></span>
                <%if(list[i].status==0){%>
                <button class="btn btn-primary">编辑</button>
                <%}else if(list[i].status==1){%>
                <button class="btn btn-danger">等待确认</button>
                <%}else if(list[i].status==2){%>
                <button class="btn btn-order">查看</button>
                <%}%>
            </div>
        </li>
        <%}%>
    </script>
    <script type="text/html" id="addTmp">
        <div class="leftBox">
            <div class="body">
                <ul class="tab-ul" id="yj-category">
                    <%for(var i=0;i< categoryData.length;i++){%>
                    <%if(categoryData[i].name!='特殊商品'){%>
                    <li id="category<%=categoryData[i].id%>" onclick="chooseGoodsType('<%=categoryData[i].id%>')"><%=categoryData[i].name%></li>
                    <%}%>
                    <%}%>
                </ul>
                <ul class="tab-content-list">
                    <li class="tab-content-item active">
                        <div class="outbound-left-body">
                            <div class="outbound-body-option">
                                <div class="selectBox" id="out-brand">
                                    <div class="select-box-header">
                                        <span class="text">品牌</span> <i class="iconfont icon-ico_arrow_down"></i>
                                    </div>
                                    <div class="optionBox" style="display: none;">
                                        <ul class="optionUL">
                                            <%for(var i=0;i< brandData.length;i++){%>
                                            <li value="<%=brandData[i].id%>"><%=brandData[i].name%></li>
                                            <%}%>
                                        </ul>
                                    </div>
                                </div>
                                <div class="selectBox" id="out-series">
                                    <div class="select-box-header">
                                        <span class="text">系列</span> <i class="iconfont icon-ico_arrow_down"></i>
                                    </div>
                                    <div class="optionBox" style="display: none;">
                                        <ul class="optionUL">

                                        </ul>
                                    </div>
                                </div>
                                <div class="selectBox" id="out-provider">
                                    <div class="select-box-header">
                                        <span class="text">供应商</span> <i class="iconfont icon-ico_arrow_down"></i>
                                    </div>
                                    <div class="optionBox" style="display: none;">
                                        <ul class="optionUL">
                                            <%for(var i=0;i< providerData.length;i++){%>
                                            <li value="<%=providerData[i].id%>"><%=providerData[i].name%></li>
                                            <%}%>
                                        </ul>
                                    </div>
                                </div>
                                <div class="selectBox" id="out-type">
                                    <div class="select-box-header">
                                        <span class="text">常规商品</span> <i class="iconfont icon-ico_arrow_down"></i>
                                    </div>
                                    <div class="optionBox" style="display: none;">
                                        <ul class="optionUL">
                                            <li value="0">常规商品</li>
                                            <li value="1">积分商品</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="selectBox jj-box" id="out-caizhi">
                                    <div class="select-box-header">
                                        <span class="text">材质</span> <i class="iconfont icon-ico_arrow_down"></i>
                                    </div>
                                    <div class="optionBox">
                                        <ul class="optionUL">
                                            <li value="01">材质A</li>
                                            <li value="05">材质E</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="btn btn-info" style="float: right" onclick="getSpu()">查询</div>


                            </div>
                            <div class="outbound-body-tag">
                                <div class="tag-list">A品牌A系列</div>
                                <div class="tag-list">B品牌$系列</div>
                                <div class="tag-list">F品牌0系列</div>
                            </div>
                            <div class="outbound-body-content outbound-body-top-hidden">
                                <span class="jp-box text-default">请先选择门店、品牌和系列</span>
                                <input class="jp-no-box" type="number" placeholder="搜索关键字">
                                <div class="btn btn-info fr" onclick="addToList()">添加至出库单</div>
                            </div>
                            <div class="outbound-body-top-show clearfix">
                                <div class="text-end clearfix">
                                    <span>A品牌A系列</span>
                                    <ul class="tab-lr clearfix">
                                        <li class="tab-lr-item active">右</li>
                                        <li class="tab-lr-item">左</li>
                                    </ul>
                                </div>
                                <div class="btn btn-info">添加至出库单</div>
                            </div>
                        </div>
                    </li>

                </ul>

                <div class="out-table1">
                    <table class="layui-hide yj-layui-table" id="outboundTable" lay-filter="outboundEvent"></table>
                </div>
                <div class="out-table2">
                    <table class="table table-self" id="out-table" lay-filter="in-table"></table>
                </div>

            </div>
        </div>
        <!--右边-->
        <div class="rightBox">
            <div class="body" id="outListDom">

            </div>
        </div>
    </script>

    <script type="text/html" id="outListTmp">
        <%for(var i in list){%>
        <%if(list[i].data.length>0){%>
        <!--<div class="itemDiv">-->
        <div class="itemDiv _scroll">
            <p class="name"><%=list[i].name%></p>
            <div class="box">
                <div class="thead">
                    <span>产品编码</span>
                    <span>品牌</span>
                    <span>系列</span>
                    <span>供应商</span>
                    <span>商品类型</span>
                    <%if(list[i].name=='镜片'){%>
                    <span>球</span>
                    <span>柱</span>
                    <%}else if(list[i].name=='镜架' || list[i].name=='太阳镜'){%>
                    <span>型号</span>
                    <span>色号</span>
                    <%}else if(list[i].name=='隐形眼镜'){%>
                    <span>球镜度数</span>
                    <span>生产批号</span>
                    <span>保质期</span>
                    <%}else if(list[i].name=='护理产品'){%>
                    <span>生产批号</span>
                    <span>保质期</span>
                    <%}else if(list[i].name=='其它商品'){%>
                    <span>型号</span>
                    <%}%>
                    <span>数量</span>
                    <span class="removeLi">操作</span>
                </div>
                <ul class="tbody">
                    <%for(var j=0;j< list[i].data.length;j++){%>
                    <li>
                        <span><%=list[i].data[j].code%></span>
                        <span><%=list[i].data[j].brandName%></span>
                        <span><%=list[i].data[j].seriesName%></span>
                        <span><%=list[i].data[j].providerName%></span>
                        <%if(type==0){%>
                        <span>常规商品</span>
                        <%}else{%>
                        <span>积分商品</span>
                        <%}%>
                        <%if(list[i].name=='镜片'){%>
                        <span><%=list[i].data[j].properties[15]%></span>
                        <span><%=list[i].data[j].properties[16]%></span>
                        <%}else if(list[i].name=='镜架' || list[i].name=='太阳镜'){%>
                        <span><%=list[i].data[j].xinghao%></span>
                        <span><%=list[i].data[j].sehao%></span>
                        <%}else if(list[i].name=='隐形眼镜'){%>
                        <span><%=list[i].data[j].ballName%></span>
                        <span><%=list[i].data[j].shengchanpihao%></span>
                        <span class="line16"><%=list[i].data[j].outDate[0]%><br/><%=list[i].data[j].outDate[1]%></span>
                        <%}else if(list[i].name=='护理产品'){%>
                        <span><%=list[i].data[j].shengchanpihao%></span>
                        <span class="line16"><%=list[i].data[j].outDate[0]%><br/><%=list[i].data[j].outDate[1]%></span>
                        <%}else if(list[i].name=='其它商品'){%>
                        <span><%=list[i].data[j].xinghao%></span>
                        <%}%>
                        <span><%=list[i].data[j].newNum%></span>
                        <span class="remove" onclick="removeOutLi('<%=i%>','<%=j%>')">移除</span>
                    </li>
                    <%}%>
                </ul>
            </div>
        </div>
        <%}%>
        <%}%>
    </script>

    <script>
        var subid = quakooUser.getUserInfo().sid;//企业id
        var selectBid;//筛选条件的品牌id
        var categoryData = [];//一级类目数据
        var brandData = [];//品牌数据
        var providerData = [];//供应商数据
        var ballData = [];//球数据
        var columnData = [];//柱数据
        var peopleData = [];//员工数据
        var cid;            //一级类目id
        var allOutList = {};//全部数据
        var peopleId;//入库人id

        var selectType = -1;//筛选条件的类型
        var startTime;//筛选时间开始时间
        var endTime;//筛选时间结束时间

        var pid;//添加入库时的供应商id
        var bid;//添加入库时的品牌id
        var sid = -1;
        var type = 0;// 0常规商品，1积分商品

        var nowGoodData;//查询出来的sku数据
        var brandName = '';
        var seriesName = '';
        var providerName = '';
        // 筛选条件的类型
        selectTag($("#select-type"),function (data) {
            if(data.value){
                selectType = data.value;
                getInData();
            }
        })
        var selectDate = new dateRange("#select-date");
        selectDate.init()
        $('#select-date button').click(function () {
            startTime = selectDate.getTime()[2];
            endTime = selectDate.getTime()[3];
            getInData()
        })

        //获取一级类目
        quakooData.ajaxGetData(config.getUrl_productCategory_getSubAllList(),{subid:subid},function (ret) {
            if(ret && ret.success){
                categoryData = ret.data;
            }
        })
        //获取品牌数据
        quakooData.ajaxGetData(config.getUrl_productBrand_getSubAllList(),{subid:subid},function (ret) {
            if(ret && ret.success){
                brandData = ret.data;
                var html = template('selectTagTmpAll',{title:'全部商品类型',list:ret.data});
                //商品列表的筛选
                $('#select-type').html(html);
                selectTag($("#select-type"),function (data) {
                    if(data.value){
                        selectBid = data.value;
                    }
                })
            }
        })
        //获取属性-球
        quakooData.ajaxGetData(config.getUrl_productPropertyvalue_getAllList(),{pnid:15},function (ret) {
            if(ret && ret.success){
                ballData = ret.data.sort(function (a,b) {
                    return b.content-a.content;
                });
            }
        })
        //获取供应商
        quakooData.ajaxGetData(config.getUrl_productProvider_getSubAllList(),{subid:subid},function (ret) {
            if(ret && ret.success){
                providerData = ret.data;
            }
        })
        //获取属性-柱
        quakooData.ajaxGetData(config.getUrl_productPropertyvalue_getAllList(),{pnid:16},function (ret) {
            if(ret && ret.success){
                columnData = ret.data.sort(function (a,b) {
                    return b.content-a.content;
                });
            }
        })
        //获取门店所有顾客-不分页
        quakooData.ajaxGetData(config.getUrl_user_getAllUser(),{sid:subid,userType:1},function (ret) {
            if(ret && ret.success){
                peopleData = ret.data;
            }
        })

        getInData()
        function getInData(){
            $("#yj-table").bootstrapTable('destroy');
            $("#yj-table").bootstrapTable({
                url: config.getUrl_inventoryOutBill_getCheckPager(),
                classes: "table",
                pagination: true,        //是否显示分页
                sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                pageNumber: 1,                       //初始化加载第一页，默认第一页
                pageSize: 6,
                pageList: [6, 12, 18],
                sortable: false,
                sortOrder: "asc",
                showColumns: true,
                strictSearch: true,
                locale: "zh-CN",
                paginationHAlign: "center",
                clickToSelect: true,
                // paginationLoop:false,        //分页是否可以循环
                columns: [],
                queryParams:function (param) {
                    param.subid = subid;
                    param.token = quakooUser.getUserInfo().token;
                    param.type=selectType;
                    if(startTime){
                        param.startTime=startTime;
                    }
                    if(endTime){
                        param.endTime=endTime;
                    }
                    return param
                },
                onPreBody: function (data) {
                    console.log(data)
                    var arr = [];
                    for (var i = (this.pageNumber - 1) * this.pageSize; i < this.pageNumber * this.pageSize; i++) {
                        if(this.data[i]){
                            this.data[i].time = quakooUtils.formatTimeToDateDian(this.data[i].ctime);
                            this.data[i].clientItemsNum = 0;
                            for(var j=0;j<this.data[i].clientItems.length;j++){
                                this.data[i].clientItemsNum +=this.data[i].clientItems[j].num;
                            }
                            arr.push(this.data[i])
                        }
                    }
                    var html = template('dataTmp',{list:arr})
                    $("#showUl").html(html);
                }
            });
        }






        /**
         * 打开新增弹窗
         * */
        function addGoods() {
            var html = [];
            html.push('<div class="leftBox leftBoxTitle"> <div class="head"> <span class="title" style="width: 100%;">添加商品</span></div></div>');
            html.push('<div class="rightBox leftBoxTitle"> <div class="head"> <span class="title">出库单</span> <div class="selectBox" id="out-people">');
            html.push('<div class="select-box-header"><span class="text">出库人</span> <i class="iconfont icon-ico_arrow_down"></i></div><div class="optionBox"><ul class="optionUL">')
            for(var i=0;i<peopleData.length;i++){
                html.push('<li value="'+peopleData[i].id+'">'+peopleData[i].name+'</li>');
            }
            html.push('</ul></div></div><span class="person">出库人:</span></div></div>')
            layer.open({
                type: 1, shade: 0.01, title: html.join(''),
                skin: 'layui-layer-outbound  content-view-enter-tan', //样式类名
                area: ['960px', '560px'],
                anim: 0,
                move:'.title',
                closeBtn: 0, //不显示关闭按钮
                resize: false,
                shadeClose: true, //开启遮罩关闭
                content: $('.content-view-outbound'),
                btn: ['关闭窗口','创建出库'],
                success: function (layero, index) {
                    var html = [];
                    html.push('<div class="leftBox"><div class="foot"><a class="layui-layer-btn0">关闭窗口</a></div></div>')
                    html.push('<div class="rightBox"><div class="foot"><a class="layui-layer-btn1">创建出库</a></div></div>')
                    $('.content-view-enter-tan .layui-layer-btn').html(html.join(''))

                    addRepertorySuccess(index)
                }
            });
        }
        function addRepertorySuccess(index) {
            var html = template('addTmp',{brandData:brandData,categoryData:categoryData,ballData:ballData,columnData:columnData,providerData:providerData})
            $('#addDom').html(html);
            $('.content-view-enter-tan .layui-layer-btn .layui-layer-btn0').click(function () {
                addOutList(0,index);
            });
            $('.content-view-enter-tan .layui-layer-btn .layui-layer-btn1').click(function () {
                addOutList(1,index)
            });
            $('#yj-category li').eq(0).click()
            selectTag($("#out-brand"), function (ret) {
                if(ret.value){
                    bid = ret.value;
                    brandName = ret.text;
                    sid = -1;
                    $('#out-series').html('');
                    //获取品牌下的系列列表
                    quakooData.ajaxGetData(config.getUrl_productSeries_getSubAllList(),{subid:quakooUser.getUserInfo().psid,bid:ret.value},function (ret1) {
                        if(ret1 && ret1.success){
                            var html2 = template('selectTagTmp',{title:'系列',list:ret1.data});
                            $('#out-series').html(html2).show();
                            selectTag($("#out-series"),function (series) {
                                sid = series.value;
                                seriesName = series.text;
                            })
                        }
                    })
                }
            })
            //入库人
            selectTag($("#out-people"), function (ret) {
                peopleId = ret.value;
            })
            //供应商
            selectTag($("#out-provider"), function (ret) {
                pid = ret.value;
                providerName = ret.text;
            })
            //商品类型
            selectTag($("#out-type"), function (ret) {
                type = ret.value;
            })
        }
        //添加出库单
        function addOutList() {

        }
        //选择一级类目
        function chooseGoodsType(value){
            cid = value;
            if(!allOutList[cid]){
                allOutList[cid] = {cid:cid,name:$('#category'+value).text(),data:[]}
            }
            $('#category'+value).addClass('active').siblings().removeClass('active');
            if($('#category'+value).text()=='镜片'){
                $('.out-table1').show();
                $('.out-table2').hide();
                $('.jj-box').hide();
                $('.jp-box').show();
                $('.jp-no-box').hide();

                $('.outbound-foot button').click(function () {
                    layer.close(index)
                })
            }else{
                $('.out-table1').hide();
                $('.out-table2').show();
                $('.jp-box').hide();
                $('.jp-no-box').show();
                if($('#category'+value).text()=='镜架' || $('#category'+value).text()=='太阳镜' || $('#category'+value).text()=='护理产品'){
                    $('.jj-box').show();
                }else{
                    $('.jj-box').hide();
                }
                $("#out-table").bootstrapTable('destroy')
                $("#out-table").bootstrapTable({
                    data: [{ a: '型号A', b: '色号A', c: '12', d: '6' }, { a: '型号A', b: '色号A', c: '12' }],                 //被加载的数据。
                    classes: "table",
                    sortable: false,
                    sortOrder: "asc",
                    showColumns: true,
                    strictSearch: true,
                    locale: "zh-CN",
                    paginationHAlign: "center",
                    clickToSelect: true,
                    columns: [
                        { field: 'a', title: '型号', align: 'left', value: 'middle'  ,width:'25%' },
                        { field: 'b', title: '色号', align: 'left', value: 'middle'  ,width:'25%' },
                        { field: 'c', title: '库存量', align: 'left', value: 'middle',width:'25%' },
                        {field: 'd', title: '出库量', align: 'left', value: 'middle' ,width:'25%' , formatter: function (value) {
                                return !value ? '<input type="text" placeholder="数量">' : value;
                            }
                        },
                    ]
                });

            }
        }

        // 查看出库单
        function ckd() {
            layer.open({
                type: 1, shade: 0.01, title: null,
                skin: 'layui-layer-outbound', //样式类名
                area: ['440px', '560px'],
                anim: 0,
                closeBtn: 0, //不显示关闭按钮
                resize: false,
                shadeClose: true, //开启遮罩关闭
                content: $('.outbound-single'),
            })
        }

        var skuObj;//镜片所需要的sku集合   键 是球+柱
        // 获取一个商品的SPU，返回需要确定的所有SKU属性
        function getSpu() {
            if(!bid){
                layer.msg('请选择品牌')
                return
            }
            if(!pid){
                layer.msg('请选择供应商')
                return
            }
            quakooData.ajaxGetData(config.getUrl_inventoryOutBill_select(),{subid:subid,type:type,cid:cid,pid:pid,bid:bid,sid:sid},function (ret) {
                if(ret && ret.success){
                    console.log(ret)
                    nowGoodData = ret.data.skuList;
                    skuObj = {};
                    for(var j=0;j<nowGoodData.length;j++){
                        skuObj[nowGoodData[j].properties[15]+''+nowGoodData[j].properties[16]] = nowGoodData[j];
                    }
                    if(ret.data){
                        if($('#category'+cid).text()=='镜片'){
                            var cols = [[], []];//球
                            var rangeData = [];//柱
                            cols[0].push({field:'num',rowspan:2,unresize:true, minWidth:60,align:'center', title: '<div class="yj-layui-table-header"><span>球</span><span>柱</span></div>', fixed: 'left'})
                            for(var i=0;i<ballData.length;i++){
                                (function (i) {
                                    cols[0].push({align: 'center', title:ballData[i].content, colspan: 2,unresize:true})
                                    cols[1].push({field: '', title: '库存', width: 60,unresize:true ,templet: function (value,row,index) {
                                            if(skuObj[ballData[i].content + '' + value.num]){
                                                return skuObj[ballData[i].content + '' + value.num].num
                                            }else{
                                                return '-'
                                            }
                                        }})
                                    cols[1].push({field: '', title: '出库', width: 60,edit:'text',unresize:true})
                                })(i)
                            }
                            for(var i=0;i<columnData.length;i++){
                                rangeData.push({num:columnData[i].content,id:columnData[i].id})
                            }
                            layui.use('table', function () {
                                var table = layui.table;
                                table.render({
                                    elem: '#outboundTable'
                                    , data: rangeData
                                    , width: 488
                                    , height: 260
                                    , unresize: true
                                    , cols: cols
                                });
                                //监听单元格事件
                                table.on('edit(outboundEvent)', function (obj) { //注：edit是固定事件名，test是table原始容器的属性 lay-filter="对应的值"
                                    if(parseInt($(this).parents('td').prev().find('.layui-table-cell').html())>0){
                                        var ball = ballData[Math.floor($(this).parents('td').attr('data-key').split('-')[$(this).parents('td').attr('data-key').split('-').length-1]/2)].content;
                                        var colum = obj.data.num;
                                        if(skuObj[ball + '' + colum].num>= obj.value){
                                            skuObj[ball + '' + colum].newNum = obj.value;
                                        }else{
                                            skuObj[ball + '' + colum].newNum = skuObj[ball + '' + colum].num;
                                            this.value = skuObj[ball + '' + colum].num;
                                        }
                                        console.log(skuObj)
                                    }else{
                                        this.value = '';
                                        layer.msg('该规格暂无库存');
                                    }
                                });
                            });
                        }else if($('#category'+cid).text()=='镜架' || $('#category'+cid).text()=='太阳镜' ){
                            $('.jj-box').show();
                        }else if($('#category'+cid).text()=='隐形眼镜'){
                            $('.yxyj-box').show();
                        }else if($('#category'+cid).text()=='护理产品'){
                            $('.hlcp-box').show();
                        }else if($('#category'+cid).text()=='其它商品'){
                            $('.qtsp-box').show();
                        }
                    }
                }else{
                    layer.msg(ret.data)
                }
            })
        }
        //添加到本地出库单
        function addToList() {
            if(quakooUtils.isBlack(nowGoodData)){
                layer.msg('请查询商品')
                return
            }
            var arr = [];
            for(var i=0;i<nowGoodData.length;i++){
                if(skuObj[nowGoodData[i].properties[15]+''+nowGoodData[i].properties[16]] && skuObj[nowGoodData[i].properties[15]+''+nowGoodData[i].properties[16]].newNum){
                    nowGoodData[i].newNum = skuObj[nowGoodData[i].properties[15]+''+nowGoodData[i].properties[16]].newNum;
                    nowGoodData[i].brandName = brandName;
                    nowGoodData[i].seriesName = seriesName;
                    nowGoodData[i].providerName = providerName;
                    arr.push(nowGoodData[i])
                }
            }


            allOutList[cid].data = arr;
            var html = template('outListTmp',{list:allOutList})
            $("#outListDom").html(html)
        }
        //移除出库单中的商品
        function removeOutLi(i,j) {
            allOutList[i].data.splice(j,1);
            var html = template('outListTmp',{list:allOutList})
            $("#outListDom").html(html)
        }
    </script>
</body>

</html>