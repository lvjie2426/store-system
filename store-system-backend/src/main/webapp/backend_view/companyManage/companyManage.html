<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <title>公司管理</title>
    <link href="../resource/layui/css/layui.css" rel="stylesheet">
    <link href="../resource/css/bootstrap.min.css" rel="stylesheet">
    <link href="../resource/js/plugins/bootstarp-table/css/bootstrap-table.min.css" rel="stylesheet">
    <link href="../resource/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
    <link href="../resource/css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="../resource/css/reset.css" rel="stylesheet">
    <link href="../resource/css/animate.css" rel="stylesheet">
    <link href="../resource/css/style.css" rel="stylesheet">
    <link href="../resource/css/common.css" rel="stylesheet">
    <link rel="stylesheet" href="../resource/fonts/iconfont.css">
    <link rel="stylesheet" href="../resource/css/yanjing/companyManage.css">
    <link href="../resource/css/yanjing/mobiscroll.2.13.2.css" rel="stylesheet">
    <link href="../resource/css/yanjing/myDate.css" rel="stylesheet">
    <link rel="stylesheet" href="../resource/css/baiduMap.css">
    <script src="../resource/js/baiduMap.js"></script>
    <style>
        .mainContent textarea{
            width: 100%;
            height: 110px;
            resize: none;
            border: 1px solid #ECECF4;
            margin: 6px 0;
            padding-left: 10px;
            line-height: 28px;
            border-radius: 2px;
            background-color: #ffffff;
        }
        .dwcc div.mbsc-w-p:nth-child(2) .dwfl:nth-child(2){
            display: block;
        }
    </style>
</head>
<body>
<div class="companyManageCont">
    <div class="contHeader">
        <ul class="tab-ul">
            <li class="active">门店管理</li>
            <li>支付方式</li>
        </ul>
        <div class="headRight">
            <div class="child newShop" onclick="shopDes()">创建门店</div>
            <div class="btn btn-info search-btn" style="margin-left: 10px;" onclick="searchShop()">搜索</div>
            <input class="child" type="text" placeholder="搜索门店" id="searchShop">
            <div class="selectBox child" id="searchShopType">
                <div class="select-box-header">
                    <span class="text">名称</span> <i class="iconfont icon-ico_arrow_down"></i>
                </div>
                <div class="optionBox">
                    <ul class="optionUL">
                        <li value="1">名称</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="headRight" style="display: none">
            <div class="btn btn-info" style="float: right;margin: 12px" onclick="setPay()">创建支付方式</div>
        </div>
    </div>
    <div class="shopBox">
        <div class="companyMsg wrap90">
            <div class="head">
                <span class="msg">公司信息</span>
                <span class="editMsg">编辑信息</span>
            </div>
            <div class="cont" id="comInfo">
            </div>
        </div>
        <div class="shopItems wrap90 clearfix">
            <ul class="contUl clearfix" id="shopUl">
            </ul>
        </div>
    </div>

    <!--支付方式列表-->
    <div class="goods-body shopBox" style="display: none">
        <table id="yj-table" style="table-layout: fixed;word-break:break-all;" data-toggle="table"  class="table table-border"></table>
    </div>

    <!--创建门店弹窗-->
    <div class="content-view content-view-creatShop" style="display:none">
        <p class="txt01">设置前请先设置支付方式</p>
    </div>
    <!--设置支付方式弹窗-->
    <div class="content-view content-view-setPay" style="display:none" id="payDom">

    </div>
    <!--门店详细弹窗-->
    <div class="content-view content-view-shopDes" id="shopDom">

    </div>
</div>
<form style="opacity: 0" action="" id="uploadForm" autocomplete="off" enctype="multipart/form-data">
    <input style="height: 0;width: 0;" type="file" name="file" accept="image/jpeg，image/jpg，image/png,image/jp2，image/jpe" />
</form>
<!--全局js-->
<script src="../resource/js/jquery.min.js"></script>
<script src="../resource/js/bootstrap.js?v=3.3.6"></script>
<!--时间插件引用的css-->
<script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table.js"></script>
<script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table-zh-CN.min.js"></script>
<script src="../resource/js/plugins/layer/layer.js"></script>
<script src="../resource/layui/layui.js"></script>
<!-- 公司内部库 -->
<script src="../resource/js/lib/quakooLib/QuakooBase-1.0.0.js"></script>
<script src="../resource/js/lib/quakooLib/QuakooConfig-1.0.0.js"></script>
<script src="../resource/js/lib/quakooLib/QuakooBasePc-1.0.0.js"></script>
<script src="../resource/js/lib/quakoo/Config.js"></script>
<script src="../resource/js/lib/quakoo/project.js"></script>
<script src="../resource/js/template-native.js"></script>
<script src="../resource/common/common.js"></script>

<script src="../resource/js/area/areaUtils.js"></script>

<!-- 全局公共js -->
<script src="../resource/js/yanjing.js"></script>
<script src="../resource/js/mobiscroll.2.13.2.js"></script>

<!--模板——公司信息-->
<script type="text/html" id="comInfoList">
    <div class="comImg">
        <%if(list.iconUrl){%>
        <img class="comImg" src="<%=list.iconUrl%>" style="<%=list.style%>" alt="公司头像">
        <%}else{%>
        <img class="comImg" src="../resource/img/icon.png" style="width: 100%;height: 100%;" alt="公司头像">
        <%}%>
    </div>
    <div class="comName">
        <span class="texUp"><%=list.name%></span>
        <span class="txtDown"><%=list.address%></span>
    </div>
    <div class="perName">
        <span class="texUp"><%=list.adminUserName%></span>
        <span class="txtDown">负责人</span>
    </div>
    <div class="perTel">
        <span class="texUp"><%=list.adminPhone%></span>
        <span class="txtDown">手机号</span>
    </div>
</script>
<!--模板——门店列表-->
<script type="text/html" id="shopList">
    <%for(var i=0;i< list.length;i++){%>
    <li class="item">
        <div class="top">
            <p class="shopName txtOverflow fl"><%=list[i].name%></p>
            <div class="fr" id="shopListSwitch">
                <%if(list[i].status == 0){%>
                <div class="switch active" attr-id="<%=list[i].id%>" attr-status="1">
                    <span class="shopOn">已启用</span>
                    <span class="switch-btn"><i></i></span>
                </div>
                <%}else if(list[i].status == 1){%>
                <div class="switch" attr-id="<%=list[i].id%>" attr-status="0">
                    <span class="shopOff">未开启</span>
                    <span class="switch-btn"><i></i></span>
                </div>
                <%}%>
            </div>
        </div>
        <div class="middle">
            <p class="Id">
                <span class="txt1">门店简码</span>
                <span class="txt2 txtOverflow"><%=list[i].storeCode%></span>
            </p>
            <p class="addr">
                <span class="txt1">门店地址</span>
                <span class="txt2 txtOverflow"><%=list[i].address%></span>
            </p>
            <p class="tel">
                <span class="txt1">联系方式</span>
                <span class="txt2 txtOverflow"><%=list[i].phone%></span>
            </p>
            <p class="payMode">
                <span class="txt1">收款方式</span>
                <%if(list[i].payType==1){%>
                <span class="txt2 txtOverflow">个人微信</span>
                <%}else if(list[i].payType==2){%>
                <span class="txt2 txtOverflow">公共微信</span>
                <%}else if(list[i].payType==3){%>
                <span class="txt2 txtOverflow">公共支付宝</span>
                <%}else if(list[i].payType==4){%>
                <span class="txt2 txtOverflow">个人支付宝</span>
                <%}%>
            </p>
        </div>
        <div class="bottom">
            <a href="./staffManage.html?subid=<%=list[i].id%>">
                <button class="check">查看员工</button>
            </a>
            <button class="edit" type="button" onclick="shopDes('<%=list[i].id%>')">编辑</button>
        </div>
    </li>
    <%}%>
</script>
<script type="text/html" id="shopTmp">
    <div class="shopMsg">
        <ul class="clearfix">
            <li class="clearfix">
                <p class="title">门店名称</p>
                <input type="text" value="<%=list.name%>" id="name" placeholder="名称">
            </li>
            <li>
                <p class="title">门店简码</p>
                <input type="text" value="<%=list.storeCode%>" id="storeCode" placeholder="简码">
            </li>
            <li>
                <p class="title">门店电话</p>
                <input type="number" value="<%=list.phone%>" id="phone" placeholder="电话">
            </li>
        </ul>
    </div>
    <div class="address">
        <p class="title">门店地址</p>
        <!--<div class="mapDiv" id="mapDiv"></div>-->
        <div class="inputBox">
            <div class="selectBox" id="province">
                <div class="select-box-header">
                    <%if(list.provinceName){%>
                    <span class="text"><%=list.provinceName%></span> <i class="iconfont icon-ico_arrow_down"></i>
                    <%}else{%>
                    <span class="text">选择省</span> <i class="iconfont icon-ico_arrow_down"></i>
                    <%}%>
                </div>
                <div class="optionBox">
                    <ul class="optionUL">
                        <%for(var i in oneArea){%>
                        <li value="<%=oneArea[i].id%>"><%=oneArea[i].name%></li>
                        <%}%>
                    </ul>
                </div>
            </div>
            <div class="selectBox" id="city">
                <div class="select-box-header">
                    <%if(list.cityName){%>
                    <span class="text"><%=list.cityName%></span> <i class="iconfont icon-ico_arrow_down"></i>
                    <%}else{%>
                    <span class="text">选择市</span> <i class="iconfont icon-ico_arrow_down"></i>
                    <%}%>
                </div>
            </div>
            <div class="selectBox" id="area" style="width: 32%">
                <div class="select-box-header">
                    <%if(list.areaName){%>
                    <span class="text"><%=list.areaName%></span> <i class="iconfont icon-ico_arrow_down"></i>
                    <%}else{%>
                    <span class="text">选择区/县</span> <i class="iconfont icon-ico_arrow_down"></i>
                    <%}%>
                </div>
            </div>
        </div>
        <input type="text" placeholder="请输入具体门牌号" id="address" value="<%=list.address%>">
    </div>
    <div class="uploadPic">
        <p class="title">上传门店照片<em>1-9张</em></p>
        <div class="cont layui-upload" style="overflow: hidden" id="imgBox">
            <%if(list.storeImg){%>
            <%for(var i=0;i< list.storeImg.length;i++){%>
            <div class="imgBox">
                <img src="<%=list.storeImg[i]%>" real-src="<%=list.storeImg[i]%>" alt="">
            </div>
            <%}%>
            <%}%>
            <span onclick="uploadImg(this)" class="layui-btn" id="test2"><i class="icon iconfont icon-ico_plus"></i></span>
        </div>
    </div>
    <div class="openHours">
        <p class="title">营业时间</p>
        <div class="cont">
            <div>
                <%if(list.startTime){%>
                <input name="test" id="startTime"
                       class="demo-test-date demo-test-datetime demo-test-time demo-test-credit"
                       placeholder="<%=list.startTime%>" data-type="minute"/>
                <%}else{%>
                <input name="test" id="startTime"
                       class="demo-test-date demo-test-datetime demo-test-time demo-test-credit"
                       placeholder="选择开市时间" data-type="minute"/>
                <%}%>

                <i class="icon iconfont icon-ico_calendar"></i>
                <div class="settings" style="display:none;">
                    <select name="demo" id="demo01">
                        <option value="date">日期</option>
                    </select>
                </div>
            </div>
            <div>
                <%if(list.endTime){%>
                <input name="test" id="endTime"
                       class="demo-test-date demo-test-datetime demo-test-time demo-test-credit"
                       placeholder="<%=list.endTime%>" data-type="minute"/>
                <%}else{%>
                <input name="test" id="endTime"
                       class="demo-test-date demo-test-datetime demo-test-time demo-test-credit"
                       placeholder="选择闭市时间" data-type="minute"/>
                <%}%>
                <i class="icon iconfont icon-ico_calendar"></i>
                <div class="settings" style="display:none;">
                    <select name="demo" id="demo02">
                        <option value="date">日期</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    <div class="sanbao">
        <p class="title">三包政策</p>
        <input type="text" value="<%=list.threePolicy%>" id="threePolicy" placeholder="三包政策(显示在小票上)">
    </div>
    <div class="payType">
        <p class="title">支付方式</p>
        <div class="selectBox" id="payType">
            <div class="select-box-header">
                <%if(list.payType==1){%>
                <span class="text">个人微信</span> <i class="iconfont icon-ico_arrow_down"></i>
                <%}else if(list.payType==2){%>
                <span class="text">公共微信</span> <i class="iconfont icon-ico_arrow_down"></i>
                <%}else if(list.payType==3){%>
                <span class="text">公共支付宝</span> <i class="iconfont icon-ico_arrow_down"></i>
                <%}else if(list.payType==4){%>
                <span class="text">个人支付宝</span> <i class="iconfont icon-ico_arrow_down"></i>
                <%}else{%>
                <span class="text">个人微信</span> <i class="iconfont icon-ico_arrow_down"></i>
                <%}%>
            </div>
            <div class="optionBox">
                <ul class="optionUL">
                    <li value="1">个人微信</li>
                    <li value="2">公用微信</li>
                    <li value="3">个人支付宝</li>
                    <li value="4">公用支付宝</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="chuzhi">
        <p class="title">储值方式</p>
        <div class="cont">
            <form class="layui-form">
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <%if(list.storedType==0){%>
                        <input type="radio" name="chuzhi" lay-filter="chuzhi" value="0" title="本店自由" checked="checked">
                        <input type="radio" name="chuzhi" lay-filter="chuzhi" value="1" title="与其他店共有">
                        <%}else{%>
                        <input type="radio" name="chuzhi" lay-filter="chuzhi" value="0" title="本店自由" >
                        <input type="radio" name="chuzhi" lay-filter="chuzhi" value="1" title="与其他店共有" checked="checked">
                        <%}%>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="jiazhong">
        <p class="title">加工方式</p>
        <div class="cont">
            <form class="layui-form">
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <%if(list.processType==0){%>
                        <input type="radio" name="jiagong" lay-filter="jiagong" value="0" title="本店加工" checked="checked">
                        <input type="radio" name="jiagong" lay-filter="jiagong" value="1" title="其它加工中心加工">
                        <%}else{%>
                        <input type="radio" name="jiagong" lay-filter="jiagong" value="0" title="本店加工">
                        <input type="radio" name="jiagong" lay-filter="jiagong" value="1" title="其它加工中心加工" checked="checked">
                        <%}%>
                    </div>
                </div>
            </form>
        </div>
        <%if(list.processType==0){%>
        <div class="selectBox" id="jiagong">
        <%}else{%>
        <div class="selectBox active" id="jiagong">
        <%}%>
            <div class="select-box-header">
                <%if(list.processId){%>
                <span class="text">加工中心<%=list.processId%></span> <i class="iconfont icon-ico_arrow_down"></i>
                <%}else{%>
                <span class="text">选择加工中心</span> <i class="iconfont icon-ico_arrow_down"></i>
                <%}%>
            </div>
            <div class="optionBox">
                <ul class="optionUL">
                    <li value="1">加工中心1</li>
                    <li value="2">加工中心2</li>
                    <li value="3">加工中心3</li>
                    <li value="4">加工中心4</li>
                </ul>
            </div>
        </div>
    </div>
</script>
<script type="text/html" id="payTmp">
    <div class="head">
        <span class="active" onclick="payType(this,1)">微信支付</span>
        <span onclick="payType(this,2)">支付宝支付</span>
        <span class="layui-layer-title"></span>
    </div>
    <!--选择微信支付/个人微信-->
    <div class="selectPayment">
        <!--个人/共用微信-->
        <div class="mainContent active grWX">
            <!--<form class="layui-form" action="">
                <div class="layui-form-item optWxZfb">
                    <div class="layui-input-block">
                        <input type="radio" name="grWX" lay-filter="grWX" value="gy" title="公用微信" checked="">
                        <input type="radio" name="grWX" lay-filter="grWX" value="gr" title="个人微信">
                    </div>
                </div>
            </form>-->
            <div class="wxNum">
                <span>微信合作伙伴帐号</span>
                <input type="text" id="wxAppid" value="<%=list.wxAppid%>" placeholder="输入微信合作伙伴帐号">
                <!--<textarea class="form-control" ></textarea>-->
            </div>
            <div class="wxNum">
                <span>微信合作伙伴应用ID</span>
                <input type="text" id="wxMerchantId"  value="<%=list.wxMerchantId%>" placeholder="输入微信合作伙伴应用ID">
            </div>
            <div class="wxNum">
                <span>微信私钥</span>
                <textarea type="text" id="wxApiKey" value="<%=list.wxApiKey%>" placeholder="输入微信私钥"></textarea>
            </div>
            <div class="wxNum">
                <span>微信公钥证书名</span>
                <input type="text" id="wxPkcs12CertificateName" value="<%=list.wxPkcs12CertificateName%>" placeholder="输入微信公钥证书名">
            </div>
            <div class="wxNum">
                <span>微信订单通知路径</span>
                <input type="text" id="wxOrderNotifyUrl" value="<%=list.wxOrderNotifyUrl%>" placeholder="输入微信订单通知路径">
            </div>

            <!--                <form class="layui-form stateBox" action="">
                                <div class="layui-form-item " style="margin: 0;">
                                    <label class="layui-form-label">状态</label>
                                    <div class="layui-input-block">
                                        <input type="radio" name="grWXnum" value="open" title="启用" checked="">
                                        <input type="radio" name="grWXnum" value="close" title="禁用">
                                    </div>
                                </div>
                            </form>
                            <span class="textDescribe">用户门店扫码支付，不需与公众号同一主体，如个体结算到个人账号</span>-->
        </div>
        <!--个人支付宝-->
        <div class="mainContent grZFB gyZFB">
            <!--<form class="layui-form" action="example">
                <div class="layui-form-item optWxZfb">
                    <div class="layui-input-block">
                        <input type="radio" name="grZFB" lay-filter="grZFB" value="gy" title="共用支付宝" checked="">
                        <input type="radio" name="grZFB" lay-filter="grZFB" value="gr" title="个人支付宝">
                    </div>
                </div>
            </form>-->
            <div class="zfbNum">
                <span>支付宝合作伙伴帐号</span>
                <input type="text" id="aliPid" value="<%=list.aliPid%>" placeholder="输入支付宝合作伙伴帐号">
            </div>
            <div class="zfbNum">
                <span>支付宝合作应用ID</span>
                <input type="text" id="aliAppid" value="<%=list.aliAppid%>" placeholder="输入支付宝合作应用ID">
            </div>
            <div class="zfbNum">
                <span>阿里私钥</span>
                <textarea type="text" id="aliPrivateKey" value="<%=list.aliPrivateKey%>" placeholder="输入阿里私钥"></textarea>
            </div>
            <div class="zfbNum">
                <span>阿里公钥</span>
                <textarea type="text" id="aliPublicKey" value="<%=list.aliPublicKey%>" placeholder="输入阿里私钥"></textarea>
            </div>
            <div class="zfbNum">
                <span>阿里回调地址</span>
                <input type="text" id="aliOrderNotifyUrl" value="<%=list.aliOrderNotifyUrl%>" placeholder="输入阿里回调地址">
            </div>

            <!--                <form class="layui-form stateBox" action="example">
                                <div class="layui-form-item " style="margin: 0;">
                                    <label class="layui-form-label">状态</label>
                                    <div class="layui-input-block">
                                        <input type="radio" name="grZFBnum" value="open" title="启用" checked="">
                                        <input type="radio" name="grZFBnum" value="close" title="禁用">
                                    </div>
                                </div>
                            </form>-->
        </div>
        <!--公用微信-->
        <!--            <div class="mainContent gyWX active" style="border-top: 1px  solid #ECECF4;">
                        <div class="wxNum">
                            <span>子商户号</span>
                            <input type="text" placeholder="子商户号">
                        </div>
                        <form class="layui-form stateBox" action="example">
                            <div class="layui-form-item " style="margin: 0;">
                                <label class="layui-form-label">单选框</label>
                                <div class="layui-input-block">
                                    <input type="radio" name="sex" value="启用" title="启用" checked="">
                                    <input type="radio" name="sex" value="禁用" title="禁用">
                                </div>
                            </div>
                        </form>
                        <span class="textDescribe">用于客户直接手机微信公众号内支付，需与公众号同一主体，如公司结算到对公账户</span>
                    </div>-->
        <!--底部提示-->
        <!--<div class="mainContent public active">
            <h4>已使用的门店</h4>
            <span class="textDescribe">杭州市西湖区湖滨银泰店，杭州市西湖区西溪印象城店，杭州市旗舰店</span>
        </div>-->
    </div>
</script>

<script type="text/html" id="selectTagTmp">
    <div class="select-box-header">
        <span class="text"><%=title%></span> <i class="iconfont icon-ico_arrow_down"></i>
    </div>
    <div class="optionBox">
        <ul class="optionUL">
            <%for(var i in list){%>
            <li value="<%=list[i].id%>"><%=list[i].name%></li>
            <%}%>
        </ul>
    </div>
</script>
<script>
    var sid = quakooUser.getUserInfo().psid;//企业/公司id
    var shopId = quakooDb.getItem('sel_ShopId');//门店id
    var searchType = 1;//搜索门店类型
    var areaJson = new areaJson();
    var oneArea = areaJson.oneList;//省数据

    var shopInfo = {};//门店信息
    var allShopData = {};// 所有门店信息

    $(function () {
        initPage();
    });

    function initPage() {
        selectTag($("#searchShopType"),function (ret) {
            searchType = ret.value;
        });
        getComInfo();                                 //获取当前公司信息
        getShopList();                                //获取当前企业下门店列表
        getPayList();                                //获取支付方式列表
    }
    function getPayList() {
        quakooData.ajaxGetData(config.getUrl_pay_getAllListBySub(),{subId:shopId,token:quakooUser.getUserInfo().token},function (ret) {
            $('#yj-table').bootstrapTable('destroy')
            $('#yj-table').bootstrapTable({
                data:ret.data,
                classes:"table",
                pagination:true,        //是否显示分页
                sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）
                pageNumber:1,                       //初始化加载第一页，默认第一页
                pageSize: 10,
                pageList: [5, 10, 15, 20],
                sortable: false,
                sortOrder: "asc",
                showColumns: true,
                strictSearch: true,
                locale: "zh-CN",
                paginationHAlign:"center",
                clickToSelect:true,
                paginationLoop:false,
                columns:[
                    {field: "id",width:"50", title: "ID", valign:"middle"},
                    {field: "wxAppid", width:"150",title: "微信合作伙伴帐号", valign:"middle"},
                    {field: "wxMerchantId", width:"150",title: "微信合作伙伴应用ID", valign:"middle"},
                    {field: "wxApiKey", width:"150",title: "微信私钥", valign:"middle"},
                    {field: "wxPkcs12CertificateName", width:"150",title: "微信公钥证书名", valign:"middle"},
                    {field: "wxOrderNotifyUrl", width:"150",title: "微信订单通知路径", valign:"middle"},
                    {field: "aliPid", width:"150",title: "支付宝合作伙伴帐号", valign:"middle"},
                    {field: "aliAppid", width:"150",title: "支付宝合作应用ID", valign:"middle"},
                    {field: "aliPrivateKey", width:"150",title: "阿里私钥", valign:"middle"},
                    {field: "aliPublicKey", width:"150",title: "阿里公钥", valign:"middle"},
                    {field: "aliOrderNotifyUrl", width:"150",title: "阿里回调地址", valign:"middle"},
                    {field: "", title: "操作",width:"70", valign:"middle",formatter: function (value, row, index) {
                            return '<button class="btn btn-info" type="button" onclick=\'setPay('+JSON.stringify(row)+')\'>编辑</button>';
                        }},
                ],
            });
        })

    }

    /**接口——获取当前公司信息*/
    function getComInfo() {
        quakooData.ajaxGetData(config.getUrl_subordinate_getSubordinate(), {sid: sid}, function (ret) {
            if (ret && ret.success) {
                if (quakooUtils.isNotBlack(ret.data)) {
                    for (var i = 0; i < ret.data.length; i++) {
                        var obj = quakooImg.processImg(ret.data[i].icon, 60, 60);
                        ret.data[i].iconUrl = obj.url;
                        ret.data[i].style = obj.style;
                    }
                    var data = {list: ret.data[0]};
                    var html = template("comInfoList", data);
                    document.getElementById("comInfo").innerHTML = html;
                }
            }
        })
    }

    /**接口——获取当前企业下门店列表*/
    function getShopList() {
        quakooData.ajaxGetData(config.getUrl_subordinate_getSubordinateStore(), {sid: sid}, function (ret) {
            console.log("门店列表信息：", ret);
            if (ret && ret.success) {
                if (quakooUtils.isNotBlack(ret.data)) {
                    for(var i=0;i<ret.data.length;i++){
                        allShopData[ret.data[i].id] = ret.data[i]
                    }
                    var data = {list: ret.data};
                    var html = template("shopList", data);
                    document.getElementById("shopUl").innerHTML = html;
                    $(".switch-btn").click(function () {
                        var $dom = $(this).parent(".switch");
                        var id = $dom.attr("attr-id");
                        var status = $dom.attr("attr-status");
                        quakooData.ajaxGetData(config.getUrl_subordinate_updateOpen(), {
                            id: id,
                            status: status
                        }, function (ret) {
                            if (ret && ret.success) {
                                $dom.toggleClass('active');
                                if (status == 1) {
                                    $dom.attr("attr-status", 0);
                                    $dom.find(".shopOn").removeClass("shopOn").addClass("shopOff").html("未开启");
                                    layer.msg("门店已关闭", {icon: 1})
                                } else if (status == 0) {
                                    $dom.attr("attr-status", 1);
                                    $dom.find(".shopOff").removeClass("shopOff").addClass("shopOn").html("已启用");
                                    layer.msg("门店已启用", {icon: 1})
                                }

                            }
                        });
                    })
                }
            }
        })
    }

    /**接口——根据名称搜索门店*/
    function searchShop() {
        if(searchType == 1){
            var searchContext = document.getElementById('searchShop').value;
            if (quakooUtils.isBlack(searchContext)) {
                layer.msg("请输入门店名称");
                getShopList();
                return;
            }
            var param = {};
            param.sid = sid;
            param.name = searchContext;
            quakooData.ajaxGetData(config.getUrl_subordinate_getSubordinateStoreByName(),param,function (ret) {
                console.log("门店搜索",ret);
                //和门店列表接口相同
                if (ret && ret.success) {
                    if (quakooUtils.isNotBlack(ret.data)) {
                        var data = {list: ret.data};
                        var html = template("shopList", data);
                        document.getElementById("shopUl").innerHTML = html;
                        $(".switch-btn").click(function () {
                            var $dom = $(this).parent(".switch");
                            var id = $dom.attr("attr-id");
                            var status = $dom.attr("attr-status");
                            quakooData.ajaxGetData(config.getUrl_subordinate_updateOpen(), {
                                id: id,
                                status: status
                            }, function (ret) {
                                if (ret && ret.success) {
                                    $dom.toggleClass('active');
                                    if (status == 1) {
                                        $dom.attr("attr-status", 0);
                                        $dom.find(".shopOn").removeClass("shopOn").addClass("shopOff").html("未开启");
                                        layer.msg("门店已关闭", {icon: 1})
                                    } else if (status == 0) {
                                        $dom.attr("attr-status", 1);
                                        $dom.find(".shopOff").removeClass("shopOff").addClass("shopOn").html("已启用");
                                        layer.msg("门店已启用", {icon: 1})
                                    }

                                }
                            });
                        })
                    }
                }
            })
        }else if(searchType == 2){

        }
    }

    /**接口——开启关闭门店*/
    function updataOpen(id, status) {
        quakooData.ajaxGetData(config.getUrl_subordinate_updateOpen(), {id: id, status: status}, function (data) {
            console.log(data);
        })
    }

    /**接口——企业下创建门店*/
    function createShop(id,index) {
        var param = {};
        if(id){
            param.pid = sid;
            param.id = id;
            param.payType = shopInfo.payType;
            param.processType = shopInfo.processType;
            param.storedType = shopInfo.storedType;
            param.province = shopInfo.province;
            param.city = shopInfo.city;
            param.area = shopInfo.area;
            param.processId = shopInfo.processId;
        }else{
            param.id = sid;
        }
        param.name = $("#name").val();
        param.storeCode = $("#storeCode").val();
        param.phone = $("#phone").val();
        param.storeImgJson = [];                  //门店照片
        for(var i=0;i<$('#imgBox .imgBox').length;i++){
            param.storeImgJson.push($('#imgBox .imgBox').eq(i).find('img').attr('real-src'))
        }
        param.storeImgJson = JSON.stringify(param.storeImgJson);
        param.address = $("#address").val();
        if($("#startTime").val()){
            param.startTime = $("#startTime").val();
        }else{
            if($("#startTime").attr('placeholder').indexOf(':')>=0){
                param.startTime = $("#startTime").attr('placeholder');
            }
        }
        if($("#endTime").val()){
            param.endTime = $("#endTime").val();
        }else{
            if($("#endTime").attr('placeholder').indexOf(':')>=0){
                param.endTime = $("#endTime").attr('placeholder');
            }
        }
        param.threePolicy = $("#threePolicy").val();

        var url = '';
        var str = '';
        if(id){
            url = config.getUrl_subordinate_updateSubordinateStore()
            str = '修改成功'
        }else{
            url = config.getUrl_subordinate_addSubordinateStore()
            str = '添加成功'
        }
        quakooData.ajaxGetData(url, param, function (ret) {
            if(ret.success){
                layer.msg(str,{icon: 1})
                layer.close(index)
                getShopList()
            }else{
                layer.msg(ret.data,{icon: 2})
            }
        })
    }

    //头部切换
    $(".tab-ul li").click(function () {
        $(this).addClass('active').siblings().removeClass('active')
        $(".shopBox").eq($(this).index()).show().siblings('.shopBox').hide()
        $(".headRight").eq($(this).index()).show().siblings('.headRight').hide()
    });


    //设置支付方式弹窗
    function creatShop() {
        layer.open({
            type: 1,
            shade: 0.01,
            title: '设置支付方式',
            skin: 'content-view-creatShop-tan', //样式类名
            anim: 0,
            area: ['240px', 'auto'],
            closeBtn: 0, //不显示关闭按钮
            resize: false,
            shadeClose: true, //开启遮罩关闭
            content: $('.content-view-creatShop'), //容器对象
            btn: ['取消', '设置'],
            yes: function (index) {
                layer.close(index);
            },
            btn2: function (index) {
                setPay();
            },
            success: function (layero, index) {
                // payTypeSwitch();
            }
        });
    }

    //支付方式切换
    function payType(el, type) {
        //公众微信
        if (type == 1) {
            $(el).addClass('active').siblings().removeClass('active');
            $('.selectPayment .grWX,.selectPayment .gyWX').addClass('active')
            $('.selectPayment .grZFB').removeClass('active')
            if ($("input[name='grWX']:checked").val() == 'gy') {
                $('.selectPayment .public').addClass('active')
                $('.selectPayment .gyWX').addClass('active')
//                $('.selectPayment .grWX').find('.wxNum').find('span').html('商户号')
                $('.selectPayment .grWX').find('.textDescribe').show()
            } else {
                $('.selectPayment .public').removeClass('active')
                $('.selectPayment .gyWX').removeClass('active')
//                $('.selectPayment .grWX ').find('.wxNum').find('span').html('个人收款微信号')
                $('.selectPayment .grWX').find('.textDescribe').hide()
            }
        }
        //公众支付宝
        if (type == 2) {
            $(el).addClass('active').siblings().removeClass('active');
            $('.selectPayment .grZFB').addClass('active');
            $('.selectPayment .grWX,.selectPayment .gyWX').removeClass('active')
            if ($("input[name='grZFB']:checked").val() == 'gy') {
                $('.selectPayment .public').addClass('active')
//                $('.selectPayment .grZFB ').find('.zfbNum').find('span').html('商户号')
            } else {
                $('.selectPayment .public').removeClass('active')
//                $('.selectPayment .grZFB ').find('.zfbNum').find('span').html('个人收款支付宝账号')
            }
        }
    }

    //公众个人切换
    function payTypeSwitch() {
        form.on('radio(grWX)', function (data) {
            if (data.value == 'gy') {
                $('.selectPayment .public').addClass('active')
                $('.selectPayment .gyWX').addClass('active')
//                $('.selectPayment .grWX').find('.wxNum').find('span').html('商户号')
                $('.selectPayment .grWX').find('.textDescribe').show()
            } else if (data.value == 'gr') {
                $('.selectPayment .public').removeClass('active')
                $('.selectPayment .gyWX').removeClass('active')
//                $('.selectPayment .grWX ').find('.wxNum').find('span').html('个人收款微信号')
                $('.selectPayment .grWX').find('.textDescribe').hide()
            }
        });
        form.on('radio(grZFB)', function (data) {
            if (data.value == 'gy') {
                $('.selectPayment .public').addClass('active')
//                $('.selectPayment .grZFB ').find('.zfbNum').find('span').html('商户号')
            } else if (data.value == 'gr') {
                $('.selectPayment .public').removeClass('active')
//                $('.selectPayment .grZFB ').find('.zfbNum').find('span').html('个人收款支付宝账号')
            }
        });
    }

    //设置支付方式弹窗
    function setPay(data) {
        var list = {}
        if(data){
            list = data;
        }else{
            list.wxAppid = '';
            list.wxMerchantId = '';
            list.wxApiKey = '';
            list.wxPkcs12CertificateName = '';
            list.wxOrderNotifyUrl = '';
            list.aliPid = '';
            list.aliAppid = '';
            list.aliPrivateKey = '';
            list.aliPublicKey = '';
            list.aliOrderNotifyUrl = '';
        }
        layer.open({
            type: 1,
            shade: 0.01,
            title: false,
            skin: 'content-view-setPay-tan content-view-submit', //样式类名
            anim: 0,
            area: ['370px', '460px'],
            closeBtn: 0, //不显示关闭按钮
            resize: false,
            shadeClose: true, //开启遮罩关闭
            content: $('.content-view-setPay'), //容器对象
            btn: ['确定', '取消'],
            yes: function (index) {
                var params = {status:0,subId:shopId};
                var wxAppid = $("#wxAppid").val();
                var wxMerchantId = $("#wxMerchantId").val();
                var wxApiKey = $("#wxApiKey").val();
                var wxPkcs12CertificateName = $("#wxPkcs12CertificateName").val();
                var wxOrderNotifyUrl = $("#wxOrderNotifyUrl").val();

                var aliPid = $("#aliPid").val();
                var aliAppid = $("#aliAppid").val();
                var aliPrivateKey = $("#aliPrivateKey").val();
                var aliPublicKey = $("#aliPublicKey").val();
                var aliOrderNotifyUrl = $("#aliOrderNotifyUrl").val();
                var tipFlag = true;
                if(wxAppid && wxMerchantId && wxApiKey && wxPkcs12CertificateName && wxOrderNotifyUrl){
                    params.wxAppid = wxAppid;
                    params.wxMerchantId = wxMerchantId;
                    params.wxApiKey = wxApiKey;
                    params.wxPkcs12CertificateName = wxPkcs12CertificateName;
                    params.wxOrderNotifyUrl = wxOrderNotifyUrl;
                    tipFlag = false;
                }
                if(aliPid && aliAppid && aliPrivateKey && aliPublicKey && aliOrderNotifyUrl){
                    params.aliPid = aliPid;
                    params.aliAppid = aliAppid;
                    params.aliPrivateKey = aliPrivateKey;
                    params.aliPublicKey = aliPublicKey;
                    params.aliOrderNotifyUrl = aliOrderNotifyUrl;
                }else{
                    if(tipFlag){
                        layer.msg('请完善相关信息');
                        return
                    }
                }
                if(data){
                    params.id = data.id;
                    quakooData.ajaxGetData(config.getUrl_pay_updatePay(),params,function (ret) {
                        if(ret.success){
                            layer.msg('修改成功',{icon: 1})
                            layer.close(index)
                            getPayList()
                        }else{
                            layer.msg(ret.data,{icon: 2})
                        }
                    })
                }else{
                    quakooData.ajaxGetData(config.getUrl_pay_addPay(),params,function (ret) {
                        if(ret.success){
                            layer.msg('添加成功',{icon: 1})
                            layer.close(index)
                            getPayList()
                        }else{
                            layer.msg(ret.data,{icon: 2})
                        }
                    })
                }
            },
            btn2: function (index) {},
            success: function (layero, index) {
                $('.content-view-setPay-tan .layui-layer-content').height(415);
                $("#payDom").html(template('payTmp',{list:list}))
            }
        });
    }

    //创建门店弹窗
    function shopDes(id) {
        shopInfo = {};
        if(id){
            for(var i in allShopData[id]){
                shopInfo[i] = allShopData[id][i]
            }
        }else{
            shopInfo.payType = 1;
            shopInfo.processType = 0;
            shopInfo.storedType = 0;
        }

        layer.open({
            type: 1,
            shade: 0.01,
            title: '创建门店',
            skin: 'content-view-shopDes-tan content-view-submit', //样式类名
            anim: 0,
            area: ['370px', '550px'],
            closeBtn: 0, //不显示关闭按钮
            resize: false,
            shadeClose: true, //开启遮罩关闭
            content: $('.content-view-shopDes'), //容器对象
            btn: ['取消', '保存'],
            yes: function (index) {
                layer.close(index);
            },
            btn2: function (index) {
                createShop(id,index)
                return false
            },
            success: function (layero, index) {
                if(areaJson.getAreaByAid(shopInfo.province)){
                    shopInfo.provinceName = areaJson.getAreaByAid(shopInfo.province).name
                }
                if(areaJson.getAreaByAid(shopInfo.city)){
                    shopInfo.cityName = areaJson.getAreaByAid(shopInfo.city).name
                }
                if(areaJson.getAreaByAid(shopInfo.area)){
                    shopInfo.areaName = areaJson.getAreaByAid(shopInfo.area).name
                }
                $("#shopDom").html(template('shopTmp',{list:shopInfo,oneArea:oneArea}))
                // mapInit()
                //选择省市区
                selectTag($("#province"), function (ret) {
                    shopInfo.province = ret.value;
                    shopInfo.city = '';
                    shopInfo.area = '';
                    var areaInfo = areaJson.getSubList(ret.value);
                    $("#city").html(template('selectTagTmp',{list:areaInfo,title:'选择市'}))
                    $("#area").html('')
                    selectTag($("#city"), function (ret1) {
                        shopInfo.city = ret1.value;
                        shopInfo.area = '';
                        var area = areaJson.getSubList(ret1.value);
                        $("#area").html(template('selectTagTmp',{list:area,title:'选择区/县'}))
                        selectTag($("#area"), function (ret2) {
                            shopInfo.area = ret2.value;
                        })
                    })
                })
                //
                selectTag($("#payType"), function (ret) {/*console.log(ret)*/
                    shopInfo.payType = ret.value
                })
                selectTag($("#jiagong"), function (ret) {/*console.log(ret)*/
                    shopInfo.processId = ret.value
                })
                layui.use('form', function () {
                    var form = layui.form;
                    form.render()
                    form.on('radio(jiagong)', function (data) {
                        shopInfo.processType = data.value;
                        if (data.value == '0') {
                            $('#jiagong').removeClass('active')
                        } else {
                            $('#jiagong').addClass('active')
                        }
                    });
                    form.on('radio(chuzhi)', function (data) {
                        shopInfo.storedType = data.value;
                    });
                })

                //营业时间
                var opt = {};
                opt.date = {preset: 'date'};
                opt.datetime = {preset: 'datetime'};
                opt.time = {preset: 'time'};

                opt.default = {
                    theme: 'mbsc-android-holo', //皮肤样式
                    display: 'bubble', //显示方式
                    mode: 'scroller', //日期选择模式
                    dateFormat: 'yyyy-mm-dd',
                    lang: 'zh',
                    showNow: true,
                    nowText: "今天",
                    typeNum: 'branch',//day：获取到日，time：获取到时，branch：获取到分；默认是获取到分
                };
                $('.settings').bind('change', function () {
                    var demo = 'datetime';
                    if (!demo.match(/select/i)) {
                        $('.demo-test-' + demo).val('');
                    }
                    $('.demo-test-' + demo).scroller('destroy').scroller($.extend(opt['datetime'], opt['default']));
                    $('.demo').hide();
                    $('.demo-' + demo).show();
                });
                $('#demo01').trigger('change');
                $('#demo02').trigger('change');

            }
        });
    }




    //上传门店图片
    function uploadImg(self) {
        quakooImg.open(function (data) {
            var obj = quakooImg.processImg(data.ok,100,100)
            var str = '<div class="imgBox"><img src="'+obj.url+'" real-src="'+data.ok+'" style="'+obj.style+'" alt=""></div>'
            $(self).before(str)
            if($(self).prevAll('.imgBox').length>=3){
                $(self).hide();
            }
        })
    }

    function mapInit() {
        //创建地图函数：
        var map = new BMap.Map("mapDiv");//在百度地图容器中创建一个地图
        var point = new BMap.Point(110.355538, 20.025802);//定义一个中心点坐标
        map.centerAndZoom(point, 7);//设定地图的中心点和坐标并将地图显示在地图容器中
        window.map = map;//将map变量存储在全局

        //地图事件设置函数：
        function setMapEvent() {
            map.enableDragging();//启用地图拖拽事件，默认启用(可不写)
            map.enableScrollWheelZoom();//启用地图滚轮放大缩小
            map.enableDoubleClickZoom();//启用鼠标双击放大，默认启用(可不写)
            map.enableKeyboard();//启用键盘上下左右键移动地图
        }

        //地图控件添加函数：
        function addMapControl() {
            //向地图中添加缩放控件
            var ctrl_nav = new BMap.NavigationControl({
                anchor: BMAP_ANCHOR_TOP_LEFT,
                type: BMAP_NAVIGATION_CONTROL_LARGE
            });
            // map.addControl(ctrl_nav);
            //向地图中添加缩略图控件
            var ctrl_ove = new BMap.OverviewMapControl({anchor: BMAP_ANCHOR_BOTTOM_RIGHT, isOpen: 1});
            // map.addControl(ctrl_ove);
            //向地图中添加比例尺控件
            var ctrl_sca = new BMap.ScaleControl({anchor: BMAP_ANCHOR_BOTTOM_LEFT});
            // map.addControl(ctrl_sca);
        }

        setMapEvent();//设置地图事件
        addMapControl();//向地图添加控件
    }

</script>
</body>
</html>
